(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{221:function(e,n,s){"use strict";s.r(n);var t=s(0),a=Object(t.a)({},(function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("p",[s("a",{attrs:{href:"/docs/software"}},[e._v("回目录")]),e._v("  《mysql实用基础》")]),e._v(" "),s("h2",{attrs:{id:"_1-setup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-setup"}},[e._v("#")]),e._v(" 1.Setup")]),e._v(" "),s("h3",{attrs:{id:"_1-1-install-on-centos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-install-on-centos"}},[e._v("#")]),e._v(" 1.1 Install on centos")]),e._v(" "),s("p",[s("strong",[e._v("Using rpm")])]),e._v(" "),s("p",[s("strong",[e._v("Using tar")])]),e._v(" "),s("p",[e._v("tar -xvf mysql-5.7.26-1.el7.x86_64.rpm-bundle.tar\nyum install mysql-community-{server,client,common,libs}-* mysql-5.*­")]),e._v(" "),s("p",[e._v("?#Install error\nhttps://princetonits.com/centos7-mysql-install-fails-due-conflict-libmysqlclient/\nyum list installed mariadb*\nyum remove mariadb-libs.x86_64")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("vim /etc/my.cnf\nBind-address:0.0.0.0\nservice mysqld stop/start\n")])])]),s("p",[e._v("Mysql default password\n/var/log/mysqld.log\nA temporary password\nhttps://www.techietown.info/2017/08/mysql-default-root-password-on-centos7/")]),e._v(" "),s("p",[e._v("password policy:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("mysql -uroot -p\nSET PASSWORD = PASSWORD(‘1qaz#EDC’);\nSHOW VARIABLES LIKE 'validate_password%';\nSET GLOBAL validate_password_length = 6;\nSET GLOBAL validate_password_number_count = 0;\nSET PASSWORD = PASSWORD(‘123456’);\n")])])]),s("p",[e._v("create database:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("CREATE USER 'newuser'@'%' IDENTIFIED BY 'password';\nGRANT ALL PRIVILEGES ON dbname.* TO 'newuser'@'%' identified by 'password';\n#GRANT ALL PRIVILEGES ON *.* TO 'newuser'@'localhost';\nFLUSH PRIVILEGES;\n\nSHOW GRANTS FOR 'root'@'localhost';\nSELECT user, host FROM mysql.user;\nDROP USER ''@'localhost';\n\ncreate database dbname;\n\n")])])]),s("h3",{attrs:{id:"_1-2-install-on-windows"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-install-on-windows"}},[e._v("#")]),e._v(" 1.2 Install on windows")]),e._v(" "),s("p",[s("img",{attrs:{src:"/docs/docs_image/software/mysql/mysql01.png",alt:""}})]),e._v(" "),s("p",[e._v("Setup replication\nhttps://lyhistory.com/mysql_replication/#")]),e._v(" "),s("h3",{attrs:{id:"_1-3-tool"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-tool"}},[e._v("#")]),e._v(" 1.3 Tool")]),e._v(" "),s("p",[e._v("http://sqlfiddle.com/")]),e._v(" "),s("p",[e._v("Dbeaver export mysql\nExport without data https://github.com/dbeaver/dbeaver/issues/2176")]),e._v(" "),s("h2",{attrs:{id:"_2-common-sql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-common-sql"}},[e._v("#")]),e._v(" 2. Common SQL")]),e._v(" "),s("p",[e._v("a mysql db can have many schema,like a building have many rooms, and users can get access to different room, so schema can have more than one user.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("SELECT DATE_FORMAT(date_add(date_column,INTERVAL 8 HOUR),'%b %d %Y %h %p'),COUNT(distinct(count_column))\nFROM db.table\nwhere date_add(date_column,INTERVAL 8 HOUR) between '2015-02-01 00:00:00' and '2015-03-01 00:00:00'\nGROUP BY DATE_FORMAT(date_column,'%b %d %Y %h %p')\norder by DATE_FORMAT(date_add(date_column,INTERVAL 8 HOUR),'%b %d %Y %h %p');\n")])])]),s("p",[e._v("CRUD")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("insert into phoenix.`program-slot`(duration,dateOfProgram,startTime,`weekly-schedule_id`,presenter_id,producer_id,program_id)\nselect duration,date_add(dateOfProgram,INTERVAL 2 DAY), IFNULL(date_add(startTime,INTERVAL 2 DAY),null) ,100,presenter_id,producer_id,program_id from phoenix.`program-slot` where `weekly-schedule_id` =3;\n\n")])])]),s("p",[e._v("Performance on index : when join a large table")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("bad:\nselect user.*, log.LoginTime\nfrom users user\nleft join login_log log on user.id=log.userid and log.LoginTime=(select max(LoginTime) from login_log where userid=log.userid and status='true');\ngood:\nselect user.*, log.LoginTime\nfrom users user\nleft join (\nselect max(LoginTime) LoginTime,userid from login_log\nwhere  status='true'\ngroup by userid) temp on temp.userid=user.userid;\n")])])]),s("p",[e._v("存储过程互相调用")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("DELIMITER $$\nCREATE DEFINER=`dbuser`@`%` PROCEDURE `PROCE1`(\nin _param varchar(50)\n)\nroot:BEGIN\ndeclare _count int;\nselect count(1) into _count from table where column=_param;\nif _count<>1 then\nselect -1 as result;\nleave root;\nend if;\ncall PROCE2(_param);\ndo something else\nselect 0 as result;\nEND\n\nDELIMITER $$\nCREATE DEFINER=`dbuser`@`%` PROCEDURE `PROCE2`(\nin _param int\n)\nBEGIN\nDECLARE done INT DEFAULT FALSE;\ndeclare _variable1 int;\ndeclare _variable2 decimal(10,2);\ndeclare resultCur cursor for select column1,column2 from table where column=_param;\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;\nDECLARE exit handler for sqlexception\nBEGIN\nROLLBACK;\nget diagnostics condition 1 @p1 = MESSAGE_TEXT;\nselect -1 as result, @p1 as message from dual;\nEND;\nopen resultCur;\noperaLoop:Loop\nfetch resultCur into _variable1,_variable2;\nif done then\nleave operaLoop;\nend if;\ndo something...\nend Loop;\nclose resultCur;\nEND\n\n")])])]),s("p",[e._v("Multiple cursors in mysql stored procedure")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('DROP PROCEDURE IF EXISTS `multipleCursorsAtOne`;\nDELIMITER $$\nCREATE PROCEDURE `multipleCursorsAtOne`()\nBEGIN\nDROP TABLE IF EXISTS userNames;\nCREATE TEMPORARY TABLE userNames\n(userName varchar(200) NOT NULL);\nBEGIN\nDECLARE done BOOLEAN DEFAULT false;\nDECLARE p_first_name VARCHAR(200);\nDECLARE cursor_a CURSOR FOR SELECT user_name FROM user_info LIMIT 1,3;\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;\nOPEN cursor_a;\ncursor_a_loop: LOOP\nFETCH cursor_a INTO p_first_name;\nIF done THEN\nLEAVE cursor_a_loop;\nEND IF;\n-- cursor loop statements\nIF p_first_name IS NOT NULL AND p_first_name <> "" THEN\nINSERT INTO userNames(userName) VALUES(p_first_name);\nEND IF;\nEND LOOP;\nCLOSE cursor_a;\nEND;\nBEGIN\nDECLARE done BOOLEAN DEFAULT false;\nDECLARE p_first_name VARCHAR(200);\nDECLARE cursor_a CURSOR FOR SELECT user_name FROM user_info LIMIT 4,3;\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;\nOPEN cursor_a;\ncursor_a_loop: LOOP\nFETCH cursor_a INTO p_first_name;\nIF done THEN\nLEAVE cursor_a_loop;\nEND IF;\n-- cursor loop statements\nIF p_first_name IS NOT NULL AND p_first_name <> "" THEN\nINSERT INTO userNames(userName) VALUES(p_first_name);\nEND IF;\nEND LOOP;\nCLOSE cursor_a;\nEND;\nSELECT * FROM userNames;\nEND\n$$\n\n')])])]),s("h2",{attrs:{id:"_3-troubleshooting"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-troubleshooting"}},[e._v("#")]),e._v(" 3.Troubleshooting")]),e._v(" "),s("p",[e._v("#Host 'xxx.xx.xxx.xxx' is not allowed to connect to this MySQL server")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("CREATE USER 'test'@'%' IDENTIFIED BY '123456';\nGRANT ALL PRIVILEGES ON * . * TO 'test'@'%';\nFLUSH PRIVILEGES;\n")])])]),s("p",[e._v("mysql workbench The type initializer for 'HtmlRenderer.Utils.FontsUtils' threw an exception.\nhttp://stackoverflow.com/questions/32020024/upgrading-to-windows-10-breaks-mysql-workbench\nhttps://bugs.mysql.com/bug.php?id=75344")]),e._v(" "),s("p",[e._v("script import issue;\ndelimiter http://buysql.com/mysql/42-delimiter-mysql.html\n-- Set new delimiter '$$'\nDELIMITER $$\n$$\n-- Set default delimiter ';'\nDELIMITER ;\nRecursive query\nHierarchical data in MySQL: parents and children in one query\nManaging Hierarchical Data in MySQL")]),e._v(" "),s("hr"),e._v(" "),s("p",[e._v("ref:")]),e._v(" "),s("p",[e._v("https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-centos-7")])])}),[],!1,null,null,null);n.default=a.exports}}]);