(window.webpackJsonp=window.webpackJsonp||[]).push([[208],{637:function(e,t,n){"use strict";n.r(t);var s=n(65),a=Object(s.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("p",[n("a",{attrs:{href:"/docs/software"}},[e._v("ÂõûÁõÆÂΩï")]),e._v("  „ÄämysqlÂÆûÁî®Âü∫Á°Ä„Äã")]),e._v(" "),n("h2",{attrs:{id:"_0-knowledge-base"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_0-knowledge-base"}},[e._v("#")]),e._v(" 0. Knowledge Base")]),e._v(" "),n("p",[e._v("default storage engine: "),n("strong",[e._v("InnoDB")])]),e._v(" "),n("p",[e._v("https://dev.mysql.com/doc/refman/5.6/en/innodb-introduction.html")]),e._v(" "),n("p",[e._v("other engine:")]),e._v(" "),n("p",[n("strong",[e._v("MyISAM")]),e._v(": https://kinsta.com/knowledgebase/convert-myisam-to-innodb/")]),e._v(" "),n("p",[n("strong",[e._v("ndb")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("mysqlshow -uroot -pP@ssw0rd -i DBNAME;\n")])])]),n("h2",{attrs:{id:"_1-setup"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-setup"}},[e._v("#")]),e._v(" 1.Setup")]),e._v(" "),n("h3",{attrs:{id:"_1-1-install-on-centos"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-install-on-centos"}},[e._v("#")]),e._v(" 1.1 Install on centos")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://dev.mysql.com/doc/mysql-installation-excerpt/8.0/en/linux-installation-rpm.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Installing MySQL on Linux Using RPM Packages from Oracle"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("strong",[e._v("Method 1: Using rpm")])]),e._v(" "),n("p",[n("strong",[e._v("Method 2: Using tar")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("tar -xvf mysql-5.7.26-1.el7.x86_64.rpm-bundle.tar\n‚Ä¢\tmysql-community-client-5.7.32-1.el7.x86_64.rpm\n‚Ä¢\tmysql-community-common-5.7.32-1.el7.x86_64.rpm\n‚Ä¢\tmysql-community-libs-5.7.32-1.el7.x86_64.rpm\n‚Ä¢\tmysql-community-libs-compat-5.7.32-1.el7.x86_64.rpm\n‚Ä¢\tmysql-community-server-5.7.32-1.el7.x86_64.rpm\n\n\nyum localinstall mysql-community-{server,client,common,libs}-* mysql-5.*¬≠\n\n?#Install error\nhttps://princetonits.com/centos7-mysql-install-fails-due-conflict-libmysqlclient/\nyum list installed mariadb\\*\nyum remove mariadb-libs.x86_64\n\nvim /etc/my.cnf\nBind-address:0.0.0.0\nservice mysqld stop/start\n")])])]),n("p",[e._v("MysqlÈªòËÆ§ÂØÜÁ†ÅÔºö\n/var/log/mysqld.log\nA temporary password\nhttps://www.techietown.info/2017/08/mysql-default-root-password-on-centos7/")]),e._v(" "),n("p",[e._v("password policy:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("mysql -uroot -p\nSET PASSWORD = PASSWORD(‚Äò1qaz#EDC‚Äô);\nSHOW VARIABLES LIKE 'validate_password%';\nSET GLOBAL validate_password_length = 6;\nSET GLOBAL validate_password_number_count = 0;\nSET PASSWORD = PASSWORD(‚Äò123456‚Äô);\n")])])]),n("p",[e._v("create database:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("CREATE USER 'newuser'@'%' IDENTIFIED BY 'password';\nGRANT ALL PRIVILEGES ON dbname.* TO 'newuser'@'%' identified by 'password';\n#GRANT ALL PRIVILEGES ON *.* TO 'newuser'@'localhost';\nFLUSH PRIVILEGES;\n\nSHOW GRANTS FOR 'root'@'localhost';\nSELECT user, host FROM mysql.user;\nDROP USER ''@'localhost';\n\ncreate database dbname;\n\n")])])]),n("h3",{attrs:{id:"_1-2-install-on-windows"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-install-on-windows"}},[e._v("#")]),e._v(" 1.2 Install on windows")]),e._v(" "),n("p",[n("img",{attrs:{src:"/docs/docs_image/software/mysql/mysql01.png",alt:""}})]),e._v(" "),n("p",[e._v("Setup replication\nhttps://lyhistory.com/mysql_replication/#")]),e._v(" "),n("h3",{attrs:{id:"_1-3-client-tools"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-client-tools"}},[e._v("#")]),e._v(" 1.3 Client Tools")]),e._v(" "),n("p",[n("strong",[e._v("mysql built-in tools:")])]),e._v(" "),n("p",[e._v("mysql")]),e._v(" "),n("p",[e._v("mysqldump")]),e._v(" "),n("p",[e._v("mysqladmin")]),e._v(" "),n("p",[e._v("È™åËØÅÈÖçÁΩÆÔºö"),n("code",[e._v("mysqld --verbose --help | grep skip-slave-start")])]),e._v(" "),n("p",[e._v("mysqlbinlog:")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/66501464",target:"_blank",rel:"noopener noreferrer"}},[e._v("mysqlbinlogÂëΩ‰ª§ËØ¶Ëß£"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("--verbose\n--base64-output=DECODE-ROWS")]),e._v(" "),n("p",[e._v("https://dev.mysql.com/doc/refman/8.0/en/mysqlbinlog.html")]),e._v(" "),n("p",[e._v("https://www.zhihu.com/tardis/sogou/art/66501464")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("sudo mysqlbinlog --verbose --start-position=653218764 --stop-position=653263629 /var/lib/mysql/mysql-bin.000007 > check-mysql-bin.000007-14\n\n--verbose Âú®BINLOG '‰πãÂêéÊâìÂç∞sqlËØ≠Âè•\n")])])]),n("p",[n("strong",[e._v("3rd party:")])]),e._v(" "),n("p",[e._v("http://sqlfiddle.com/")]),e._v(" "),n("p",[e._v("Dbeaver export mysql\nExport without data https://github.com/dbeaver/dbeaver/issues/2176")]),e._v(" "),n("p",[e._v("mysql workbench")]),e._v(" "),n("ul",[n("li",[e._v("DBeaver\n"),n("strong",[e._v("offline install")]),e._v("\nsettings:\nclass name: com.mysql.cj.jdbc.Driver\ntemplate: jdbc:mysql://{host}:{port}/{database}\nlibraries: "),n("a",{attrs:{href:"https://dev.mysql.com/downloads/connector/j/",target:"_blank",rel:"noopener noreferrer"}},[e._v("add postgres drivers"),n("OutboundLink")],1)])]),e._v(" "),n("h2",{attrs:{id:"_2-db-management"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-db-management"}},[e._v("#")]),e._v(" 2. DB Management")]),e._v(" "),n("h3",{attrs:{id:"_2-1-mysql-cli"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-mysql-cli"}},[e._v("#")]),e._v(" 2.1 mysql-cli")]),e._v(" "),n("p",[e._v("vertical format:")]),e._v(" "),n("p",[e._v("mysql> select * from table limit 1 \\G;")]),e._v(" "),n("p",[e._v("ÂçÉ‰∏á‰∏çË¶ÅÁî®ÂèåÂºïÂè∑ÔºåÂ∞§ÂÖ∂ÊòØpasswordÔºåÊâÄÊúâÁöÑ-u -p -eÁ≠âÁ≠âÂêéÈù¢‰∏çË¶ÅÂä†Á©∫Ê†ºÔºÅ")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("mysql -uroot -p123456\nmysql --login-path=XXXX\n\n\nmysql_config_editor/login-path\nmysql_config_editor print --all\nmysql_config_editor set --login-path=host-rpl --host=localhost --port=3306 --user=replicator --password\n\nÊâæÂõûÂØÜÁ†Å:\nmy_print_defaults -s client (ÈúÄË¶ÅÂÆâË£Ömysql-server)\nÊàñËÄÖÂèØ‰ª•\ndecrypt ~/.mylogin.cnf\nhttps://github.com/PyMySQL/myloginpath\n")])])]),n("p",[e._v("grep:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("pager grep ***\n\\n\nhttps://stackoverflow.com/questions/10177465/grep-in-mysql-cli-interpretter\n")])])]),n("h3",{attrs:{id:"_2-2-database-management"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-database-management"}},[e._v("#")]),e._v(" 2.2 database management")]),e._v(" "),n("h4",{attrs:{id:"house-keeping-disk-space-var-lib-mysql"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#house-keeping-disk-space-var-lib-mysql"}},[e._v("#")]),e._v(" house keeping disk space /var/lib/mysql/")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("[ERROR] Disk is full writing './mysql-bin.000099' (Errcode: 16062400 - No space left on device). Waiting for someone to free space...\n")])])]),n("p",[n("strong",[e._v("expire_logs_days")]),e._v("\nThe number of days for automatic binary log file removal. The default is 0, which means ‚Äúno automatic removal.‚Äù Possible removals happen at startup and when the binary log is flushed. Log flushing occurs as indicated in Section 5.4, ‚ÄúMySQL Server Logs‚Äù.")]),e._v(" "),n("p",[e._v("To remove binary log files manually, use the PURGE BINARY LOGS statement. See Section 13.4.1.1, ‚ÄúPURGE BINARY LOGS Statement‚Äù.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("mysql> show variables like 'expire_logs_days';\n+------------------+-------+\n| Variable_name    | Value |\n+------------------+-------+\n| expire_logs_days | 0     |\n+------------------+-------+\n1 row in set (0.00 sec)\n\nmysql> show variables like 'max_binlog_size';\n+-----------------+------------+\n| Variable_name   | Value      |\n+-----------------+------------+\n| max_binlog_size | 1073741824 |\n+-----------------+------------+\n1 row in set (0.01 sec)\n\nFor the binary log, you can set the expire_logs_days system variable to expire binary log files automatically after a given number of days (see Section 5.1.7, ‚ÄúServer System Variables‚Äù). If you are using replication, you should set the variable no lower than the maximum number of days your replicas might lag behind the source. To remove binary logs on demand, use the PURGE BINARY LOGS statement (see Section 13.4.1.1, ‚ÄúPURGE BINARY LOGS Statement‚Äù).\n\nTo force MySQL to start using new log files, flush the logs. Log flushing occurs when you execute a FLUSH LOGS statement or a mysqladmin flush-logs, mysqladmin refresh, mysqldump --flush-logs, or mysqldump --master-data command. See Section 13.7.6.3, ‚ÄúFLUSH Statement‚Äù, Section 4.5.2, ‚Äúmysqladmin ‚Äî A MySQL Server Administration Program‚Äù, and Section 4.5.4, ‚Äúmysqldump ‚Äî A Database Backup Program‚Äù. In addition, the server flushes the binary log automatically when current binary log file size reaches the value of the max_binlog_size system variable.\n\n\nËá™Âä®Ê∏ÖÈô§Ôºö\n[mysqld]\nexpire_logs_days=7\n\n> flush logs\n\nÊâãÂä®Ê∏ÖÈô§Ôºö\nManually prune bin log:\nmysql>purge binary logs to 'bin.XXX';\n\nmysql>purge binary logs before '2022-01-01 23:59:59';\n\n")])])]),n("h4",{attrs:{id:"users-permissions"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#users-permissions"}},[e._v("#")]),e._v(" Users & Permissions")]),e._v(" "),n("p",[e._v("https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://stackoverflow.com/questions/11634084/are-users-user-and-userlocalhost-not-the-same",target:"_blank",rel:"noopener noreferrer"}},[e._v(" 'User'@'%' and 'User'@'localhost'"),n("OutboundLink")],1)]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("SELECT user,host FROM mysql.user;\n\nSHOW GRANTS FOR 'test'@'localhost';\nGRANT ALL PRIVILEGES ON *.* TO 'test'@'localhost' WITH GRANT OPTION;\nREVOKE ALL ON *.* FROM 'test'@'localhost';\nflush privileges;\n\nDROP USER 'test'@'localhost';\n")])])]),n("h4",{attrs:{id:"global-status"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#global-status"}},[e._v("#")]),e._v(" Global Status")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("show global variables like '%timeout'; \nshow variables like '%engine%';\nSHOW VARIABLES LIKE \"max_connections\";\nselect @@wait_timeout;\nshow variables like '%error%';\n\nshow global status like '%connection%';\nshow global status like '%errors%';\nshow global status like '%thread%';\nshow processlist;\n\nselect * from mysql.user;\n\nshow variables like \"%time_zone%\";\nshow processlist;\nselect substring_index(host,':' ,1) as client_ip,Command,Time from information_schema.processlist;\nshow variables like 'max_connections';\nSHOW GLOBAL STATUS LIKE \"Threads_connected\";\nshow variables like 'log_error';\n\nuse mysql;\nSHOW CREATE TABLE innodb_index_stats;\n")])])]),n("h4",{attrs:{id:"security-hardening"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#security-hardening"}},[e._v("#")]),e._v(" Security hardening")]),e._v(" "),n("p",[n("strong",[e._v("disable remote Access")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');\nFLUSH PRIVILEGES;\n\nmy.ini:\n[mysqld]\n.....\nskip-networking\n\nvim /etc/my.cnf\nBind-address:127.0.0.1\nservice mysqld stop/start\n")])])]),n("p",[n("strong",[e._v("turn off local_infile")])]),e._v(" "),n("p",[e._v("https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_local_infile\nhttps://dev.mysql.com/doc/refman/8.0/en/load-data-local-security.html")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("SHOW VARIABLES WHERE Variable_name = 'local_infile';\nSET GLOBAL local_infile = 'OFF';\n")])])]),n("p",[e._v("Â∫îËØ•‰∏ªË¶ÅÊòØÁ¶ÅÁî® select into lcoalfile, loaddata from localfile")]),e._v(" "),n("p",[n("strong",[e._v("disable log-raw")]),e._v("\nÊØîÂ¶Ç‰∏Ä‰∫õÊïèÊÑüÁöÑ statement Â¶ÇÊûú log-raw=ON Âàô‰ºöÊó•ÂøóËÆ∞‰∏ãoriginal statementÔºåÂê¶Âàô‰ºöËøõË°å‰∏ÄÂÆöÁöÑ‰øÆÊîπÊé©Áõñ")]),e._v(" "),n("p",[e._v("https://dev.mysql.com/doc/refman/5.7/en/server-options.html#option_mysqld_log-raw")]),e._v(" "),n("h4",{attrs:{id:"backup-restore"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#backup-restore"}},[e._v("#")]),e._v(" backup&restore")]),e._v(" "),n("p",[e._v("backup https://dev.mysql.com/doc/refman/5.7/en/mysqldump-sql-format.html")]),e._v(" "),n("p",[e._v("Âü∫Êú¨Áî®Ê≥ï")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("--------------------------------------------------------------\n--- all db\n--------------------------------------------------------------\nmysqldump -uroot -p123456 --all-databases > mysqldump_20190524.sql\n\nmysqldump -uroot -p123456 <dbname> > mysqldump_20190524.sql\n\n--------------------------------------------------------------\n--- schema only\n--------------------------------------------------------------\nmysqldump -uXXX -pXXX --no-tablespaces --routines --events --no-data --set-gtid-purged=OFF DBName > schema.sql\n\nmysql -uXXX -pXXX  DBName < schema.sql\n\n--------------------------------------------------------------\n--- options\n--------------------------------------------------------------\nIf you used the **‚Äìset-gtid-purged=ON** option, you would see the value of the [Global Transaction Identifier‚Äôs](http://dev.mysql.com/doc/refman/5.6/en/replication-gtids-concepts.html) (GTID‚Äôs):\n--\n--GTID state at the beginning of the backup \n--\n\nSET @@GLOBAL.GTID_PURGED='';\n\n-routines\nInclude stored routines (procedures and functions) \n")])])]),n("p",[e._v("ËÑöÊú¨Ôºö")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('-----------------------------------------------------------------\n--- db_backup.sh\n-----------------------------------------------------------------\n#!/bin/bash\n# Shell script to backup MySQL database\n\n# Set variables\nV_USER="root"\t# DB_USERNAME\nV_PASS="123456"\t# DB_PASSWORD\n\nV_DBS="db1\ndb2"\n\nV_DEST="/opt/backup/" # Backup Dest directory\nV_DAYS=365 # How many days old files must be to be removed\n\n# Linux bin paths\nMYSQL="$(which mysql)"\nMYSQLDUMP="$(which mysqldump)"\nGZIP="$(which gzip)"\n\n# Create Backup sub-directories\nNOW="$(date +"%Y%m%d")"\nMBD="$V_DEST/$NOW/mysql"\ninstall -d $MBD\n\n\n# Archive database dumps\nfor db in $V_DBS\ndo\n    FILE="$MBD/$db.sql"\n    echo "Start to backup $db ...."\n    $MYSQLDUMP -u$V_USER -p$V_PASS $db > $FILE\n    echo "Done!"\ndone\n\n# Archive the directory, send mail and cleanup\ncd $V_DEST\ntar -cf $NOW.tar $NOW\n$GZIP -9 $NOW.tar\n\necho "MySQL backup is completed! Backup name is $NOW.tar.gz"\n#echo "MySQL backup is completed! Backup name is $NOW.tar.gz" | mail -s "MySQL backup" $EMAIL\nrm -rf $NOW\n\n# Remove old files\nfind $V_DEST -mtime +$V_DAYS -exec rm -f {} \\;\n\n-----------------------------------------------------------------\n--- db_restore.sh\n-----------------------------------------------------------------\n#!/bin/bash - \n# Shell script to restore MySQL database\n\n# Set Variables\nV_USER="root"\nV_SOURCE="/opt/backup/"\n\nMYSQL="$(which mysql)"\nMYSQLADMIN="$(which mysqladmin)"\n\npushd ${V_SOURCE} &> /dev/null\n\nif [ $# -eq 0 ]\n  then\n    echo "Please speicifed the date, USAGE:./db_restore 20200101"\n    exit 0\nfi\n\n# Look for sql.gz files:\nif [ "$(ls -A $1.tar.gz 2> /dev/null)" ]  ; then\n  echo "sql.gz files found extracting..."\n  tar -zxvf $1.tar.gz\nelse\n  echo "target file $1.tar.gz not found in ${V_SOURCE}"\n  exit 0\nfi\npushd ${V_SOURCE}/$1/mysql &> /dev/null\n# Exit when folder doesn\'t have .sql files:\nif [ "$(ls -A *.sql 2> /dev/null | wc -l)" == 0 ]; then\n  echo "No *.sql files found in $(pwd)"\n  exit 0\nfi\n\n# Read mysql root password:\necho -n "Type mysql $V_USER password: "\nread -s V_PASS\necho ""\n\n\n# Get all database list first\nDBS="$($MYSQL -u$V_USER -p$V_PASS -Bse \'show databases\')"\n\n# Ignore list, won\'t restore the following list of DB:\nSKIP="db2"\n\n\n# Restore DBs:\nfor filename in *.sql\ndo\n  dbname=${filename%.sql}\n  \n  skipdb=-1\n  if [ "$SKIP" != "" ]; then\n    for ignore in $SKIP\n    do\n        [ "$dbname" == "$ignore" ] && skipdb=1 || :\n        \n    done\n  fi      \n\n  # If not in ignore list, restore:\n  if [ "$skipdb" == "-1" ] ; then\n  \n    skip_create=-1\n    for existing in $DBS\n    do      \n      [ "$dbname" == "$existing" ] && skip_create=1 || :\n    done\n  \n    if [ "$skip_create" ==  "1" ] ; then \n      echo "Database: $dbname already exist, skiping create"\n    else\n      echo "Creating DB: $dbname"\n      #mysqladmin create $dbname -u $V_USER -p$V_PASS\n    fi\n    \n    echo "Importing DB: $dbname from $filename"\n    #mysql $dbname < $filename -u $V_USER -p$V_PASS\n  fi    \ndone\n\n')])])]),n("h4",{attrs:{id:"upgrade"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#upgrade"}},[e._v("#")]),e._v(" upgrade")]),e._v(" "),n("p",[e._v("EXAMPLE: from 5.7.18 to 5.7.26")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('SHOW VARIABLES WHERE Variable_name LIKE "version";\n\nhttps://dev.mysql.com/doc/refman/5.7/en/upgrading.html\nyum list installed | grep "^mysql"\n\n$ yum list installed | grep "^mysql"\nRepodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast\nmysql-community-client.x86_64         5.7.18-1.el7                @/mysql-community-client-5.7.18-1.el7.x86_64\nmysql-community-common.x86_64         5.7.18-1.el7                @/mysql-community-common-5.7.18-1.el7.x86_64\nmysql-community-libs.x86_64           5.7.18-1.el7                @/mysql-community-libs-5.7.18-1.el7.x86_64\nmysql-community-server.x86_64         5.7.18-1.el7                @/mysql-community-server-5.7.18-1.el7.x86_64\n\n$ find / -name "mysql" -o -name "mysqld" -type f -print 2>/dev/null\n/usr/sbin/mysqld\n$ find / -name "mysql" -type d -print 2>/dev/null\n/var/lib/mysql\n/usr/lib64/mysql\n/usr/share/mysql\n\n')])])]),n("p",[e._v("Upgrading MySQL with Directly-Downloaded RPM Packages\nhttps://dev.mysql.com/doc/refman/5.7/en/updating-direct-rpms.html\nhttps://dev.mysql.com/doc/refman/5.7/en/linux-installation-rpm.html")]),e._v(" "),n("p",[e._v("https://dev.mysql.com/downloads/mysql/")]),e._v(" "),n("p",[e._v("??rpm -qpl mysql-community-server-5.7.26-1.el7.x86_64.rpm\nFor Red Hat Enterprise Linux/Oracle Linux/CentOS systems:\nyum install mysql-community-{server,client,common,libs}-* mysql-5.*¬≠")]),e._v(" "),n("p",[e._v("For Red Hat Enterprise Linux, Oracle Linux, CentOS, and Fedora systems, use the following command to start MySQL:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("service mysqld start\nmysql-upgrade -uroot -pPassword //[Warning] InnoDB: Table mysql/innodb_table_stats has length mismatch in the column name table_name.  Please run mysql_upgrade\n")])])]),n("p",[e._v("Once the server restarts, run mysql_upgrade to check and possibly resolve any incompatibilities between the old data and the upgraded software. mysql_upgrade also performs other functions; see Section 4.4.7, ‚Äúmysql_upgrade ‚Äî Check and Upgrade MySQL Tables‚Äù for details.\nIf you use replication, review Section 16.4.3, ‚ÄúUpgrading a Replication Setup‚Äù.\nwarning Table mysql/innodb_table_stats has length mismatch in the column name table_name. Please run mysql_upgrade\nhttps://dev.mysql.com/doc/relnotes/mysql/5.7/en/news-5-7-23.html")]),e._v(" "),n("p",[e._v("Installation of previous versions of MySQL using older packages might have created a configuration file named /usr/my.cnf. It is highly recommended that you examine the contents of the file and migrate the desired settings inside to the file /etc/my.cnf file, then remove /usr/my.cnf.")]),e._v(" "),n("h4",{attrs:{id:"plugins"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#plugins"}},[e._v("#")]),e._v(" plugins")]),e._v(" "),n("p",[e._v("https://dev.mysql.com/doc/refman/5.7/en/server-plugins.html\nhttps://dev.mysql.com/doc/refman/5.7/en/plugin-loading.html#server-plugin-installing")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("SHOW VARIABLES WHERE Variable_name = 'plugin_dir';\n\t/usr/lib64/mysql/plugin/\nSELECT * FROM INFORMATION_SCHEMA.PLUGINS\\G \nSELECT * FROM mysql.plugin;\nINSTALL PLUGIN myplugin SONAME 'validate_password.so';\n\nSELECT PLUGIN_NAME, PLUGIN_STATUS\n       FROM INFORMATION_SCHEMA.PLUGINS\n       WHERE PLUGIN_NAME LIKE 'validate%';\n\t   \nThe following lines should be present in the global configuration:\nplugin-load=validate_password.so\nvalidate-password=FORCE_PLUS_PERMANENT\nhttps://dev.mysql.com/doc/refman/5.7/en/validate-password-installation.html\n\nvim /etc/my.cnf\n[mysqld]\nplugin-load-add=validate_password.so\nvalidate-password=FORCE_PLUS_PERMANENT\n")])])]),n("p",[e._v("If it is desired to prevent the server from running without the password-validation plugin, use --validate-password with a value of FORCE or FORCE_PLUS_PERMANENT to force server startup to fail if the plugin does not initialize successfully.")]),e._v(" "),n("p",[e._v("service mysqld start --validate-password=FORCE_PLUS_PERMANENT")]),e._v(" "),n("h2",{attrs:{id:"_4-sql"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-sql"}},[e._v("#")]),e._v(" 4. SQL")]),e._v(" "),n("h3",{attrs:{id:"basic"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#basic"}},[e._v("#")]),e._v(" Basic")]),e._v(" "),n("p",[e._v("a mysql db can have many schema,"),n("strong",[e._v("like a building have many rooms, and users can get access to different room, so schema can have more than one user.")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("SELECT DATE_FORMAT(date_add(date_column,INTERVAL 8 HOUR),'%b %d %Y %h %p'),COUNT(distinct(count_column))\nFROM db.table\nwhere date_add(date_column,INTERVAL 8 HOUR) between '2015-02-01 00:00:00' and '2015-03-01 00:00:00'\nGROUP BY DATE_FORMAT(date_column,'%b %d %Y %h %p')\norder by DATE_FORMAT(date_add(date_column,INTERVAL 8 HOUR),'%b %d %Y %h %p');\n")])])]),n("p",[e._v("CRUD")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("insert into phoenix.`program-slot`(duration,dateOfProgram,startTime,`weekly-schedule_id`,presenter_id,producer_id,program_id)\nselect duration,date_add(dateOfProgram,INTERVAL 2 DAY), IFNULL(date_add(startTime,INTERVAL 2 DAY),null) ,100,presenter_id,producer_id,program_id from phoenix.`program-slot` where `weekly-schedule_id` =3;\n\n")])])]),n("h3",{attrs:{id:"advance"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#advance"}},[e._v("#")]),e._v(" Advance")]),e._v(" "),n("p",[n("strong",[e._v("ÊâπÈáèÁîüÊàêtruncate")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('mysql -h\'HOST\' -u\'USERNAME\' -p\'PASSWORD\' -e\'SELECT CONCAT("TRUNCATE TABLE ",TABLE_NAME,";") FROM information_schema.TABLES WHERE TABLE_SCHEMA="db01" into outfile "/var/lib/mysql-files/truncate_db01.sql";\'\n\nSHOW VARIABLES LIKE "secure_file_priv" Êü•ÁúãËÉΩÂÜôÂà∞Âì™‰∏™ÁõÆÂΩï\n')])])]),n("p",[n("strong",[e._v("Performance on index : when join a large table")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("bad:\nselect user.*, log.LoginTime\nfrom users user\nleft join login_log log on user.id=log.userid and log.LoginTime=(select max(LoginTime) from login_log where userid=log.userid and status='true');\ngood:\nselect user.*, log.LoginTime\nfrom users user\nleft join (\nselect max(LoginTime) LoginTime,userid from login_log\nwhere  status='true'\ngroup by userid) temp on temp.userid=user.userid;\n")])])]),n("p",[n("strong",[e._v("Â≠òÂÇ®ËøáÁ®ã‰∫íÁõ∏Ë∞ÉÁî®")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("DELIMITER $$\nCREATE DEFINER=`dbuser`@`%` PROCEDURE `PROCE1`(\nin _param varchar(50)\n)\nroot:BEGIN\ndeclare _count int;\nselect count(1) into _count from table where column=_param;\nif _count<>1 then\nselect -1 as result;\nleave root;\nend if;\ncall PROCE2(_param);\ndo something else\nselect 0 as result;\nEND\n\nDELIMITER $$\nCREATE DEFINER=`dbuser`@`%` PROCEDURE `PROCE2`(\nin _param int\n)\nBEGIN\nDECLARE done INT DEFAULT FALSE;\ndeclare _variable1 int;\ndeclare _variable2 decimal(10,2);\ndeclare resultCur cursor for select column1,column2 from table where column=_param;\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;\nDECLARE exit handler for sqlexception\nBEGIN\nROLLBACK;\nget diagnostics condition 1 @p1 = MESSAGE_TEXT;\nselect -1 as result, @p1 as message from dual;\nEND;\nopen resultCur;\noperaLoop:Loop\nfetch resultCur into _variable1,_variable2;\nif done then\nleave operaLoop;\nend if;\ndo something...\nend Loop;\nclose resultCur;\nEND\n\n")])])]),n("p",[n("strong",[e._v("Multiple cursors in mysql stored procedure")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('DROP PROCEDURE IF EXISTS `multipleCursorsAtOne`;\nDELIMITER $$\nCREATE PROCEDURE `multipleCursorsAtOne`()\nBEGIN\nDROP TABLE IF EXISTS userNames;\nCREATE TEMPORARY TABLE userNames\n(userName varchar(200) NOT NULL);\nBEGIN\nDECLARE done BOOLEAN DEFAULT false;\nDECLARE p_first_name VARCHAR(200);\nDECLARE cursor_a CURSOR FOR SELECT user_name FROM user_info LIMIT 1,3;\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;\nOPEN cursor_a;\ncursor_a_loop: LOOP\nFETCH cursor_a INTO p_first_name;\nIF done THEN\nLEAVE cursor_a_loop;\nEND IF;\n-- cursor loop statements\nIF p_first_name IS NOT NULL AND p_first_name <> "" THEN\nINSERT INTO userNames(userName) VALUES(p_first_name);\nEND IF;\nEND LOOP;\nCLOSE cursor_a;\nEND;\nBEGIN\nDECLARE done BOOLEAN DEFAULT false;\nDECLARE p_first_name VARCHAR(200);\nDECLARE cursor_a CURSOR FOR SELECT user_name FROM user_info LIMIT 4,3;\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;\nOPEN cursor_a;\ncursor_a_loop: LOOP\nFETCH cursor_a INTO p_first_name;\nIF done THEN\nLEAVE cursor_a_loop;\nEND IF;\n-- cursor loop statements\nIF p_first_name IS NOT NULL AND p_first_name <> "" THEN\nINSERT INTO userNames(userName) VALUES(p_first_name);\nEND IF;\nEND LOOP;\nCLOSE cursor_a;\nEND;\nSELECT * FROM userNames;\nEND\n')])])]),n("p",[n("strong",[e._v("Recursive query")])]),e._v(" "),n("p",[e._v("Â∞±ÊòØÈíàÂØπÂ≠òÂú®parent idÁöÑÂ≠òÂú®Â±ÇÁ∫ßÂÖ≥Á≥ªÁöÑË°®")]),e._v(" "),n("p",[e._v("Hierarchical data in MySQL: parents and children in one query")]),e._v(" "),n("p",[e._v("https://stackoverflow.com/questions/20215744/how-to-create-a-mysql-hierarchical-recursive-query")]),e._v(" "),n("p",[e._v("Managing Hierarchical Data in MySQL")]),e._v(" "),n("p",[e._v("https://www.mysqltutorial.org/mysql-adjacency-list-tree/")]),e._v(" "),n("p",[n("strong",[e._v("Partition")])]),e._v(" "),n("p",[e._v("mysql> show create table TABLE_NAME\\G;")]),e._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("createPartition")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),e._v(" theDate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),e._v(" sql "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("\"SELECT count(partition_name) FROM INFORMATION_SCHEMA.PARTITIONS WHERE  TABLE_SCHEMA =SCHEMA() AND TABLE_NAME='t_xxx';\"")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Integer")]),e._v(" result "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" jdbcTemplate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("queryForObject")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("sql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Integer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("result "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n            sql "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("\"ALTER TABLE t_xxx PARTITION BY LIST COLUMNS(CreateDate) (PARTITION p%s VALUES IN ('%s'));\"")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" theDate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" theDate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n            jdbcTemplate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("execute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("sql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("else")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n            sql "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("\"SELECT count(partition_name) FROM INFORMATION_SCHEMA.PARTITIONS WHERE  TABLE_SCHEMA =SCHEMA() AND TABLE_NAME='t_xxx' AND PARTITION_NAME = 'p%s' \"")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" theDate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Integer")]),e._v(" count "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" jdbcTemplate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("queryForObject")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("sql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Integer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("count "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n                sql "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("\"ALTER TABLE t_xxx ADD PARTITION(PARTITION p%s VALUES IN ('%s'));\"")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" theDate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" theDate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n                jdbcTemplate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("execute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("sql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),n("h2",{attrs:{id:"_5-ha"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-ha"}},[e._v("#")]),e._v(" 5. HA")]),e._v(" "),n("h3",{attrs:{id:"ÁêÜËÆ∫"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ÁêÜËÆ∫"}},[e._v("#")]),e._v(" ÁêÜËÆ∫")]),e._v(" "),n("p",[e._v("https://dev.mysql.com/doc/refman/8.0/en/replication.html")]),e._v(" "),n("p",[e._v("In MySQL, replication involves the source database writing down every  change made to the data held within one or more databases in a special  file known as the "),n("em",[e._v("binary log")])]),e._v(" "),n("p",[e._v("Once the replica instance has been initialized, it creates two threaded processes:")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("master-binary log=>slave-relay log")]),e._v(" "),n("p",[e._v("The first, called the "),n("em",[e._v("IO thread")]),e._v(", connects to the source MySQL instance and reads the binary log events  line by line, and then copies them over to a local file on the replica‚Äôs server called the "),n("em",[e._v("relay log")]),e._v(".")])]),e._v(" "),n("li",[n("p",[e._v("slave-relay log=>slave db changes")]),e._v(" "),n("p",[e._v("The second thread, called the "),n("em",[e._v("SQL thread")]),e._v(", reads events from the relay log and then applies them to the replica instance as fast as possible.")])])]),e._v(" "),n("h3",{attrs:{id:"‰∏§ÁßçÊ®°Âºè"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#‰∏§ÁßçÊ®°Âºè"}},[e._v("#")]),e._v(" ‰∏§ÁßçÊ®°Âºè")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("Âü∫‰∫ébinary log, "),n("em",[e._v("binary log file position-based replication")])]),e._v(" "),n("p",[e._v("When you turn a MySQL instance into a replica using this method, you  must provide it with a set of binary log coordinates. These consist of  the name of the binary log file on the source which the replica must  read and a specific position within that file which represents the first database event the replica should copy to its own MySQL instance.")]),e._v(" "),n("p",[e._v("These coordinates are important since replicas receive a copy of their  source‚Äôs entire binary log and, without the right coordinates, they will begin replicating every database event recorded within it. This can  lead to problems if you only want to replicate data after a certain  point in time or only want to replicate a subset of the source‚Äôs data.")]),e._v(" "),n("p",[e._v("Binary log file position-based replication is viable for many use cases, but this method can become clunky in more complex setups.")])]),e._v(" "),n("li",[n("p",[e._v("Âü∫‰∫é global transaction identifier GTID [starting with version 5.6 and above]")]),e._v(" "),n("p",[e._v("GTID stands for global transaction identifier (GTID) which uniquely  identifies a transaction committed on the server of origin (master). A  unique GTID is created when any transaction occurs. The GTID is not  just unique to the server on which it originates, but also across the  servers in any given replication setup. In other words, each transaction is mapped to a GTID.")]),e._v(" "),n("p",[e._v("MySQL GTIDs are displayed as a pair of coordinates, separated by a colon character (üòÉ "),n("code",[e._v("GTID = source_id(noramlly server uuid):transaction_id(sequential integer,start from 1, representing the order a transaction was committed on the source)")])]),e._v(" "),n("p",[e._v("server uuid: /var/lib/mysql/auto.cnf")]),e._v(" "),n("p",[e._v("GTID Set")]),e._v(" "),n("p",[e._v("rather than just a single transaction id, an interval is given a range of transactions like "),n("code",[e._v("baecf819-a6a5-11e9-a78d-566f18fa0007:1-699")]),e._v(" or")]),e._v(" "),n("p",[e._v("two ranges with a gap "),n("code",[e._v("baecf819-a6a5-11e9-a78d-566f18fa0007:1-699, 702-900")])]),e._v(" "),n("ul",[n("li",[e._v("Retrieved _Gtid_Set:\n"),n("ul",[n("li",[e._v("All GTIDs received from the master")]),e._v(" "),n("li",[e._v("Resets on:\n"),n("ul",[n("li",[e._v("CHANGE MASTER")]),e._v(" "),n("li",[e._v("RESET SLAVE")]),e._v(" "),n("li",[e._v("server restart(if relay-log-recovery is on)")])])])])]),e._v(" "),n("li",[e._v("Executed_Gtid_Set:\n"),n("ul",[n("li",[e._v("All GTIDs written to binary log")]),e._v(" "),n("li",[e._v("Same value seen in:\n"),n("ul",[n("li",[e._v("SHOW MASTER STATUS")]),e._v(" "),n("li",[e._v("SHOW SLAVE STATUS")]),e._v(" "),n("li",[e._v("show global variables like 'gtid_executed';")])])])])])]),e._v(" "),n("p",[e._v("This method involves creating a global transaction identifier (GTID)  for each transaction ‚Äî or, an isolated piece of work performed by a  database ‚Äî that the source MySQL instance executes.")]),e._v(" "),n("p",[e._v("The mechanics of transaction-based replication are similar to binary log file-based replication: whenever a database transaction occurs on the  source, MySQL assigns and records a GTID for the transaction in the  binary log file along with the transaction itself. The GTID and the  transaction are then transmitted to the source‚Äôs replicas for them to  process.")]),e._v(" "),n("p",[e._v("When the replication takes place, the slave makes use of the same  GTIDs, irrespective of whether it acts as a master for any other nodes  or not. With each transaction replication, the same GTIDs and  transaction numbers also come along from the master and the slave will  write these to the binlog if it‚Äôs configured to write its data events.")]),e._v(" "),n("p",[e._v("To ensure a smooth, consistent and fault-tolerant replication, the  slave will then inform the master of the GTIDs that were a part of the  execution, which helps master node identify if any transaction did not  take place. The master node then informs the slave to carry out the  left-over transactions and thereby ensures that data replication takes  place accurately.")]),e._v(" "),n("p",[e._v("MySQL‚Äôs transaction-based replication has a number of benefits over its  traditional replication method. For example, because both a source and  its replicas preserve GTIDs, if either the source or a replica encounter a transaction with a GTID that they have processed before they will  skip that transaction. This helps to ensure consistency between the  source and its replicas. Additionally, with transaction-based  replication replicas don‚Äôt need to know the binary log coordinates of  the next database event to process. This means that starting new  replicas or changing the order of replicas in a replication chain is far less complicated.")])])]),e._v(" "),n("h3",{attrs:{id:"Áõ∏ÂÖ≥ÊùÉÈôê"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#Áõ∏ÂÖ≥ÊùÉÈôê"}},[e._v("#")]),e._v(" Áõ∏ÂÖ≥ÊùÉÈôê")]),e._v(" "),n("p",[e._v("REPLICATION CLIENTÊùÉÈôê: replication user‰ΩøÁî®shellÂëΩ‰ª§ SHOW MASTER STATUS, SHOW SLAVE STATUSÂíå SHOW BINARY LOGSÊù•Á°ÆÂÆöÂ§çÂà∂Áä∂ÊÄÅ„ÄÇ")]),e._v(" "),n("p",[e._v("REPLICATION SLAVEÊùÉÈôê: SLAVE ËøõË°åreplicationÔºå‰ΩøÁî® show slave hosts Ôºåshow binlog events;Á≠âÂëΩ‰ª§Ôºõ")]),e._v(" "),n("p",[e._v('ÂÅáËÆæÊÉ≥Ë¶ÅÂú®Slave‰∏äÊúâÊùÉÈôêËøêË°å"LOAD TABLE FROM MASTER" Êàñ "LOAD DATA FROM MASTER"ËØ≠Âè•ÁöÑËØùÔºåÂøÖÈ°ªÊéà‰∫àÂÖ®Â±ÄÁöÑ FILE Âíå SELECT ÊùÉÈôêÔºö')]),e._v(" "),n("p",[e._v("RELOAD ÊùÉÈôêÔºöReset slave: Access denied; you need (at least one of) the RELOAD privilege(s) for this operation")]),e._v(" "),n("p",[e._v("superÊùÉÈôêÔºöstart slaveÔºåstop slaveÔºõ")]),e._v(" "),n("h3",{attrs:{id:"replication-solution"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#replication-solution"}},[e._v("#")]),e._v(" Replication Solution")]),e._v(" "),n("p",[e._v("‰∏ªÊú∫Âô®ÈúÄË¶ÅÂÖÅËÆ∏‰ªéÊú∫Âô®ËÆøÈóÆÂÖ∂3306Á´ØÂè£")]),e._v(" "),n("h4",{attrs:{id:"‰∏ª‰ªé-Âü∫‰∫éfile-based-binary-log-replication"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#‰∏ª‰ªé-Âü∫‰∫éfile-based-binary-log-replication"}},[e._v("#")]),e._v(" ‰∏ª‰ªé - Âü∫‰∫éfile based / binary log replication")]),e._v(" "),n("p",[e._v("https://www.digitalocean.com/community/tutorials/how-to-set-up-replication-in-mysql")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("----------------------------------------------------------------------------\nstep 1: config master and slave /etc/my.cnf And restart:\n----------------------------------------------------------------------------\nMaster:\nserver-id=1\nlog-bin=mysql-bin #This defines the base name and location of MySQL‚Äôs binary log file,When commented out, as this directive is by default, binary logging is disabled. Your replica server must read the source‚Äôs binary log file so it knows when and how to replicate the source‚Äôs data\n\nbinlog_do_db          = include_database_name ÈúÄË¶ÅÂ§çÂà∂ÁöÑÊï∞ÊçÆÂ∫ì\nbinlog_do_db          = db_1\nbinlog_do_db          = db_2\n\nreplicate-ignore-db = mysql  #ÂøΩÁï•Êï∞ÊçÆÂ∫ìÔºå‰∏çÈúÄË¶ÅÂ§çÂà∂\nreplicate-ignore-db = information_schema\nreplicate-ignore-db = performance_schema\nreplicate-ignore-db = sys\n\nSlave:\n[mysqld]\nserver-id=2\nlog_bin                 = /var/log/mysql/mysql-bin.log\nbinlog_do_db            =  Ë∑ümaster‰∏ÄËá¥\nrelay-log               = /var/log/mysql/mysql-relay-bin.log\n\n> sudo systemctl restart mysqld\n\n----------------------------------------------------------------------------\nstep 2: on master, create and grant repl user\n----------------------------------------------------------------------------\n\ngood:\nmysql> CREATE USER 'replica_user'@'replica_server_ip' IDENTIFIED WITH mysql_native_password BY 'password';\n# Note that this command specifies that replica_user will use the mysql_native_password authentication plugin. It‚Äôs possible to instead use MySQL‚Äôs default authentication mechanism, caching_sha2_password, but this would require setting up an encrypted connection between the source and the replica. This kind of setup would be optimal for production environment: https://dev.mysql.com/doc/refman/8.0/en/replication-solutions-encrypted-connections.html\n\nbad: ‰ªªÊÑèipÈÉΩÂèØ‰ª•ËÆøÈóÆÔºå‰∏çÂÆâÂÖ®\nmysql> CREATE USER 'replica_user'@'%' IDENTIFIED BY '123456';\n\n\nmysql> GRANT REPLICATION SLAVE ON *.* TO 'replica_user'@'replica_server_ip';\n\n----------------------------------------------------------------------------\nstep 3: on master: Retrieving Binary Log Coordinates from the Source\n----------------------------------------------------------------------------\nTo make sure that no users change any data while you retrieve the coordinates, which could lead to problems, you‚Äôll need to lock the database to prevent any clients from reading or writing data as you obtain the coordinates. \n\nmysql> FLUSH TABLES WITH READ LOCK;\nmysql> SHOW MASTER STATUS; # return the current status information for the source‚Äôs binary log files\n\nOutput\n+------------------+----------+--------------+------------------+-------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |\n+------------------+----------+--------------+------------------+-------------------+\n| mysql-bin.000001 |      899 | db           |                  |                   |\n+------------------+----------+--------------+------------------+-------------------+\n1 row in set (0.00 sec)\n\nËæìÂá∫ÁöÑfileÂíåpositionÂç≥‰∏ãÈù¢Áî®Âà∞ÁöÑMASTER_LOG_FILEÂíåMASTER_LOG_POS\n\nsudo find / -name mysql-bin.000001\nmysqlbinlog /var/lib/mysql/mysql-bin.000001\n\n----------------------------------------------------------------------------\nstep 4: dump and import, If Your Source Has Existing Data to Migrate\n----------------------------------------------------------------------------\non master::\nIf you have data on your source MySQL instance that you want to migrate to your replicas, you can do so by creating a snapshot of the database with the mysqldump utility. However, your database should still be currently locked. If you make any new changes in the same window, the database will automatically unlock. Likewise, the tables will automatically unlock if you exit the client. \nFor this reason, you must open a new terminal window or tab on your local machine so you can create the database snapshot without unlocking MySQL.\n\n> mysqldump -u root db > db.sql\nor\n> mysqldump -u repl -p 123456 --all-databases --master-data > dbdump.db\n\n\nFollowing that you can close this terminal window or tab and return to your first one, which should still have the MySQL shell open, then:\nmysql> UNLOCK TABLES;\n\n\non slave:: import data\n> mysql -u root -p < dbdump.db\nor\nmysql> CREATE DATABASE db; \n> mysql db < /tmp/db.sql\n\n\n----------------------------------------------------------------------------\nstep 5: Slave: setting and start\n----------------------------------------------------------------------------\n\nmysql> CHANGE MASTER TO MASTER_HOST='source_server_ip',MASTER_PORT=3306,MASTER_USER='replica_user',MASTER_PASSWORD='password',MASTER_LOG_FILE='mysql-bin.000001',MASTER_LOG_POS=52113;\n\nmysql> START SLAVE;\n \nmysql> SHOW SLAVE STATUS\\G;\nMaster_Log_File:\t# source bin log\nRead_Master_Log_Pos: # source bin log position\nRelay_Log_File:\t\t# slave relay log\nRelay_Log_Pos: \t\t# salve relay log position\nRelay_Master_Log_File:\n        \nÂÖ∂‰∏≠ÔºåSlave_IO_RunningÂíåSlave_SQL_RunningÂùáÊòæÁ§∫yesË°®Á§∫ReplicationÂ∑•‰ΩúÊ≠£Â∏∏ÔºåÂèØÈÄöËøáÂÖ∂‰ΩôÂèÇÊï∞Êù•‰∫ÜËß£ReplicationÁöÑÂ∑•‰ΩúÁä∂ÊÄÅ„ÄÇ\n\n\n\nNote: If your replica has an issue in connecting or replication stops unexpectedly, it may be that an event in the source‚Äôs binary log file is preventing replication. In such cases, you could run the SET GLOBAL SQL_SLAVE_SKIP_COUNTER command to skip a certain number of events following the binary log file position you defined in the previous command. This example only skips the first event:\nmysql> SET GLOBAL SQL_SLAVE_SKIP_COUNTER = 1;\n\nFollowing that, you‚Äôd need to start the replica again:\nmysql> START REPLICA;\n\n\n")])])]),n("h4",{attrs:{id:"‰∏ª‰ªé-Âü∫‰∫égtid-based-replication"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#‰∏ª‰ªé-Âü∫‰∫égtid-based-replication"}},[e._v("#")]),e._v(" ‰∏ª‰ªé - Âü∫‰∫éGTID based replication")]),e._v(" "),n("p",[e._v("https://hevodata.com/learn/mysql-gtids-and-replication-set-up/")]),e._v(" "),n("p",[e._v("https://dev.mysql.com/doc/refman/5.7/en/replication-gtids-howto.html")]),e._v(" "),n("p",[e._v("gtid_executedÔºöËøô‰∏™ÊòØÂ∑≤ÁªèÊâßË°åËøáÁöÑÊâÄÊúâÁöÑ‰∫ãÂä°ÁöÑGTIDÁöÑ‰∏Ä‰∏™Á≥ªÂàó‰∏≤Ôºå‰πüÂ∞±ÊòØbinary logÈáåÈù¢Â∑≤ÁªèËêΩÂ∫ìÁöÑ‰∫ãÂä°ÁöÑÂ∫èÂàóÂè∑„ÄÇËøô‰∏™ÂèÇÊï∞ÊòØÂè™ËØªÁöÑÔºå‰∏çËÉΩÂ§üËøõË°åËÆæÁΩÆ„ÄÇ")]),e._v(" "),n("p",[e._v("gtid_purgedÔºösubsets of gtid_executed that are no longer in the binary logs Ëøô‰∏™Â∫èÂàóÊòØÊåáÊàë‰ª¨Âú®binary logÂà†Èô§ÁöÑ‰∫ãÂä°ÁöÑGTIDÁöÑÂ∫èÂàóÂè∑„ÄÇÊàë‰ª¨ÂèØ‰ª•ÊâãÂä®ËøõË°åËÆæÁΩÆÔºåÊñπ‰æøÊàë‰ª¨ÂÅö‰∏Ä‰∫õÁÆ°ÁêÜ„ÄÇ")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("----------------------------------------------------------------------------\nstep 1: lock master&slave\n----------------------------------------------------------------------------\non both master & slave:\nmysql> SET @@GLOBAL.read_only = ON;\nmysql> show global variables like 'read_only';\nËøôÊ¨°Ë∑üÂâçÈù¢ÁöÑlockÊñπÊ≥ï‰∏çÂêåÔºåÊ≥®ÊÑè**‰∏ç‰ºöÂΩ±ÂìçslaveÂêåÊ≠•Â§çÂà∂ÁöÑÂäüËÉΩ**\n\nmysqladmin -uroot -p shutdown\n\n----------------------------------------------------------------------------\nstep 2: config master and slave /etc/my.cnf And restart:\n----------------------------------------------------------------------------\nmysqld --defaults-file=/etc/my.cnf --validate-config\n\nfor master: \nThe Master server needs to be started with GTID mode enabled by setting the gtid_mode variable to ON. It is also essential that the enforce_gtid_consistency variable is enabled to make sure that only the statements which are safe for MySQL GTIDs Replication are logged. \n[mysqld]\nserver-id=1\nlog-bin = mysql-bin\n#binlog_format = row\ngtid-mode=ON\nenforce-gtid-consistency=ON\n#read-only = ON #Âè¶‰∏ÄÁßçÊñπÂºèËÆæÁΩÆreadonly\n\n> systemctl restart mysqld\n\nfor slave:\n[mysqld]\nserver-id = 2\nlog-bin = mysql-bin\ngtid-mode=ON\nenforce-gtid-consistency=ON\nlog-slave-updates\n#read-only = ON #Âè¶‰∏ÄÁßçÊñπÂºèËÆæÁΩÆreadonly\n#relay-log = relay-log-server\nskip-slave-start #ÔºÅÔºÅÔºÅÔºÅImportant In addition, you should start replicas with the --skip-slave-start option before configuring the replica settings. Tells the replica server not to start the replication threads when the server starts. To start the threads later, use a START SLAVE statement. \n\n> systemctl restart mysqld\n----------------------------------------------------------------------------\nstep 3: on master create replicator user\n----------------------------------------------------------------------------\n\n> mysql -uroot -p\n\nmysql> DROP USER 'replicator'@'localhost';\n--- mysql> REVOKE ALL ON *.* FROM 'replicator'@'localhost';\n\n# replicator@localhostÂèØ‰ª•ÁÆ°ÁêÜmasterÊú¨Êú∫\nmysql> CREATE USER replicator@localhost IDENTIFIED BY 'password';\nmysql> GRANT SUPER,RELOAD,REPLICATION SLAVE ON *.* TO 'replicator'@'localhost' IDENTIFIED BY 'password';\n\n# 'replicator'@'replication_server_ip'Âú®slaveÊú∫Âô®‰∏äreplication_server_ipËøúÁ®ãËøûÊé•ÁÆ°ÁêÜmaster‰ª•ÂèäËøõË°åÂü∫Êú¨ÁöÑÂ§çÂà∂ÔºàÊúÄ‰ΩéÈúÄË¶ÅREPLICATION SLAVEÊùÉÈôêÔºâ\nmysql> CREATE USER replicator@replication_server_ip IDENTIFIED BY 'password';\nmysql> GRANT SUPER,RELOAD,REPLICATION SLAVE ON *.* TO 'replicator'@'replication_server_ip' IDENTIFIED BY 'password';\n\nmysql> flush privileges;\n\nmysql_config_editor set --login-path=host-rpl --host=localhost --port=3306 --user=replicator --password\n\n----------------------------------------------------------------------------\n(no need) step 4: on master: Retrieving Binary Log Coordinates from the Source\n----------------------------------------------------------------------------\n\nmysql> show master status\nmysql> show global variables like 'gtid_executed';\n‰∏§ËÄÖËæìÂá∫ÁöÑgtid_executedÂ∫îËØ•ÊòØ‰∏ÄÊ†∑ÁöÑ\nselect * from mysql.gtid_executed;\n\nGTID = source_id(noramlly server uuid):transaction_id(sequential integer,start from 1, representing the order a transaction was committed on the source)\n\nmysqlbinlog /var/lib/mysql/mysql-bin.000001\nÂÜÖÂÆπÂü∫Êú¨Ë∑ü‰∏äÈù¢ÁöÑfile based replicationÁöÑbin log‰∏ÄÊ†∑ÔºåÂè™‰∏çËøáÂ§ö‰∫ÜÔºö\n                    #210621 16:50:01 server id 2  end_log_pos 259 CRC32 0x7b8ba749  GTID    last_committed=0        sequence_number=1\n                    SET @@SESSION.GTID_NEXT= '878556a6-ff0e-11ea-bf92-566f18fa0008:3'/*!*/;\n                    # at 259\n----------------------------------------------------------------------------\nstep 5: dump and import, If Your Source Has Existing Data to Migrate\n----------------------------------------------------------------------------\n\n> mysqldump --all-databases -flush-privileges --single-transaction --flush-logs --triggers --routines --events -hex-blob --host=54.89.xx.xx --port=3306 --user=root  --password=XXXXXXXX > mysqlbackup_dump.sql\n# head -n30 mysqlbackup_dump.sql\n\n> mysqldump -flush-privileges --single-transaction --flush-logs --triggers --routines --events -hex-blob --host=localhost --user=root --password --databases db1 db2> source_dump.sql\n\n            SET @MYSQLDUMP_TEMP_LOG_BIN = @@SESSION.SQL_LOG_BIN;\n            SET @@SESSION.SQL_LOG_BIN= 0;\n\n            --\n            -- GTID state at the beginning of the backup \n            --\n\n            SET @@GLOBAL.GTID_PURGED='baecf819-a6a5-11e9-a78d-566f18fa0007:1-594';\n\n\non slave:: import data\nmysql> show global variables like 'gtid_executed';\nÂ¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°ÔºåÂ∫îËØ•ÊòØÁ©∫ÁöÑ\nmysql> SET @@GLOBAL.read_only = OFF;\nmysql> source source_dump.sql ;\nmysql> show global variables like 'gtid_executed';\n\nÂØºÂÖ•ÂÆåÂ∫îËØ•Ë∑ümaster‰∏ÄÊ†∑‰∫Ü? Ë∑üfile based replication‰∏çÂêåÔºå‰∏§Âè∞Êú∫Âô®‰∏ä‰∫ßÁîüÁöÑgtidÊú¨Êù•Â∞±‰∏çÂêåÁöÑÔºåÂè™‰∏çËøáslave‰ºöÂ§çÂà∂master‰∏äÈù¢‰∫ßÁîüÁöÑgtid transactionÔºå\n\nÂè¶Â§ñÂèëÁé∞readonly‰πüÂèòÊàê‰∫ÜoffÔºåÊàë‰ª•‰∏∫Á¨¨‰∏ÄÊ≠•ËÆæÁΩÆreadonly‰ºö‰∏ÄÁõ¥ÊúâÊïàÔºåÁúãÊù•ÊòØ‰∏≠Èó¥Êüê‰∏ÄÊ≠•ÊîπÂèò‰∫ÜreadonlyÔºàÈáçÂêØÊàñËÄÖÂÖ∂‰ªñÊìç‰ΩúÔºâÔºåÂÜçÂÅö‰∏ÄÊ¨°Step 1\n\n----------------------------------------------------------------------------\nstep 6: Slave: setting and start\t\n----------------------------------------------------------------------------\nThe slave should be configured to use the master with GTID based transactions as the source for data replication and to use GTID-based auto-positioning rather than file-based positioning.\n\n> mysql -uroot -p\nmysql> CHANGE MASTER TO\nMASTER_HOST = '54.89.xx.xx',\nMASTER_PORT = 3306,\nMASTER_USER = 'repl_user',\nMASTER_PASSWORD = 'XXXXXXXXX',\nMASTER_AUTO_POSITION = 1;\n\nTake a new backup.  Existing backups that were made before you enabled GTIDs can no longer be used on these servers now that you have enabled GTIDs. Take a new backup at this point, so that you are not left without a usable backup. \n\nmysql> start slave;\nmysql> show slave status\\G\n\n\t\t\tRetrieved_Gtid_Set:\n            Executed_Gtid_Set: baecf819-a6a5-11e9-a78d-566f18fa0007:\n                Auto_Position: 1\n----------------------------------------------------------------------------\nstep 6: Finally touch: unlock\n----------------------------------------------------------------------------\nmysql> SET @@GLOBAL.read_only = OFF;\n\nON SLAVE:\n> vim /etc/my.cnf\n #skip-slave-start\n\n")])])]),n("p",[e._v("https://www.cnblogs.com/shengdimaya/p/6897584.html")]),e._v(" "),n("h4",{attrs:{id:"‰∏ª‰∏ª-Âü∫‰∫égtid-replication"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#‰∏ª‰∏ª-Âü∫‰∫égtid-replication"}},[e._v("#")]),e._v(" ‰∏ª‰∏ª - Âü∫‰∫éGTID replication")]),e._v(" "),n("p",[e._v("https://www.huaweicloud.com/articles/e85563c3c3c75c7d980466d800a8c43c.html")]),e._v(" "),n("p",[e._v("‰∏äÈù¢ÁöÑÊìç‰ΩúÂèçËøáÊù•Êìç‰Ωú‰∏ÄÈÅçÂç≥ÂèØÔºå‰ΩÜÊòØÊ≥®ÊÑèÔºö")]),e._v(" "),n("p",[e._v("‰∏§‰∏™‰∏ªËá™Â¢ûidË¶ÅÂàÜÂà´‰∏∫Â•áÊï∞ÂÅ∂Êï∞Ôºå‰∏çÁÑ∂ÊúâÂÜ≤Á™Å")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("----------------------------------------------------------------------------\nstep 1: lock master&slave\n----------------------------------------------------------------------------\non both master & slave:\nmysql> SET @@GLOBAL.read_only = ON;\nmysql> show global variables like 'read_only';\nËøôÊ¨°Ë∑üÂâçÈù¢ÁöÑlockÊñπÊ≥ï‰∏çÂêåÔºåÊ≥®ÊÑè**‰∏ç‰ºöÂΩ±ÂìçslaveÂêåÊ≠•Â§çÂà∂ÁöÑÂäüËÉΩ**\n\nmysqladmin -uroot -p shutdown\n\n----------------------------------------------------------------------------\nstep 2: config master & slave /etc/my.cnf And restart:\n----------------------------------------------------------------------------\nmaster:\n\n[mysqld]\nserver-id = 1\nauto_increment_offset = 1\nauto_increment_increment = 2  #Â•áÊï∞ID\n\n\nlog-bin = mysql-bin  #ÊâìÂºÄ‰∫åËøõÂà∂ÂäüËÉΩ,MASTER‰∏ªÊúçÂä°Âô®ÂøÖÈ°ªÊâìÂºÄÊ≠§È°π\nbinlog-format=ROW\nlog-slave-updates=true\ngtid-mode=ON\nenforce-gtid-consistency=ON\nmaster-info-repository=TABLE\nrelay-log-info-repository=TABLE\nsync-master-info=1\nslave-parallel-workers=0\nsync_binlog=0\nbinlog-checksum=CRC32\nmaster-verify-checksum=1\nslave-sql-verify-checksum=1\nbinlog-rows-query-log_events=1\nmax_binlog_size=1024M       #binlogÂçïÊñá‰ª∂ÊúÄÂ§ßÂÄº\n\nreplicate-ignore-db = mysql  #ÂøΩÁï•‰∏çÂêåÊ≠•‰∏ª‰ªéÁöÑÊï∞ÊçÆÂ∫ì\nreplicate-ignore-db = information_schema\nreplicate-ignore-db = performance_schema\nreplicate-ignore-db = sys\n\nmax_connections = 3000\nmax_connect_errors = 30\n\nlower_case_table_names=1      \nskip-name-resolve\n\nskip-slave-start #ÔºÅÔºÅÔºÅÔºÅImportant In addition, you should start replicas with the --skip-slave-start option before configuring the replica settings. Tells the replica server not to start the replication threads when the server starts. To start the threads later, use a START SLAVE statement. \n\n> systemctl restart mysqld\n\nslave:\n[mysqld]\nserver-id = 2\nauto_increment_offset = 2\nauto_increment_increment = 2    #ÂÅ∂Êï∞ID\n\n\nlog-bin = mysql-bin    #ÊâìÂºÄ‰∫åËøõÂà∂ÂäüËÉΩ,MASTER‰∏ªÊúçÂä°Âô®ÂøÖÈ°ªÊâìÂºÄÊ≠§È°π\nbinlog-format=ROW\nlog-slave-updates=true\ngtid-mode=ON\nenforce-gtid-consistency=ON\nmaster-info-repository=TABLE\nrelay-log-info-repository=TABLE\nsync-master-info=1\nslave-parallel-workers=0\nsync_binlog=0\nbinlog-checksum=CRC32\nmaster-verify-checksum=1\nslave-sql-verify-checksum=1\nbinlog-rows-query-log_events=1\nmax_binlog_size=1024M         #binlogÂçïÊñá‰ª∂ÊúÄÂ§ßÂÄº\n\nreplicate-ignore-db = mysql   #ÂøΩÁï•‰∏çÂêåÊ≠•‰∏ª‰ªéÁöÑÊï∞ÊçÆÂ∫ì\nreplicate-ignore-db = information_schema\nreplicate-ignore-db = performance_schema\nreplicate-ignore-db = sys\n\nmax_connections = 3000\nmax_connect_errors = 30\n\nlower_case_table_names=1      \nskip-name-resolve\n\nskip-slave-start #ÔºÅÔºÅÔºÅÔºÅImportant In addition, you should start replicas with the --skip-slave-start option before configuring the replica settings. Tells the replica server not to start the replication threads when the server starts. To start the threads later, use a START SLAVE statement. \n\nNoteÔºö\n1. Âè¶Â§ñ‰∏ÄÁßçÊñπÂºèÂ∞±ÊòØ\nsystemctl edit mysqld.service\nand then adding --skip-slave-start\nhttps://stackoverflow.com/questions/65434207/start-mysql-replication-server-with-skip-slave-start\n2. ÈÖçÁΩÆÂÆåÊàê‰∏ª‰∏ªÂ§çÂà∂‰πãÂêé‰∏ÄÂÆöË¶ÅÊ≥®ÈáäÊéâmy.cnfÈáåÈù¢ÁöÑskip-slave-startÔºå‰∏çÁÑ∂ÊØèÊ¨°ÂêØÂä®‰πãÂêéÈÉΩË¶ÅÊâãÂä®start slave\n\n> systemctl restart mysqld\n\n----------------------------------------------------------------------------\nstep 3: on BOTH two masters create replicator user\n----------------------------------------------------------------------------\n\n> mysql -uroot -p\n\nON BOTH SERVER:\n# replicator@localhostÂèØ‰ª•ÁÆ°ÁêÜmasterÊú¨Êú∫\nmysql> CREATE USER replicator@localhost IDENTIFIED BY 'password';\nmysql> GRANT SUPER,RELOAD,REPLICATION SLAVE ON *.* TO 'replicator'@'localhost' IDENTIFIED BY 'password';\n\n# 'replicator'@'replication_server_ip'Âú®slaveÊú∫Âô®‰∏äreplication_server_ipËøúÁ®ãËøûÊé•ÁÆ°ÁêÜmaster‰ª•ÂèäËøõË°åÂü∫Êú¨ÁöÑÂ§çÂà∂ÔºàÊúÄ‰ΩéÈúÄË¶ÅREPLICATION SLAVEÊùÉÈôêÔºâ\nON SERVER 1:\nmysql> CREATE USER replicator@replication_server2_ip IDENTIFIED BY 'password';\nmysql> GRANT SUPER,RELOAD,REPLICATION SLAVE ON *.* TO 'replicator'@'replication_server2_ip' IDENTIFIED BY 'password';\nmysql_config_editor set --login-path=host-rpl --host=replication_server2_ip --port=3306 --user=replicator --password\n\nON SERVER 2:\nmysql> CREATE USER replicator@replication_server1_ip IDENTIFIED BY 'password';\nmysql> GRANT SUPER,RELOAD,REPLICATION SLAVE ON *.* TO 'replicator'@'replication_server1_ip' IDENTIFIED BY 'password';\nmysql_config_editor set --login-path=host-rpl --host=replication_server1_ip --port=3306 --user=replicator --password\n\n\nmysql> flush privileges;\n\n----------------------------------------------------------------------------\nstep 4: on BOTH two master: Retrieving Binary Log Coordinates from the Source\n----------------------------------------------------------------------------\n\nmysql> show master status\nmysql> show global variables like 'gtid_executed';\n‰∏§ËÄÖËæìÂá∫ÁöÑgtid_executedÂ∫îËØ•ÊòØ‰∏ÄÊ†∑ÁöÑ\n\n----------------------------------------------------------------------------\nstep 5: dump and import, If Your Source Has Existing Data to Migrate\n----------------------------------------------------------------------------\n\nMethod 1Ôºö\n> mysqldump --all-databases -flush-privileges --single-transaction --flush-logs --triggers --routines --events -hex-blob --host=54.89.xx.xx --port=3306 --user=root  --password=XXXXXXXX > mysqlbackup_dump.sql\n# head -n30 mysqlbackup_dump.sql\n\n\non slave:: import data\nmysql> show global variables like 'gtid_executed';\nÂ¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°ÔºåÂ∫îËØ•ÊòØÁ©∫ÁöÑ\nmysql> SET @@GLOBAL.read_only = OFF;\nmysql> source mysqlbackup_dump.sql ;\nmysql> show global variables like 'gtid_executed';\nÂØºÂÖ•ÂÆåÂ∫îËØ•Ë∑ümaster‰∏ÄÊ†∑‰∫Ü\n\nMethod 2Ôºö\nCreate a dump file using mysqldump on the source server. Set the mysqldump option --master-data (with the default value of 1) to include a CHANGE MASTER TO statement with binary logging information. Set the --set-gtid-purged option to AUTO (the default) or ON, to include information about executed transactions in the dump. Then use the mysql client to import the dump file on the target server. \n\n--master-data[=value]\n\nUse this option to dump a source replication server to produce a dump file that can be used to set up another server as a replica of the source. It causes the dump output to include a CHANGE MASTER TO statement that indicates the binary log coordinates (file name and position) of the dumped server. These are the source server coordinates from which the replica should start replicating after you load the dump file into the replica.\n\nIf the option value is 2, the CHANGE MASTER TO statement is written as an SQL comment, and thus is informative only; it has no effect when the dump file is reloaded. If the option value is 1, the statement is not written as a comment and takes effect when the dump file is reloaded. If no option value is specified, the default value is 1. \n\n----------------------------------------------------------------------------\nstep 6: Both two Slave: setting and start\n----------------------------------------------------------------------------\nThe slave should be configured to use the master with GTID based transactions as the source for data replication and to use GTID-based auto-positioning rather than file-based positioning.\n\n> mysql -uroot -p\nmysql> CHANGE MASTER TO\nMASTER_HOST = '54.89.xx.xx',\nMASTER_PORT = 3306,\nMASTER_USER = 'repl_user',\nMASTER_PASSWORD = 'XXXXXXXXX',\nMASTER_AUTO_POSITION = 1;\n\nTake a new backup.  Existing backups that were made before you enabled GTIDs can no longer be used on these servers now that you have enabled GTIDs. Take a new backup at this point, so that you are not left without a usable backup. \n\nmysql> start slave;\nmysql> show slave status\\G\n\n----------------------------------------------------------------------------\nstep 6: Finally touch: unlock\n----------------------------------------------------------------------------\nmysql> SET @@GLOBAL.read_only = OFF;\n\n> vim /etc/my.cnf\n #skip-slave-start\n\n")])])]),n("h4",{attrs:{id:"reset-replication"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#reset-replication"}},[e._v("#")]),e._v(" Reset Replication")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("on slave:\nmysql > stop slave;\nmysql > reset slave (all);\n\tRESET SLAVE ‰∏ç‰ºöÊîπÂèòÂ§çÂà∂ËøûÊé•‰ΩøÁî®ÁöÑÂèÇÊï∞Ôºå‰æãÂ¶Çmaster host, master port, master user, or master password\n\tRESET SLAVE ALL Âàô‰ºöÔºõ\n    Ê∏ÖÈô§slave Â§çÂà∂Êó∂ÁöÑmaster binlogÁöÑ‰ΩçÁΩÆ\n    Ê∏ÖÁ©∫master info, relay log info\n    Âà†Èô§ÊâÄÊúâÁöÑrelay logÊñá‰ª∂ÔºåÂπ∂ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑrelay logÊñá‰ª∂„ÄÇ\n    ÈáçÁΩÆÂ§çÂà∂Âª∂Ëøü(CHANGE MASTER TO ÁöÑ MASTER_DELAYÂèÇÊï∞ÊåáÂÆöÁöÑ)‰∏∫0„ÄÇ\n\nÂäüËÉΩËØ¥ÊòéÔºöÁî®‰∫éÂà†Èô§SLAVEÊï∞ÊçÆÂ∫ìÁöÑrelaylogÊó•ÂøóÊñá‰ª∂ÔºåÂπ∂ÈáçÊñ∞ÂêØÁî®Êñ∞ÁöÑrelaylogÊñá‰ª∂Ôºõ\n\nreset slave Â∞Ü‰Ωøslave ÂøòËÆ∞‰∏ª‰ªéÂ§çÂà∂ÂÖ≥Á≥ªÁöÑ‰ΩçÁΩÆ‰ø°ÊÅØ„ÄÇËØ•ËØ≠Âè•Â∞ÜË¢´Áî®‰∫éÂπ≤ÂáÄÁöÑÂêØÂä®, ÂÆÉÂà†Èô§master.infoÊñá‰ª∂Âíårelay-log.info Êñá‰ª∂‰ª•ÂèäÊâÄÊúâÁöÑrelay log Êñá‰ª∂Âπ∂ÈáçÊñ∞ÂêØÁî®‰∏Ä‰∏™Êñ∞ÁöÑrelaylogÊñá‰ª∂„ÄÇ\n\n‰ΩøÁî®reset slave‰πãÂâçÂøÖÈ°ª‰ΩøÁî®stop slave ÂëΩ‰ª§Â∞ÜÂ§çÂà∂ËøõÁ®ãÂÅúÊ≠¢„ÄÇ\n\n\non master:\n\nmysql > RESET MASTER\n\n    Âà†Èô§binlogÁ¥¢ÂºïÊñá‰ª∂‰∏≠ÂàóÂá∫ÁöÑÊâÄÊúâbinlogÊñá‰ª∂\n    Ê∏ÖÁ©∫binlogÁ¥¢ÂºïÊñá‰ª∂\n    ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑbinlogÊñá‰ª∂\n    Ê∏ÖÁ©∫Á≥ªÁªüÂèòÈáègtid_purgedÂíågtid_executed\n    Âú®MySQL 5.7.5 ÂèäÂêéÁª≠ÁâàÊú¨‰∏≠, RESET MASTERËøò‰ºö‰ºöÊ∏ÖÁ©∫ mysql.gtid_executed Êï∞ÊçÆË°®„ÄÇ\n\nÂäüËÉΩËØ¥ÊòéÔºöÂà†Èô§ÊâÄÊúâÁöÑbinglogÊó•ÂøóÊñá‰ª∂ÔºåÂπ∂Â∞ÜÊó•ÂøóÁ¥¢ÂºïÊñá‰ª∂Ê∏ÖÁ©∫ÔºåÈáçÊñ∞ÂºÄÂßãÊâÄÊúâÊñ∞ÁöÑÊó•ÂøóÊñá‰ª∂„ÄÇÁî®‰∫éÁ¨¨‰∏ÄÊ¨°ËøõË°åÊê≠Âª∫‰∏ª‰ªéÂ∫ìÊó∂ÔºåËøõË°å‰∏ªÂ∫ìbinlogÂàùÂßãÂåñÂ∑•‰ΩúÔºõ\n\n Ê≥®ÊÑèreset master ‰∏çÂêå‰∫épurge binary logÁöÑ‰∏§Â§ÑÂú∞Êñπ\n1. reset master Â∞ÜÂà†Èô§Êó•ÂøóÁ¥¢ÂºïÊñá‰ª∂‰∏≠ËÆ∞ÂΩïÁöÑÊâÄÊúâbinlogÊñá‰ª∂ÔºåÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÊó•ÂøóÊñá‰ª∂ Ëµ∑ÂßãÂÄº‰ªé000001 ÂºÄÂßãÔºåÁÑ∂ËÄåpurge binary log ÂëΩ‰ª§Âπ∂‰∏ç‰ºö‰øÆÊîπËÆ∞ÂΩïbinlogÁöÑÈ°∫Â∫èÁöÑÊï∞ÂÄº\n2. reset master ‰∏çËÉΩÁî®‰∫éÊúâ‰ªª‰Ωïslave Ê≠£Âú®ËøêË°åÁöÑ‰∏ª‰ªéÂÖ≥Á≥ªÁöÑ‰∏ªÂ∫ì„ÄÇÂõ†‰∏∫Âú®slave ËøêË°åÊó∂Âàª reset master ÂëΩ‰ª§‰∏çË¢´ÊîØÊåÅÔºåreset master Â∞Ümaster ÁöÑbinlog‰ªé000001 ÂºÄÂßãËÆ∞ÂΩï,slave ËÆ∞ÂΩïÁöÑmaster log ÂàôÊòØreset master Êó∂‰∏ªÂ∫ìÁöÑÊúÄÊñ∞ÁöÑbinlog,‰ªéÂ∫ì‰ºöÊä•ÈîôÊó†Ê≥ïÊâæÁöÑÊåáÂÆöÁöÑbinlogÊñá‰ª∂„ÄÇ\n")])])]),n("h3",{attrs:{id:"sync-replication"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sync-replication"}},[e._v("#")]),e._v(" Sync Replication")]),e._v(" "),n("p",[e._v("Synchronize both servers by setting them to read-only if the replication is running already by using the following command:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("mysql> SET @@GLOBAL.read_only = ON;\n")])])]),n("p",[e._v("Ëß£ÈáäÔºö")]),e._v(" "),n("p",[e._v('ÂØπ‰∫éMysqlÊï∞ÊçÆÂ∫ìËØªÂÜôÁä∂ÊÄÅÔºå‰∏ªË¶ÅÈù†"read_only"ÂÖ®Â±ÄÂèÇÊï∞Êù•ËÆæÂÆöÔºõÈªòËÆ§ÊÉÖÂÜµ‰∏ã, Êï∞ÊçÆÂ∫ìÊòØÁî®‰∫é'),n("strong",[e._v("ËØªÂÜôÊìç‰Ωú")]),e._v("ÁöÑÔºåÊâÄ‰ª•read_onlyÂèÇÊï∞‰πüÊòØ0ÊàñfaluseÁä∂ÊÄÅÔºåËøôÊó∂ÂÄô‰∏çËÆ∫ÊòØÊú¨Âú∞Áî®Êà∑ËøòÊòØËøúÁ®ãËÆøÈóÆÊï∞ÊçÆÂ∫ìÁöÑÁî®Êà∑ÔºåÈÉΩÂèØ‰ª•ËøõË°åËØªÂÜôÊìç‰ΩúÔºõ")]),e._v(" "),n("p",[e._v("Â¶ÇÈúÄËÆæÁΩÆ‰∏∫"),n("strong",[e._v("Âè™ËØªÁä∂ÊÄÅ")]),e._v("ÔºåÂ∞ÜËØ•read_onlyÂèÇÊï∞ËÆæÁΩÆ‰∏∫1ÊàñTRUEÁä∂ÊÄÅÔºå‰ΩÜËÆæÁΩÆ read_only=1 Áä∂ÊÄÅÊúâ‰∏§‰∏™ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÂú∞ÊñπÔºö")]),e._v(" "),n("ol",[n("li",[n("p",[e._v("read_only=1Âè™ËØªÊ®°ÂºèÔºå"),n("strong",[e._v("‰∏ç‰ºöÂΩ±ÂìçslaveÂêåÊ≠•Â§çÂà∂ÁöÑÂäüËÉΩ")]),e._v('ÔºåÊâÄ‰ª•Âú®MySQL slaveÂ∫ì‰∏≠ËÆæÂÆö‰∫Üread_only=1ÂêéÔºåÈÄöËøá "show slave status\\G" ÂëΩ‰ª§Êü•ÁúãsalveÁä∂ÊÄÅÔºåÂèØ‰ª•ÁúãÂà∞salve‰ªçÁÑ∂‰ºöËØªÂèñmaster‰∏äÁöÑÊó•ÂøóÔºåÂπ∂‰∏îÂú®slaveÂ∫ì‰∏≠Â∫îÁî®Êó•ÂøóÔºå‰øùËØÅ‰∏ª‰ªéÊï∞ÊçÆÂ∫ìÂêåÊ≠•‰∏ÄËá¥Ôºõ')])]),e._v(" "),n("li",[n("p",[e._v('read_only=1Âè™ËØªÊ®°ÂºèÔºåÈôêÂÆöÁöÑÊòØÊôÆÈÄöÁî®Êà∑ËøõË°åÊï∞ÊçÆ‰øÆÊîπÁöÑÊìç‰ΩúÔºå‰ΩÜ‰∏ç‰ºöÈôêÂÆöÂÖ∑ÊúâsuperÊùÉÈôêÁöÑÁî®Êà∑ÁöÑÊï∞ÊçÆ‰øÆÊîπÊìç‰Ωú (‰ΩÜÊòØÂ¶ÇÊûúËÆæÁΩÆ‰∫Ü"'),n("strong",[e._v("super_read_only=on")]),e._v('"Ôºå ÂàôÂ∞±‰ºöÈôêÂÆöÂÖ∑ÊúâsuperÊùÉÈôêÁöÑÁî®Êà∑ÁöÑÊï∞ÊçÆ‰øÆÊîπÊìç‰Ωú‰∫Ü)ÔºõÂú®MySQL‰∏≠ËÆæÁΩÆread_only=1ÂêéÔºåÊôÆÈÄöÁöÑÂ∫îÁî®Áî®Êà∑ËøõË°åinsert„ÄÅupdate„ÄÅdeleteÁ≠â‰ºö‰∫ßÁîüÊï∞ÊçÆÂèòÂåñÁöÑDMLÊìç‰ΩúÊó∂ÔºåÈÉΩ‰ºöÊä•Âá∫Êï∞ÊçÆÂ∫ìÂ§Ñ‰∫éÂè™ËØªÊ®°Âºè‰∏çËÉΩÂèëÁîüÊï∞ÊçÆÂèòÂåñÁöÑÈîôËØØÔºå‰ΩÜÂÖ∑ÊúâsuperÊùÉÈôêÁöÑÁî®Êà∑Ôºå‰æãÂ¶ÇÂú®Êú¨Âú∞ÊàñËøúÁ®ãÈÄöËøárootÁî®Êà∑ÁôªÂΩïÂà∞Êï∞ÊçÆÂ∫ìÔºåËøòÊòØÂèØ‰ª•ËøõË°åÊï∞ÊçÆÂèòÂåñÁöÑDMLÊìç‰ΩúÔºõ'),n("strong",[e._v('(‰πüÂ∞±ÊòØËØ¥"real_only"Âè™‰ºöÁ¶ÅÊ≠¢ÊôÆÈÄöÁî®Êà∑ÊùÉÈôêÁöÑmysqlÂÜôÊìç‰ΩúÔºå‰∏çËÉΩÈôêÂà∂superÊùÉÈôêÁî®Êà∑ÁöÑÂÜôÊìç‰ΩúÔºõ Â¶ÇÊûúË¶ÅÊÉ≥ËøûsuperÊùÉÈôêÁî®Êà∑ÁöÑÂÜôÊìç‰Ωú‰πüÁ¶ÅÊ≠¢ÔºåÂ∞±‰ΩøÁî®"flush tables with read lock;"ÔºåËøôÊ†∑ËÆæÁΩÆ‰πü‰ºöÈòªÊ≠¢‰∏ª‰ªéÂêåÊ≠•Â§çÂà∂ÔºÅ)')])])])]),e._v(" "),n("p",[e._v("https://www.cnblogs.com/kevingrace/p/10095332.html")]),e._v(" "),n("h3",{attrs:{id:"replication-troubleshooting"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#replication-troubleshooting"}},[e._v("#")]),e._v(" Replication Troubleshooting")]),e._v(" "),n("h4",{attrs:{id:"gtid"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gtid"}},[e._v("#")]),e._v(" gtid")]),e._v(" "),n("p",[n("strong",[e._v("GTID Set Gaps:")])]),e._v(" "),n("p",[e._v("Executed_Gtid_Set")]),e._v(" "),n("p",[e._v("uuid:1-111,113-120")]),e._v(" "),n("p",[e._v("occur when slave_parrallel_workers > 1, A transaction is missing;")]),e._v(" "),n("p",[n("strong",[e._v("Finding transactions:")])]),e._v(" "),n("p",[e._v("mysqlbinlog --no-defaults -vvv --base64-output=DECODE-ROWS --include-gtids='uuid:112' /var/lib/mysql/mysql-bin.xxxxx")]),e._v(" "),n("p",[e._v("result: SET @@SESSION.GTID_NEXT='uuid:112'")]),e._v(" "),n("p",[n("strong",[e._v("Faking transactions:")])]),e._v(" "),n("p",[e._v("set gtid_next='uuid:112'; BEGIN; COMMIT;")]),e._v(" "),n("p",[n("strong",[e._v("Skipping transactions:")])]),e._v(" "),n("p",[e._v("sql_slave_skip_counter")]),e._v(" "),n("h4",{attrs:{id:"other"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#other"}},[e._v("#")]),e._v(" other")]),e._v(" "),n("p",[e._v("https://dev.mysql.com/doc/mysql-replication-excerpt/8.0/en/replication-problems.html")]),e._v(" "),n("p",[e._v("‰∏çË¶ÅËΩªÊòìÂú®‰∏§Áßç‰∏çÂêåÁöÑreplicationÊ®°ÂºèÈó¥ÂàáÊç¢Ôºö")]),e._v(" "),n("p",[e._v("MySQL 5.7Â§çÂà∂ÈÖçÁΩÆ‰∏çËßÑËåÉ‰øÆÊîπÂØºËá¥ÁöÑÂùëÔºöhttp://blog.itpub.net/28218939/viewspace-2142235/")]),e._v(" "),n("p",[e._v("https://www.cnblogs.com/shengdimaya/p/6897584.html")]),e._v(" "),n("p",[e._v("ref:")]),e._v(" "),n("p",[e._v("https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-centos-7")]),e._v(" "),n("p",[e._v("benchmark: http://www.itsecure.hu/library/image/CIS_Oracle_MySQL_Enterprise_Edition_5.7_Benchmark_v1.0.0.pdf")]),e._v(" "),n("h3",{attrs:{id:"keepalived-mysql-È´òÂèØÁî®"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keepalived-mysql-È´òÂèØÁî®"}},[e._v("#")]),e._v(" Keepalived+ mysql È´òÂèØÁî®")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('-------------------------------------------------------------------------------\n1.\t‰∏§Âè∞ÊúçÂä°ÈÉΩÂÆâË£ÖnginxÂíåkeepalived\n-------------------------------------------------------------------------------\nyum install nginx\nyum install keepalived\n\n\n-------------------------------------------------------------------------------\n2. MYSQL check linux scripts\n-------------------------------------------------------------------------------\nvim /etc/keepalived/scripts/check_mysql.sh\n\nMYSQL=/usr/bin/mysql\nMYSQL_HOST=localhost\nMYSQL_USER=root\nMYSQL_PASSWORD=redhat\n\n$MYSQL -h $MYSQL_HOST -u $MYSQL_USER -p$MYSQL_PASSWORD -e "show status;" >/dev/null 2>&1\n\nif [ $? == 0 ]\nthen\n  echo " $host mysql login successfully"\n  exit 0\nelse\n  #echo " $host mysql login faild" #Ëã•mysqlÂÖ≥Èó≠ÔºåÂàôkeepalivedÂÖ≥Èó≠\n  killall keepalived\n  exit 2\nfi\n\n-------------------------------------------------------------------------------\n4. ‰øÆÊîπkeepalivedÈÖçÁΩÆÊñá‰ª∂\n-------------------------------------------------------------------------------\nsudo vim /etc/keepalived/keepalived.conf \n\n! Configuration File for keepalived \n\nglobal_defs {\n   router_id MYSQL0001    # router_idÂèØÈöèÊÑèÈÖçÁΩÆÔºå‰∏ªÂ§áÊúçÂä°Âô®ÈÖçÁΩÆÈúÄ‰∏çÂêå #ËøêË°åkeepalivedÁöÑÊú∫Âô®ÁöÑ‰∏Ä‰∏™Ê†áËØÜÔºåÈÄöÂ∏∏ÂèØËÆæ‰∏∫hostname„ÄÇÊïÖÈöúÂèëÁîüÊó∂ÔºåÂèëÈÇÆ‰ª∂Êó∂ÊòæÁ§∫Âú®ÈÇÆ‰ª∂‰∏ªÈ¢ò‰∏≠ÁöÑ‰ø°ÊÅØ„ÄÇ\n}\n\nvrrp_script chk_mysql {\n    script "/etc/keepalived/scripts/check_mysql.sh"    #ËÑöÊ≠•Âú∞ÂùÄ\n    interval 300  #ËÑöÊú¨ÊâßË°åÈó¥Èöî 300Áßí\n    weight -5                    #ËÑöÊú¨ÁªìÊûúÂØºËá¥ÁöÑ‰ºòÂÖàÁ∫ßÂèòÊõ¥ÔºåÊ£ÄÊµãÂ§±Ë¥•ÔºàËÑöÊú¨ËøîÂõûÈùû0ÔºâÂàô‰ºòÂÖàÁ∫ß -5\n    fall 2                    #Ê£ÄÊµãËøûÁª≠2Ê¨°Â§±Ë¥•ÊâçÁÆóÁ°ÆÂÆöÊòØÁúüÂ§±Ë¥•„ÄÇ‰ºöÁî®weightÂáèÂ∞ë‰ºòÂÖàÁ∫ßÔºà1-255‰πãÈó¥Ôºâ\n    rise 1                    #Ê£ÄÊµã1Ê¨°ÊàêÂäüÂ∞±ÁÆóÊàêÂäü„ÄÇ‰ΩÜ‰∏ç‰øÆÊîπ‰ºòÂÖàÁ∫ß\n}\n\nvrrp_instance VI_1 { #keepalivedÂú®Âêå‰∏Ävirtual_router_id‰∏≠priorityÔºà0-255ÔºâÊúÄÂ§ßÁöÑ‰ºöÊàê‰∏∫masterÔºå‰πüÂ∞±ÊòØÊé•ÁÆ°VIPÔºåÂΩìpriorityÊúÄÂ§ßÁöÑ‰∏ªÊú∫ÂèëÁîüÊïÖÈöúÂêéÊ¨°priorityÂ∞Ü‰ºöÊé•ÁÆ°\n    state BACKUP    # ‰∏ªÂ§ákeepalivedËäÇÁÇπÊ≠§Â§ÑÂøÖÈ°ªÈÉΩËÆæÁΩÆÊàêBACKUPÔºåÂê¶ÂàôÈùûÊä¢Âç†Ê®°Âºè‰∏çÁîüÊïà\n    interface eth0 #ÊåáÂÆöHAÁõëÊµãÁΩëÁªúÁöÑÊé•Âè£„ÄÇÂÆû‰æãÁªëÂÆöÁöÑÁΩëÂç°ÔºåÂõ†‰∏∫Âú®ÈÖçÁΩÆËôöÊãüIPÁöÑÊó∂ÂÄôÂøÖÈ°ªÊòØÂú®Â∑≤ÊúâÁöÑÁΩëÂç°‰∏äÊ∑ªÂä†ÁöÑ\n    virtual_router_id 54  # Âêå‰∏Ä‰∏™VIPÁöÑvirtual_router_idÂøÖÈ°ª‰∏ÄËá¥ #ËôöÊãüË∑ØÁî±Ê†áËØÜÔºåËøô‰∏™Ê†áËØÜÊòØ‰∏Ä‰∏™Êï∞Â≠óÔºåÂêå‰∏Ä‰∏™vrrpÂÆû‰æã‰ΩøÁî®ÂîØ‰∏ÄÁöÑÊ†áËØÜ„ÄÇÂç≥Âêå‰∏Ävrrp_instance‰∏ãÔºåMASTERÂíåBACKUPÂøÖÈ°ªÊòØ‰∏ÄËá¥ÁöÑ\n    priority 100     # ‰ºòÂÖàÁ∫ßÈÖçÁΩÆÔºåÊï∞Â≠óË∂äÂ§ßÔºå‰ºòÂÖàÁ∫ßË∂äÈ´òÔºà‰∏ªÁöÑÂ§ßÔºå‰ªéÁöÑÂ∞èÔºâ\n    advert_int 1\t#ËÆæÂÆöMASTER‰∏éBACKUPË¥üËΩΩÂùáË°°Âô®‰πãÈó¥ÂêåÊ≠•Ê£ÄÊü•ÁöÑÊó∂Èó¥Èó¥ÈöîÔºåÂçï‰ΩçÊòØÁßí\n    authentication {\t#ËÆæÁΩÆÈ™åËØÅÁ±ªÂûãÂíåÂØÜÁ†Å„ÄÇ‰∏ª‰ªéÂøÖÈ°ª‰∏ÄÊ†∑\n        auth_type PASS\t#ËÆæÁΩÆvrrpÈ™åËØÅÁ±ªÂûãÔºå‰∏ªË¶ÅÊúâPASSÂíåAH‰∏§Áßç\n        auth_pass 1111\t#ËÆæÁΩÆvrrpÈ™åËØÅÂØÜÁ†ÅÔºåÂú®Âêå‰∏Ä‰∏™vrrp_instance‰∏ãÔºåMASTER‰∏éBACKUPÂøÖÈ°ª‰ΩøÁî®Áõ∏ÂêåÁöÑÂØÜÁ†ÅÊâçËÉΩÊ≠£Â∏∏ÈÄö‰ø°\n    }\n    nopreempt        # ÈùûÊä¢Âç†Ê®°ÂºèÔºåÂç≥masterÂ§±ÊïàÂêéÔºåÂ¶ÇÈáçÊñ∞‰∏äÁ∫øÔºåÂ∞Ü‰∏çÊä¢Âç†VIPÔºà‰∏ªÁöÑÈúÄË¶ÅÔºå‰ªéÁöÑ‰∏çÈúÄË¶ÅÔºâ\n    track_script {\n        chk_mysql\n    }\n    track_interface {\n        eth0    \n    }\n    virtual_ipaddress {\n        192.168.100.150    ËôöÊãüIp  #Ê†πÊçÆÊÉÖÂÜµÈÖçÁΩÆËôöÊãüip\n    }\n    notify_master /etc/keepalived/scripts/mysql_master.sh     #ËÑöÊ≠•Âú∞ÂùÄ\n    notify_backup /etc/keepalived/scripts/mysql_slave.sh\n    notify_fault /etc/keepalived/scripts/mysql_fault.sh\n#    notify_stop /etc/keepalived/scripts/mysql_stop.sh\n}\n\n\nÂú®x.x.x.49‰∏äÔºåÂè™ÈúÄË¶ÅÊîπÂèò:\nrouter_id MYSQL0001->MYSQL0002\npriority 101 -> priority 100Ôºå\nmcast_src_ip x.x.x.48 -> mcast_src_ip x.x.x.49Âç≥ÂèØ„ÄÇ\n\n-------------------------------------------------------------------------------\n5. ÂêØÂä®\n-------------------------------------------------------------------------------\n\nsystemctl start keepalived\n\nip addr show eth0\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP qlen 1000\n    link/ether 56:6f:18:fa:00:08 brd ff:ff:ff:ff:ff:ff\n    inet x.x.x.49/24 brd x.x.x.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet x.x.x.44/32 scope global eth0\n       valid_lft forever preferred_lft forever\n\nÂÜçÂêØÂä®Âè¶Â§ñ‰∏Ä‰∏™Êú∫Âô®ÁöÑkeepalivedÔºåÊâßË°å ip addr show eth0 Âπ∂‰∏ç‰ºöÊúâÁ±ª‰ºº‰∏äÈù¢ÁöÑËæìÂá∫ÔºåÈô§ÈùûÊòØÂú®ÂâçÈù¢ÁöÑÊú∫Âô®‰∏äÊâßË°å systemctl stop keepalived\n\nÊüêÂè∞Êú∫Âô®Ë¢´ÈÄâ‰∏≠ÁöÑÊó∂ÂÄô‰ºöÂá∫Áé∞Â¶Ç‰∏ãÊó•ÂøóÔºå/var/log/messages Ôºö\n\nJun 15 17:01:08 vm2-devclr-v08 Keepalived_vrrp[4850]: VRRP_Instance(VI_1) Transition to MASTER STATE\nJun 15 17:01:09 vm2-devclr-v08 Keepalived_vrrp[4850]: VRRP_Instance(VI_1) Entering MASTER STATE\nJun 15 17:01:09 vm2-devclr-v08 Keepalived_vrrp[4850]: VRRP_Instance(VI_1) setting protocol VIPs.\nJun 15 17:01:09 vm2-devclr-v08 Keepalived_vrrp[4850]: Sending gratuitous ARP on eth0 for x.x.x.44\nJun 15 17:01:09 vm2-devclr-v08 Keepalived_vrrp[4850]: VRRP_Instance(VI_1) Sending/queueing gratuitous ARPs on eth0 for x.x.x.44\nJun 15 17:01:09 vm2-devclr-v08 Keepalived_vrrp[4850]: Sending gratuitous ARP on eth0 for x.x.x.44\n\n-------------------------------------------------------------------------------\n5. Áä∂ÊÄÅÊ£ÄÊµã\n-------------------------------------------------------------------------------\nsudo tcpdump -vvv -n -i eth0 dst 224.0.0.18 and src x.x.x.48\n')])])]),n("h2",{attrs:{id:"_6-system-table"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-system-table"}},[e._v("#")]),e._v(" 6 System Table")]),e._v(" "),n("p",[e._v("sys\ninformation_schema\nperformance_schema\nmysql")]),e._v(" "),n("h2",{attrs:{id:"_7-troubleshooting"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-troubleshooting"}},[e._v("#")]),e._v(" 7 Troubleshooting")]),e._v(" "),n("p",[e._v("vim /var/log/mysqld.log\nÊ≥®ÊÑèÔºåÈªòËÆ§Êó∂Âå∫‰∏∫ UTC")]),e._v(" "),n("h3",{attrs:{id:"host-xxx-xx-xxx-xxx-is-not-allowed-to-connect-to-this-mysql-server"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#host-xxx-xx-xxx-xxx-is-not-allowed-to-connect-to-this-mysql-server"}},[e._v("#")]),e._v(" Host 'xxx.xx.xxx.xxx' is not allowed to connect to this MySQL server**")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("CREATE USER 'test'@'%' IDENTIFIED BY '123456';\nGRANT ALL PRIVILEGES ON * . * TO 'test'@'%';\nFLUSH PRIVILEGES;\n")])])]),n("h3",{attrs:{id:"mysql-workbench-the-type-initializer-for-htmlrenderer-utils-fontsutils-threw-an-exception"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql-workbench-the-type-initializer-for-htmlrenderer-utils-fontsutils-threw-an-exception"}},[e._v("#")]),e._v(" mysql workbench The type initializer for 'HtmlRenderer.Utils.FontsUtils' threw an exception.**")]),e._v(" "),n("p",[e._v("http://stackoverflow.com/questions/32020024/upgrading-to-windows-10-breaks-mysql-workbench\nhttps://bugs.mysql.com/bug.php?id=75344")]),e._v(" "),n("h3",{attrs:{id:"mysqldump-stored-procedure-routines-faild"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysqldump-stored-procedure-routines-faild"}},[e._v("#")]),e._v(" mysqldump stored procedure --routines faild")]),e._v(" "),n("p",[e._v("mysqldump: test_dbuser has insufficent privileges to SHOW CREATE PROCEDURE "),n("code",[e._v("pTEST")]),e._v("!")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("ÊúÄÂºÄÂßãÊòØÂá∫Áé∞\nERROR 1227 (42000) at line 5632: Access denied; you need (at least one of) the SUPER privilege(s) for this operation\n\n5618 --\n5619 -- Dumping routines for database 'db01'\n5620 --\n5621 /*!50003 DROP PROCEDURE IF EXISTS `pTEST1` */;\n5622 ALTER DATABASE `db01` CHARACTER SET utf8 COLLATE utf8_general_ci ;\n5623 /*!50003 SET @saved_cs_client      = @@character_set_client */ ;\n5624 /*!50003 SET @saved_cs_results     = @@character_set_results */ ;\n5625 /*!50003 SET @saved_col_connection = @@collation_connection */ ;\n5626 /*!50003 SET character_set_client  = utf8 */ ;\n5627 /*!50003 SET character_set_results = utf8 */ ;\n5628 /*!50003 SET collation_connection  = utf8_general_ci */ ;\n5629 /*!50003 SET @saved_sql_mode       = @@sql_mode */ ;\n5630 /*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;\n5631 DELIMITER ;;\n5632 CREATE DEFINER=`test_dbuser`@`%` PROCEDURE `pTEST1`(IN i_asof DATE)\n5633 BEGIN\n5634 \n5635         DECLARE EXIT HANDLER FOR SQLEXCEPTION\n5636     BEGIN\n\nÂèØ‰ª•ÁúãÂà∞ 5632 CREATE DEFINER=`test_dbuser`@`%` PROCEDURE `pTEST1`(IN i_asof DATE)\nÊâÄ‰ª•ÊàëÂ∞±Áõ¥Êé•\nmysql> GRANT SUPER ON *.* TO 'test_dbuser'@'%';                                                                \nÁÑ∂ÂêéÂêéÊù•ÊàëÊÉ≥Âà∞ÂÆûÈôÖ‰∏äÊâßË°åmysqldumpÁöÑËØ≠Âè•ÊòØ\nmysqldump --login-path=cn-dev-v01 --set-gtid-purged=OFF --no-tablespaces db01 >test\ncn-dev-v01ÁöÑhostÊòØlocalhostÔºå‰∏çÊòØ%ÔºåÂèØ‰ª•ÁúãÂà∞CREATE DEFINER=`test_dbuser`@`%` ‰∏çÊòØ @`localhost`\nÁÑ∂ÂêéÊàëÊÉ≥ÁùÄËÆæÁΩÆcn-dev-v01 login path host‰∏∫%Ôºå‰ΩÜÊòØÂ§±Ë¥•ÔºåÂõ†‰∏∫%Êó†Ê≥ïËß£ÊûêÔºåËá™ÁÑ∂Êó†Ê≥ïËøûÊé•dbÔºåÂè™Â•ΩÊîπÂõûÊù•Ôºå\nÁÑ∂ÂêéÂÜçËØïÂèëÁé∞ÂèàÊúâÈóÆÈ¢òÔºö\nmysqldump: test_dbuser has insufficent privileges to SHOW CREATE PROCEDURE `pTEST1`!\nÊü•‰∫Ü‰∏ã\nhttps://dba.stackexchange.com/questions/184724/permissions-for-mysql-show-create-procedure\nTo use either statement, you must be the user named in the routine DEFINER clause or have SELECT access to the mysql.proc table. If you do not have privileges for the routine itself, the value displayed for the Create Procedure or Create Function field will be NULL. \nhttps://dev.mysql.com/doc/refman/5.7/en/show-create-procedure.html\nË¶ÅÁªôSELECTÊùÉÈôêÔºåSUPER‰∏çÂåÖÂê´SELECTÊùÉÈôêÔºüÔºü\nmysql> grant SELECT ON *.* TO 'test_dbuser'@'localhost';\nÂ∞±Â•Ω‰∫Ü\n\nÁÑ∂ÂêéÂèàÊÉ≥Âà∞ÔºåÊó¢ÁÑ∂'%'ÂåÖÂê´'localhost'ÔºåÂπ≤ËÑÜÁõ¥Êé•Âà†Êéâ test_dbuser@'localhost'\nDROP USER 'test_dbuser'@'localhost';\nËøôÊ¨°ËôΩÁÑ∂Ê≤°Êúâ\nmysqldump: test_dbuser has insufficent privileges to SHOW CREATE PROCEDURE `pTEST1`!\n‰ΩÜÊòØÂè¶Â§ñ‰∏Ä‰∏™db02ËøòÊòØÊúâËøô‰∏™ÈóÆÈ¢ò\nmysqldump: test_dbuser has insufficent privileges to SHOW CREATE PROCEDURE `pTEST2`!\n\n1994 DELIMITER ;\n1995 /*!50003 SET sql_mode              = @saved_sql_mode */ ;\n1996 /*!50003 SET character_set_client  = @saved_cs_client */ ;\n1997 /*!50003 SET character_set_results = @saved_cs_results */ ;\n1998 /*!50003 SET collation_connection  = @saved_col_connection */ ;\n1999 /*!50003 DROP PROCEDURE IF EXISTS `pTEST2` */;\n2000 /*!50003 SET @saved_cs_client      = @@character_set_client */ ;\n2001 /*!50003 SET @saved_cs_results     = @@character_set_results */ ;\n2002 /*!50003 SET @saved_col_connection = @@collation_connection */ ;\n2003 /*!50003 SET character_set_client  = utf8 */ ;\n2004 /*!50003 SET character_set_results = utf8 */ ;\n2005 /*!50003 SET collation_connection  = utf8_general_ci */ ;\n2006 /*!50003 SET @saved_sql_mode       = @@sql_mode */ ;\n2007 /*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;\n2008 DELIMITER ;;\n2009 CREATE DEFINER=`test_dbuser`@`%` PROCEDURE `pTEST2`(IN i_asof DATE)\n2010 BEGIN\n2011 \n2012         DECLARE EXIT HANDLER FOR SQLEXCEPTION\n2013     BEGIN\n\nÂÜçÊääSELECTÂä†Áªô'test_dbuser'@'%'Âç≥ÂèØ\nmysql> grant SELECT ON *.* TO 'test_dbuser'@'%';\nÊúÄÂêérevokeÊéâSUPERÊùÉÈôêÂÜçËØï\nmysql> revoke SUPER ON *.* FROM 'test_dbuser'@'%';\n‰ªçÁÑ∂ÊàêÂäü\n")])])]),n("h3",{attrs:{id:"script-import-issue"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#script-import-issue"}},[e._v("#")]),e._v(" script import issue;")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("-- Set new delimiter '$$'\nDELIMITER $$\n-- Set default delimiter ';'\nDELIMITER ;\n")])])]),n("h3",{attrs:{id:"fixing-lock-wait-timeout-exceeded-try-restarting-transaction-for-a-stuck-mysql-table"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#fixing-lock-wait-timeout-exceeded-try-restarting-transaction-for-a-stuck-mysql-table"}},[e._v("#")]),e._v(" Fixing ‚ÄúLock wait timeout exceeded; try restarting transaction‚Äù for a 'stuck\" Mysql table?")]),e._v(" "),n("p",[e._v("https://stackoverflow.com/questions/5836623/getting-lock-wait-timeout-exceeded-try-restarting-transaction-even-though-im")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("show processlist;\nkill <put_process_id_here>; ÂÖàÂπ≤ÊéâËÄóÊó∂ÈïøÁöÑprocess\n")])])]),n("h3",{attrs:{id:"upgrade-trouble-shooting"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#upgrade-trouble-shooting"}},[e._v("#")]),e._v(" upgrade trouble shooting")]),e._v(" "),n("p",[e._v("https://dev.mysql.com/doc/refman/5.7/en/upgrade-troubleshooting.html")]),e._v(" "),n("h3",{attrs:{id:"access-denied-for-user-root-localhost-using-password-no-when-trying-to-connect"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#access-denied-for-user-root-localhost-using-password-no-when-trying-to-connect"}},[e._v("#")]),e._v(" Access denied for user 'root'@'localhost' (using password: NO) when trying to connect**")]),e._v(" "),n("p",[e._v("ÈÄöÂ∏∏ÊòØÂõ†‰∏∫ËæìÂÖ•‰∫Ü‰∏≠ÊñáÂ≠óÁ¨¶ÁöÑdash -- ÊàñËÄÖ‰ªéwordÊñáÊ°£copyÂá∫Êù•ÁöÑÈîôËØØÁºñÁ†ÅÁöÑÂèÇÊï∞Á¨¶Âè∑--")]),e._v(" "),n("h3",{attrs:{id:"ÈöèÊú∫Âá∫Áé∞ÁöÑconnection-timeout"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ÈöèÊú∫Âá∫Áé∞ÁöÑconnection-timeout"}},[e._v("#")]),e._v(" ÈöèÊú∫Âá∫Áé∞ÁöÑconnection timeout")]),e._v(" "),n("h5",{attrs:{id:"Ëµ∑Âõ†ÊòØduirdËøûÊé•Ê±†Êä•Èîô"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#Ëµ∑Âõ†ÊòØduirdËøûÊé•Ê±†Êä•Èîô"}},[e._v("#")]),e._v(" Ëµ∑Âõ†ÊòØduirdËøûÊé•Ê±†Êä•Èîô")]),e._v(" "),n("p",[e._v("Êàë‰ª¨ÁöÑ‰∏Ä‰∏™springbootÁ®ãÂ∫è ‰ΩøÁî®‰∫ÜÈòøÈáådruidÔºå‰πãÂâçÈÉΩÂ•ΩÂ•ΩÁöÑÔºå‰∏äÂà∞Áîü‰∫ßÈÅáÂà∞Âá†Ê¨°ÊØîËæÉÈöèÊú∫ÁöÑÈîôËØØÔºö")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("Caused by: com.alibaba.druid.pool.GetConnectionTimeoutException: wait millis 60000, active 0, maxActive 500, creating 1, createElapseMillis 120001\n\tat com.alibaba.druid.pool.DruidDataSource.getConnectionInternal(DruidDataSource.java:1682)\n\tat com.alibaba.druid.pool.DruidDataSource.getConnectionDirect(DruidDataSource.java:1395)\n\tat com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1375)\n\tat com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1365)\n\tat com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:109)\n\tat org.springframework.jdbc.datasource.DataSourceTransactionManager.doBegin(DataSourceTransactionManager.java:262)\n\nÈíàÂØπËøô‰∏™ÈóÆÈ¢ò‰∏™‰∫∫ÂàÜÊûêÊñπÊ≥ïÂèäËß£ÂÜ≥ÊñπÊ°à Ôºö\n1„ÄÅ‰ª£Á†Å‰∏≠Â≠òÂú®Ëé∑ÂèñDataSource Connection Ê≤°ÊúâÈáäÊîæÁöÑÊÉÖÂÜµÔºåÂèØÊü•ËØ¢‰∏öÂä°‰ª£Á†ÅÊòØÂê¶Â≠òÂú® Êú™ÈáäÊîæÁé∞Ë±°„ÄÇ\n2„ÄÅÁ®ãÂ∫èÂπ∂ÂèëÊï∞ÈáèÂ§ßÊàñËÄÖSQLÊâßË°åËæÉÊÖ¢ÔºåÊï∞ÊçÆÂ∫ìËøûÊé•ÈÖçÁΩÆÂ§™Â∞èÔºåÂèØÂ¢ûÂ§ßmaxActiveÂèÇÊï∞„ÄÅÂ¢ûÂ§ßwait millis ÂèÇÊï∞„ÄÇ\n3„ÄÅÊ£ÄÊü•Êï∞ÊçÆÂ∫ìËøûÊé•Êï∞ÊòØÂê¶ÈÖçÁΩÆËøá‰ΩéÔºåLinuxÊñá‰ª∂Âè•ÊüÑÊï∞ÊòØÂê¶ÈúÄË¶ÅË∞ÉÊï¥\n4„ÄÅÊ≠§ÈóÆÈ¢òÈùûdruidÊ°ÜÊû∂ÂºïÂèëÔºåÂª∫ËÆÆ‰ªé‰∏öÂä°‰ª£Á†Å„ÄÅÂπ∂ÂèëÈáèËøõË°åÂàÜÊûêÊéíÊü•„ÄÇÂ¶ÇËã•druidÁâàÊú¨Ëøá‰ΩéÂèØÂçáÁ∫ßÔºå‰πüÂèØÈÖçÁΩÆÂº∫Âà∂ÈáäÊîæËøûÊé•„ÄÇ\n‰ª•‰∏ãÈÖçÁΩÆÔºö\nspring.datasource.druid.log-abandoned=true\nspring.datasource.druid.remove-abandoned=true\n#ÂèØÊ†πÊçÆÂÖ∑‰ΩìÊÉÖÂÜµÈÖåÊÉÖÈÖçÁΩÆÂõûÊî∂Êó∂Èó¥\nspring.datasource.druid.remove-abandoned-timeout=300\n\n\n###mysql show connections\nshow processlist;\nshow variables like 'max_connections';\nselect substring_index(host,':' ,1) as client_ip,Command,Time from information_schema.processlist;\n\n### linuxÂè•ÊüÑÊï∞ÊéíÈîô mysql\nhttps://blog.csdn.net/qq_28423997/article/details/87880653\nhttps://blog.csdn.net/fygkchina/article/details/106537736\n\n### mysql timeout\nvi /etc/my.cnf\n wait_timeout = 28800\n interactive_timeout = 28800\n select @@wait_timeout; \n \n\n### druid VS hikari\nhttps://github.com/alibaba/druid/issues/3720\n")])])]),n("p",[e._v("Ê†∏ÂøÉÁöÑÊèêÁ§∫Â∞±ÊòØËøô‰∏™Ôºö")]),e._v(" "),n("p",[e._v("Caused by: com.alibaba.druid.pool.GetConnectionTimeoutException: wait millis 60000, active 0, maxActive 500, creating 1, createElapseMillis 120001")]),e._v(" "),n("p",[e._v("Ê†πÊçÆÊàëÁõÆÂâçÊü•Âà∞ÁöÑÔºåËÉΩÁü•ÈÅìÁöÑÊòØÔºåÊäõÂá∫ÂºÇÂ∏∏Êó∂ÔºåÊ±†Â≠êÈáåÁöÑactive ConnectionÊòØ0ÔºåÊâÄ‰ª•‰∏çÂ≠òÂú®Ê±†Â≠êÊª°‰∫ÜÁöÑÊÉÖÂÜµÔºåÂè¶Â§ñcreating 1Â∫îËØ•ÊòØ‰ª£Ë°®ÈúÄË¶ÅÂàõÂª∫‰∏Ä‰∏™connectionÔºå‰ΩÜÊòØ‰∏çÁü•ÈÅìÂõ†‰∏∫‰ªÄ‰πàÂéüÂõ†ÔºåÂàõÂª∫Ë∂ÖËøá‰∫ÜÊàë‰ª¨ËÆæÁΩÆÁöÑmaxWait=60000‰πüÂ∞±ÊòØ1ÂàÜÈíüÔºåcreateElapseMillis 120001ÊÑèÊÄùÂ∫îËØ•ÊòØÂàõÂª∫Ë∂ÖËøá‰∫Ü‰∏§ÂàÜÈíü")]),e._v(" "),n("p",[e._v("Áî±‰∫é‰πãÂâçÂÖ∂‰ªñÁéØÂ¢ÉÊ≤°ÊúâÈÅáÂà∞ËøáÔºåÊØîËæÉÂÄæÂêë‰∫éÊòØÊúçÂä°Á´ØÈóÆÈ¢òÊàñÁΩëÁªúÈóÆÈ¢òÔºåÊÄªÁªìÂèØËÉΩÁöÑÈóÆÈ¢òÂ¶Ç‰∏ã")]),e._v(" "),n("p",[e._v("1.ÊúçÂä°Á´ØÔºö\n1ÔºâmysqlÔºöÊ†πÊçÆlogÁöÑwarnÔºåÂ•ΩÂÉèËøô‰∏™ÁâàÊú¨ÊòØÁªèËøáÂçáÁ∫ßÁöÑÔºå‰ΩÜÊòØÊ≤°ÊúâÂçáÁ∫ßÂÆåÂÖ®ÔºåÈúÄË¶ÅÊâßË°å‰∏ãmysql_upgradeÔºå‰∏çÁü•ÈÅìÊòØÂê¶ÊúâÂΩ±ÂìçÔºõ")]),e._v(" "),n("p",[e._v("[Warning] InnoDB: Table mysql/innodb_table_stats has length mismatch in the column name table_name.  Please run mysql_upgrade")]),e._v(" "),n("p",[e._v("2ÔºâÁΩëÁªúÊ≥¢Âä®Ôºå‰∏çÊ∏ÖÊ•ö‰∏§Âè∞Êú∫Âô®ÁöÑÈÉ®ÁΩ≤ÊÉÖÂÜµ")]),e._v(" "),n("p",[e._v("2.ÈÖçÁΩÆÈóÆÈ¢òÔºö\n1Ôºâmysql connection string‰ΩøÁî®ÁöÑÊòØserverTimezone=Asia/ShanghaiÔºåÊúçÂä°Âô®‰ΩøÁî®ÁöÑÂ∫îËØ•ÊòØSGT Asia/SingaporeÔºå‰∏çËøáËøô‰∏™ÊÑüËßâÂ∫îËØ•Ê≤°ÊúâÂΩ±ÂìçÔºåÂõ†‰∏∫ÈÉΩÊòØ‰∏úÂÖ´Âå∫\n2ÔºâdruidÈÖçÁΩÆÈóÆÈ¢òÔºåÂÆòÊñπÂª∫ËÆÆmysql‰∏çË¶ÅÂºÄÂêØmaxPoolPreparedStatementPerConnectionSizeÔºåÁõÆÂâçÁä∂ÊÄÅÊòØÂºÄÂêØ‰∫Ü")]),e._v(" "),n("p",[e._v("3.druidÊú¨Ë∫´ÈóÆÈ¢òÔºö\n1ÔºâÁâàÊú¨Ëøá‰ΩéÔºåÁõÆÂâç‰ΩøÁî®ÁöÑ1.1.20ÊòØ19Âπ¥ÁöÑÁâàÊú¨Ôºå‰ΩÜÊòØÊàëÊ≤°ÊúâÁúãÂà∞‰ªª‰ΩïÊñ∞ÁâàÊú¨ÁöÑrelease noteÊèêÂà∞‰∫ÜÊàë‰ª¨ÈÅáÂà∞ÁöÑÈóÆÈ¢òÔºå‰∏çËøáÊúâ‰∫∫ÈÄöËøáÂçáÁ∫ßËß£ÂÜ≥‰∫ÜÈóÆÈ¢ò\n2ÔºâdruidÊú¨Ë∫´ÁöÑÁº∫Èô∑ÔºåÊàëÁúãÂà∞duird ‰∏Ä‰∫õÂºÄÊîæÁöÑissueÂíåÂÖ≥Èó≠ÁöÑissue‰ªéÂá†Âπ¥ÂâçÂà∞ÊúÄËøëÈÉΩÊúâ‰∫∫ÊèêÂà∞Ëøô‰∏™ÈóÆÈ¢òÔºå‰ΩÜÊòØÂÆòÊñπÊ≤°ÊúâÁªôÂá∫‰ªª‰ΩïÂõûÂ∫îÂíåËß£ÂÜ≥ÔºåÁÑ∂ÂêéÊúâ‰∫∫ÈÄöËøáÊîæÂºÉÈòøÈáåÁöÑdruidÔºå‰ΩøÁî®ÂÖ∂‰ªñËøûÊé•Ê±†Ëß£ÂÜ≥‰∫Ü")]),e._v(" "),n("p",[e._v("https://github.com/alibaba/druid/issues/3720\nhttps://github.com/alibaba/druid/issues/2130\n"),n("a",{attrs:{href:"https://github.com/alibaba/druid/wiki/DruidDataSource%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/alibaba/druid/wiki/DruidDataSource%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8"),n("OutboundLink")],1)]),e._v(" "),n("h5",{attrs:{id:"ËÑöÊú¨ËøûÊé•Êï∞ÊçÆÂ∫ì‰πüÈöèÊú∫Âá∫Èîô"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ËÑöÊú¨ËøûÊé•Êï∞ÊçÆÂ∫ì‰πüÈöèÊú∫Âá∫Èîô"}},[e._v("#")]),e._v(" ËÑöÊú¨ËøûÊé•Êï∞ÊçÆÂ∫ì‰πüÈöèÊú∫Âá∫Èîô")]),e._v(" "),n("p",[e._v("Êé•ÁùÄÔºåÂêå‰∫ãÂèçÈ¶àcron job‰πüÈÅáÂà∞ËøáÂá†Ê¨°Á±ª‰ººÈóÆÈ¢ò:")]),e._v(" "),n("p",[e._v("error 2003 (hy000) can't connect to mysql server 110")]),e._v(" "),n("p",[e._v("https://blog.csdn.net/qq1137623160/article/details/78927741")]),e._v(" "),n("p",[e._v("ÊúÄÂêéÂÖ∂ÂÆûÊÑüËßâÁõÆÂâçÁº∫Â∞ëÁöÑÊòØÔºö")]),e._v(" "),n("p",[e._v("ÁõëÊéßÂíåload test performance test")]),e._v(" "),n("p",[e._v("https://segmentfault.com/a/1190000022336871")]),e._v(" "),n("h5",{attrs:{id:"ÂèëÁé∞Á´ØÂÄ™-aborted-connects"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ÂèëÁé∞Á´ØÂÄ™-aborted-connects"}},[e._v("#")]),e._v(" ÂèëÁé∞Á´ØÂÄ™ Aborted_connects")]),e._v(" "),n("p",[e._v("ÁûÑ‰∫ÜÁúºËøôÁØáÊñáÁ´†ÔºåÊÉ≥Âà∞ÂøòËÆ∞ËÆ§ÁúüÁúã‰∏ãËøûÊé•Êï∞")]),e._v(" "),n("p",[e._v("https://www.jianshu.com/p/07c85b8a7997")]),e._v(" "),n("p",[e._v("ÊâßË°å netstat -anp|grep 3306 Â§ßÊ¶Ç‰∏âÂçÅÂ§ö‰∏™ÔºåËøòÁÆóÊ≠£Â∏∏ÔºåÁÑ∂Âêé")]),e._v(" "),n("p",[e._v("show global status like '%connection%';")]),e._v(" "),n("p",[e._v("ÁªìÊûúÔºöConnections=7772 Max_used_connections=60")]),e._v(" "),n("p",[e._v("Êü•‰∫Ü‰∏ãÔºåÂ•ΩÂÉèÊòØÊåáÊúçÂä°Âô®ÂêØÂä®‰πãÂêéÁ¥ØÁßØÁöÑÔºåÊâÄ‰ª•Ê≤°Êúâ‰ªÄ‰πàÂèÇËÄÉÊÑè‰πâ")]),e._v(" "),n("p",[e._v("ConnectionsÔºöThe number of connection attempts (successful or not) to the MySQL server.\nMax_used_connectionsÔºöThe maximum number of connections that have been in use simultaneously since the server started.")]),e._v(" "),n("p",[e._v("show global status like '%thread%';")]),e._v(" "),n("p",[e._v("ÁªìÊûúÔºöThreads_cached=8\tThreads_connected=34\tThreads_created=2232\tThreads_running=1")]),e._v(" "),n("p",[e._v("Threads_createdÂ∫îËØ•‰πüÊòØÁ¥ØËÆ°ÁöÑÔºåThreads_connectedÂ∫îËØ•ÊòØÂΩìÂâçÁöÑÔºåÁ°ÆÂÆûË∑üÂâçÈù¢netstatÂ∑Æ‰∏çÂ§ö")]),e._v(" "),n("p",[e._v("show processlist;")]),e._v(" "),n("p",[e._v("ÁªìÊûúÊòæÁ§∫‰∏âÂçÅÂ§ö‰∏™Á®ãÂ∫èÔºåÂ§ßÈÉ®ÂàÜÈÉΩÊòØsleepÁä∂ÊÄÅÔºåÂîØ‰∏ÄrunningÁöÑÊòØÊàëÂΩìÂâçÊü•ËØ¢ÁöÑËøô‰∏™Á∫øÁ®ãÔºõ")]),e._v(" "),n("p",[e._v("Á°ÆËÆ§‰∫Ü‰∏ãÊúÄÂ§ßËøûÊé•Êï∞")]),e._v(" "),n("p",[e._v('SHOW VARIABLES LIKE "max_connections";')]),e._v(" "),n("p",[e._v("ÁªìÊûúÊòØ151ÈªòËÆ§ÂÄºÔºåËøúË∂Ö34ÔºåÂ∫îËØ•Ê≤°‰ªÄ‰πàÈóÆÈ¢òÔºå‰ΩÜÊòØÊÄªÊÑüËßâËøô‰∫õsleepÁä∂ÊÄÅÁöÑthreads/connectionsÊúâ‰∫õÈóÆÈ¢òÔºå")]),e._v(" "),n("p",[e._v("ÁÑ∂ÂêéÁúãÂà∞‰∫ÜËøô‰∏™")]),e._v(" "),n("p",[e._v("show global status like '%aborted%';")]),e._v(" "),n("p",[e._v("ÁªìÊûúÔºöAborted_clients 1095\tAborted connections 9")]),e._v(" "),n("p",[e._v("Ëøô‰∏™ÊúâÁÇπÊÑèÊÄùÔºö")]),e._v(" "),n("p",[e._v("Aborted_clientsÔºöThe number of connections that were aborted because the client died without closing the connection properly.")]),e._v(" "),n("p",[e._v("Aborted_connectsÔºöThe number of failed attempts to connect to the MySQL server.")]),e._v(" "),n("p",[e._v("ÁÑ∂ÂêéÁåúÊµãÂ¶Ç‰∏ãÔºö\nAborted_clients=1095, big number, probably means that we have some clients(app or scripts) connected to mysql, but failed to close mysql connections properly, caused lots of sleep threads/connections in mysql processlist;\nat some point in time, it may reached the max connections limit;\nand then some new connection request coming in, mysql then start to recycle zombies, most of the time is fine, but sometimes may delayed some seconds because of recycle taking time, caused Aborted_connects=9, small number, quite random")]),e._v(" "),n("p",[e._v("Ê†πÊçÆAborted_connectsÊñáÊ°£ÊèêÁ§∫Ôºö")]),e._v(" "),n("p",[e._v("For additional connection-related information, check the   "),n("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/server-status-variables.html#statvar_Connection_errors_xxx",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Connection_errors_*")]),e._v("xxx"),n("code",[e._v("*")]),n("OutboundLink")],1),e._v("   status variables and the "),n("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/performance-schema-host-cache-table.html",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("host_cache")]),n("OutboundLink")],1),e._v(" table.")]),e._v(" "),n("p",[e._v("show global status like '%errors%';")]),e._v(" "),n("p",[e._v("select * from performance_schema.host_cache;")]),e._v(" "),n("p",[e._v("‰∏çËøáÂπ∂Ê≤°Êúâ‰ªÄ‰πàÂèëÁé∞")]),e._v(" "),n("h3",{attrs:{id:"my-cnf-not-working"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#my-cnf-not-working"}},[e._v("#")]),e._v(" my.cnf not working")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("ËÆæÁΩÆ‰∏ª‰ªéÊó∂Ôºå\nchange master toÂ§±Ë¥•Ôºö\n\nERROR 1794 (HY000): Slave is not configured or failed to initialize properly. You must at least set --server-id to enable either a master or a slave. Additional error messages can be found in the MySQL error log.\n\nÂàöÂºÄÂßã‰ΩøÁî®‰∫Ü  mysqld --verbose --help Êù•È™åËØÅ my.cnfÊòØÂê¶ÊúâÊïàÔºåÁúãÂà∞ËæìÂá∫Á°ÆÂÆûÊòØÂØπÁöÑ\n‰ΩÜÊòØÂÆûÈôÖ‰∏äËøû‰∏äÊï∞ÊçÆÂ∫ìÂêéÊâßË°åÔºö\nmysql> SHOW GLOBAL VARIABLES like 'server\\_id';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| server_id     | 0     |\n+---------------+-------+\n1 row in set (0.00 sec)\nÂèØ‰ª•ÁúãÂà∞Âπ∂Ê≤°ÊúâÁîüÊïà\n\nÊü•Áúã‰∫Ümy.cnf‰πüÊ≤°Êúâ‰ªÄ‰πàÂºÇÂ∏∏ÔºåÊÄÄÁñëÊòØÊùÉÈôê\n#ll /etc/my.cnf\n-rw-r----- 1 root root 2112 Aug  2 10:24 /etc/my.cnf\nÂèØ‰ª•ÁúãÂà∞Èô§‰∫Üroot‰πãÂ§ñÁöÑÁî®Êà∑ÈÉΩÊ≤°ÊúâËØªÂèñÊùÉÈôê,\nËôΩÁÑ∂ÂêØÂä®mysqldÂ•ΩÂÉèÊòØÈÄöËøárootÔºöservice mysqld startÔºå‰ΩÜÊòØÂÆûÈôÖ‰ΩøÁî®my.cnfÁöÑÁî®Êà∑Â∫îËØ•ÊòØÔºö\n/etc/passwd\nmysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/false\n\nÊõ¥ÊîπÊùÉÈôêÔºåÈáçÂêØÂç≥ÂèØ\nchmod o+r /etc/my.cnf\n\nË°•ÂÖÖÔºö\n#service mysqld status\nRedirecting to /bin/systemctl status  mysqld.service\n‚óè mysqld.service - MySQL Server\n   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)\n   Active: active (running) since Mon 2021-08-02 15:59:34 SGT; 58min ago\n     Docs: man:mysqld(8)\n           http://dev.mysql.com/doc/refman/en/using-systemd.html\n  Process: 15300 ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS (code=exited, status=0/SUCCESS)\n  Process: 15282 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS)\n Main PID: 15303 (mysqld)\n   CGroup: /system.slice/mysqld.service\n           ‚îî‚îÄ15303 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid\nÊü•Áúã‰∫ÜÂêØÂä®ËÑöÊú¨/usr/lib/systemd/system/mysqld.service‰πüÊ≤°ÊúâÂèëÁé∞‰ªÄ‰πàÂºÇÂ∏∏\n\nÊâæÂà∞ÂêØÂä®ËÑöÊú¨ /usr/lib/systemd/system/mysqld.serviceÔºö\n„ÄÇ„ÄÇ„ÄÇ„ÄÇ„ÄÇ\n[Service]\nUser=mysql\nGroup=mysql\n„ÄÇ„ÄÇ„ÄÇ„ÄÇ\n# Start main service\nExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS\n„ÄÇ„ÄÇ„ÄÇ„ÄÇ„ÄÇ„ÄÇ\n\nÂèØ‰ª•ÁúãÂà∞ÂêØÂä®mysqldÁúüÊ≠£ÁöÑÁî®Êà∑ÊòØmysql\n\n")])])]),n("h3",{attrs:{id:"replication-issues"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#replication-issues"}},[e._v("#")]),e._v(" Replication Issues")]),e._v(" "),n("h4",{attrs:{id:"replication-issues-handler-error-ha-err-key-not-found"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#replication-issues-handler-error-ha-err-key-not-found"}},[e._v("#")]),e._v(" Replication Issues::handler error HA_ERR_KEY_NOT_FOUND")]),e._v(" "),n("p",[e._v("A<->B Âèå‰∏ªÔºå‰∫í‰∏∫‰∏ªÂ§á")]),e._v(" "),n("p",[e._v("A:\nmysql> show master status;\n+------------------+-----------+--------------+------------------+---------------------------------------------------------------------------------------------+\n| File             | Position  | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set                                                                           |\n+------------------+-----------+--------------+------------------+---------------------------------------------------------------------------------------------+\n| mysql-bin.000019 | 785823599 |              |                  | 4a79ada9-5f9c-11eb-8dea-525400b19818:1-2642682,\n52a0ed6b-5f9c-11eb-b408-525400f12e4f:1-1183 |\n+------------------+-----------+--------------+------------------+---------------------------------------------------------------------------------------------+\nmysql> show slave status\\G;\nLast_SQL_Error: Could not execute Delete_rows event on table XXXX; Can't find record in 'XXXX', Error_code: 1032; handler error HA_ERR_KEY_NOT_FOUND; the event's master log mysql-bin.000006, end_log_pos 51662949")]),e._v(" "),n("p",[e._v("Âà∞ËØ•Êú∫Âô®ÁöÑmasterÊú∫Âô®B‰∏äÊâæ:\nmysql> show master status;\n+------------------+-----------+--------------+------------------+---------------------------------------------------------------------------------------------+\n| File             | Position  | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set                                                                           |\n+------------------+-----------+--------------+------------------+---------------------------------------------------------------------------------------------+\n| mysql-bin.000011 | 909786110 |              |                  | 4a79ada9-5f9c-11eb-8dea-525400b19818:1-2642666,\n52a0ed6b-5f9c-11eb-b408-525400f12e4f:1-1186 |\n+------------------+-----------+--------------+------------------+---------------------------------------------------------------------------------------------+\nÊ≥®ÊÑèÂà∞A‰∏ä52a0ed6b-5f9c-11eb-b408-525400f12e4f:1-1183ÔºåBÊòØ52a0ed6b-5f9c-11eb-b408-525400f12e4f:1-1186\nBÂ∞±ÊòØ52a0ed6b-5f9c-11eb-b408-525400f12e4fÔºå\nÊâÄ‰ª•Âú®B‰∏äÊü•Êâæ 52a0ed6b-5f9c-11eb-b408-525400f12e4f:1184\nmysqlbinlog --verbose /var/lib/mysql/mysql-bin.000006 > check-mysql-bin.000006")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("/*!50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED*//*!*/;\nSET @@SESSION.GTID_NEXT= '52a0ed6b-5f9c-11eb-b408-525400f12e4f:1184'/*!*/;\n# at 51654542\n#220110 11:54:59 server id 2  end_log_pos 51654620 CRC32 0x5ec1b3e8     Query   thread_id=16    exec_time=0     error_code=0\nSET TIMESTAMP=1641786899/*!*/;\nSET @@session.sql_mode=1436549152/*!*/;\nSET @@session.auto_increment_increment=2, @@session.auto_increment_offset=2/*!*/;\nBEGIN\n/*!*/;\n# at 51654620\n# at 51654672\n#220110 11:54:59 server id 2  end_log_pos 51654744 CRC32 0x6aeb7e9f     Table_map: `DB`.`XXXX` mapped to number 9217\n# at 51654744\n#220110 11:54:59 server id 2  end_log_pos 51662949 CRC32 0xc3f5e895     Delete_rows: table id 9217\n# at 51662949\n")])])]),n("p",[e._v("ÊûúÁÑ∂ 52a0ed6b-5f9c-11eb-b408-525400f12e4f:1184Â∞±ÊòØdeleteËØ≠Âè•\nÂΩìÁÑ∂‰πüÂèØ‰ª•Âú®AÊú∫Âô®‰∏äÊü•Áúãrelay binlog\nmysqlbinlog --verbose --base64-output=DECODE-ROWS /var/lib/mysql/relay-bin.000022 > check-relay-bin.000022")]),e._v(" "),n("h5",{attrs:{id:"Ëß£ÂÜ≥ÊñπÊ≥ï"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#Ëß£ÂÜ≥ÊñπÊ≥ï"}},[e._v("#")]),e._v(" Ëß£ÂÜ≥ÊñπÊ≥ïÔºö")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("ÊñπÊ≥ï‰∏ÄÔºöresetÊï¥‰∏™master slave")])]),e._v(" "),n("li",[n("p",[e._v("ÊñπÊ≥ï‰∫åÔºöskip error")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('mysql> stop slave;\nmysql> SET GLOBAL SQL_SLAVE_SKIP_COUNTER = 1;\nmysql> START SLAVE;\n\nÊâπÈáèÂ§ÑÁêÜÔºö\n$ while true; do if [[ $(mysql -uroot -pP@ssw0rd -e "SHOW SLAVE STATUS\\G" | grep "Last_SQL_Error:" | grep -c "HA_ERR_KEY_NOT_FOUND") -gt 0 ]]; then mysql -uroot -pP@ssw0rd -e "STOP SLAVE; SET GLOBAL SQL_SLAVE_SKIP_COUNTER = 1; START SLAVE;"; else break; fi; sleep 1; done\n')])])]),n("p",[e._v("ERROR 1858 (HY000): sql_slave_skip_counter can not be set when the server is running with @@GLOBAL.GTID_MODE = ON. Instead, for each transaction that you want to skip, generate an empty transaction with the same GTID as the transaction")])]),e._v(" "),n("li",[n("p",[e._v("ÊñπÊ≥ï ‰∏âÔºö fake transaction")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("Âú®A:\nmysql> stop slave;\nmysql> SET @@SESSION.GTID_NEXT= '52a0ed6b-5f9c-11eb-b408-525400f12e4f:1184'; \n#1184ÊòØÂá∫ÈîôÁöÑÂú∞Êñπ ÂÆö‰ΩçÊñπÊ≥ïÔºö\n  > ÈÄöËøámysqlbinlog -vÂéªrelay logÊâæÂà∞Âá∫ÈîôÁöÑÂú∞Êñπ\n  > Êõ¥ÁÆÄÂçïÁöÑÔºåÂØπÊØîRetrieved_Gtid_Set Âíå Executed_Gtid_SetÔºåExecuted_Gtid_SetÊúÄÂêé‰∏ÄÊù°Âä†1Âç≥‰∏ã‰∏ÄÊù°Â∞±ÊòØ\nmysql> begin ; commit ;\nmysql> start slave;\nERROR 1837 (HY000): When @@SESSION.GTID_NEXT is set to a GTID, you must explicitly set it to a different value after a COMMIT or ROLLBACK. Please check GTID_NEXT variable manual page for detailed explanation. Current @@SESSION.GTID_NEXT is '878556a6-ff0e-11ea-bf92-566f18fa0008:1184'.\nmysql> SET GTID_NEXT=\"AUTOMATIC\";\n\nÊ≥®ÊÑèÂà∞ÊúâË∂£ÁöÑÁé∞Ë±°ÔºöÂõûÂà∞B‰∏äÊü•Áúãslave status‰ºöÂèëÁé∞ÔºöRetrieved_Gtid_SetÂ§ö‰∫Ü‰∏ÄÊù° XXXX:1184 ‰πüÂ∞±ÊòØÂú®A‰∏äÊâßË°åÁöÑ1184Á©∫ËØ≠Âè•\n\n\n")])])])]),e._v(" "),n("li",[n("p",[e._v("ÊñπÊ≥ïÂõõÔºöÁõ¥Êé•ÂøΩËßÜÔºàÊØîËæÉÂç±Èô©Ôºâ\nmy.cnf: [mysqld] slave-skip-errors=1032")])])]),e._v(" "),n("h5",{attrs:{id:"‰ªçÁÑ∂Â≠òÂú®ÁöÑÁñëÈóÆ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#‰ªçÁÑ∂Â≠òÂú®ÁöÑÁñëÈóÆ"}},[e._v("#")]),e._v(" ‰ªçÁÑ∂Â≠òÂú®ÁöÑÁñëÈóÆÔºö")]),e._v(" "),n("p",[e._v("Could not execute Delete_rows event on table XXXX; Can't find record in 'XXXX', Error_code: 1032; handler error HA_ERR_KEY_NOT_FOUND;\nËØ¥ÊòéAÊú∫Âô®‰∏äÂÅöÂà†Èô§ÁöÑÊó∂ÂÄôÊüêÊù°ËÆ∞ÂΩï‰∏çÂ≠òÂú®ÔºåÈÇ£Â∞±Â•áÊÄ™‰∫ÜÔºåÂõ†‰∏∫AÂíåBÊòØ‰∫í‰∏∫‰∏ªÂ§áÔºåÊó¢ÁÑ∂B‰∏äÈù¢Âà†Èô§ÊàêÂäü‰∫ÜÔºåËØ¥ÊòéËøôÊù°Êï∞ÊçÆÂú®B‰∏äÂ≠òÂú®ÔºåÈÇ£Â∫îËØ•‰πüÂú®A‰∏ä‰πüÂ≠òÂú®ÊâçÂØπÔºå\nÊàñËÄÖËØ¥Â¶ÇÊûúA‰∏äÁöÑËøôÊù°ËÆ∞ÂΩïË¢´Âà†Èô§‰∫ÜÔºåÈÇ£Âà†Èô§ÁöÑÂä®‰Ωú‰πü‰ºöÂêåÊ≠•Âà∞BÔºå\nÂ¶ÇÊûúÊòØÂàöÂ•ΩB‰∏äÈù¢Âà†Èô§ÁöÑÊó∂ÂÄôA‰∏äÈù¢‰πüÂà†Èô§‰∫ÜÔºåÂΩìBÂêåÊ≠•Âà∞AÁöÑÊó∂ÂÄôÔºåAÂ∑≤ÁªèÂà†Èô§Ëøá‰∫ÜÊâÄ‰ª•Âá∫Áé∞ÈîôËØØÔºåÂèçËøáÊù•ÔºåÈÇ£B‰πüÂ∫îËØ•ÊúâÈîôËØØÊâçÂØπÔºå‰ΩÜÊòØB‰∏äÁöÑÂêåÊ≠•Ê≠£Â∏∏Ê≤°ÊúâÈîôËØØÔºå\nÊâÄ‰ª•ÊÄé‰πàÈÉΩÊó†Ê≥ïËØ¥ÈÄöÔºå\nÈô§ÈùûÊòØËØ¥ÂèØËÉΩÂú®B‰∏äÂèëËµ∑ÁöÑdeleteÊìç‰Ωú‰πüÊòØÊâæ‰∏çÂà∞ËÆ∞ÂΩïÔºå‰ΩÜÊòØÂπ∂‰∏ç‰ºö‰∫ßÁîüÈóÆÈ¢òÔºå‰ΩÜÊòØreplicationÂà∞AÁöÑÊó∂ÂÄôÔºåA‰Ωú‰∏∫slave‰ºöÊØîËæÉ‰∏•Ê†ºÔºåÊâÄ‰ª•Â∞Ünot foundÈîôËØØËÆ∞ÂΩïÂá∫Êù•Ôºõ")]),e._v(" "),n("p",[e._v("ËøôÈáåÊúâÁÇπËß£ÈáäÂÄºÂæóÁúã‰∏Ä‰∏ãÔºö")]),e._v(" "),n("blockquote",[n("p",[e._v("If a statement produces the same error (identical error code) on both the source and the replica, the error is logged, but replication continues.\nIf a statement produces different errors on the source and the replica, the replication SQL thread terminates, and the replica writes a message to its error log and waits for the database administrator to decide what to do about the error.\nReplica Errors During Replication https://dev.mysql.com/doc/mysql-replication-excerpt/5.7/en/replication-features-slaveerrors.html")])]),e._v(" "),n("p",[e._v("Ë∑üÊàëÁöÑÁåúÊµãÂ∑Æ‰∏çÂ§öÔºåÊÄª‰πãÂ∞±ÊòØÂêåÊ†∑ÁöÑdeleteËØ≠Âè•Âú®AÂíåB‰∏äÁöÑÊä•Èîô‰∏çÂêåÔºå\nÊñáÊ°£ÊèêÂà∞‰∫Ü‰∏§ËæπÁöÑÁâàÊú¨ÂíåengineÔºå\n"),n("code",[e._v("$mysqlshow -uroot -pP@ssw0rd -i DBNAME TABLENAME;")]),e._v("\nÁ°ÆËÆ§‰∫Ü‰∏ãÔºå‰∏§ËæπÂÆåÂÖ®‰∏ÄËá¥")]),e._v(" "),n("p",[e._v("Ëøõ‰∏ÄÊ≠•Áúã‰∫Ü‰∏ãAÂíåBÁöÑÊó∂Èó¥ÔºåÂèëÁé∞BÊØîAÂø´‰∫Ü2ÂàÜÈíüÔºå‰∏çÁü•ÈÅìÊòØÂê¶ÊúâÂÖ≥")]),e._v(" "),n("p",[e._v("REFER:\nhttps://bugs.mysql.com/bug.php?id=94827\nhttps://dev.mysql.com/doc/relnotes/mysql/5.7/en/news-5-7-20.html\nhttps://dev.mysql.com/doc/mysql-errors/5.7/en/server-error-reference.html#error_er_key_not_found\nhttps://severalnines.com/blog/mysql-tutorial-troubleshooting-mysql-replication-part-2\nhttps://www.etlbi.com/blog/2018/08/11/mysql-gtid-1032-error/")]),e._v(" "),n("h4",{attrs:{id:"replication-issues-got-fatal-error-1236-from-master-when-reading-data-from-binary-log-binary-log-is-not-open"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#replication-issues-got-fatal-error-1236-from-master-when-reading-data-from-binary-log-binary-log-is-not-open"}},[e._v("#")]),e._v(" Replication Issues::Got fatal error 1236 from master when reading data from binary log: 'Binary log is not open'")]),e._v(" "),n("p",[e._v("Background: MASTER A<->MASTER B, both are master&slaves")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("ON SERVER B: \nmysql> show slave status\\G;\n*************************** 1. row ***************************\n               Slave_IO_State: \n                  Master_Host: SERVER_A_IP\n                  Master_User: replicator\n                  Master_Port: 3306\n                Connect_Retry: 60\n              Master_Log_File: mysql-bin.000012\n          Read_Master_Log_Pos: 341592308\n               Relay_Log_File: sgkc2-devclr-v06-relay-bin.000033\n                Relay_Log_Pos: 341592521\n        Relay_Master_Log_File: mysql-bin.000012\n             Slave_IO_Running: No\n            Slave_SQL_Running: Yes\n              Replicate_Do_DB: \nMaster_SSL_Verify_Server_Cert: No\n                Last_IO_Errno: 1236\n                Last_IO_Error: Got fatal error 1236 from master when reading data from binary log: 'Binary log is not open'\n               Last_SQL_Errno: 0\n               Last_SQL_Error: \n  Replicate_Ignore_Server_Ids: \n             Master_Server_Id: 1\n                  Master_UUID: db4cbf6c-d96e-11eb-872a-566f18fa0034\n             Master_Info_File: mysql.slave_master_info\n                    SQL_Delay: 0\n          SQL_Remaining_Delay: NULL\n      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates\n           Master_Retry_Count: 86400\n                  Master_Bind: \n      Last_IO_Error_Timestamp: 220303 14:43:40\n     Last_SQL_Error_Timestamp: \n               Master_SSL_Crl: \n           Master_SSL_Crlpath: \n           Retrieved_Gtid_Set: db4cbf6c-d96e-11eb-872a-566f18fa0034:1-230351\n            Executed_Gtid_Set: db4cbf6c-d96e-11eb-872a-566f18fa0034:1-230351\n                Auto_Position: 1\n         Replicate_Rewrite_DB: \n                 Channel_Name: \n           Master_TLS_Version: \n\nmysql> show master status;\n+------------------+-----------+--------------+------------------+-----------------------------------------------+\n| File             | Position  | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set                             |\n+------------------+-----------+--------------+------------------+-----------------------------------------------+\n| mysql-bin.000009 | 945084747 |              |                  | db4cbf6c-d96e-11eb-872a-566f18fa0034:1-230351 |\n+------------------+-----------+--------------+------------------+-----------------------------------------------+\n1 row in set (0.00 sec)\n\nmysql> SHOW BINARY LOGS;\n+------------------+------------+\n| Log_name         | File_size  |\n+------------------+------------+\n| mysql-bin.000001 | 1075544412 |\n| mysql-bin.000002 | 1073857153 |\n| mysql-bin.000003 | 1074315226 |\n| mysql-bin.000004 | 1073856204 |\n| mysql-bin.000005 | 1075105942 |\n| mysql-bin.000006 | 1075591706 |\n| mysql-bin.000007 | 1074646766 |\n| mysql-bin.000008 | 1075091646 |\n| mysql-bin.000009 |  945084747 |\n+------------------+------------+\n9 rows in set (0.00 sec)\n\n\nON SERVER A:\nmysql> show slave status\\G;\n*************************** 1. row ***************************\n               Slave_IO_State: \n                  Master_Host: B\n                  Master_User: replicator\n                  Master_Port: 3306\n                Connect_Retry: 60\n              Master_Log_File: mysql-bin.000009\n          Read_Master_Log_Pos: 945084747\n               Relay_Log_File: sgkc2-devclr-v05-relay-bin.000021\n                Relay_Log_Pos: 367\n        Relay_Master_Log_File: mysql-bin.000009\n             Slave_IO_Running: No\n            Slave_SQL_Running: No\n  Replicate_Ignore_Server_Ids: \n             Master_Server_Id: 0\n                  Master_UUID: 435441ed-10f1-11ea-b6f4-566f18fa0032\n             Master_Info_File: mysql.slave_master_info\n                    SQL_Delay: 0\n          SQL_Remaining_Delay: NULL\n      Slave_SQL_Running_State: \n           Master_Retry_Count: 86400\n                  Master_Bind: \n      Last_IO_Error_Timestamp: \n     Last_SQL_Error_Timestamp: \n               Master_SSL_Crl: \n           Master_SSL_Crlpath: \n           Retrieved_Gtid_Set: \n            Executed_Gtid_Set: db4cbf6c-d96e-11eb-872a-566f18fa0034:1-230351\n                Auto_Position: 1\n         Replicate_Rewrite_DB: \n                 Channel_Name: \n           Master_TLS_Version:   \nmysql> show master status;\nEmpty set (0.00 sec)\nmysql> SHOW BINARY LOGS;\nERROR 1381 (HY000): You are not using binary logging\n\nÊèêÁ§∫Ê≤°ÊúâÂºÄÈÄöbinary logging ÂäüËÉΩ\nvim /etc/my.cnf\n#log-bin = mysql-bin                                                     #ÊâìÂºÄ‰∫åËøõÂà∂ÂäüËÉΩ,MASTER‰∏ªÊúçÂä°Âô®ÂøÖÈ°ªÊâìÂºÄÊ≠§\nsomeone has commentted out the log-bin!!!\n\n")])])]),n("p",[e._v("Âú® SERVER A ‰∏äÁªßÁª≠Êü•ÁúãÊó•ÂøóÔºö")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("2022-03-03T06:40:04.873013Z 0 [Note] Shutting down plugin 'binlog'\n2022-03-03T06:40:06.275534Z 0 [Note] /usr/sbin/mysqld: Shutdown complete\n\n2022-03-03T06:40:22.048599Z 0 [Warning] Changed limits: max_open_files: 5000 (requested 15000)\n2022-03-03T06:40:22.048850Z 0 [Warning] Changed limits: table_open_cache: 995 (requested 2000)\n2022-03-03T06:40:22.238472Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).\n2022-03-03T06:40:22.244013Z 0 [Note] /usr/sbin/mysqld (mysqld 5.7.32) starting as process 4110 ...\n2022-03-03T06:40:22.292202Z 0 [Warning] You need to use --log-bin to make --log-slave-updates work.\n2022-03-03T06:40:22.292245Z 0 [Warning] You need to use --log-bin to make --binlog-format work.\n\n")])])]),n("p",[n("s",[e._v("ÂèØ‰ª•ÁúãÂà∞Êúâ‰∫∫Âú®2022-03-03T06:40ÂÖ≥Èó≠‰∫Ülog-binÁöÑÂäüËÉΩ")]),e._v("(ËØØËß£ÔºåËøôÊòØÂõ†‰∏∫ÈáçÂêØÔºå‰ΩÜÊòØÁ°ÆÂÆûÊòØconfigÈáåÈù¢Ë¢´‰∫∫ÂÖ≥Èó≠‰∫ÜbinlogÔºåÊúâ‰∫∫Ê≥®ÈáäÊéâ‰∫Ülog-bin = mysql-bin )")]),e._v(" "),n("p",[e._v("ÁªßÁª≠Êü•ÁúãSERVER A‰∏äÁöÑbinary logÔºö")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("vim /var/lib/mysql/mysql-bin.index\n./mysql-bin.000001\n./mysql-bin.000002\n./mysql-bin.000003\n./mysql-bin.000004\n./mysql-bin.000005\n./mysql-bin.000006\n./mysql-bin.000007\n./mysql-bin.000008\n./mysql-bin.000009\n./mysql-bin.000010\n./mysql-bin.000011\n./mysql-bin.000012\n\n‰∏çËøáÁõÆÂΩï/var/lib/mysql/‰∏ãÂè™Ââ©‰∏ãmysql-bin.000012ÔºåÁªèËøáÊü•ÁúãhistoryÔºåÂèëÁé∞ÊòØÊúâ‰∫∫ÊâãÂä®Âà†Èô§\n")])])]),n("h5",{attrs:{id:"reset"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#reset"}},[e._v("#")]),e._v(" Reset:")]),e._v(" "),n("p",[e._v("Êó¢ÁÑ∂A‰∏äÈù¢ÁöÑbin logÂ∑≤ÁªèË¢´Âà†Èô§‰∏çÂÆåÊï¥‰∫ÜÔºåËÄå‰∏îÂ∑≤ÁªèÂæà‰πÖÊ≤°ÊúâÂºÄÂêØbin logÔºå‰∏≠Èó¥ÂæàÂ§öÊìç‰Ωú‰πüÊ≤°ÊúâËÆ∞ÂΩï‰∏ãÊù•ÔºåÊâÄ‰ª•Âè™ËÉΩÈáçÂ§¥ÈáçÊñ∞ÂÅöËµ∑")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("\n\nON SERVER A:\nmysql> stop slave;  \nmysql> reset slave all //Êñ≠ÊéâA‰Ωú‰∏∫slaveÔºåB‰Ωú‰∏∫masterÁöÑÂ§çÂà∂\n\nON SERVER B:\nmysql> stop slave;\n\ndump data from A TO B\n\nON SERVER A:\n> mysqldump -flush-privileges --single-transaction --flush-logs --triggers --routines --events -hex-blob --host=localhost --user=root --password --databases --set-gtid-purged=OFF DB_NAME> source_dump.sql\n\nON SERVER B:\nimport data dumpÔºö\nsource source_dump.sql;\nmysql> reset master; //Áî±‰∫éÂÆ¢Êà∑Á´ØÈÉΩÊòØËøûAÔºåB‰∏äÂπ∂Ê≤°Êúâ‰ªª‰ΩïmysqlÊìç‰ΩúÔºåÊâÄ‰ª•Ëøô‰∏™ÂèØ‰ª•‰∏çÂÅö\nmysql> reset slave all //Êñ≠ÊéâB‰Ωú‰∏∫slaveÔºåA‰Ωú‰∏∫masterÁöÑÂ§çÂà∂\n\nenable log-bin on SERVER A and restart\nmysql> show master status;\nmysql> reset master; //\n\nCHANGE MASTER ON A&B\nSTART SLAVE ON A&B\n")])])]),n("h3",{attrs:{id:"error-1049-42000-unknown-database"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#error-1049-42000-unknown-database"}},[e._v("#")]),e._v(" ERROR 1049 (42000): Unknown database")]),e._v(" "),n("p",[e._v("[Warning] 'db' entry 'xxx@%' had database in mixed case that has been forced to lowercase because lower_case_table_names is set. It will not be possible to remove this privilege using REVOKE.")]),e._v(" "),n("p",[e._v("show databases ÂèØ‰ª•ÁúãÂà∞ËØ•dbÊØîÂ¶Ç TEST_DBÔºå‰ΩÜÊòØ use TEST_DBÊèêÁ§∫ÈîôËØØÊâæ‰∏çÂà∞Ôºå\n/var/lib/mysql Êü•ÁúãÁõÆÂΩï‰∏ãÂ≠òÂú® TEST_DBËøô‰∏™Êï∞ÊçÆÂ∫ìÁöÑÊñá‰ª∂Â§πÔºåÊã•ÊúâËÄÖÊòØmysqlÔºåÊñá‰ª∂ÊùÉÈôê‰πüÊ≠£Á°ÆÔºå\nÊúÄÂêéÂèëÁé∞ÂéüÊù•ÊòØ my.cnfÂºÄÂêØ‰∫Ü lower_case_table_names=1\nÊ≥®ÈáäÊéâÈáçÂêØmysqlÂç≥ÂèØÔºÅ")]),e._v(" "),n("p",[e._v("https://stackoverflow.com/questions/19678769/error-1049-42000-unknown-database-mydatabasename")]),e._v(" "),n("h3",{attrs:{id:"variables-‰∏çÊòØÊâÄËßÅÂç≥ÊâÄÂæó"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#variables-‰∏çÊòØÊâÄËßÅÂç≥ÊâÄÂæó"}},[e._v("#")]),e._v(" Variables ‰∏çÊòØÊâÄËßÅÂç≥ÊâÄÂæó")]),e._v(" "),n("p",[e._v("ÊØîÂ¶ÇÔºö\nÈîôËØØÔºö"),n("code",[e._v("Update mysql.user set password_lifetime=90 where user='root';")]),e._v("\nÊ≠£Á°ÆÔºö"),n("code",[e._v("ALTER USER ' root'@'localhost' PASSWORD EXPIRE INTERVAL 90 DAY;")])]),e._v(" "),n("disqus")],1)}),[],!1,null,null,null);t.default=a.exports}}]);