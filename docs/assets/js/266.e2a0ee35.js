(window.webpackJsonp=window.webpackJsonp||[]).push([[266],{694:function(t,e,a){"use strict";a.r(e);var s=a(65),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("剖析Linux网络包接收过程：掌握数据如何被捕获和分发的全过程 https://mp.weixin.qq.com/s/zyqIN3G5xwkQfa1uaU8DmQ")]),t._v(" "),a("h2",{attrs:{id:"基本命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本命令"}},[t._v("#")]),t._v(" 基本命令")]),t._v(" "),a("p",[t._v("查端口找pid netstat -anp|grep :80")]),t._v(" "),a("p",[t._v("pid查程序：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("//查看程序完整启动命令\ncat /proc/21268/cmdline\n\n//查看程序路径\nls -l /proc/21268/exe\n\nps -lef|grep 21268\nps -eo pid,lstart,cmd |grep pid //程序启动时间\n")])])]),a("h3",{attrs:{id:"软硬限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#软硬限制"}},[t._v("#")]),t._v(" 软硬限制")]),t._v(" "),a("p",[t._v("要知道,在linux的世界里,一切皆文件.因此要实现大的并发量的第一步,修改linux系统的文件标识符限制数,也就是文件打开数量的限制")]),t._v(" "),a("p",[t._v("Soft nofile:开启文件数软限制\nHard nofile:开启文件数硬限制\nSoft proc:进程数软限制\nHard proc:进程数硬限制")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.huaweicloud.com/articles/31d10c0fcca16be1e0c478c748bc0c08.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Linux最大文件数限制的那些事"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('vim /etc/security/limits.conf\nAdd inside limits.conf below 2 lines\nusrename           hard    core    unlimited\nusrename           soft    core    unlimited\n\n$ ulimit -c unlimited\nNo error shall be seen after executing the command\n\n\n$ulimit -Hn //查看硬件资源限制\n65536\n$ulimit -Sn ////软件资源限制\n4096\n\n$ps -lef|grep "kafka"\n\n$ls /proc/<kafka pid>/fd | wc -l\n')])])]),a("h3",{attrs:{id:"socket-statistics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#socket-statistics"}},[t._v("#")]),t._v(" Socket Statistics")]),t._v(" "),a("p",[t._v("ss是Socket Statistics的缩写。顾名思义，ss命令可以用来获取socket统计信息，它可以显示和netstat类似的内容。ss的优势在于它能够显示更多更详细的有关TCP和连接状态的信息，而且比netstat更快速更高效。\n当服务器的socket连接数量变得非常大时，无论是使用netstat命令还是直接cat /proc/net/tcp，执行速度都会很慢。\nss快的秘诀在于，它利用到了TCP协议栈中tcp_diag。tcp_diag是一个用于分析统计的模块，可以获得Linux 内核中第一手的信息，这就确保了ss的快捷高效。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("#查看进程使用的socket\n# ss -pl\n显示所有UDP Sockets\nss -u -a\n查看建立的 TCP 连接\nss -tna\n\n使用 -p 选项查看监听端口的程序名称\nss -tlp\n\n\n")])])]),a("h3",{attrs:{id:"dns"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns"}},[t._v("#")]),t._v(" dns")]),t._v(" "),a("p",[t._v("/etc/dhcp/dhclient.conf // Change #prepend domain-name-servers line, add the dns you want. Example:\nprepend domain-name-servers 1.1.1.1, 8.8.8.8;\nhttps://unix.stackexchange.com/questions/174349/what-overwrites-etc-resolv-conf-on-every-boot")]),t._v(" "),a("h2",{attrs:{id:"端口tcp流量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#端口tcp流量"}},[t._v("#")]),t._v(" 端口TCP流量")]),t._v(" "),a("p",[t._v("查看某个端口的tcp连接记录：")]),t._v(" "),a("p",[t._v("https://serverfault.com/questions/193600/how-to-get-a-linux-network-log/193602")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('------------------------------------------------------\n--- 通过 iptables\n------------------------------------------------------\n--- 创建\n$iptables -I INPUT -p tcp --dport 9092 -j LOG\n$tail -f /var/log/messages\n\n--- 删除\n$iptables -L INPUT --line-numbers\nChain INPUT (policy ACCEPT)\nnum  target     prot opt source               destination\n1    LOG        tcp  --  anywhere             anywhere             tcp dpt:XmlIpcRegSvc LOG level warning\n$iptables -D INPUT 1\n\n--- More\niptables -A INPUT -p tcp --destination-port 9092 -j DROP\n\n------------------------------------------------------\n--- 其他\n------------------------------------------------------\nss sport eq :10101\n\nss -tanp | grep 10101\nESTAB      0      0      172.22.16.15:10101              172.22.16.7:9092                users:(("java",pid=21268,fd=46))\n\nls -al  /proc/21268/fd/46\n')])])]),a("h2",{attrs:{id:"检查网卡-network-card-adapter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查网卡-network-card-adapter"}},[t._v("#")]),t._v(" 检查网卡 network card adapter")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('grep -r -H "eth0" /var/log/\n')])])]),a("h2",{attrs:{id:"案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例"}},[t._v("#")]),t._v(" 案例")]),t._v(" "),a("p",[t._v("https://blog.cloudflare.com/this-is-strictly-a-violation-of-the-tcp-specification/")]),t._v(" "),a("p",[t._v("https://serverfault.com/questions/199434/how-do-i-make-curl-use-keepalive-from-the-command-line")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('while :;do echo -e "GET / HTTP/1.1\\nhost: $YOUR_VIRTUAL_HOSTNAME\\n\\n";sleep 1;done|telnet $YOUR_SERVERS_IP 80\n')])])])])}),[],!1,null,null,null);e.default=n.exports}}]);