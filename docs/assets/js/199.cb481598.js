(window.webpackJsonp=window.webpackJsonp||[]).push([[199],{429:function(e,t,n){"use strict";n.r(t);var _=n(0),o=Object(_.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h2",{attrs:{id:"web容器："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#web容器："}},[e._v("#")]),e._v(" web容器：")]),e._v(" "),n("p",[e._v("tomcat")]),e._v(" "),n("p",[e._v("apache")]),e._v(" "),n("p",[e._v("iis")]),e._v(" "),n("p",[e._v("nginx")]),e._v(" "),n("p",[e._v("phpstudy")]),e._v(" "),n("h2",{attrs:{id:"工具"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#工具"}},[e._v("#")]),e._v(" 工具")]),e._v(" "),n("p",[e._v("chrome:\nchrome://net-export/\nhttps://netlog-viewer.appspot.com/#sockets\nhttps://chromium.googlesource.com/chromium/src/+/HEAD/net/docs/crash-course-in-net-internals.md\nhttps://zhuanlan.zhihu.com/p/266622278")]),e._v(" "),n("p",[e._v("firefox:\nweb developer tool->performance->recording\nhttps://firefox-source-docs.mozilla.org/networking/http/logging.html\nabout:networking#logging")]),e._v(" "),n("p",[e._v("When Mozilla’s built-in logging capabilities aren’t good enough, and you need a full-fledged packet tracing tool, two free products are "),n("a",{attrs:{href:"https://www.wireshark.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Wireshark"),n("OutboundLink")],1),e._v(" and "),n("a",{attrs:{href:"https://github.com/jpr5/ngrep/",target:"_blank",rel:"noopener noreferrer"}},[e._v("ngrep"),n("OutboundLink")],1)]),e._v(" "),n("h2",{attrs:{id:"troubleshooting"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#troubleshooting"}},[e._v("#")]),e._v(" Troubleshooting")]),e._v(" "),n("h3",{attrs:{id:"_301-auto-redirect"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_301-auto-redirect"}},[e._v("#")]),e._v(" 301 auto redirect")]),e._v(" "),n("p",[e._v("事件：dev.site.com 总是自动跳转到www.site.com")]),e._v(" "),n("p",[e._v('初步整个服务器上grep -r -l "www.site.com" / 没有结果')]),e._v(" "),n("p",[e._v("1.通过nslookup查看了cname，确定没有cname重定向")]),e._v(" "),n("p",[e._v("2.查看了apache配置")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("vim /etc/httpd/conf/httpd.conf \nvim /etc/httpd/conf.d/demo_http.conf \nvim /etc/httpd/conf.d/demo_https.conf\n")])])]),n("p",[e._v("确定没有重定向，唯一的重定向是http里面有到https的重定向，不过测试的时候完全可以直接访问\nhttps://dev.site.com 来排除http重定向的问题，依然自动跳转")]),e._v(" "),n("p",[e._v("3.怀疑是代码问题，此站点使用的是WordPress代码，备份删除整站代码，创建 index.html: hello world，")]),e._v(" "),n("p",[e._v("发现访问https://dev.site.com/index.html不跳转，访问https://dev.site.com依然跳转，")]),e._v(" "),n("p",[e._v("刚开始我因此排除了是代码问题，其实301跳转有缓存，此时的跳转是")]),e._v(" "),n("p",[e._v("后来才发现network里面这个301 Moved Permanently 是from disk cache！！！")]),e._v(" "),n("p",[e._v("清理缓存后（或者浏览器开发者工具，直接勾选Disable cache更容易），再访问https://dev.site.com，发现response如下：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("\nHTTP/1.1 301 Moved Permanently\nDate: Thu, 28 Oct 2021 07:31:15 GMT\nServer: Apache\nX-Redirect-By: Polylang\nLocation: https://www.xxx.com/\nX-Content-Type-Options: nosniff\nX-XSS-Protection: 1; mode=block\nContent-Length: 0\nKeep-Alive: timeout=5, max=100\nConnection: Keep-Alive\nContent-Type: text/html; charset=UTF-8\n\n")])])]),n("p",[e._v("注意到X-Redirect-By: Polylang，就是这个鬼，wordpress一个插件，最后查明原因是，dev的db配置成了生产的，所以估计这个polylang就使用了生产的域名！")]),e._v(" "),n("h3",{attrs:{id:"wordpress-upload-failed-empty-response"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#wordpress-upload-failed-empty-response"}},[e._v("#")]),e._v(" wordpress upload failed empty response")]),e._v(" "),n("p",[e._v("描述：")]),e._v(" "),n("p",[e._v("wordpress media上传，"),n("strong",[e._v("开发环境")]),e._v("没有问题，"),n("strong",[e._v("生产production")]),e._v("上却失败，大小3m也不是很大，")]),e._v(" "),n("p",[e._v("/wp-admin/async-upload.php")]),e._v(" "),n("h4",{attrs:{id:"初步观察"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#初步观察"}},[e._v("#")]),e._v(" 初步观察")]),e._v(" "),n("h5",{attrs:{id:"firefox下面："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#firefox下面："}},[e._v("#")]),e._v(" firefox下面：")]),e._v(" "),n("p",[e._v("Queued: 21.50 s\tStarted: 1.60 m\tinDownloaded: 2.88 min\nRequest Timing\nBlocked:\n1.25 min\nDNS Resolution:\n0 ms\nConnecting:\n64 ms\nTLS Setup:\n69 ms\nSending:\n1.27 min\nWaiting:\n0 ms\nReceiving:\n0 ms")]),e._v(" "),n("p",[e._v("可以发现Blocked时间很长（后面才知道是因为经过waf过滤才导致的）\nhttps://developer.mozilla.org/en-US/docs/Tools/Network_Monitor/request_details#Timings\nBlocked解释：\nTime spent in a queue waiting for a network connection.")]),e._v(" "),n("p",[e._v("The browser imposes a limit on the number of simultaneous connections that can be made to a single server. In Firefox this defaults to 6, but can be changed using the network.http.max-persistent-connections-per-server preference. If all connections are in use, the browser can't download more resources until a connection is released.")]),e._v(" "),n("p",[e._v("http://kb.mozillazine.org/Network.http.max-persistent-connections-per-server")]),e._v(" "),n("p",[e._v("http://kb.mozillazine.org/Editing_configuration")]),e._v(" "),n("p",[e._v("修改（先不要随便修改）：访问 about:config 搜索 Network.http.max-persistent-connections-per-server")]),e._v(" "),n("h5",{attrs:{id:"chrome："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#chrome："}},[e._v("#")]),e._v(" chrome：")]),e._v(" "),n("p",[e._v("跟firefox稍有不同，\n首先在status一列可以看到 (failed) net::ERR_EMPTY_RESPONSE 在network timing里面看到 stalled")]),e._v(" "),n("p",[e._v("搜索这两个关键词无果：")]),e._v(" "),n("p",[e._v("https://stackoverflow.com/questions/66036116/wordpress-err-empty-response-on-long-content")]),e._v(" "),n("p",[e._v("https://stackoverflow.com/questions/27740692/request-stalled-for-a-long-time-occasionally-in-chrome")]),e._v(" "),n("p",[e._v("注意力回到timing解释")]),e._v(" "),n("p",[e._v("https://developer.chrome.com/docs/devtools/network/reference/#timing-explanation")]),e._v(" "),n("p",[e._v("Queueing. The browser queues requests when:\nThere are higher priority requests.\nThere are already six TCP connections open for this origin, which is the limit. Applies to HTTP/1.0 and HTTP/1.1 only.\nThe browser is briefly allocating space in the disk cache\nStalled. The request could be stalled for any of the reasons described in Queueing.\n这里也提到了6个TCP连接的限制")]),e._v(" "),n("p",[e._v("Firefox和chrome都可以在network列名上右键添加 Protocol，从而确认确实是HTTP1.1，然后chrome还可以添加 connection id")]),e._v(" "),n("p",[e._v("下面这个解释很有帮助")]),e._v(" "),n("blockquote",[n("p",[n("em",[e._v("Note 2: If a TCP handshake was needed for a HTTP request, you'll see an orange bar in the DevTools waterfall and, if you hover over it, you'll see \"Initial connection\" - this tells you how long the handshake took in milliseconds. TCP connections may be reused across tabs and windows so watch out -- you might see an ID for the first time but it may not have a TCP handshake! This likely because you visited the page previously and opened a connection with that host. It may also be because Chrome prefetched a resource from the host -- Chrome prefetches a favicon for example when you type an address in the bar.")])]),e._v(" "),n("p",[e._v("https://stackoverflow.com/questions/34184994/chrome-developer-tools-connection-id")])]),e._v(" "),n("p",[e._v("下面可以排除前面 https://stackoverflow.com/questions/27740692/request-stalled-for-a-long-time-occasionally-in-chrome")]),e._v(" "),n("p",[e._v("提到的 "),n("strong",[e._v("persistent TCP connection")]),e._v("的原因")]),e._v(" "),n("p",[e._v("chrome://net-export/")]),e._v(" "),n("p",[e._v("https://netlog-viewer.appspot.com/#import")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('t=35069 [st=    0] +REQUEST_ALIVE  [dt=34115]\n                    --\x3e priority = "MEDIUM"\n                    --\x3e traffic_annotation = 101845102\n                    --\x3e url = "https://www.xxx.com/wp-admin/async-upload.php"\nt=35069 [st=    0]    DELEGATE_INFO  [dt=108]\n                      --\x3e delegate_blocked_by = "Opening Files"\nt=35177 [st=  108]    NETWORK_DELEGATE_BEFORE_URL_REQUEST  [dt=0]\nt=35177 [st=  108]   +URL_REQUEST_START_JOB  [dt=34006]\n                      --\x3e initiator = "https://www.xxx.com"\n                      --\x3e load_flags = 2 (BYPASS_CACHE)\n                      --\x3e method = "POST"\n                      --\x3e network_isolation_key = "https://xxx.com https://xxx.com"\n                      --\x3e privacy_mode = "disabled"\n                      --\x3e request_type = "other"\n                      --\x3e site_for_cookies = "SiteForCookies: {site=https://xxx.com; schemefully_same=true}"\n                      --\x3e upload_id = "0"\n                      --\x3e url = "https://www.xxx.com/wp-admin/async-upload.php"\nt=35177 [st=  108]      COOKIE_INCLUSION_STATUS\n                        --\x3e operation = "send"\n                        --\x3e status = "EXCLUDE_NOT_ON_PATH, DO_NOT_WARN"\nt=35177 [st=  108]      COOKIE_INCLUSION_STATUS\n                        --\x3e operation = "send"\n                        --\x3e status = "EXCLUDE_DOMAIN_MISMATCH, DO_NOT_WARN"\nt=35177 [st=  108]      COOKIE_INCLUSION_STATUS\n                        --\x3e operation = "send"\n                        --\x3e status = "EXCLUDE_DOMAIN_MISMATCH, DO_NOT_WARN"\nt=35177 [st=  108]      COOKIE_INCLUSION_STATUS\n                        --\x3e operation = "send"\n                        --\x3e status = "EXCLUDE_DOMAIN_MISMATCH, DO_NOT_WARN"\nt=35177 [st=  108]      COOKIE_INCLUSION_STATUS\n                        --\x3e operation = "send"\n                        --\x3e status = "INCLUDE, DO_NOT_WARN"\nt=35177 [st=  108]      COOKIE_INCLUSION_STATUS\n                        --\x3e operation = "send"\n                        --\x3e status = "INCLUDE, DO_NOT_WARN"\nt=35177 [st=  108]      COOKIE_INCLUSION_STATUS\n                        --\x3e operation = "send"\n                        --\x3e status = "INCLUDE, DO_NOT_WARN"\nt=35177 [st=  108]      COOKIE_INCLUSION_STATUS\n                        --\x3e operation = "send"\n                        --\x3e status = "INCLUDE, DO_NOT_WARN"\nt=35177 [st=  108]      COOKIE_INCLUSION_STATUS\n                        --\x3e operation = "send"\n                        --\x3e status = "INCLUDE, DO_NOT_WARN"\nt=35177 [st=  108]      COOKIE_INCLUSION_STATUS\n                        --\x3e operation = "send"\n                        --\x3e status = "INCLUDE, DO_NOT_WARN"\nt=35177 [st=  108]      COOKIE_INCLUSION_STATUS\n                        --\x3e operation = "send"\n                        --\x3e status = "INCLUDE, DO_NOT_WARN"\nt=35177 [st=  108]      COOKIE_INCLUSION_STATUS\n                        --\x3e operation = "send"\n                        --\x3e status = "INCLUDE, DO_NOT_WARN"\nt=35177 [st=  108]      NETWORK_DELEGATE_BEFORE_START_TRANSACTION  [dt=0]\nt=35177 [st=  108]      HTTP_CACHE_GET_BACKEND  [dt=0]\n建立连接HTTP_STREAM_JOB_CONTROLLER和HTTP_STREAM_JOB\nt=35177 [st=  108]     +HTTP_STREAM_REQUEST  [dt=3]\nt=35177 [st=  108]        HTTP_STREAM_JOB_CONTROLLER_BOUND\n                          --\x3e source_dependency = 1174836 (HTTP_STREAM_JOB_CONTROLLER)\nt=35180 [st=  111]        HTTP_STREAM_REQUEST_BOUND_TO_JOB\n                          --\x3e source_dependency = 1174837 (HTTP_STREAM_JOB)\nt=35180 [st=  111]     -HTTP_STREAM_REQUEST\nt=35181 [st=  112]      UPLOAD_DATA_STREAM_INIT  [dt=0]\n                        --\x3e is_chunked = false\n                        --\x3e net_error = 0 (?)\n                        --\x3e total_size = 3505027\nt=35181 [st=  112]     +HTTP_TRANSACTION_SEND_REQUEST  [dt=6769]\nt=35181 [st=  112]        HTTP_TRANSACTION_SEND_REQUEST_HEADERS\n                          --\x3e POST /wp-admin/async-upload.php HTTP/1.1\n                              Host: www.xxx.com\n                              Connection: keep-alive\n                              Content-Length: 3505027\n                              Pragma: no-cache\n                              Cache-Control: no-cache\n                              sec-ch-ua: " Not A;Brand";v="99", "Chromium";v="90", "Google Chrome";v="90"\n                              sec-ch-ua-mobile: ?0\n                              User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36\n                              Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryZinpNBEkQJmJWpBq\n                              Accept: */*\n                              Origin: https://www.xxx.com\n                              Sec-Fetch-Site: same-origin\n                              Sec-Fetch-Mode: cors\n                              Sec-Fetch-Dest: empty\n                              Referer: https://www.xxx.com/wp-admin/upload.php\n                              Accept-Encoding: gzip, deflate, br\n                              Accept-Language: en-US,en;q=0.9\n                              Cookie: [717 bytes were stripped]\nt=35181 [st=  112]        HTTP_TRANSACTION_SEND_REQUEST_BODY\n                          --\x3e did_merge = false\n                          --\x3e is_chunked = false\n                          --\x3e length = 3505027\n开始上传                          \nt=35181 [st=  112]        UPLOAD_DATA_STREAM_READ  [dt=0]\n                          --\x3e current_position = 0\nt=35182 [st=  113]        UPLOAD_DATA_STREAM_READ  [dt=0]\n                          --\x3e current_position = 16384\n..............\nt=41949 [st= 6880]        UPLOAD_DATA_STREAM_READ  [dt=1]\n                          --\x3e current_position = 3505027\n上传失败 net_error = -100，但是注意此时current_position = 3505027===length = 3505027\n耗时\nt = 41950-35181=6769\nst = 6881-112=6769\n大概6秒\nt=41950 [st= 6881]     -HTTP_TRANSACTION_SEND_REQUEST\nt=41950 [st= 6881]     +HTTP_TRANSACTION_READ_HEADERS  [dt=10169]\nt=41950 [st= 6881]        HTTP_STREAM_PARSER_READ_HEADERS  [dt=10168]\n                          --\x3e net_error = -100 (ERR_CONNECTION_CLOSED)\nt=52118 [st=17049]        HTTP_TRANSACTION_RESTART_AFTER_ERROR\n                          --\x3e net_error = -100 (ERR_CONNECTION_CLOSED)\nchrome发起重试                          \nt=52119 [st=17050]     -HTTP_TRANSACTION_READ_HEADERS\nt=52119 [st=17050]     +HTTP_STREAM_REQUEST  [dt=399]\n建立连接HTTP_STREAM_JOB_CONTROLLER和HTTP_STREAM_JOB\nt=52119 [st=17050]        HTTP_STREAM_JOB_CONTROLLER_BOUND\n                          --\x3e source_dependency = 1174847 (HTTP_STREAM_JOB_CONTROLLER)\nt=52518 [st=17449]        HTTP_STREAM_REQUEST_BOUND_TO_JOB\n                          --\x3e source_dependency = 1174848 (HTTP_STREAM_JOB)\nt=52518 [st=17449]     -HTTP_STREAM_REQUEST\nt=52518 [st=17449]      UPLOAD_DATA_STREAM_INIT  [dt=0]\n                        --\x3e is_chunked = false\n                        --\x3e net_error = 0 (?)\n                        --\x3e total_size = 3505027\nt=52518 [st=17449]     +HTTP_TRANSACTION_SEND_REQUEST  [dt=6530]\nt=52518 [st=17449]        HTTP_TRANSACTION_SEND_REQUEST_HEADERS\n                          --\x3e POST /wp-admin/async-upload.php HTTP/1.1\n                              Host: www.xxx.com\n                              Connection: keep-alive\n                              Content-Length: 3505027\n                              Pragma: no-cache\n                              Cache-Control: no-cache\n                              sec-ch-ua: " Not A;Brand";v="99", "Chromium";v="90", "Google Chrome";v="90"\n                              sec-ch-ua-mobile: ?0\n                              User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36\n                              Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryZinpNBEkQJmJWpBq\n                              Accept: */*\n                              Origin: https://www.xxx.com\n                              Sec-Fetch-Site: same-origin\n                              Sec-Fetch-Mode: cors\n                              Sec-Fetch-Dest: empty\n                              Referer: https://www.xxx.com/wp-admin/upload.php\n                              Accept-Encoding: gzip, deflate, br\n                              Accept-Language: en-US,en;q=0.9\n                              Cookie: [717 bytes were stripped]\nt=52518 [st=17449]        HTTP_TRANSACTION_SEND_REQUEST_BODY\n                          --\x3e did_merge = false\n                          --\x3e is_chunked = false\n                          --\x3e length = 3505027\nt=52518 [st=17449]        UPLOAD_DATA_STREAM_READ  [dt=0]\n                          --\x3e current_position = 0\n..............\n又是上传完了但是另外一个错误 net_error = -324\nt=59048 [st=23979]        UPLOAD_DATA_STREAM_READ  [dt=0]\n                          --\x3e current_position = 3505027\nt=59048 [st=23979]     -HTTP_TRANSACTION_SEND_REQUEST\nt=59048 [st=23979]     +HTTP_TRANSACTION_READ_HEADERS  [dt=10135]\nt=59048 [st=23979]        HTTP_STREAM_PARSER_READ_HEADERS  [dt=10135]\n                          --\x3e net_error = -324 (ERR_EMPTY_RESPONSE)\nt=69183 [st=34114]     -HTTP_TRANSACTION_READ_HEADERS\n                        --\x3e net_error = -324 (ERR_EMPTY_RESPONSE)\nt=69183 [st=34114]   -URL_REQUEST_START_JOB\n                      --\x3e net_error = -324 (ERR_EMPTY_RESPONSE)\nt=69183 [st=34114]    URL_REQUEST_DELEGATE_RESPONSE_STARTED  [dt=0]\nt=69184 [st=34115] -REQUEST_ALIVE\n                    --\x3e net_error = -324 (ERR_EMPTY_RESPONSE)\n                    \n看下：HTTP_STREAM_JOB_CONTROLLER和HTTP_STREAM_JOB     \n初次是\nt=35177 [st=  108]        HTTP_STREAM_JOB_CONTROLLER_BOUND\n                          --\x3e source_dependency = 1174836 (HTTP_STREAM_JOB_CONTROLLER)\nt=35180 [st=  111]        HTTP_STREAM_REQUEST_BOUND_TO_JOB\n                          --\x3e source_dependency = 1174837 (HTTP_STREAM_JOB)\n1174836：\n1174836: HTTP_STREAM_JOB_CONTROLLER\nhttps://www.xxx.com/wp-admin/async-upload.php\nStart Time: 2021-11-29 17:25:53.321\n\nt=35177 [st=0] +HTTP_STREAM_JOB_CONTROLLER  [dt=4]\n                --\x3e is_preconnect = false\n                --\x3e url = "https://www.xxx.com/wp-admin/async-upload.php"\nt=35177 [st=0]    HTTP_STREAM_JOB_CONTROLLER_BOUND\n                  --\x3e source_dependency = 1174835 (URL_REQUEST)\nt=35177 [st=0]   +PROXY_RESOLUTION_SERVICE  [dt=3]\nt=35178 [st=1]     +HOST_RESOLVER_IMPL_REQUEST  [dt=0]\n                    --\x3e allow_cached_response = true\n                    --\x3e dns_query_type = 1\n                    --\x3e host = "www.xxx.com:0"\n                    --\x3e is_speculative = false\n                    --\x3e network_isolation_key = "null null"\nt=35178 [st=1]        HOST_RESOLVER_IMPL_CACHE_HIT\n                      --\x3e addresses = ["18.140.49.179","203.205.159.22","150.109.90.80","54.254.71.41","54.254.112.6","13.251.21.164"]\n                      --\x3e expiration = "13282651581632397"\nt=35178 [st=1]        HOST_RESOLVER_IMPL_CACHE_HIT\n                      --\x3e addresses = ["18.140.49.179","203.205.159.22","150.109.90.80","54.254.71.41","54.254.112.6","13.251.21.164"]\n                      --\x3e expiration = "13282651581632397"\nt=35178 [st=1]     -HOST_RESOLVER_IMPL_REQUEST\nt=35180 [st=3]      PROXY_RESOLUTION_SERVICE_RESOLVED_PROXY_LIST\n                    --\x3e pac_string = "PROXY 172.16.101.100:8080"\nt=35180 [st=3]   -PROXY_RESOLUTION_SERVICE\nt=35180 [st=3]    HTTP_STREAM_JOB_CONTROLLER_PROXY_SERVER_RESOLVED\n                  --\x3e proxy_server = "PROXY 172.16.101.100:8080"\nt=35180 [st=3]    HTTP_STREAM_REQUEST_STARTED_JOB\n                  --\x3e source_dependency = 1174837 (HTTP_STREAM_JOB)\nt=35181 [st=4] -HTTP_STREAM_JOB_CONTROLLER\n\n1174837: HTTP_STREAM_JOB\nhttps://www.xxx.com/\nStart Time: 2021-11-29 17:25:53.324\n\nt=35180 [st=0] +HTTP_STREAM_JOB  [dt=0]\n                --\x3e expect_spdy = false\n                --\x3e original_url = "https://www.xxx.com/"\n                --\x3e priority = "MEDIUM"\n                --\x3e source_dependency = 1174836 (HTTP_STREAM_JOB_CONTROLLER)\n                --\x3e url = "https://www.xxx.com/"\n                --\x3e using_quic = false\nt=35180 [st=0]    HTTP_STREAM_JOB_WAITING  [dt=0]\n                  --\x3e should_wait = false\nt=35180 [st=0]   +HTTP_STREAM_JOB_INIT_CONNECTION  [dt=0]\nt=35180 [st=0]      TCP_CLIENT_SOCKET_POOL_REQUESTED_SOCKET\n                    --\x3e group_id = "ssl/www.xxx.com:443"\nt=35180 [st=0]     +SOCKET_POOL  [dt=0]\nt=35180 [st=0]        SOCKET_POOL_REUSED_AN_EXISTING_SOCKET\t#重用persistent TCP connection，所以就排除了最初查到的原因\n                      --\x3e idle_ms = 30348\nt=35180 [st=0]        SOCKET_POOL_BOUND_TO_SOCKET\n                      --\x3e source_dependency = 1174753 (SOCKET)\t#注意这里的SOCKET 1174753就是对应的前面说的connectionID\nt=35180 [st=0]     -SOCKET_POOL\nt=35180 [st=0]   -HTTP_STREAM_JOB_INIT_CONNECTION\nt=35180 [st=0]    HTTP_STREAM_REQUEST_PROTO\n                  --\x3e proto = "http/1.1"\nt=35180 [st=0]    HTTP_STREAM_JOB_BOUND_TO_REQUEST\n                  --\x3e source_dependency = 1174835 (URL_REQUEST)\nt=35180 [st=0] -HTTP_STREAM_JO\n                          \n')])])]),n("p",[e._v("对比，正常的上传")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('1208145: URL_REQUEST\nhttps://xxxx.com/wp-admin/async-upload.php\nStart Time: 2021-11-30 14:27:56.488\n\nt=5339 [st=   0] +REQUEST_ALIVE  [dt=1320]\n                  --\x3e priority = "MEDIUM"\n                  --\x3e traffic_annotation = 101845102\n                  --\x3e url = "https://xxxx.com/wp-admin/async-upload.php"\nt=5339 [st=   0]    DELEGATE_INFO  [dt=140]\n                    --\x3e delegate_blocked_by = "Opening Files"\nt=5479 [st= 140]    NETWORK_DELEGATE_BEFORE_URL_REQUEST  [dt=0]\nt=5479 [st= 140]   +URL_REQUEST_START_JOB  [dt=1179]\n                    --\x3e initiator = "https://www.xxx.com"\n                    --\x3e load_flags = 2 (BYPASS_CACHE)\n                    --\x3e method = "POST"\n                    --\x3e network_isolation_key = "https://xxx.com https://xxx.com"\n                    --\x3e privacy_mode = "disabled"\n                    --\x3e request_type = "other"\n                    --\x3e site_for_cookies = "SiteForCookies: {site=https://xxx.com; schemefully_same=true}"\n                    --\x3e upload_id = "0"\n                    --\x3e url = "https://www.xxx.com/wp-admin/async-upload.php"\nt=5479 [st= 140]      COOKIE_INCLUSION_STATUS\n                      --\x3e operation = "send"\n                      --\x3e status = "EXCLUDE_NOT_ON_PATH, DO_NOT_WARN"\nt=5479 [st= 140]      COOKIE_INCLUSION_STATUS\n                      --\x3e operation = "send"\n                      --\x3e status = "EXCLUDE_DOMAIN_MISMATCH, DO_NOT_WARN"\nt=5479 [st= 140]      COOKIE_INCLUSION_STATUS\n                      --\x3e operation = "send"\n                      --\x3e status = "EXCLUDE_DOMAIN_MISMATCH, DO_NOT_WARN"\nt=5479 [st= 140]      COOKIE_INCLUSION_STATUS\n                      --\x3e operation = "send"\n                      --\x3e status = "EXCLUDE_DOMAIN_MISMATCH, DO_NOT_WARN"\nt=5479 [st= 140]      COOKIE_INCLUSION_STATUS\n                      --\x3e operation = "send"\n                      --\x3e status = "INCLUDE, DO_NOT_WARN"\nt=5479 [st= 140]      COOKIE_INCLUSION_STATUS\n                      --\x3e operation = "send"\n                      --\x3e status = "INCLUDE, DO_NOT_WARN"\nt=5479 [st= 140]      COOKIE_INCLUSION_STATUS\n                      --\x3e operation = "send"\n                      --\x3e status = "INCLUDE, DO_NOT_WARN"\nt=5479 [st= 140]      COOKIE_INCLUSION_STATUS\n                      --\x3e operation = "send"\n                      --\x3e status = "INCLUDE, DO_NOT_WARN"\nt=5479 [st= 140]      COOKIE_INCLUSION_STATUS\n                      --\x3e operation = "send"\n                      --\x3e status = "INCLUDE, DO_NOT_WARN"\nt=5479 [st= 140]      COOKIE_INCLUSION_STATUS\n                      --\x3e operation = "send"\n                      --\x3e status = "INCLUDE, DO_NOT_WARN"\nt=5479 [st= 140]      COOKIE_INCLUSION_STATUS\n                      --\x3e operation = "send"\n                      --\x3e status = "INCLUDE, DO_NOT_WARN"\nt=5479 [st= 140]      COOKIE_INCLUSION_STATUS\n                      --\x3e operation = "send"\n                      --\x3e status = "INCLUDE, DO_NOT_WARN"\nt=5479 [st= 140]      NETWORK_DELEGATE_BEFORE_START_TRANSACTION  [dt=0]\nt=5479 [st= 140]      HTTP_CACHE_GET_BACKEND  [dt=0]\nt=5479 [st= 140]     +HTTP_STREAM_REQUEST  [dt=3]\nt=5479 [st= 140]        HTTP_STREAM_JOB_CONTROLLER_BOUND\n                        --\x3e source_dependency = 1208146 (HTTP_STREAM_JOB_CONTROLLER)\nt=5482 [st= 143]        HTTP_STREAM_REQUEST_BOUND_TO_JOB\n                        --\x3e source_dependency = 1208147 (HTTP_STREAM_JOB)\nt=5482 [st= 143]     -HTTP_STREAM_REQUEST\nt=5482 [st= 143]      UPLOAD_DATA_STREAM_INIT  [dt=0]\n                      --\x3e is_chunked = false\n                      --\x3e net_error = 0 (?)\n                      --\x3e total_size = 4792\nt=5482 [st= 143]     +HTTP_TRANSACTION_SEND_REQUEST  [dt=1]\nt=5482 [st= 143]        HTTP_TRANSACTION_SEND_REQUEST_HEADERS\n                        --\x3e POST /wp-admin/async-upload.php HTTP/1.1\n                            Host: www.xxx.com\n                            Connection: keep-alive\n                            Content-Length: 4792\n                            Pragma: no-cache\n                            Cache-Control: no-cache\n                            sec-ch-ua: " Not A;Brand";v="99", "Chromium";v="90", "Google Chrome";v="90"\n                            sec-ch-ua-mobile: ?0\n                            User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36\n                            Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryHCDeoH2gO9wCcNFe\n                            Accept: */*\n                            Origin: https://www.xxx.com\n                            Sec-Fetch-Site: same-origin\n                            Sec-Fetch-Mode: cors\n                            Sec-Fetch-Dest: empty\n                            Referer: https://www.xxx.com/wp-admin/upload.php\n                            Accept-Encoding: gzip, deflate, br\n                            Accept-Language: en-US,en;q=0.9\n                            Cookie: [717 bytes were stripped]\nt=5483 [st= 144]        HTTP_TRANSACTION_SEND_REQUEST_BODY\n                        --\x3e did_merge = false\n                        --\x3e is_chunked = false\n                        --\x3e length = 4792\nt=5483 [st= 144]        UPLOAD_DATA_STREAM_READ  [dt=0]\n                        --\x3e current_position = 0\nt=5483 [st= 144]        UPLOAD_DATA_STREAM_READ  [dt=0]\n                        --\x3e current_position = 4792\nt=5483 [st= 144]     -HTTP_TRANSACTION_SEND_REQUEST\nt=5483 [st= 144]     +HTTP_TRANSACTION_READ_HEADERS  [dt=1175]\nt=5483 [st= 144]        HTTP_STREAM_PARSER_READ_HEADERS  [dt=1175]\nt=6658 [st=1319]        HTTP_TRANSACTION_READ_RESPONSE_HEADERS\n                        --\x3e HTTP/1.1 200 OK\n                            Server: nginx\n                            Date: Tue, 30 Nov 2021 06:27:57 GMT\n                            Content-Type: text/plain; charset=UTF-8\n                            Expires: Wed, 11 Jan 1984 05:00:00 GMT\n                            X-Frame-Options: SAMEORIGIN\n                            Referrer-Policy: strict-origin-when-cross-origin\n                            X-Content-Type-Options: nosniff\n                            X-WP-Upload-Attachment-ID: 3447\n                            X-XSS-Protection: 1; mode=block\n                            Strict-Transport-Security: max-age=31536000; includeSubDomains;\n                            X-Cache-Lookup: Cache Miss\n                            Content-Encoding: gzip\n                            Cache-Control: must-revalidate, no-cache, max-age=0\n                            Transfer-Encoding: chunked\n                            X-NWS-LOG-UUID: 7691670333191889\n                            Connection: keep-alive\n                            X-Cache-Lookup: Cache Miss\nt=6658 [st=1319]     -HTTP_TRANSACTION_READ_HEADERS\nt=6658 [st=1319]      NETWORK_DELEGATE_HEADERS_RECEIVED  [dt=0]\nt=6658 [st=1319]      URL_REQUEST_FILTERS_SET\n                      --\x3e filters = "GZIP"\nt=6658 [st=1319]   -URL_REQUEST_START_JOB\nt=6658 [st=1319]    URL_REQUEST_DELEGATE_RESPONSE_STARTED  [dt=0]\nt=6658 [st=1319]    HTTP_TRANSACTION_READ_BODY  [dt=0]\nt=6658 [st=1319]    URL_REQUEST_JOB_BYTES_READ\n                    --\x3e byte_count = 845\nt=6658 [st=1319]    URL_REQUEST_JOB_FILTERED_BYTES_READ\n                    --\x3e byte_count = 1868\nt=6659 [st=1320]    HTTP_TRANSACTION_READ_BODY  [dt=0]\nt=6659 [st=1320] -REQUEST_ALIVE\n')])])]),n("p",[e._v("问题的核心在于为什么明明已经上传完成（current_position = 3505027===length = 3505027），但是")]),e._v(" "),n("p",[e._v("HTTP_STREAM_PARSER_READ_HEADERS net_error = -100 (ERR_CONNECTION_CLOSED)")]),e._v(" "),n("p",[e._v("为什么服务端会关掉？")]),e._v(" "),n("p",[e._v("想起来再抓一下dev环境的netlog，发现dev上速度确实快一点，")]),e._v(" "),n("p",[e._v("测试了  vim /etc/httpd/conf/httpd.conf\tTimeout 以及 vim /etc/opt/rh/rh-php72/php.ini max_execution_time，把这些时间放到3秒都没有问题，前面测试3M文件上传大概6到10秒")]),e._v(" "),n("p",[e._v("并且检查了 /.htaccess 都没有问题")]),e._v(" "),n("p",[e._v("再查查其他timeout： 搜索apache httpd http connection closed timeout")]),e._v(" "),n("p",[e._v("https://httpd.apache.org/docs/2.4/mod/core.html")]),e._v(" "),n("p",[e._v("https://www.oreilly.com/library/view/http-the-definitive/1565925092/ch04s07.html")]),e._v(" "),n("p",[e._v("换个关键词吧，毕竟是大文件引起的，测试小图标确实上传没问题，搜索 large file ERR_CONNECTION_CLOSED")]),e._v(" "),n("p",[e._v("https://stackoverflow.com/questions/53736912/neterr-connection-reset-when-large-file-takes-longer-than-a-minute")]),e._v(" "),n("p",[e._v("但是这个答案总感觉有点不太对")]),e._v(" "),n("div",{staticClass:"language-php extra-class"},[n("pre",{pre:!0,attrs:{class:"language-php"}},[n("code",[e._v("RequestReadTimeout header"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("20")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("40")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" MinRate"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("500")]),e._v(" body"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" MinRate"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("500")]),e._v("\nhttps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//httpd.apache.org/docs/current/mod/mod_reqtimeout.html")]),e._v("\n")])])]),n("p",[e._v("然后看到另外一个人的回答是因为 ProxyTimeout，回到netlog-viewer：")]),e._v(" "),n("p",[e._v("https://netlog-viewer.appspot.com/#sockets")]),e._v(" "),n("table",[n("thead",[n("tr",[n("th",[e._v("Name")]),e._v(" "),n("th",[e._v("Handed Out")]),e._v(" "),n("th",[e._v("Idle")]),e._v(" "),n("th",[e._v("Connecting")]),e._v(" "),n("th",[e._v("Max")]),e._v(" "),n("th",[e._v("Max Per Group")]),e._v(" "),n("th",[e._v("Generation")])])]),e._v(" "),n("tbody",[n("tr",[n("td",[e._v("direct:// (transport_socket_pool)")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[n("a",{attrs:{href:"https://netlog-viewer.appspot.com/#events&q=id:1208669,1208667,1208111,1208329",target:"_blank",rel:"noopener noreferrer"}},[e._v("4"),n("OutboundLink")],1)]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("256")]),e._v(" "),n("td",[e._v("6")]),e._v(" "),n("td",[e._v("undefined")])]),e._v(" "),n("tr",[n("td",[e._v("172.16.101.100:8080 (http_proxy_socket_pool)")]),e._v(" "),n("td",[e._v("1")]),e._v(" "),n("td",[n("a",{attrs:{href:"https://netlog-viewer.appspot.com/#events&q=id:1203134,1205602,1208691",target:"_blank",rel:"noopener noreferrer"}},[e._v("3"),n("OutboundLink")],1)]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("32")]),e._v(" "),n("td",[e._v("6")]),e._v(" "),n("td",[e._v("undefined")])]),e._v(" "),n("tr",[n("td",[e._v("127.0.0.1:8888 (http_proxy_socket_pool)")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("32")]),e._v(" "),n("td",[e._v("6")]),e._v(" "),n("td",[e._v("undefined")])])])]),e._v(" "),n("table",[n("thead",[n("tr",[n("th",[e._v("direct:// (transport_socket_pool)")]),e._v(" "),n("th"),e._v(" "),n("th"),e._v(" "),n("th"),e._v(" "),n("th"),e._v(" "),n("th"),e._v(" "),n("th"),e._v(" "),n("th")])]),e._v(" "),n("tbody",[n("tr",[n("td",[e._v("Name")]),e._v(" "),n("td",[e._v("Pending")]),e._v(" "),n("td",[e._v("Top Priority")]),e._v(" "),n("td",[e._v("Active")]),e._v(" "),n("td",[e._v("Idle")]),e._v(" "),n("td",[e._v("Connect Jobs")]),e._v(" "),n("td",[e._v("Backup Timer")]),e._v(" "),n("td",[e._v("Stalled")])]),e._v(" "),n("tr",[n("td",[e._v("ssl/dev.xxx.com:443")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("-")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[n("a",{attrs:{href:"https://netlog-viewer.appspot.com/#events&q=id:1208669,1208667",target:"_blank",rel:"noopener noreferrer"}},[e._v("2"),n("OutboundLink")],1)]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("stopped")]),e._v(" "),n("td",[e._v("false")])]),e._v(" "),n("tr",[n("td",[e._v("ssl/hrs.asiapacificex.com:443")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("-")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[n("a",{attrs:{href:"https://netlog-viewer.appspot.com/#events&q=id:1208111,1208329",target:"_blank",rel:"noopener noreferrer"}},[e._v("2"),n("OutboundLink")],1)]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("stopped")]),e._v(" "),n("td",[e._v("false")])])])]),e._v(" "),n("table",[n("thead",[n("tr",[n("th",[e._v("172.16.101.100:8080 (http_proxy_socket_pool)")]),e._v(" "),n("th"),e._v(" "),n("th"),e._v(" "),n("th"),e._v(" "),n("th"),e._v(" "),n("th"),e._v(" "),n("th"),e._v(" "),n("th")])]),e._v(" "),n("tbody",[n("tr",[n("td",[e._v("Name")]),e._v(" "),n("td",[e._v("Pending")]),e._v(" "),n("td",[e._v("Top Priority")]),e._v(" "),n("td",[e._v("Active")]),e._v(" "),n("td",[e._v("Idle")]),e._v(" "),n("td",[e._v("Connect Jobs")]),e._v(" "),n("td",[e._v("Backup Timer")]),e._v(" "),n("td",[e._v("Stalled")])]),e._v(" "),n("tr",[n("td",[e._v("pm/ssl/sdk.split.io:443")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("-")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[n("a",{attrs:{href:"https://netlog-viewer.appspot.com/#events&q=id:1203134",target:"_blank",rel:"noopener noreferrer"}},[e._v("1"),n("OutboundLink")],1)]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("stopped")]),e._v(" "),n("td",[e._v("false")])]),e._v(" "),n("tr",[n("td",[e._v("ssl/d27xxe7juh1us6.cloudfront.net:443")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("-")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[n("a",{attrs:{href:"https://netlog-viewer.appspot.com/#events&q=id:1205602",target:"_blank",rel:"noopener noreferrer"}},[e._v("1"),n("OutboundLink")],1)]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("stopped")]),e._v(" "),n("td",[e._v("false")])]),e._v(" "),n("tr",[n("td",[e._v("ssl/www.xxx.com:443")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("-")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[n("a",{attrs:{href:"https://netlog-viewer.appspot.com/#events&q=id:1208691",target:"_blank",rel:"noopener noreferrer"}},[e._v("1"),n("OutboundLink")],1)]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("stopped")]),e._v(" "),n("td",[e._v("false")])]),e._v(" "),n("tr",[n("td",[e._v("ssl/www.google.com:443")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("-")]),e._v(" "),n("td",[e._v("1")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("0")]),e._v(" "),n("td",[e._v("stopped")]),e._v(" "),n("td",[e._v("false")])])])]),e._v(" "),n("p",[e._v("可以看到，dev.xxx.com是直接访问的，而www.xxx.com是通过proxy，所以是不是因为这个proxy的原因")]),e._v(" "),n("h4",{attrs:{id:"问题梳理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#问题梳理"}},[e._v("#")]),e._v(" 问题梳理")]),e._v(" "),n("p",[e._v("首先，chrome使用了机器本身设定的proxy，我是公司电脑，连vpn访问网站会经过默认的proxy server，就是前面的172.16.101.100，")]),e._v(" "),n("p",[e._v("firefox可以设定proxy，然后想起来最初使用firefox测试的时候，设置的是no-proxy，")]),e._v(" "),n("p",[e._v("经过一番查找，firefox貌似没有类似chrome的net log viewer，只有个")]),e._v(" "),n("p",[e._v("https://firefox-source-docs.mozilla.org/networking/http/logging.html\nabout:networking#logging")]),e._v(" "),n("p",[e._v("然后发现web developer tool下面有个performance capture，用了下，发现")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("Status:\nResponse received\nURL:\nhttps://www.xxx.com/wp-admin/async-upload.php\nPriority:\nNormal(0)\nThread:\nWeb Content (3/9)\nURL:\nhttps://www.xxx.com/wp-admin/upload.php (id: 42949673009)\nWaiting for socket thread:\n42,476ms\nDNS request:\n0.27ms\nAfter DNS request:\n1.2ms\nTCP connection:\n22,389ms\nAfter TCP connection:\n13ms\nEstablishing TLS session:\n311ms\nWaiting for HTTP request:\n1,549ms\nHTTP request and waiting for response:\n14,964ms\nHTTP response:\n15,294ms\nWaiting to transmit the response:\n32ms\n")])])]),n("p",[e._v("Response received显然是不对的，不过下面Waiting for socket thread:42,476ms和TCP connection:22,389ms加起来都超过一分钟了，在about:networking#dns可以看到www.xxx.com解析到了一堆ip，经过询问infra，同事说是waf public ip，所以原来是waf导致了tcp connection超时，")]),e._v(" "),n("p",[e._v("怪不得跟chrome的时间有点不同，chrome至少可以看到在重用reuse tcp socket connection的时候是很快的，那么就自然要确认下，重新设置firefox auto detect proxy，即使用跟chrome一样的机器的proxy，结果如下：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("Status:\nResponse received\nURL:\nhttps://www.xxx.com/wp-admin/async-upload.php\nPriority:\nNormal(0)\nThread:\nWeb Content (1/8)\nURL:\nhttps://www.xxx.com/wp-admin/upload.php (id: 42949673012)\nWaiting for socket thread:\n44ms\nHTTP request and waiting for response:\n13,371ms\nHTTP response:\n15,701ms\nWaiting to transmit the response:\n4.3ms\n")])])]),n("p",[e._v("先走了proxy，等待socket时间变短了，可能是reuse也不用重新建立tcp连接握手了，不过等待http reponse的时间很长，估计超时了（超过proxy服务器的timeout时长），至少这次跟chrome表现一样了；")]),e._v(" "),n("p",[e._v("最后自然是重新设置no-proxy，绕过proxy然后绕过waf（设置hosts直接指向web服务器的ip），果然上传成功！")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("Status:\nResponse received\nURL:\nhttps://www.xxx.com/wp-admin/async-upload.php\nPriority:\nNormal(0)\nMIME type:\ntext/plain\nRequested bytes:\n2,259B\nThread:\nWeb Content (1/8)\nURL:\nhttps://www.xxx.com/wp-admin/upload.php (id: 42949673015)\nWaiting for socket thread:\n98ms\nDNS request:\n0.29ms\nAfter DNS request:\n1.3ms\nTCP connection:\n121ms\nAfter TCP connection:\n3.5ms\nEstablishing TLS session:\n114ms\nWaiting for HTTP request:\n21ms\nHTTP request and waiting for response:\n18,930ms\nHTTP response:\n0.67ms\nWaiting to transmit the response:\n4.1ms\n")])])]),n("p",[e._v("https://stackoverflow.com/questions/27740692/request-stalled-for-a-long-time-occasionally-in-chrome/70180892#70180892")]),e._v(" "),n("p",[e._v("https://stackoverflow.com/questions/53736912/neterr-connection-reset-when-large-file-takes-longer-than-a-minute/70180666#70180666")]),e._v(" "),n("h3",{attrs:{id:"websocket-connection-issue"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#websocket-connection-issue"}},[e._v("#")]),e._v(" websocket connection issue")]),e._v(" "),n("p",[e._v("这次遇到的问题：")]),e._v(" "),n("p",[e._v("firefox访问没有问题（浏览器连接服务器的nginx并转发到websocket端口），本地vscode debug（连接本地nginx，nginx转发到服务器上的websocket服务端）")]),e._v(" "),n("p",[e._v("原因跟上面wordpress large file upload failed一样都是因为公司机器chrome使用了proxy")]),e._v(" "),n("p",[e._v("通常websocket连接不成功大概率是client端或者服务端的问题，所以刚开始浪费了不少时间查看服务端的情况以及websocket client端代码，其实可以直接在dev tools里面执行代码片段进行调试")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("// Create WebSocket connection.\nconst socket = new WebSocket('ws://localhost:8080');\n\n// Connection opened\nsocket.addEventListener('open', function (event) {\n    socket.send('Hello Server!');\n});\n\n// Listen for messages\nsocket.addEventListener('message', function (event) {\n    console.log('Message from server ', event.data);\n});\n\n")])])]),n("p",[e._v("观察到，chrome下偶尔成功，多数时间失败，上chrome终极大杀器 netlog viewer，发现跟前面一样的原因；")]),e._v(" "),n("p",[e._v("后来才有人反馈firefox可以，才意识到firefox默认proxy设置成了blank，chrome不使用插件的情况下默认是系统的proxy")])])}),[],!1,null,null,null);t.default=o.exports}}]);