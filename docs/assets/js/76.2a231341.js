(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{278:function(e,s,t){"use strict";t.r(s);var n=t(0),a=Object(n.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[t("a",{attrs:{href:"/docs/software"}},[e._v("回目录")]),e._v("  《mysql实用基础》")]),e._v(" "),t("h2",{attrs:{id:"_1-setup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-setup"}},[e._v("#")]),e._v(" 1.Setup")]),e._v(" "),t("h3",{attrs:{id:"_1-1-install-on-centos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-install-on-centos"}},[e._v("#")]),e._v(" 1.1 Install on centos")]),e._v(" "),t("p",[t("strong",[e._v("Method 1: Using rpm")])]),e._v(" "),t("p",[t("strong",[e._v("Method 2: Using tar")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("tar -xvf mysql-5.7.26-1.el7.x86_64.rpm-bundle.tar\nyum install mysql-community-{server,client,common,libs}-* mysql-5.*­\n\n?#Install error\nhttps://princetonits.com/centos7-mysql-install-fails-due-conflict-libmysqlclient/\nyum list installed mariadb\\*\nyum remove mariadb-libs.x86_64\n\nvim /etc/my.cnf\nBind-address:0.0.0.0\nservice mysqld stop/start\n")])])]),t("p",[e._v("Mysql默认密码：\n/var/log/mysqld.log\nA temporary password\nhttps://www.techietown.info/2017/08/mysql-default-root-password-on-centos7/")]),e._v(" "),t("p",[e._v("password policy:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("mysql -uroot -p\nSET PASSWORD = PASSWORD(‘1qaz#EDC’);\nSHOW VARIABLES LIKE 'validate_password%';\nSET GLOBAL validate_password_length = 6;\nSET GLOBAL validate_password_number_count = 0;\nSET PASSWORD = PASSWORD(‘123456’);\n")])])]),t("p",[e._v("create database:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("CREATE USER 'newuser'@'%' IDENTIFIED BY 'password';\nGRANT ALL PRIVILEGES ON dbname.* TO 'newuser'@'%' identified by 'password';\n#GRANT ALL PRIVILEGES ON *.* TO 'newuser'@'localhost';\nFLUSH PRIVILEGES;\n\nSHOW GRANTS FOR 'root'@'localhost';\nSELECT user, host FROM mysql.user;\nDROP USER ''@'localhost';\n\ncreate database dbname;\n\n")])])]),t("h3",{attrs:{id:"_1-2-install-on-windows"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-install-on-windows"}},[e._v("#")]),e._v(" 1.2 Install on windows")]),e._v(" "),t("p",[t("img",{attrs:{src:"/docs/docs_image/software/mysql/mysql01.png",alt:""}})]),e._v(" "),t("p",[e._v("Setup replication\nhttps://lyhistory.com/mysql_replication/#")]),e._v(" "),t("h3",{attrs:{id:"_1-3-client-tools"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-client-tools"}},[e._v("#")]),e._v(" 1.3 Client Tools")]),e._v(" "),t("p",[e._v("http://sqlfiddle.com/")]),e._v(" "),t("p",[e._v("Dbeaver export mysql\nExport without data https://github.com/dbeaver/dbeaver/issues/2176")]),e._v(" "),t("p",[e._v("mysql workbench")]),e._v(" "),t("h2",{attrs:{id:"_2-db-management"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-db-management"}},[e._v("#")]),e._v(" 2. DB Management")]),e._v(" "),t("h3",{attrs:{id:"_2-1-mysql-cli"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-mysql-cli"}},[e._v("#")]),e._v(" 2.1 mysql-cli")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("mysql -uroot -pCappuccin0!\nmysql --login-path=sgkc2-devclr-v01\n\nmysql_config_editor/login-path\nmysql_config_editor print --all\n")])])]),t("p",[e._v("grep:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("pager grep ***\n\\n\nhttps://stackoverflow.com/questions/10177465/grep-in-mysql-cli-interpretter\n")])])]),t("h3",{attrs:{id:"_2-2-database-management"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-database-management"}},[e._v("#")]),e._v(" 2.2 database management")]),e._v(" "),t("p",[t("strong",[e._v("upgrade 5.7.18 5.7.26")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('SHOW VARIABLES WHERE Variable_name LIKE "version";\n\nhttps://dev.mysql.com/doc/refman/5.7/en/upgrading.html\nyum list installed | grep "^mysql"\n\n$ yum list installed | grep "^mysql"\nRepodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast\nmysql-community-client.x86_64         5.7.18-1.el7                @/mysql-community-client-5.7.18-1.el7.x86_64\nmysql-community-common.x86_64         5.7.18-1.el7                @/mysql-community-common-5.7.18-1.el7.x86_64\nmysql-community-libs.x86_64           5.7.18-1.el7                @/mysql-community-libs-5.7.18-1.el7.x86_64\nmysql-community-server.x86_64         5.7.18-1.el7                @/mysql-community-server-5.7.18-1.el7.x86_64\n\n$ find / -name "mysql" -o -name "mysqld" -type f -print 2>/dev/null\n/usr/sbin/mysqld\n$ find / -name "mysql" -type d -print 2>/dev/null\n/var/lib/mysql\n/usr/lib64/mysql\n/usr/share/mysql\n\n')])])]),t("p",[e._v("backup https://dev.mysql.com/doc/refman/5.7/en/mysqldump-sql-format.html\nmysqldump -uroot -pCappuccin0! --all-databases > mysqldump_20190524.sql")]),e._v(" "),t("p",[e._v("Upgrading MySQL with Directly-Downloaded RPM Packages\nhttps://dev.mysql.com/doc/refman/5.7/en/updating-direct-rpms.html\nhttps://dev.mysql.com/doc/refman/5.7/en/linux-installation-rpm.html")]),e._v(" "),t("p",[e._v("https://dev.mysql.com/downloads/mysql/")]),e._v(" "),t("p",[e._v("??rpm -qpl mysql-community-server-5.7.26-1.el7.x86_64.rpm\nFor Red Hat Enterprise Linux/Oracle Linux/CentOS systems:\nyum install mysql-community-{server,client,common,libs}-* mysql-5.*­")]),e._v(" "),t("p",[e._v("For Red Hat Enterprise Linux, Oracle Linux, CentOS, and Fedora systems, use the following command to start MySQL:\nservice mysqld start\nmysql-upgrade -uroot -pPassword\nOnce the server restarts, run mysql_upgrade to check and possibly resolve any incompatibilities between the old data and the upgraded software. mysql_upgrade also performs other functions; see Section 4.4.7, “mysql_upgrade — Check and Upgrade MySQL Tables” for details.\nIf you use replication, review Section 16.4.3, “Upgrading a Replication Setup”.\nwarning Table mysql/innodb_table_stats has length mismatch in the column name table_name. Please run mysql_upgrade\nhttps://dev.mysql.com/doc/relnotes/mysql/5.7/en/news-5-7-23.html")]),e._v(" "),t("p",[e._v("Installation of previous versions of MySQL using older packages might have created a configuration file named /usr/my.cnf. It is highly recommended that you examine the contents of the file and migrate the desired settings inside to the file /etc/my.cnf file, then remove /usr/my.cnf.")]),e._v(" "),t("p",[e._v("trouble shooting\nhttps://dev.mysql.com/doc/refman/5.7/en/upgrade-troubleshooting.html")]),e._v(" "),t("p",[t("strong",[e._v("turn off local_infile")]),e._v("\nSHOW VARIABLES WHERE Variable_name = 'local_infile';\nSET GLOBAL local_infile = 'OFF';")]),e._v(" "),t("p",[t("strong",[e._v("plugins")]),e._v("\nhttps://dev.mysql.com/doc/refman/5.7/en/server-plugins.html\nhttps://dev.mysql.com/doc/refman/5.7/en/plugin-loading.html#server-plugin-installing")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("SHOW VARIABLES WHERE Variable_name = 'plugin_dir';\n\t/usr/lib64/mysql/plugin/\nSELECT * FROM INFORMATION_SCHEMA.PLUGINS\\G \nSELECT * FROM mysql.plugin;\nINSTALL PLUGIN myplugin SONAME 'validate_password.so';\n\nSELECT PLUGIN_NAME, PLUGIN_STATUS\n       FROM INFORMATION_SCHEMA.PLUGINS\n       WHERE PLUGIN_NAME LIKE 'validate%';\n\t   \nThe following lines should be present in the global configuration:\nplugin-load=validate_password.so\nvalidate-password=FORCE_PLUS_PERMANENT\nhttps://dev.mysql.com/doc/refman/5.7/en/validate-password-installation.html\n\nvim /etc/my.cnf\n[mysqld]\nplugin-load-add=validate_password.so\nvalidate-password=FORCE_PLUS_PERMANENT\n")])])]),t("p",[e._v("If it is desired to prevent the server from running without the password-validation plugin, use --validate-password with a value of FORCE or FORCE_PLUS_PERMANENT to force server startup to fail if the plugin does not initialize successfully.")]),e._v(" "),t("p",[e._v("service mysqld start --validate-password=FORCE_PLUS_PERMANENT")]),e._v(" "),t("h2",{attrs:{id:"_3-troubleshooting"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-troubleshooting"}},[e._v("#")]),e._v(" 3.Troubleshooting")]),e._v(" "),t("p",[t("strong",[e._v("?#Host 'xxx.xx.xxx.xxx' is not allowed to connect to this MySQL server")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("CREATE USER 'test'@'%' IDENTIFIED BY '123456';\nGRANT ALL PRIVILEGES ON * . * TO 'test'@'%';\nFLUSH PRIVILEGES;\n")])])]),t("p",[t("strong",[e._v("?#mysql workbench The type initializer for 'HtmlRenderer.Utils.FontsUtils' threw an exception.")]),e._v("\nhttp://stackoverflow.com/questions/32020024/upgrading-to-windows-10-breaks-mysql-workbench\nhttps://bugs.mysql.com/bug.php?id=75344")]),e._v(" "),t("p",[t("strong",[e._v("?#script import issue;")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("-- Set new delimiter '$$'\nDELIMITER $$\n$$\n-- Set default delimiter ';'\nDELIMITER ;\n")])])]),t("p",[t("strong",[e._v("?#Fixing “Lock wait timeout exceeded; try restarting transaction” for a 'stuck\" Mysql table?")])]),e._v(" "),t("p",[e._v("https://stackoverflow.com/questions/5836623/getting-lock-wait-timeout-exceeded-try-restarting-transaction-even-though-im")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("show processlist;\nkill <put_process_id_here>; 先干掉耗时长的process\n")])])]),t("h2",{attrs:{id:"_4-sql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-sql"}},[e._v("#")]),e._v(" 4. SQL")]),e._v(" "),t("h3",{attrs:{id:"basic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#basic"}},[e._v("#")]),e._v(" Basic")]),e._v(" "),t("p",[e._v("a mysql db can have many schema,"),t("strong",[e._v("like a building have many rooms, and users can get access to different room, so schema can have more than one user.")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("SELECT DATE_FORMAT(date_add(date_column,INTERVAL 8 HOUR),'%b %d %Y %h %p'),COUNT(distinct(count_column))\nFROM db.table\nwhere date_add(date_column,INTERVAL 8 HOUR) between '2015-02-01 00:00:00' and '2015-03-01 00:00:00'\nGROUP BY DATE_FORMAT(date_column,'%b %d %Y %h %p')\norder by DATE_FORMAT(date_add(date_column,INTERVAL 8 HOUR),'%b %d %Y %h %p');\n")])])]),t("p",[e._v("CRUD")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("insert into phoenix.`program-slot`(duration,dateOfProgram,startTime,`weekly-schedule_id`,presenter_id,producer_id,program_id)\nselect duration,date_add(dateOfProgram,INTERVAL 2 DAY), IFNULL(date_add(startTime,INTERVAL 2 DAY),null) ,100,presenter_id,producer_id,program_id from phoenix.`program-slot` where `weekly-schedule_id` =3;\n\n")])])]),t("h3",{attrs:{id:"advance"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#advance"}},[e._v("#")]),e._v(" Advance")]),e._v(" "),t("p",[t("strong",[e._v("Performance on index : when join a large table")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("bad:\nselect user.*, log.LoginTime\nfrom users user\nleft join login_log log on user.id=log.userid and log.LoginTime=(select max(LoginTime) from login_log where userid=log.userid and status='true');\ngood:\nselect user.*, log.LoginTime\nfrom users user\nleft join (\nselect max(LoginTime) LoginTime,userid from login_log\nwhere  status='true'\ngroup by userid) temp on temp.userid=user.userid;\n")])])]),t("p",[t("strong",[e._v("存储过程互相调用")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("DELIMITER $$\nCREATE DEFINER=`dbuser`@`%` PROCEDURE `PROCE1`(\nin _param varchar(50)\n)\nroot:BEGIN\ndeclare _count int;\nselect count(1) into _count from table where column=_param;\nif _count<>1 then\nselect -1 as result;\nleave root;\nend if;\ncall PROCE2(_param);\ndo something else\nselect 0 as result;\nEND\n\nDELIMITER $$\nCREATE DEFINER=`dbuser`@`%` PROCEDURE `PROCE2`(\nin _param int\n)\nBEGIN\nDECLARE done INT DEFAULT FALSE;\ndeclare _variable1 int;\ndeclare _variable2 decimal(10,2);\ndeclare resultCur cursor for select column1,column2 from table where column=_param;\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;\nDECLARE exit handler for sqlexception\nBEGIN\nROLLBACK;\nget diagnostics condition 1 @p1 = MESSAGE_TEXT;\nselect -1 as result, @p1 as message from dual;\nEND;\nopen resultCur;\noperaLoop:Loop\nfetch resultCur into _variable1,_variable2;\nif done then\nleave operaLoop;\nend if;\ndo something...\nend Loop;\nclose resultCur;\nEND\n\n")])])]),t("p",[t("strong",[e._v("Multiple cursors in mysql stored procedure")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('DROP PROCEDURE IF EXISTS `multipleCursorsAtOne`;\nDELIMITER $$\nCREATE PROCEDURE `multipleCursorsAtOne`()\nBEGIN\nDROP TABLE IF EXISTS userNames;\nCREATE TEMPORARY TABLE userNames\n(userName varchar(200) NOT NULL);\nBEGIN\nDECLARE done BOOLEAN DEFAULT false;\nDECLARE p_first_name VARCHAR(200);\nDECLARE cursor_a CURSOR FOR SELECT user_name FROM user_info LIMIT 1,3;\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;\nOPEN cursor_a;\ncursor_a_loop: LOOP\nFETCH cursor_a INTO p_first_name;\nIF done THEN\nLEAVE cursor_a_loop;\nEND IF;\n-- cursor loop statements\nIF p_first_name IS NOT NULL AND p_first_name <> "" THEN\nINSERT INTO userNames(userName) VALUES(p_first_name);\nEND IF;\nEND LOOP;\nCLOSE cursor_a;\nEND;\nBEGIN\nDECLARE done BOOLEAN DEFAULT false;\nDECLARE p_first_name VARCHAR(200);\nDECLARE cursor_a CURSOR FOR SELECT user_name FROM user_info LIMIT 4,3;\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;\nOPEN cursor_a;\ncursor_a_loop: LOOP\nFETCH cursor_a INTO p_first_name;\nIF done THEN\nLEAVE cursor_a_loop;\nEND IF;\n-- cursor loop statements\nIF p_first_name IS NOT NULL AND p_first_name <> "" THEN\nINSERT INTO userNames(userName) VALUES(p_first_name);\nEND IF;\nEND LOOP;\nCLOSE cursor_a;\nEND;\nSELECT * FROM userNames;\nEND\n$$\n\n')])])]),t("p",[t("strong",[e._v("Recursive query")])]),e._v(" "),t("p",[e._v("就是针对存在parent id的存在层级关系的表")]),e._v(" "),t("p",[e._v("Hierarchical data in MySQL: parents and children in one query")]),e._v(" "),t("p",[e._v("https://stackoverflow.com/questions/20215744/how-to-create-a-mysql-hierarchical-recursive-query")]),e._v(" "),t("p",[e._v("Managing Hierarchical Data in MySQL")]),e._v(" "),t("p",[e._v("https://www.mysqltutorial.org/mysql-adjacency-list-tree/")]),e._v(" "),t("hr"),e._v(" "),t("p",[e._v("ref:")]),e._v(" "),t("p",[e._v("https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-centos-7")]),e._v(" "),t("p",[e._v("benchmark: http://www.itsecure.hu/library/image/CIS_Oracle_MySQL_Enterprise_Edition_5.7_Benchmark_v1.0.0.pdf")])])}),[],!1,null,null,null);s.default=a.exports}}]);