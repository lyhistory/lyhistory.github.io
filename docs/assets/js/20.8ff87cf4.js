(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{222:function(t,e,n){"use strict";n.r(e);var a=n(0),r=Object(a.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[n("a",{attrs:{href:"/docs/software"}},[t._v("回目录")]),t._v("  《spring分布式微服务入门》")]),t._v(" "),n("p",[t._v("我们今天来梳理归纳一下java的开发框架，首先为什么需要框架？")]),t._v(" "),n("ol",[n("li",[t._v("节约成本")])]),t._v(" "),n("p",[t._v("不可能所有东西都从零造起，成本太高，spring融合了市场上大部分的开源项目，可以直接‘免费’利用")]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[t._v("安全考虑")])]),t._v(" "),n("p",[t._v("当前网络环境复杂，攻击无处不在，成熟的框架已经被主流公司接受使用，很多坑已经被前人踩过，站在巨人的肩膀上是明智之选，不用交额外的智商税")]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[t._v("业务发展")])]),t._v(" "),n("p",[t._v("spring boot不只是框架，还是spring cloud的一部分，spring cloud是微服务架构的一套完整是有序框架集合，\nspring是建筑材料，spring boot是脚手架，spring cloud就是行业规范，采用行业规范的开发模式有利于IT更好的服务business和业务拓展")]),t._v(" "),n("h2",{attrs:{id:"_1-overview"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-overview"}},[t._v("#")]),t._v(" 1. Overview")]),t._v(" "),n("h3",{attrs:{id:"_1-1-soa-微服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-soa-微服务"}},[t._v("#")]),t._v(" 1.1 SOA?微服务?")]),t._v(" "),n("p",[t._v("我们常说用spring boot构建微服务，又说spring cloud构建微服务，他们到底是什么关系？")]),t._v(" "),n("p",[t._v("首先微服务是啥，微服务首先是一种架构思想，\n首先最初的很多产品都是单体monolithic架构，所有的服务都紧紧耦合在一个解决方案中，难以扩展，只能通过加cpu加内存的方式扩展，举例一个电商平台,\n刚开始所有功能都放在一个解决方案，比如托管在Apache的一个war或者托管在iis的一个.net mvc程序，\n随着项目的发展，团队的壮大，单体会变得庞大而难以维护，我们需要将功能拆分开，比如商家系统、买家系统、管理后台系统等，面向业务或者叫服务切分，分而治之，这种粒度的就是SOA架构，\n其显著缺点：\n1.从技术的角度，其实业务的切分在技术层面上仍然会有大面积的重叠，因此如果业务切割的不好，形成各种依赖，有可能在修改时牵一发而动全身\n2.从业务角度来说，由于是业务的切分，所以当需要发展新的业务时就需要重新构建一个完全新的服务，不利于基于业务创新和发现")]),t._v(" "),n("p",[t._v("所以引入微服务的概念，微服务进一步将服务自底向上或自上到下做更细的切分，最下面是基础系统服务（短信、邮件、存储、缓存、消息推送等），中间是共享服务（支付系统、订单系统、仓储系统等），\n最上面则是业务层（零售系统、团购系统、采购系统），比如我们要加一个闪购业务也是很轻松的，不用从底到上再来一遍，只需要基于基础服务和共享服务做业务开发")]),t._v(" "),n("h3",{attrs:{id:"_1-2-springboot-springcloud"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-springboot-springcloud"}},[t._v("#")]),t._v(" 1.2 SpringBoot SpringCloud")]),t._v(" "),n("p",[t._v("Rod Johnson创建的开源框架interface21是 Spring的前身，随着spring从小框架发展为大而全的企业级框架，spring对市面上主流的开源软件都有了对应的组件支持，\n人们发现使用spring项目开发变得难用，往往需要引入很多配置，难以维护容易出错，spring因此冠名配置地狱；")]),t._v(" "),n("p",[t._v("Spring boot是基于spring抽象出来的开发框架，是快速开发的scaffold脚手架，spring boot丧心病狂的运用依赖注入DI的思想，配置文件可以auto config，用户只需要定义好需要的bean，\nspring boot的大容器会进行管理，丰富的starter让开发者可以集中精力在业务逻辑上而不是依赖的配置管理；")]),t._v(" "),n("p",[t._v("依赖注入的思想简单来说就比如小孩要从冰箱拿吃的，但是不应该自己拿，应该交由家长来处理，因为小孩可能会忘记关冰箱门，可能会打乱冰箱里面其他东西，总之小孩这个组件应该只关心自己的事情，不要做这些大人才能做好的事情，\n所以从冰箱拿东西吃要交由家长处理，在spring boot中，小孩可以采用构造函数注入或者setter based如autowired方式来使用家长组件；")]),t._v(" "),n("p",[t._v("spring-cloud是一套完整的微服务解决方案，是一系列框架的有序集合，提供了分布式的各种解决方案：\n服务开发（springBoot spring springMVC）、服务配置中心（SpringCloudConfig Chef）、服务发现（eureka zookeeper）、服务调用（rest rpc）、负载均衡（ribbon nginx）、服务熔断器、服务监控、服务部署（docker kubernetes）、消息队列（kafka rabbitmq）")]),t._v(" "),n("p",[t._v("所以可见一个个具体的微服务(这里说的微服务就是具体的一个个应用了)是用spring boot开发，spring cloud又提供了服务配置中心、服务注册发现等所谓微服务治理的解决方案")]),t._v(" "),n("p",[t._v("1.spring boot是一个快速开发框架，应该说是spring系列的集大成者。我们可以简单的把spring boot理解成是一个快速开发的脚手架。\n2.微服务往往是指Spring Cloud，微服务是一个框架。\n3.如果把基于微服务架构的软件比作是一个大厦，钢筋混凝土结构就是spring cloud，而砖头瓦块等就是spring boot。微服务的一个一个服务是用spring boot开发的，spring cloud提供服务注册与发现、负载均衡、API网管、熔断路由、配置中心等框架性服务，当然一个完整的微服务系统有很多其他的内容，例如服务拆分、监控、限流降级等等。")]),t._v(" "),n("p",[t._v("dubbo常常拿来跟spring cloud对比，实际目前已经不具有可比性了，Dubbo现在只是一款高性能的Java RPC框架，只能跟spring cloud集合中的服务调用部分REST RPC做对比")]),t._v(" "),n("h2",{attrs:{id:"_2-spring-framework"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-spring-framework"}},[t._v("#")]),t._v(" 2. Spring Framework")]),t._v(" "),n("p",[t._v("https://docs.spring.io/spring/docs/current/spring-framework-reference/\nProject generator\nhttps://start.spring.io/\nhttps://www.tutorialspoint.com/spring/spring_quick_guide.htm\nhttps://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/ (spring boot 2.1.4 depend on spring 5.1.6)")]),t._v(" "),n("p",[t._v("** architecture\n"),n("img",{attrs:{src:"/docs/docs_image/software/java/java_spring01.png",alt:""}})]),t._v(" "),n("p",[t._v("** Beans\nhttps://www.tutorialspoint.com/spring/spring_bean_definition.htm")]),t._v(" "),n("p",[t._v("Components(@Component @Service @Controller @Repository) vs beans (@Beans)\nall component types are treated in the same way. The subtypes are mere markers, think code readability rather than features.\nhttps://www.tomaszezula.com/2014/02/09/spring-series-part-5-component-vs-bean/")]),t._v(" "),n("p",[t._v("** Scan&Autowire")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('package org.springframework.beans.factory.annotation;\n/**\n\t * Class representing injection information about an annotated field.\n\t */\n\tprivate class AutowiredFieldElement extends InjectionMetadata.InjectedElement {\n\n\t\tprivate final boolean required;\n\n\t\tprivate volatile boolean cached = false;\n\n\t\t@Nullable\n\t\tprivate volatile Object cachedFieldValue;\n\n\t\tpublic AutowiredFieldElement(Field field, boolean required) {\n\t\t\tsuper(field, null);\n\t\t\tthis.required = required;\n\t\t}\n\n\t\t@Override\n\t\tprotected void inject(Object bean, @Nullable String beanName, @Nullable PropertyValues pvs) throws Throwable {\n\t\t\tField field = (Field) this.member;\n\t\t\tObject value;\n\t\t\tif (this.cached) {\n\t\t\t\tvalue = resolvedCachedArgument(beanName, this.cachedFieldValue);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tDependencyDescriptor desc = new DependencyDescriptor(field, this.required);\n\t\t\t\tdesc.setContainingClass(bean.getClass());\n\t\t\t\tSet<String> autowiredBeanNames = new LinkedHashSet<>(1);\n\t\t\t\tAssert.state(beanFactory != null, "No BeanFactory available");\n\t\t\t\tTypeConverter typeConverter = beanFactory.getTypeConverter();\n\t\t\t\ttry {\n\t\t\t\t\tvalue = beanFactory.resolveDependency(desc, beanName, autowiredBeanNames, typeConverter);\n\t\t\t\t}\n\t\t\t\tcatch (BeansException ex) {\n\t\t\t\t\tthrow new UnsatisfiedDependencyException(null, beanName, new InjectionPoint(field), ex);\n\t\t\t\t}\n\t\t\t\tsynchronized (this) {\n\t\t\t\t\tif (!this.cached) {\n\t\t\t\t\t\tif (value != null || this.required) {\n\t\t\t\t\t\t\tthis.cachedFieldValue = desc;\n\t\t\t\t\t\t\tregisterDependentBeans(beanName, autowiredBeanNames);\n\t\t\t\t\t\t\tif (autowiredBeanNames.size() == 1) {\n\t\t\t\t\t\t\t\tString autowiredBeanName = autowiredBeanNames.iterator().next();\n\t\t\t\t\t\t\t\tif (beanFactory.containsBean(autowiredBeanName) &&\n\t\t\t\t\t\t\t\t\t\tbeanFactory.isTypeMatch(autowiredBeanName, field.getType())) {\n\t\t\t\t\t\t\t\t\tthis.cachedFieldValue = new ShortcutDependencyDescriptor(\n\t\t\t\t\t\t\t\t\t\t\tdesc, autowiredBeanName, field.getType());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tthis.cachedFieldValue = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.cached = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (value != null) {\n\t\t\t\tReflectionUtils.makeAccessible(field);\n\t\t\t\tfield.set(bean, value);\n\t\t\t}\n\t\t}\n\t}\n')])])]),n("p",[t._v("Autowire vs getbean\nInjecting a Prototype Bean into a Singleton Bean Problem https://www.logicbig.com/tutorials/spring-framework/spring-core/injecting-singleton-with-prototype-bean.html")]),t._v(" "),n("blockquote",[n("p",[t._v("You can then use getBean to retrieve instances of your beans. The ApplicationContext interface has a few other methods for retrieving beans, but, ideally, your application code should never use them. Indeed, your application code should have no calls to the getBean() method at all and thus have no dependency on Spring APIs at all.\nhttps://docs.spring.io/spring/docs/current/spring-framework-reference/core.html")])]),t._v(" "),n("p",[t._v("** Spring AOP\nhttps://docs.spring.io/spring/docs/2.5.x/reference/aop.html")]),t._v(" "),n("p",[t._v("** 代理\n动态代理 静态代理\ncglib 通过使用proxy设计模式 远程调用看起来像本地调用\n增强类 如mybatis，fastclassbyspringcglib")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('保存生成的动态代理类或者增强类\n@EnableAsync\n@SpringBootApplication\npublic class Application {\n    public static void main(String[] args) {\n    \tSystem.setProperty(DebuggingClassWriter.DEBUG_LOCATION_PROPERTY,"C:\\\\Workspace\\\\debug");\n        SpringApplication.run(Application.class, args);\n    }\n')])])]),n("h2",{attrs:{id:"mybatis-is-a-fork-from-ibatis"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mybatis-is-a-fork-from-ibatis"}},[t._v("#")]),t._v(" MyBatis is a fork from iBATIS,")]),t._v(" "),n("h2",{attrs:{id:"_3-springboot-framework"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-springboot-framework"}},[t._v("#")]),t._v(" 3.SpringBoot Framework")]),t._v(" "),n("blockquote",[n("p",[t._v("While the Spring framework focuses on providing flexibility to you, Spring Boot aims to shorten the code length and provide you with the easiest way to develop a web application. With annotation configuration and default codes, Spring Boot shortens the time involved in developing an application.\nhttps://www.tutorialspoint.com/spring_boot/index.htm")])]),t._v(" "),n("p",[n("span",{staticStyle:{color:"red"}},[t._v("https://spring.io/tools3/sts/all")])]),t._v(" "),n("p",[t._v("guides:\nhttps://spring.io/guides#gs\nhttps://spring.io/guides/gs/spring-boot/\nStarters samples code:\nhttps://docs.spring.io/spring-boot/docs/2.1.4.RELEASE/reference/htmlsingle/#using-boot-starter\nhttps://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples\nDocs:\nhttps://docs.spring.io/spring-boot/docs/2.1.4.RELEASE/reference/htmlsingle/\nUnit test:\nhttps://stackabuse.com/how-to-test-a-spring-boot-application/\nhttps://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-testing.html")]),t._v(" "),n("p",[t._v("Spring Boot中如何干掉过多的if else！ https://mp.weixin.qq.com/s/Uf8KGTbNcuDtwIlpMJnaXg")]),t._v(" "),n("p",[t._v("Spring boot web default web server:\nAsp.net default is IIS Express, how about spring boot web?\nTomcat vs. Jetty vs. Undertow: Comparison of Spring Boot Embedded Servlet Containers\nhttps://examples.javacodegeeks.com/enterprise-java/spring/tomcat-vs-jetty-vs-undertow-comparison-of-spring-boot-embedded-servlet-containers/")]),t._v(" "),n("h3",{attrs:{id:"_3-1-plugins"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-plugins"}},[t._v("#")]),t._v(" 3.1 Plugins")]),t._v(" "),n("p",[t._v("** spring-boot-maven-plugin")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t\t<artifactId>spring-boot-maven-plugin</artifactId>\n\t\t\t\t<version>${spring-boot-maven-plugin.version}</version>\n\t\t\t\t<executions>\n\t\t\t\t\t<execution>\n\t\t\t\t\t\t<goals>\n\t\t\t\t\t\t\t<goal>repackage</goal>\n\t\t\t\t\t\t</goals>\n\t\t\t\t\t</execution>\n\t\t\t\t</executions>\n\t\t\t</plugin>\n\t\t</plugins>\n\t</build>\n")])])]),n("p",[t._v('这个plugin很重要，其中的repackage是把java程序打包成为executable程序，否则就只是普通的jar包（纠正：实际测试即使没用这个plugin，pom parent继承了org.springframework.boot，一样可以生成可执行程序，原因见后面关于这个包的解释），不能直接执行，比如hello world，需要javac之后生成的class，用java *.class才能执行，而且如果java程序比较负责，依赖了外部的包，还要给出classpath或libpath，极其麻烦，maven本身就是包管理器，最基本的职责就是mvn package打成普通的jar包，然后mvn install到本地.m2 repository，然后mvn deploy到远程的repository，当需要运行的时候就是用前面提到的java命令执行，当然也可以直接用mvn执行，好处是mvn会自动去.m2下面找到依赖的包，\nmvn exec:java -Dexec.mainClass="com.example.Main" -Dexec.args="arg0 arg1"，可以看到mvn实际也就是调用java命令\n首先使用这个plugin的情况下，正常的mvn clean package，生成XXX-0.0.1-SNAPSHOT.jar和XXX-0.0.1-SNAPSHOT.jar.origninal：\n可以重命名一下orignial为jar，反编译对比下：')]),t._v(" "),n("p",[n("img",{attrs:{src:"/docs/docs_image/software/java/java_springboot01.png",alt:""}})]),t._v(" "),n("p",[t._v("对比可以看到，普通的jar包里面的东西被再次包入了BOOT-INF，然后增加了一个org.springframework.boot.loader的启动包\n执行方法：\nproject里：mvn spring-boot:run\n打成包后：java -server -jar XXXX.jar --spring.config.location=/config/")]),t._v(" "),n("p",[t._v("这里居然还有个比较傻逼的比较 https://www.baeldung.com/spring-boot-run-maven-vs-executable-jar\n有点意思，还有人这么较真")]),t._v(" "),n("p",[t._v("然后我好奇测试了下mvn最原始的打包plugin，看打成一个fat jar会如何\n"),n("img",{attrs:{src:"/docs/docs_image/software/java/java_springboot02.png",alt:""}}),t._v("\n无法运行，估计是缺少springboot的上下文，spring boot的程序自然真正的入口应该是spring boot那个loader，加了annotation的那个所谓的入口main实际只是为spring boot loader准备的入口；")]),t._v(" "),n("p",[t._v("** maven-enforcer-plugin\n这个是用来检查依赖问题的  mvn enforcer:enforce")]),t._v(" "),n("h3",{attrs:{id:"_3-2-dependencies"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-dependencies"}},[t._v("#")]),t._v(" 3.2 Dependencies")]),t._v(" "),n("p",[t._v("Parent org.springframework.boot\nhttps://www.baeldung.com/spring-boot-dependency-management-custom-parent")]),t._v(" "),n("p",[t._v("继承两种方式：\n直接写在parent里面；\n写在dependencymanagement里面")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("<dependencyManagement>\n     <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-dependencies</artifactId>\n            <version>1.5.6.RELEASE</version>\n            <type>pom</type>\n            <scope>import</scope>\n        </dependency>\n    </dependencies>\n</dependencyManagement>\n")])])]),n("p",[t._v("如果没有继承org.springframework.boot,如果有多个入口方法，在pom中指定：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t\t<artifactId>spring-boot-maven-plugin</artifactId>\n\t\t\t\t<configuration>\n\t\t\t\t\t<mainClass>com.lyhistory.rce.shiro.WebApp</mainClass>\n\t\t\t\t</configuration>\n\t\t\t\t<executions>\n\t\t\t\t\t<execution>\n\t\t\t\t\t\t<goals>\n\t\t\t\t\t\t\t<goal>repackage</goal>\n\t\t\t\t\t\t</goals>\n\t\t\t\t\t</execution>\n\t\t\t\t</executions>\n\t\t\t</plugin>\n")])])]),n("p",[t._v("如果继承org.springframework.boot,如果有多个入口方法，就多一种方式，在pom中指定：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("<parent>\n   \t <groupId>org.springframework.boot</groupId>\n   \t <artifactId>spring-boot-starter-parent</artifactId>\n   \t <version>1.5.9.RELEASE</version>\n   \t <relativePath /> \x3c!-- lookup parent from repository --\x3e\n</parent>\n\n<properties>\n  <start-class>com.xx.xx</start-class>\n</properties>\n")])])]),n("h3",{attrs:{id:"_3-3integration"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3integration"}},[t._v("#")]),t._v(" 3.3Integration")]),t._v(" "),n("h4",{attrs:{id:"_3-3-1-redis"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-redis"}},[t._v("#")]),t._v(" 3.3.1 redis")]),t._v(" "),n("p",[t._v("@Autowired\nPrivate RedisTemplate redisTemplate;\nhttps://github.com/spring-projects/spring-boot/issues/7238")]),t._v(" "),n("p",[t._v("一文搞定 Spring Data Redis 详解及实战 https://cloud.tencent.com/developer/article/1349818\nSpringBoot下Redis相关配置是如何被初始化的 https://my.oschina.net/u/3866531/blog/1858069")]),t._v(" "),n("p",[t._v("Which type of injection??\n深度解析SpringBoot2.x整合Spring-Data-Redis https://www.itcodemonkey.com/article/13627.html")]),t._v(" "),n("h4",{attrs:{id:"_3-3-2-shiro"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-shiro"}},[t._v("#")]),t._v(" 3.3.2 Shiro")]),t._v(" "),n("p",[t._v("https://shiro.apache.org/architecture.html")]),t._v(" "),n("blockquote",[n("p",[t._v("To simplify configuration and enable flexible configuration/pluggability, Shiro’s implementations are all highly modular in design -\nso modular in fact, that the SecurityManager implementation (and its class-hierarchy) does not do much at all.\n"),n("strong",[t._v("Instead, the SecurityManager implementations mostly act as a lightweight ‘container’ component")]),t._v(", delegating almost all behavior to nested/wrapped components.\nThis ‘wrapper’ design is reflected in the detailed architecture diagram above.")])]),t._v(" "),n("blockquote",[n("p",[t._v("SessionManager (org.apache.shiro.session.mgt.SessionManager)\nThe SessionManager knows how to create and manage user Session lifecycles to provide a robust Session experience for users in all environments.\nThis is a unique feature in the world of security frameworks -\n**Shiro has the ability to natively manage user Sessions in any environment, even if there is no Web/Servlet or EJB container available.\n**By default, Shiro will use an existing session mechanism if available, (e.g. Servlet Container), but if there isn’t one, such as in a standalone application or non-web environment,\n**it will use its built-in enterprise session management to offer the same programming experience. The SessionDAO exists to allow any datasource to be used to persist sessions.")])]),t._v(" "),n("blockquote",[n("p",[t._v("https://shiro.apache.org/architecture.html")])]),t._v(" "),n("h5",{attrs:{id:"_3-3-2-1-realm注入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-1-realm注入"}},[t._v("#")]),t._v(" 3.3.2.1 Realm注入")]),t._v(" "),n("p",[t._v("好了 我们从头看下这个Realm是如何注入的，刚开始我从jar里面找到了很多注入的地方加了断点，\n但是报错“not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)” 所以就只好具体分析，找到一些疑似调用到的方法再下断点拦截看调用栈;")]),t._v(" "),n("p",[n("img",{attrs:{src:"/docs/docs_image/software/java/java_springboot_shiro01.png",alt:""}})]),t._v(" "),n("p",[t._v("先是创建了DefaultWebSecurityManager, SecurityManager终极是继承自RealmSecurityManager,\nAfter方法内部再调用其子类型的方法，又是常见的template pattern，最终这里是将Realm传递给了这个默认的Authorizer: ModularRealmAuthorizer;")]),t._v(" "),n("h5",{attrs:{id:"_3-3-2-2-请求拦截和登录过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-2-请求拦截和登录过程"}},[t._v("#")]),t._v(" 3.3.2.2 请求拦截和登录过程")]),t._v(" "),n("p",[n("img",{attrs:{src:"/docs/docs_image/software/java/java_springboot_shiro02.png",alt:""}}),t._v("\n先要注册一下拦截/login,")]),t._v(" "),n("p",[t._v("给每一个web请求的thread生成绑定一个subject，并且绑定一个单例的SecurityManager（关于绑定bind，是将其放入当前所在thread的一个ThreadLocal Map里面，值得学习研究下）；\n注意getSecurityManager的第三行是找开发者主动set的全局静态的SecurityManager，不推荐这种方式，具体参见文档或者vm static线程安全的文档，\n第一行是去找下面那个Application级别的单例bean（说错了，不是bean，是第一步Realm注入里面提到的创建好的一个单例）；")]),t._v(" "),n("p",[t._v("接着看下图，回到拦截的post请求，请求中的form是被层层委托到DelegatingSubject：")]),t._v(" "),n("p",[n("img",{attrs:{src:"/docs/docs_image/software/java/java_springboot_shiro03.png",alt:""}})]),t._v(" "),n("p",[t._v("看到没，这里是去找SecurityManager，然后跟进其命名空间找到默认的实现 login，这是一个线程安全的singleton实例，可以看到多线程调用这个login没有用到任何公共资源，资源都在传入的上下文参数中，\nSecurityManager被设计成一个dispatcher并不参与太多实现，都是交给其他的组件来处理，")]),t._v(" "),n("blockquote",[n("p",[t._v("the SecurityManager implementations mostly act as a lightweight ‘container’ component, delegating almost all behavior to nested/wrapped components.\nhttps://shiro.apache.org/securitymanager.html")])]),t._v(" "),n("p",[t._v("继续看下调用的这个authenticate(token)具体是如何工作的：")]),t._v(" "),n("p",[t._v("Authenticator是一个interface，其实就是找到前面注入提到的现ModularRealmAuthenticator，如果不知道也可以这样找：在同级package找到AbstractAuthenticator，\nauthenticate(AuthenticationToken token) 标准的template pattern，然后找到其一个默认实现ModularRealmAuthenticator；")]),t._v(" "),n("p",[t._v("从我们自定义实例化的这个Realm里面找getAuthenticationInfo也是template pattern，一层层的，\ngetAuthenticationInfo调doGetAuthenticationInfo调getUser；")]),t._v(" "),n("p",[t._v('补充一句，在定义Realm bean的时候我们用了realm.setUserDefinitions("joe.coder=password,user\\n" + "jill.coder=password,admin");\n这就相当于初始化了”内存数据库”，具体代码很简单不再分析；\n然后关于多线程安全的问题，这个简单的Realm自然是用了读写锁；')]),t._v(" "),n("p",[t._v("至此剖析完成")]),t._v(" "),n("h2",{attrs:{id:"_4-spring-cloud"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-spring-cloud"}},[t._v("#")]),t._v(" 4. Spring Cloud")]),t._v(" "),n("p",[t._v("https://github.com/macrozheng/mall\nhttps://github.com/zhangdaiscott/jeecg-boot")]),t._v(" "),n("p",[t._v("https://github.com/ZhongFuCheng3y/msc-Demo\nhttps://github.com/forezp/SpringCloudLearning\nhttps://github.com/zhoutaoo/SpringCloud")]),t._v(" "),n("p",[t._v("todo:\nMvc\nThymeleaf\nRealm")]),t._v(" "),n("hr"),t._v(" "),n("p",[t._v("ref\n"),n("a",{attrs:{href:"https://www.cnblogs.com/ityouknow/p/9175980.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("为什么说 Java 程序员到了必须掌握 Spring Boot 的时候？"),n("OutboundLink")],1),t._v(" "),n("a",{attrs:{href:"https://www.jianshu.com/p/b73a9bdb7612",target:"_blank",rel:"noopener noreferrer"}},[t._v("聊一聊Spring中的代理"),n("OutboundLink")],1),t._v(" "),n("a",{attrs:{href:"https://spring.io/projects/spring-cloud",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Cloud"),n("OutboundLink")],1),t._v(" "),n("a",{attrs:{href:"https://www.zhihu.com/question/286198868",target:"_blank",rel:"noopener noreferrer"}},[t._v("spring boot 和微服务的关系?"),n("OutboundLink")],1),t._v(" "),n("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/25843782",target:"_blank",rel:"noopener noreferrer"}},[t._v("重新理解微服务"),n("OutboundLink")],1),t._v(" "),n("a",{attrs:{href:"https://www.jianshu.com/p/6fe0795c782d",target:"_blank",rel:"noopener noreferrer"}},[t._v("架构设计漫步：从单体架构、SOA到微服务"),n("OutboundLink")],1),t._v(" "),n("a",{attrs:{href:"https://martinfowler.com/articles/microservices.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Microservices"),n("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=r.exports}}]);