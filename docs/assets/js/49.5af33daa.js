(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{251:function(e,t,n){"use strict";n.r(t);var a=n(0),o=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("p",[n("a",{attrs:{href:"/docs/software"}},[e._v("回目录")]),e._v("  《mongodb》")]),e._v(" "),n("h2",{attrs:{id:"_1-install"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-install"}},[e._v("#")]),e._v(" 1.Install")]),e._v(" "),n("p",[n("strong",[e._v("use install file")])]),e._v(" "),n("p",[e._v("Windows:\nhttps://docs.mongodb.com/manual/tutorial/install-mongodb-on-windows/\nUse Command Interpreter, 不要用 Powershell")]),e._v(" "),n("p",[n("strong",[e._v("manually install")])]),e._v(" "),n("p",[e._v("STEP 1:\ndownload zip from mongodb ,suggest you use latest version, extract to maybe 'd:\\mongodb'")]),e._v(" "),n("p",[e._v("STEP 2:\nset System variables Path add 'd:\\mong\\bin'")]),e._v(" "),n("p",[e._v("STEP 3:\ncreate folder for dbpath d:\\mongodb\\data")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('mongdb --dbpath "d:\\mongodb\\data"\n')])])]),n("p",[e._v("in the case you come accross 'the program can't start because ssleay32.dll is missing from your computer',\nyou can fix it or using install files instead of manually install.")]),e._v(" "),n("p",[e._v('type http://localhost:27017/ in browser, will show "It looks like you are trying to access MongoDB over HTTP on the native driver port."\n代表安装成功.\n(tips:\nif later you encounter "Unable to connect to server localhost:27017: Invalid credential for ..:\nplease check whether port 27017 is blocked by firewall,can run cmd:\nnetsh advfirewall firewall add rule name="MongoDB 27017" dir=in action=allow protocol=TCP localport=27017\n)')]),e._v(" "),n("p",[e._v("STEP 4:\nfurther step, if you want to make it a service, prepare mongd.cfg files:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("logpath = c:\\mongodb\\log\\log.txt\ndbpath = c:\\mongodb\\data\ndirectoryperdb = true\nlogappend = true\nauth = false\nsetParameter = enableLocalhostAuthBypass=0\nmaster = true\noplogSize = 500\n")])])]),n("p",[e._v("then run")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("mongod --config c:\\mongodb\\mongd.cfg --install\n")])])]),n("p",[e._v("to set up service ( to remove: replace 'install' with 'remove')")]),e._v(" "),n("p",[e._v("IMPORTANT\nIf you are running any edition of Windows Server 2008 R2 or Windows 7, please install a hotfix to resolve an issue with memory mapped files on Windows.")]),e._v(" "),n("p",[e._v("STEP 5:connect mongodb")]),e._v(" "),n("p",[e._v('a. directly connect: mongo localhost/dbname -u*** -p***\nb.use mongo cmd, will connect to \'test\' automatically, db cmd will show current database, show dbs will show all dbs, if got \'listDatabases failed:{ "ok" : 0, "errmsg" : "unauthorized" } at src/mongo/shell/mongo.js:46\', according to the documentation, the user must be granted the clusterAdmin role for the listDatabases privilege')]),e._v(" "),n("p",[e._v("STEP 6:auth")]),e._v(" "),n("p",[e._v("prepare admin.js:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('db = db.getSiblingDB("admin");\ndb.createUser({user:"test", pwd:"123456",roles:[{"role":"ｒｏｏｔ","db":"ａｄｍｉｎ"}]});//old version: db.addUser("sa", "123456");\ndb.auth("sa", "123456");\n')])])]),n("p",[e._v("execute\n"),n("code",[e._v("mongo localhost/admin c:\\mongodb\\admin.js (before doing this, make sure mongodb is running)")])]),e._v(" "),n("p",[e._v("IMPORTANT:")]),e._v(" "),n("p",[e._v('a. You may encounter "I CONTROL Hotfix KB2731284 or later update is not installed, will zero-out data files"\nthen stop mongodb service, and modify mongod.cfg set auth=true, it will work\nnext time if you wanna run js,must do like this:')]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('mongo -usa -p123456 localhost/admin c:\\mongodb\\mongo-newdb.js:\nprint("===== newdb =====");\ndb = db.getSiblingDB("dbname");\ndb.createUser({user:"ｄｅｖ", pwd:"123456",roles:[{"role":"dbOwner","db":"ｄｂｎａｍｅ"}]});//old version: db.addUser("dev", "123456");\ndb.auth("dev", "123456");\nprint("--- insert data ---");\ndb.Client.insert({ "_id" : "123", "Name" : "lyhistory", "Secret" : "lyhistory", "Callback" : "https://lyhistory.com", "ClientType" : 1 });\n')])])]),n("p",[e._v("b. Version Issues\nThe schema of db.system.users in mongodb 2.4 and 2.6 are different which caused you fail to create new user.\nhttp://stackoverflow.com/questions/23468137/how-to-add-authentication-to-mongodb-2-6\n更改认证模式 MONGODB-CR / SCRAM-SHAR-1\nhttp://www.xlgps.com/article/441478.html")]),e._v(" "),n("h2",{attrs:{id:"cmds"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cmds"}},[e._v("#")]),e._v(" Cmds")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('c:\\mongodb\\bin>mongo localhost/mydb -udev -p123456\nMongoDB shell version: 2.6.8\nconnecting to: localhost/mydb\n> show tables\nFriend\nMessage\nsystem.indexes\n> db.Friend.find({"_id":1}).pretty();\n{\n"_id" : 1,\n"Friends" : [\n{\n{\n"UserId" : 2,\n"Name" : "Test 1",\n"Avatar" : null,\n"IsOnline" : false,\n"State" : 1,\n"NameType" : "3"\n},\n{\n"UserId" : 3,\n"Name" : "Test 2",\n"Avatar" : null,\n"IsOnline" : false,\n"State" : 1,\n"NameType" : "3"\n}\n]\n}\n>\nDescribe Schema\n> var schema=db.ChatUser.findOne();\n> for(var key in schema){print(key);}\n_id\nUserName\nGender\ndb.TableName.drop()\nremove a deprecated filed(\'column\')\ndb.collection.update(\n{ \'<field>\': { \'$exists\': true } },  // Query\n{ \'$unset\': { \'<field>\': true  } },  // Update\nfalse, true                      \t// Upsert, Multi\n)\nUpdate for MongoDB 2.2+:\nYou can now provide a JSON object instead of positional arguments for upsert and multi.\ndb.collection.update(\n{ \'<field>\': { \'$exists\': true } },  // Query\n{ \'$unset\': { \'<field>\': true  } },  // Update\n{ \'multi\': true }                \t// Options\n)\n> db.ChatUser.update({\'IsFriend\':{\'$exists\':true}},{\'$unset\':{\'IsFriend\':true}},false,true);\nWriteResult({ "nMatched" : 5, "nUpserted" : 0, "nModified" : 5 })\nAdd new fields:\ndb.your_collection.update({},{$set : {"new_field":1}},false,true)  --\x3e 1 here represents double type,if you want to use as string, replace it with "1"\n\n')])])]),n("h2",{attrs:{id:"code-snippets"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#code-snippets"}},[e._v("#")]),e._v(" code snippets")]),e._v(" "),n("p",[e._v("c#:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('#1.MongoDB.Bson.Serialization\n\nBsonClassMap.RegisterClassMap<Friend>(x =>\n{\nx.AutoMap();\nx.SetIdMember(x.GetMemberMap(m => m.UserId));\nx.IdMemberMap.SetRepresentation(BsonType.String);\nx.GetMemberMap(m => m.UserId).SetIgnoreIfNull(true);\n});\nBsonClassMap.RegisterClassMap<Message>(x =>\n{\nx.AutoMap();\nx.IdMemberMap.SetRepresentation(BsonType.ObjectId);\nx.GetMemberMap(m => m.Id).SetIgnoreIfNull(true);\n});\nGet _id of an inserted document in MongoDB?\nsimply add this filed to your own class\n[BsonId]\npublic ObjectId ID{get;set;}\n\n#2.Update Mongodb\n\nvar updatebuidler = new List<UpdateBuilder>();\nupdatebuidler.Add(MongoDB.Driver.Builders.Update.Set("<COLUMN>", new BsonArray(<COLUMN VALUE>)));\nthis.Update(Query.EQ("_id", ObjectId.Parse(id)),MongoDB.Driver.Builders.Update.Combine(updatebuidler));\n\n#3.UTC Date\n\nlist.ToList().ForEach(x =>\n{\nif (x.UpdateDate != null)\n{\nx.UpdateDate = x.UpdateDate .ToLocalTime();\n}\n});\n\n')])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("db.test.insertOne({'code':'111','announced_date':'2018-02-01','report_date':'2018-02-01'})\n\n\ndb.daily.sort({'date':-1}).limit(1)\ndb.CWBB_ZCFZB.find({report_date:{$lt:'2018-03-31'}}).sort({report_date:-1}).limit(2)\n\nmap = function () { \n    emit(this.code, {rec:[this]}); \n}\n\nreduce = function (key, values) {\n    result={rec:[]};\n    values.forEach( function(v) {\n        result.rec = v.rec.concat(result.rec);\n    } );\n    return result;\n}\n\nfinal = function (key, value) {\n      Array.prototype.sortByProp = function(p){\n       return this.sort(function(a,b){\n\t\treturn (a[p] < b[p]) ? 1 : (a[p] > b[p]) ? -1 : 0;\n      });\n    }\n\tvalue.rec.sortByProp('report_date');\n    value.rec.sortByProp('announced_date');\n    return value.rec.slice(0,1);\n}\n\n\ndb.test.mapReduce(map, reduce, {query:{'report_date':{$lt:'2018-03-02'}},finalize:final, out:{inline:1}})\n\ndb.daily.find({is_trading:{$exists:false}}).sort({'date':1}).limit(1)\ndb.daily_qfq.find({index:{$nin:[true,false]}}).sort({'date':-1}).limit(1)\ndb.daily.find({code:'002688','index':false,date:{$lte:'2018-01-17'}}).sort({'time':-1}).limit(2)\ndb.daily.find({code:'002707','index':false,au_factor:{$ne:12.07}}).sort({'date':1}).limit(1)\ndb.daily.find({'index':false,au_factor:{$gte:10}}).sort({'date':1}).limit(1)\n\n")])])]),n("hr"),e._v(" "),n("p",[e._v("ref:")]),e._v(" "),n("p",[n("a",{attrs:{href:"http://stackoverflow.com/questions/21303456/migrate-mongodb-database-from-localhost-to-remote-servers",target:"_blank",rel:"noopener noreferrer"}},[e._v("Migrate mongodb database from localhost to remote servers"),n("OutboundLink")],1),e._v(" "),n("a",{attrs:{href:"https://docs.mongodb.org/manual/tutorial/backup-and-restore-tools/",target:"_blank",rel:"noopener noreferrer"}},[e._v("backup and restore"),n("OutboundLink")],1),e._v(" "),n("a",{attrs:{href:"http://www.mkyong.com/mongodb/mongodb-import-and-export-example/",target:"_blank",rel:"noopener noreferrer"}},[e._v("mongo export import"),n("OutboundLink")],1),e._v("\nmongodump mongorestore")]),e._v(" "),n("p",[e._v("pagination:\nhttp://blog.mongodirector.com/fast-paging-with-mongodb/\nhttp://stackoverflow.com/questions/9703319/mongodb-ranged-pagination")]),e._v(" "),n("p",[e._v("MongoDB-CR Authentication failed: http://stackoverflow.com/questions/29006887/mongodb-cr-authentication-failed\n想使用 MongoDB ，你应该了解这8个方面！ https://yq.aliyun.com/articles/7245\n阿里云MongoDB技术内幕 https://yq.aliyun.com/topic/58?utm_campaign=wenzhang&utm_medium=article&utm_source=QQ-qun&utm_content=m_7769\n如何把数据迁移到阿里云云MongoDb www.jianshu.com/p/d8a64bc90605\n【Mongodb】用户和认证 权限总结  https://yq.aliyun.com/articles/27952\nmongdb3.0用户验证问题  www.bbsmax.com/A/B0zq2eg8Jv/\nhttp://canonind.blog.51cto.com/8239025/1843220\ndriver: https://pecl.php.net/package/mongodb")]),e._v(" "),n("p",[e._v("GUI\nrobomongo\nhttp://docs.mongodb.org/getting-started/csharp/")]),e._v(" "),n("p",[e._v("repository:\nhttps://github.com/mongodb")])])}),[],!1,null,null,null);t.default=o.exports}}]);