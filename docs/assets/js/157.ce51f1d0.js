(window.webpackJsonp=window.webpackJsonp||[]).push([[157],{388:function(t,e,n){"use strict";n.r(e);var a=n(0),r=Object(a.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"_1-virtualbox-network-mode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-virtualbox-network-mode"}},[t._v("#")]),t._v(" 1.Virtualbox network mode")]),t._v(" "),n("p",[t._v("https://www.virtualbox.org/manual/ch06.html")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("Mode")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("VM->Host")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("VM<-Host")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("VM1<->VM2")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("VM->Net/LAN")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("VM<-Net/LAN")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("Host-only")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("+")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("+")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("+")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("-")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("-")])]),t._v(" "),n("tr",[n("td",[t._v("Internal")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("-")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("-")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("+")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("-")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("-")])]),t._v(" "),n("tr",[n("td",[t._v("Bridged")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("+")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("+")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("+")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("+")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("+")])]),t._v(" "),n("tr",[n("td",[t._v("NAT")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("+")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("PortForward")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("-")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("+")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("PortForward")])]),t._v(" "),n("tr",[n("td",[t._v("NATservice")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("+")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("PortForward")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("+")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("+")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("PortForward")])])])]),t._v(" "),n("h3",{attrs:{id:"_1-1-nat-network"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-nat-network"}},[t._v("#")]),t._v(" 1.1 NAT Network.")]),t._v(" "),n("p",[t._v("A NAT network is a type of internal network that allows outbound connections. See Section 6.4, “Network Address Translation Service”.")]),t._v(" "),n("p",[t._v("有虚拟路由，所以guest可以直接通过10.0.2.2:"),n("PORT",[t._v("访问host的服务,b包括vpn服务等\nPort forwarding for NAT:\nhttps://www.virtualbox.org/manual/ch06.html#natforward")])],1),t._v(" "),n("p",[n("img",{attrs:{src:"/docs/docs_image/software/linux/vm_network01.png",alt:""}})]),t._v(" "),n("p",[n("img",{attrs:{src:"/docs/docs_image/software/linux/vm_network02.png",alt:""}}),t._v(" "),n("img",{attrs:{src:"/docs/docs_image/software/linux/vm_network03.png",alt:""}})]),t._v(" "),n("p",[t._v("netstat -aon | findstr 'PORT'\ntasklist | findstr 'PID'\ntasklist /fi \"pid eq 4444\"")]),t._v(" "),n("p",[t._v('"c:\\Program Files\\Oracle\\VirtualBox\\VBoxManage" modifyvm Test_centos7 --natpf1 "guestssh,tcp,,2222,,22"\nBut failed on the second rule??? "c:\\Program Files\\Oracle\\VirtualBox\\VBoxManage" modifyvm Test_centos7 --natpf2 "guestkafka,tcp,,9092,,9092", work around: add in VB Network settings\n'),n("img",{attrs:{src:"/docs/docs_image/software/linux/vm_network04.png",alt:""}})]),t._v(" "),n("p",[t._v("?#No network access for NAT, change dns settings, for centos:")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("vim /etc/sysconfig/network-scripts/ifcfg-enp0s3\n\tDNS1=8.8.8.8\n\tONBOOT=yes\n")])])]),n("h3",{attrs:{id:"_1-2-bridged-networking"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-bridged-networking"}},[t._v("#")]),t._v(" 1.2 Bridged networking.")]),t._v(" "),n("p",[t._v("This is for more advanced networking needs, such as network simulations and running servers in a guest. When enabled, Oracle VM VirtualBox connects to one of your installed network cards and exchanges network packets directly, circumventing your host operating system's network stack.\n"),n("img",{attrs:{src:"/docs/docs_image/software/linux/vm_network05.png",alt:""}})]),t._v(" "),n("h3",{attrs:{id:"_1-3-internal-networking"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-internal-networking"}},[t._v("#")]),t._v(" 1.3 Internal networking.")]),t._v(" "),n("p",[t._v("This can be used to create a different kind of software-based network which is visible to selected virtual machines, but not to applications running on the host or to the outside world.\n"),n("img",{attrs:{src:"/docs/docs_image/software/linux/vm_network06.png",alt:""}})]),t._v(" "),n("h3",{attrs:{id:"_1-4-host-only-networking"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-host-only-networking"}},[t._v("#")]),t._v(" 1.4 Host-only networking.")]),t._v(" "),n("p",[t._v("This can be used to create a network containing the host and a set of virtual machines, without the need for the host's physical network interface. Instead, a virtual network interface, similar to a loopback interface, is created on the host, providing connectivity among virtual machines and the host.")]),t._v(" "),n("p",[n("img",{attrs:{src:"/docs/docs_image/software/linux/vm_network07.png",alt:""}})]),t._v(" "),n("p",[t._v("?#host-only模式下客户机vm无法访问位于host宿主机上面的web服务，比如192.168.207.1:8080\n原因：不像在NAT和bridge模式下有virtual route虚拟路由，host only是直接连接的，所以宿主机访问主机如同访问外网(没有经过虚拟路由)，所以会受到宿主机上面的一些权限限制，比如\n可以看到下图，10.0.2.2就是NAT模式的虚拟路由，所以可以直接通过这个路由访问宿主机host的服务\n"),n("img",{attrs:{src:"/docs/docs_image/software/linux/vm_network08.png",alt:""}})]),t._v(" "),n("p",[t._v("Ping不通：如果宿主机是win10，文件与打印机共享开启")]),t._v(" "),n("p",[t._v("Port telnet不通:如果宿主机是win10，Turn Windows Defender Firewall off")]),t._v(" "),n("p",[t._v("Video::NAT, Bridged and Internal Networking\nhttps://www.youtube.com/watch?v=iEj42l4otNY\nhttps://www.youtube.com/watch?v=cDF4X7RmV4Q\nhttps://www.youtube.com/watch?v=VWKZqa2RjpA")]),t._v(" "),n("h2",{attrs:{id:"_2-build-local-lab-network"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-build-local-lab-network"}},[t._v("#")]),t._v(" 2 Build local Lab network")]),t._v(" "),n("h3",{attrs:{id:"_2-1-linux-configuration"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-linux-configuration"}},[t._v("#")]),t._v(" 2.1 Linux configuration")]),t._v(" "),n("p",[t._v("Golden trace rule:\nhttps://forums.kali.org/showthread.php?20846-Troubleshooting-Internet-Network-Access")]),t._v(" "),n("p",[t._v("Networkmanager configuration\nhttps://wiki.debian.org/NetworkConfiguration\nKali network configuration\nThe default network configuration relies on DHCP to obtain an IP address, DNS server, and gateway\nhttps://kali.training/topic/configuring-the-network/\nhttp://www.solutionsatexperts.com/ip-address-configuration-in-kali-linux/")]),t._v(" "),n("p",[t._v("How to configure Network Adapter in Kali Linux using Command Line Interface https://www.youtube.com/watch?v=JL2_fnzCZbE\nAllow-hotplug ?")]),t._v(" "),n("p",[t._v("Restart network after change config\nhttps://www.cyberciti.biz/faq/linux-restart-network-interface/\nreload /etc/resolv.conf\nhttps://askubuntu.com/questions/224966/how-do-i-get-resolvconf-to-regenerate-resolv-conf-after-i-change-etc-network-in")]),t._v(" "),n("p",[t._v("常用命令：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('Ifconfig\nIp route show\nip a show eth0\nRoute -n\nIp addr\nIp route\n\ncat /etc/network/interfaces\n\necho "iface eth0 inet dhcp" >> /etc/network/interfaces\n/etc/init.d/networking restart\n\nifdown eth0\nifup eth0\ndhclient eth0\nOr manually::\nIfconfig eth0 192.168.1.1 netmask 255.255.255.0 up\n\troute add default gw 192.168.0.1 eth0\n\tip route add default via 192.168.0.1 dev eth0\n\nsudo service network-manager restart \n\n')])])]),n("h3",{attrs:{id:"_2-2-基于network类型构建复杂的环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-基于network类型构建复杂的环境"}},[t._v("#")]),t._v(" 2.2 基于network类型构建复杂的环境")]),t._v(" "),n("p",[t._v("https://www.youtube.com/watch?v=AiWRmMzwwJM\nhttps://sandilands.info/sgordon/building-internal-network-virtualbox\nhttps://blog.pythian.com/test-lab-using-virtualbox-nat-networking/\nhttps://vorkbaard.nl/set-up-a-testlab-in-virtualbox-with-a-virtual-lan/\n'Bridged' and 'Host Only' network settings in Virtualbox https://superuser.com/questions/1352678/bridged-and-host-only-network-settings-in-virtualbox-advice-please")]),t._v(" "),n("p",[n("img",{attrs:{src:"/docs/docs_image/software/linux/vm_network09.png",alt:""}})]),t._v(" "),n("p",[t._v("https://askubuntu.com/questions/113604/how-to-run-virtualbox-on-bridged-and-host-only-networks\nhttp://christophermaier.name/2010/09/01/host-only-networking-with-virtualbox/")]),t._v(" "),n("p",[t._v("VirtualBox: two network interfaces (NAT and host-only ones) https://unix.stackexchange.com/questions/37122/virtualbox-two-network-interfaces-nat-and-host-only-ones-in-a-debian-guest-on\nImages\nhttps://developer.microsoft.com/en-us/microsoft-edge/tools/vms")]),t._v(" "),n("h2",{attrs:{id:"_3-troubleshooting"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-troubleshooting"}},[t._v("#")]),t._v(" 3 troubleshooting")]),t._v(" "),n("h3",{attrs:{id:"bridged-mode-not-assign-ip-address-and-route"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#bridged-mode-not-assign-ip-address-and-route"}},[t._v("#")]),t._v(" bridged mode not assign ip address and route")]),t._v(" "),n("ul",[n("li",[t._v("方法一： dhclient eth0\nhttps://unix.stackexchange.com/questions/174573/dhcp-kali-linux\nHavne’t try this manual method::ip route add default via ip-of-router-on-local-network dev enp0s3 https://superuser.com/questions/1075988/virtualbox-bridged-network-is-unreachable")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("less /var/logs/messages \nApr  1 03:05:04 kali NetworkManager[431]: <info>  [1554102304.0124] device (eth0): carrier: link connected\n...............\nApr  1 03:05:05 kali NetworkManager[431]: <info>  [1554102305.3947] manager: NetworkManager state is now CONNECTED_LOCAL\nApr  1 03:05:05 kali NetworkManager[431]: <info>  [1554102305.4044] device (eth1): Activation: successful, device activated.\nApr  1 03:05:05 kali NetworkManager[431]: <info>  [1554102305.4072] manager: startup complete\n")])])]),n("p",[t._v("dhclient eth0")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("Apr  1 03:09:49 kali NetworkManager[431]: <info>  [1554102589.2543] keyfile: add connection /run/NetworkManager/system-connections/eth0.nmconnection (effc3b34-06a5-49dd-886b-d21223855eac,\"eth0\")\nApr  1 03:09:49 kali NetworkManager[431]: <info>  [1554102589.2623] device (eth0): Activation: starting connection 'eth0' (effc3b34-06a5-49dd-886b-d21223855eac)\n.........\nApr  1 03:09:49 kali NetworkManager[431]: <info>  [1554102589.3036] manager: NetworkManager state is now CONNECTED_GLOBAL\n")])])]),n("ul",[n("li",[n("p",[t._v("方法二 设置静态ip（注意ip不要冲突了，不然有各种异常出现）")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("宿主机查看当前网络：\nWireless LAN adapter Wi-Fi:\n\n   Connection-specific DNS Suffix  . :\n   Description . . . . . . . . . . . : Intel(R) Dual Band Wireless-AC 8265\n   Physical Address. . . . . . . . . : 00-28-F8-22-E9-5D\n   DHCP Enabled. . . . . . . . . . . : Yes\n   Autoconfiguration Enabled . . . . : Yes\n   Link-local IPv6 Address . . . . . : fe80::61e4:8e32:fb58:74a4%26(Preferred)\n   IPv4 Address. . . . . . . . . . . : 192.168.0.141(Preferred)\n   Subnet Mask . . . . . . . . . . . : 255.255.255.0\n   Lease Obtained. . . . . . . . . . : Tuesday, 17 November 2020 10:59:55 AM\n   Lease Expires . . . . . . . . . . : Tuesday, 24 November 2020 10:59:54 AM\n   Default Gateway . . . . . . . . . : 192.168.0.1\n   DHCP Server . . . . . . . . . . . : 192.168.0.1\n   DHCPv6 IAID . . . . . . . . . . . : 134228216\n   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-21-C8-05-55-00-28-F8-22-E9-5D\n   DNS Servers . . . . . . . . . . . : 172.17.5.36\n                                       172.17.5.4\n   NetBIOS over Tcpip. . . . . . . . : Enabled\n\n----------------------------------------------------------------------------\n--- for ubuntu:\n----------------------------------------------------------------------------\n默认会出现类似下面的结果,其中 ipv4对应的是enp0s3:avahi的169的地址,\nlyhistory@lyhistory-VirtualBox:~$ ifconfig\nenp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet6 2404:e801:2001:3955:357e:c623:5742:484a  prefixlen 64  scopeid 0x0<global>\n        inet6 2404:e801:2001:3955:543b:3df2:4b55:43b1  prefixlen 64  scopeid 0x0<global>\n        inet6 fe80::2228:aebf:fda5:523b  prefixlen 64  scopeid 0x20<link>\n        ether 08:00:27:64:46:ce  txqueuelen 1000  (Ethernet)\n        RX packets 7632  bytes 1432852 (1.4 MB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 7961  bytes 1009450 (1.0 MB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nenp0s3:avahi: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 169.254.7.153  netmask 255.255.0.0  broadcast 169.254.255.255\n        ether 08:00:27:64:46:ce  txqueuelen 1000  (Ethernet)\n\nlo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536\n        inet 127.0.0.1  netmask 255.0.0.0\n        inet6 ::1  prefixlen 128  scopeid 0x10<host>\n        loop  txqueuelen 1000  (Local Loopback)\n        RX packets 11328  bytes 898386 (898.3 KB)\n      RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 11328  bytes 898386 (898.3 KB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n        \n根据<<Linux.md/网络>>部分的原理,ubuntu 17以上版本都是UI的network manager来控制的，所以直接打开控制面板来设置静态IP和DNS即可\naddress 192.168.0.109\nnetmask 255.255.255.0\ngateway 192.168.0.1\nDNS: 8.8.8.8\n设置完等一会即可        \n----------------------------------------------------------------------------\n--- for 其他debain:\n----------------------------------------------------------------------------\n配置静态ip\n/etc/network/interfaces：\n#auto eth0\n#iface eth0 inet dhcp\nauto eth0\niface eth0 inet static\naddress 192.168.0.109\nnetmask 255.255.255.0\ngateway 192.168.0.1\n\nsudo ifdown eth0\nsudo ifup eth0\nor\nsudo /etc/init.d/networking restart\n\n如果还是无法上网（上面172.17.5.36是某ISP提供的，貌似虚拟机无法用）：\n/etc/resolv.conf\nnameserver 8.8.8.8\n\nsudo systemctl restart systemd-resolved.service\n\n解决后看下当前路由情况：\nroute -n\n\n#Verify new IP settings:\nip a s eth0\n#Verify new routing settings:\nip r\n#Verify DNS servers settings:\ncat /etc/resolv.conf\n#Verify the internet connectivity:\nping -c 4 google.com\n\nroot@kali:/home/lyhistory# ip -4 addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    inet 192.168.0.109/24 brd 192.168.0.255 scope global eth0\n       valid_lft forever preferred_lft forever\n\nroot@kali:/home/lyhistory# ip route\ndefault via 192.168.0.1 dev eth0 onlink \n192.168.0.0/24 dev eth0 proto kernel scope link src 192.168.0.109 \n----------------------------------------------------------------------------\n--- for centos\n----------------------------------------------------------------------------\nvim /etc/sysconfig/network-scripts/ifcfg-eth0\nHWADDR=00:08:A2:0A:BA:B8\nTYPE=Ethernet\n#BOOTPROTO=dhcp\nBOOTPROTO=none\t\n# Server IP #\nIPADDR=192.168.0.110\n# Subnet #\nPREFIX=24\n# Set default gateway IP #\nGATEWAY=192.168.0.1\n# Set dns servers #\nDNS1=8.8.8.8\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\n# Disable ipv6 #\nIPV6INIT=no\nNAME=eth0\n# This is system specific and can be created using 'uuidgen eth0' command #\nUUID=41171a6f-bce1-44de-8a6e-cf5e782f8bd6\nDEVICE=eth0\nONBOOT=yes\n\nsystemctl restart network\n\n\n")])])])])]),t._v(" "),n("h3",{attrs:{id:"can-access-internet-but-cannot-ping"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#can-access-internet-but-cannot-ping"}},[t._v("#")]),t._v(" Can access internet but cannot ping")]),t._v(" "),n("p",[t._v("Firewall setting\nOutbound port\nhttps://askubuntu.com/questions/608194/have-internet-connection-but-cant-ping-external-sites\nhttps://networkengineering.stackexchange.com/questions/37896/ping-port-number")]),t._v(" "),n("h3",{attrs:{id:"eth0-not-found-or-not-configured-simply-restart-vm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#eth0-not-found-or-not-configured-simply-restart-vm"}},[t._v("#")]),t._v(" eth0 not found or not configured simply restart vm")]),t._v(" "),n("p",[t._v("https://askubuntu.com/questions/1060980/eth0-not-configured-but-it-was-working-earlier")]),t._v(" "),n("p",[n("img",{attrs:{src:"/docs/docs_image/software/linux/vm_network03.png",alt:""}})])])}),[],!1,null,null,null);e.default=r.exports}}]);