(window.webpackJsonp=window.webpackJsonp||[]).push([[193],{646:function(e,n,t){"use strict";t.r(n);var s=t(65),a=Object(s.a)({},(function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("如果你已经购买了VPN服务比如strong vpn或者express vpn等，他们会提供openvpn的客户端配置文件，您只需查看下面的客户端安装步骤；\n如果你是要服务端也亲自安装，则需要购买服务器，然后参考下面client端和server端的安装步骤")]),e._v(" "),t("h2",{attrs:{id:"client-install-客户端安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#client-install-客户端安装"}},[e._v("#")]),e._v(" Client Install 客户端安装")]),e._v(" "),t("h3",{attrs:{id:"基本版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本版本"}},[e._v("#")]),e._v(" 基本版本")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("apt install openvpn\n\nOn CentOS, Fedora and openSUSE use:\n$ sudo yum -y install openvpn\n\nOn CentOS you may need to install EPEL repository firstly:\n$ sudo yum -y install epel-release\n")])])]),t("p",[e._v("https://openvpn.net/community-downloads")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("wget https://swupdate.openvpn.org/community/releases/openvpn-2.5.5.tar.gz\n\ntar xvf openvpn-2.5.5.tar.gz\n\nsudo apt-get install build-essential libssl-dev iproute2 liblz4-dev liblzo2-dev libpam0g-dev libpkcs11-helper1-dev libsystemd-dev resolvconf pkg-config\n\ncd openvpn-2.5.5\n\n./configure --enable-systemd --enable-async-push --enable-iproute2\n\nmake\n\nsudo make install\n\n")])])]),t("h3",{attrs:{id:"scramble版本-你懂的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#scramble版本-你懂的"}},[e._v("#")]),e._v(" Scramble版本（你懂的）")]),e._v(" "),t("p",[e._v("scramble options patch:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("\nwget https://swupdate.openvpn.org/community/releases/openvpn-2.5.5.tar.gz\n\ntar xvf openvpn-2.5.5.tar.gz\n\nwget https://github.com/Tunnelblick/Tunnelblick/archive/master.zip\n\nsudo apt-get install unzip\n\nunzip master.zip\n\ncp Tunnelblick-master/third_party/sources/openvpn/openvpn-2.5.5/patches/*.diff openvpn-2.5.5\n\ncd openvpn-2.5.5\n\npatch -p1 < 02-tunnelblick-openvpn_xorpatch-a.diff\n\npatch -p1 < 03-tunnelblick-openvpn_xorpatch-b.diff\n\npatch -p1 < 04-tunnelblick-openvpn_xorpatch-c.diff\n\npatch -p1 < 05-tunnelblick-openvpn_xorpatch-d.diff\n\npatch -p1 < 06-tunnelblick-openvpn_xorpatch-e.diff\n\nsudo apt-get install build-essential libssl-dev iproute2 liblz4-dev liblzo2-dev libpam0g-dev libpkcs11-helper1-dev libsystemd-dev resolvconf pkg-config\n\n./configure --enable-systemd --enable-async-push --enable-iproute2\n\nmake\n\nsudo make install\n")])])]),t("h3",{attrs:{id:"configuration-配置-以linux为例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configuration-配置-以linux为例"}},[e._v("#")]),e._v(" Configuration 配置(以linux为例)")]),e._v(" "),t("p",[e._v("举例:")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("StrongVPN")]),e._v(" "),t("p",[e._v("VPN Accounts-> VPN Account Summary->选择Open类型的地址服务器->download the .ovpn file")])]),e._v(" "),t("li",[t("p",[e._v("ExpressVPN")]),e._v(" "),t("p",[e._v("Dashboard->Setup the device->More->Manual Configuration->选择地址以及 Linux OpenVPN with Terminal->download the .ovpn file")])])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$ sudo mv vpn-XXX_ovpnXXX_account.ovpn /etc/openvpn/strongvpn.conf\n\n$ vim /etc/openvpn/auth.txt\nThe first line should be VPN server login.\nThe second line should be your password.\n\n$ sudo chmod 400 /etc/openvpn/auth.txt\n\n$ vim /etc/openvpn/strongvpn.conf\nChange the line from “auth-user-pass” to “auth-user-pass /etc/openvpn/auth.txt” (without quotes).\n\n$ sudo service openvpn start\n$ sudo update-rc.d -f openvpn disable\n\nOn CentOS, Fedora and openSUSE:\n$ sudo systemctl start openvpn@strongvpn.service\nIf you have selinux enabled, you also need to run this command before the service start:\n$ sudo restorecon -v /etc/openvpn/strongvpn.conf\nTo disconnect use:\n$ sudo systemctl stop openvpn@strongvpn.service\n")])])]),t("p",[e._v("openvpn程序是如何读取 strongvpn.conf\nsudo service openvpn status\n找到 /etc/init.d/openvpn 查看代码就知道是读取 /etc/openvpn/*.conf文件")]),e._v(" "),t("h3",{attrs:{id:"dns-traffic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dns-traffic"}},[e._v("#")]),e._v(" DNS traffic")]),e._v(" "),t("p",[e._v("Some Ubuntu systems require a script to make sure DNS traffic passes through the VPN tunnel.\nThis is not necessary unless you successfully connect then cannot access web sites by host name.")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo mkdir -p /etc/openvpn/scripts\n\nsudo wget https://raw.githubusercontent.com/jonathanio/update-systemd-resolved/master/update-systemd-resolved -P /etc/openvpn/scripts/\n\nsudo chmod +x /etc/openvpn/scripts/update-systemd-resolved\n")])])]),t("p",[e._v("Then edit your OpenVPN client file (e.g. strong.ovpn) by adding the up/down scripts.\nAdd these 3 lines after the line where it shows your server name (e.g. remote str-atl203.strongconnectivity.com 443 tcp)")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("script-security 2\nup /etc/openvpn/scripts/update-systemd-resolved\ndown /etc/openvpn/scripts/update-systemd-resolved\n")])])]),t("h2",{attrs:{id:"server-install-服务端安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#server-install-服务端安装"}},[e._v("#")]),e._v(" Server Install 服务端安装")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/ttlequals0/autovpn",target:"_blank",rel:"noopener noreferrer"}},[e._v("Create On Demand Disposable OpenVPN Endpoints on AWS."),t("OutboundLink")],1)]),e._v(" "),t("h2",{attrs:{id:"troubleshooting-问题排查"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#troubleshooting-问题排查"}},[e._v("#")]),e._v(" Troubleshooting 问题排查")]),e._v(" "),t("h3",{attrs:{id:"基本方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本方法"}},[e._v("#")]),e._v(" 基本方法")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$ sudo grep ovpn /var/log/syslog\nFor CentOS, Fedora and openSUSE use:\n$ sudo systemctl status -l openvpn@strongvpn.service\n\nIf you see “Initialization Sequence Completed” as the last line, the VPN should be connected fine.\n")])])]),t("h3",{attrs:{id:"status-active-exited"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#status-active-exited"}},[e._v("#")]),e._v(" status: active (exited)")]),e._v(" "),t("p",[e._v("因为你懂的某些国家直接使用openvpn有问题，所以要开启scramble模式，因此我卸载了kali默认的openvpn，\n安装了scramble option")]),e._v(" "),t("p",[e._v("结果无法用service/systemctl启动openvpn")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$service/systemctl start openvpn\nfailed to start .service unit is masked\n\nCheck that the unit file is a symlink to /dev/null:\n$file /etc/systemd/system/openvpn.service\n\n/lib/systemd/system/openvpn.service: symbolic link to /dev/null\n")])])]),t("p",[e._v("删除无效link后重启：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$sudo rm /lib/systemd/system/openvpn.service\n$sudo systemctl daemon-reload\n$service/systemctl start openvpn \n")])])]),t("p",[e._v("但是这一次显示状态有点奇怪：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('$service/systemctl status openvpn\nState active (exited) \n\n$which open\n/usr/local/sbin/openvpn\n\n$sudo find / -name "openvpn.service"\n/run/systemd/generator.late/openvpn.service\n\n$/etc/init.d/openvpn 指向错误路径:\n/usr/sbin/openvpn\n\n修改 /etc/init.d/openvpn指向 /usr/local/sbin/openvpn即可\n')])])]),t("h3",{attrs:{id:"连上vpn但是无法访问"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#连上vpn但是无法访问"}},[e._v("#")]),e._v(" 连上vpn但是无法访问")]),e._v(" "),t("p",[e._v("尝试修改DNS")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("/etc/resolv.conf\n如果上面这个文件是动态修改的，则需要修改（dynamic resolv.conf file for glibc generated）：\n/etc/resolvconf/resolv.conf.d/base\n")])])]),t("p",[e._v("refer:")]),e._v(" "),t("p",[e._v("https://strongvpn.com/setup-linux-openvpn/\nhttps://shenzhensuzy.wordpress.com/2019/01/26/openvpn-with-xor-patch/\nhttps://scramblevpn.wordpress.com/2017/03/26/raspberry-pi-and-patched-openvpn-server-built-from-source-code-2-4-1/")]),e._v(" "),t("disqus")],1)}),[],!1,null,null,null);n.default=a.exports}}]);