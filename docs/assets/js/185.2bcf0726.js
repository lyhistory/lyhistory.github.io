(window.webpackJsonp=window.webpackJsonp||[]).push([[185],{610:function(e,n,s){"use strict";s.r(n);var o=s(65),t=Object(o.a)({},(function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("p",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s/jQlKl45iwVE-iM4SFVohsw",target:"_blank",rel:"noopener noreferrer"}},[e._v("sudo提权这些门道"),s("OutboundLink")],1),e._v(" "),s("code",[e._v("user2 ALL=(root) NOPASSWD: /bin/*")]),e._v("\n看起来没问题，但实际上这给了用户执行/bin/目录下所有命令的权限，包括/bin/bash。用户可以通过sudo /bin/bash直接获得root shell，这就等于给了完整的root权限。")]),e._v(" "),s("p",[e._v("给用户配置了vim的sudo权限，想让他能编辑某些配置文件：\n"),s("code",[e._v("user3 ALL=(root) NOPASSWD: /usr/bin/vim /etc/nginx/nginx.conf")]),e._v("\n但是vim这种编辑器可以执行shell命令，用户在vim中输入:!bash就能获得root shell。类似的还有less、more等命令。")]),e._v(" "),s("p",[e._v("sudo虽然方便，但如果配置不当，反而会带来安全风险。首先，永远不要给用户这样的权限：\n"),s("code",[e._v("user ALL=(ALL) NOPASSWD: ALL")]),e._v("\n这等于直接给了root权限，sudo就失去了意义。其次，要特别小心那些可以执行其他程序的命令，比如：\n• 编辑器（vim, nano, emacs）\n• 分页器（less, more）\n• 解释器（python, perl, ruby）\n• 文件传输工具（scp, rsync）\n这些程序往往都有执行shell命令的功能，给了sudo权限就等于给了root权限。")]),e._v(" "),s("p",[e._v("还有一个容易忽略的点是环境变量。默认情况下，sudo会重置大部分环境变量，但有些变量会保留。如果需要更严格的控制，可以这样配置：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('Defaults env_reset\nDefaults env_keep="LANG LC_* HOME"\n')])])])])}),[],!1,null,null,null);n.default=t.exports}}]);