(window.webpackJsonp=window.webpackJsonp||[]).push([[208],{638:function(e,v,p){"use strict";p.r(v);var _=p(65),s=Object(_.a)({},(function(){var e=this,v=e.$createElement,p=e._self._c||v;return p("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[p("p",[p("a",{attrs:{href:"https://mp.weixin.qq.com/s/SVxAYhdGbUhUT5AurmmJtw",target:"_blank",rel:"noopener noreferrer"}},[e._v("网络安全技能大赛之Linux后门排查"),p("OutboundLink")],1)]),e._v(" "),p("p",[e._v("一、tcpdump 捕获检测流量\n如果比赛的检测脚本使用明文流量进行检测，当检测某个webshell是否被删除，检测脚本会发起对webshell的访问，这时我们可以采用抓包的方式，就可以获得需要删除的webshell名字和路径。")]),e._v(" "),p("p",[e._v("监听指定网卡 ens33 的所有传输数据包\n"),p("code",[e._v("> tcpdump -i ens33")])]),e._v(" "),p("p",[e._v("捕获主机 192.168.100.10 经过网卡 ens33 的所有数据包")]),e._v(" "),p("p",[p("code",[e._v("> tcpdump -i ens33 host 192.168.100.10")])]),e._v(" "),p("p",[e._v("捕获主机 192.168.56.210 接收和发出的 tcp 协议的 ssh 的数据包")]),e._v(" "),p("p",[p("code",[e._v("> tcpdump tcp port 22 and host 192.168.56.210")])]),e._v(" "),p("p",[e._v("过滤端口号 22-433 内的数据包")]),e._v(" "),p("p",[p("code",[e._v("> tcpdump portrange 22-433 -i ens33 -n -c 8")])]),e._v(" "),p("p",[e._v("保存捕获的数据包")]),e._v(" "),p("p",[p("code",[e._v("> tcpdump -i ens33 -w ./1.pcap")])]),e._v(" "),p("p",[e._v("二、查看网站日志")]),e._v(" "),p("p",[e._v("以webshell为例，比赛时检测某个webshell是否被删除，检测脚本会发起对webshell的访问，这时我们通过查看web日志，就可以获得需要删除的webshell名字和路径。")]),e._v(" "),p("p",[e._v("三、常用命令")]),e._v(" "),p("p",[e._v("查看历史命令")]),e._v(" "),p("p",[p("code",[e._v("history")]),e._v("\n查找某时间段修改的文件")]),e._v(" "),p("p",[p("code",[e._v("find / -newermt '2024-07-10 18:00:00' ! -newermt '2024-07-10 19:00:00'")]),e._v("\n查看后门用户")]),e._v(" "),p("p",[p("code",[e._v("查找uid为0的后门账户 cat /etc/passwd")])]),e._v(" "),p("p",[p("code",[e._v('cat auth.log.1 | grep -a "new user"')]),e._v("\n查找webshell")]),e._v(" "),p("p",[e._v("可下载网站源码后用D盾扫描")]),e._v(" "),p("p",[p("code",[e._v('find ./ -name "*.php" | xargs grep --color=auto "eval("')]),e._v("\n免杀马可能使用base64进行加密 特征肯定会有GET接收参数或POST也可以当做一个过滤点")]),e._v(" "),p("p",[p("code",[e._v('find ./ -name "*.php" | xargs grep "base"')]),e._v(" "),p("code",[e._v('find ./ -name "*.php" | xargs grep GET')]),e._v("\n查看可疑进程")]),e._v(" "),p("p",[p("code",[e._v("netstat -anopt")])]),e._v(" "),p("p",[e._v("查看可疑PID进程的cmdline")]),e._v(" "),p("p",[p("code",[e._v("cat /proc/pid/cmdline")])]),e._v(" "),p("p",[e._v("查看ssh登录IP")]),e._v(" "),p("p",[e._v("ssh登录日志位于/var/log/secure或/var/log/auth.log文件中")]),e._v(" "),p("p",[p("code",[e._v('cat /var/log/secure | grep -a "Accept”')])]),e._v(" "),p("p",[e._v("ssh登录失败情况")]),e._v(" "),p("p",[p("code",[e._v("cat auth.log.1 | grep -a \"Failed password for root\" | awk '{print $11}' |sort | uniq -c")]),e._v("\nfind查找Mysql的配置文件")]),e._v(" "),p("p",[p("code",[e._v('find ./ -name "*.php" | xargs grep "127.0.0.1”')]),e._v("\n查找黑链")]),e._v(" "),p("p",[p("code",[e._v('find ./ -name "*.php" | xargs grep "黑链"')]),e._v("\nfind查找隐藏的文件")]),e._v(" "),p("p",[p("code",[e._v("find / -type f -name '.*' 2>/dev/null | grep -v \"sys\"")]),e._v("\nfind查找隐藏的文件夹")]),e._v(" "),p("p",[p("code",[e._v("find / -type d -name '.*' 2>/dev/null | grep -v \"sys\"")])]),e._v(" "),p("p",[e._v("查找木马文件")]),e._v(" "),p("p",[e._v("linux下的木马文件一般为elf后缀 可以直接搜索elf后缀的文件")]),e._v(" "),p("p",[p("code",[e._v('find ./ -name "*.elf"')]),e._v("\n查看计划任务")]),e._v(" "),p("p",[p("code",[e._v("查看计划任务 crontab -l")])]),e._v(" "),p("p",[p("code",[e._v("隐藏的计划任务后门查看 cat -A /var/spool/cron/root")])]),e._v(" "),p("p",[p("code",[e._v("编辑用户的计划任务 crontab -e")])]),e._v(" "),p("p",[p("code",[e._v("删除计划任务 crontab -r")])]),e._v(" "),p("p",[e._v("查看alias后门")]),e._v(" "),p("p",[p("code",[e._v("alias")]),e._v("\n删除alias后门")]),e._v(" "),p("p",[p("code",[e._v("unalias 后门名字")]),e._v("\n可能隐藏在/etc/profile 、 /etc/bashrc 、~/.bashrc 、~/.bash_profile 、~/.profile、~/.bash_logout、~/.bash_aliases 等文件里。")]),e._v(" "),p("p",[e._v("TCP Wrapper后门")]),e._v(" "),p("p",[p("code",[e._v("查看 /etc/hosts.allow")])]),e._v(" "),p("p",[e._v("软链接SSH后门命令")]),e._v(" "),p("div",{staticClass:"language- extra-class"},[p("pre",{pre:!0,attrs:{class:"language-text"}},[p("code",[e._v("查看可疑端口 netstat -antlp\n\n查看可执行文件 ls -al /tmp/su\n\n禁止PAM认证  vim /etc/ssh/sshd_config  UsePAM no\n关闭可疑进程 kill -s 9 PID\n\n重启SSH服务\n")])])]),p("p",[e._v("文件锁定（权限隐藏）")]),e._v(" "),p("div",{staticClass:"language-lsattr evil.php #属性查看 extra-class"},[p("pre",{pre:!0,attrs:{class:"language-text"}},[p("code",[e._v("chattr -i evil.php #解除锁定\nrm -rf evil.php #彻底删除⽂件\n")])])]),p("p",[e._v("查找SUID文件")]),e._v(" "),p("p",[e._v("利用SUID提权的思路就是运行root用户所拥有的SUID的文件，那么我们运行该文件的时候就需要获得root用户的身份了。")]),e._v(" "),p("div",{staticClass:"language- extra-class"},[p("pre",{pre:!0,attrs:{class:"language-text"}},[p("code",[e._v("find / -user root -perm -4000 -exec ls -ldb {} \\;\n\n取消s权限例如 chmod u-s /usr/bin/find\n")])])])])}),[],!1,null,null,null);v.default=s.exports}}]);