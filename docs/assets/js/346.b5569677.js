(window.webpackJsonp=window.webpackJsonp||[]).push([[346],{773:function(e,s,n){"use strict";n.r(s);var t=n(65),a=Object(t.a)({},(function(){var e=this,s=e.$createElement,n=e._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("p",[e._v("Book: Linux Bible, 9th Edition\nLAB:  "),n("a",{attrs:{href:"https://github.com/ivandavidov/minimal",target:"_blank",rel:"noopener noreferrer"}},[e._v("Minimal Linux"),n("OutboundLink")],1)]),e._v(" "),n("h2",{attrs:{id:"万物皆文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#万物皆文件"}},[e._v("#")]),e._v(" 万物皆文件")]),e._v(" "),n("p",[e._v("文件描述符（file descriptor）是操作系统内核为了高效管理已被打开的文件所创建的索引，用于指代被打开的文件\n在linux操作系统中，每一个进程中都有一个文件描述符表，它是一个指针数组，系统默认初始化了数组的前3位。第0位指向标准的输入流（一般是键盘），第1位指向标准的输出流（一般是显示器），第2位指向标准的错误流（一般是也显示器）。\n现在如果有一个进程中只打开了一个 hello.txt 文件,那么这个进程的文件描述符表的第3位就是指向这个 hello.txt 的指针。之后如果该进程创建了一个socket，那么这个文件描述符表的第4位就是指向这个socket的指针，因为在linux中一切皆文件，socket也是一个文件。我们所说的文件描述符就是进程中这个数组的下标，因此他也可以说是一个索引")]),e._v(" "),n("h2",{attrs:{id:"命令执行本质"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#命令执行本质"}},[e._v("#")]),e._v(" 命令执行本质")]),e._v(" "),n("p",[e._v("一个命令行终端是一个shell进程，在这个终端里执行的程序都是作为该shell进程的子进程。\n如果子进程命令阻塞终端shell进程，shell进程就会等待子进程退出才能接收其他命令；\n如果关掉了shell终端，，依附的所有子进程都会退出；\n加上&号可以避免这种情况，原理是将命令挂在systemd系统守护进程名下，其他办法还有nohup或者开tmux或者screen，并且加&可以让shell进程不再阻塞，从而继续响应新命令；")]),e._v(" "),n("p",[e._v("how to find whether a script run as a nohup finished or not?")]),e._v(" "),n("ul",[n("li",[e._v("method 1:\nput "),n("code",[e._v("echo $$ > /var/run/myscript.pid")]),e._v(" at the top of your script:\nto check if it's still running: ps -p "),n("code",[e._v("cat /var/run/myscript.pid")])]),e._v(" "),n("li",[e._v("method 2:\nAfter running "),n("code",[e._v("nohup script.sh &")]),e._v("\nstore the PID into a variable. $! is the PID of the last background process. "),n("code",[e._v("HISPID=$!")]),e._v("\nThen you can check if it's there with ps or kill:\n"),n("code",[e._v("ps -p $HISPID")]),e._v(" "),n("code",[e._v("kill -0 $HISPID")])])]),e._v(" "),n("p",[e._v("set -x 可以显示shell在执行什么程序")]),e._v(" "),n("p",[e._v("当使用 sudo 时，系统会使用 /etc/sudoers 这个文件中规定的该用户的权限和环境变量")]),e._v(" "),n("h2",{attrs:{id:"重定向-管道"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#重定向-管道"}},[e._v("#")]),e._v(" 重定向/管道")]),e._v(" "),n("p",[n("img",{attrs:{src:"/docs/docs_image/software/linux/linux_redirect01.png",alt:""}})]),e._v(" "),n("ul",[n("li",[n("p",[e._v("重定向")]),e._v(" "),n("p",[e._v("输入<+输出流>")]),e._v(" "),n("p",[n("code",[e._v("exec 8<> /dev/tcp/www.baidu.com/80")])]),e._v(" "),n("p",[e._v("重定向到文件："),n("code",[e._v("> file")])]),e._v(" "),n("p",[e._v("重定向到文件描述符要加&"),n("code",[e._v(">& fd")])]),e._v(" "),n("p",[n("code",[e._v('echo -e "GET / HTTP/1.0\\n" 1>& 8')]),e._v(" "),n("code",[e._v("cat 0<& 8 或 cat<&8")])])]),e._v(" "),n("li",[n("p",[n("strong",[e._v("标准输出重定向：")])]),e._v(" "),n("p",[e._v("比如标准输出重定向 java -jar **.jar > log.txt")]),e._v(" "),n("p",[e._v("2>&1 标准错误输出重定向到标准输出")]),e._v(" "),n("p",[e._v("如果需要sudo权限，可以用tee：sudo tee")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("cat shopee.sg.domain.uniq | filter-resolved > shopee.sg.domain.uniq.resolved\ncat shopee.sg.domain.uniq | filter-resolved | sudo tee shopee.sg.domain.uniq.resolved\n")])])])]),e._v(" "),n("li",[n("p",[n("strong",[e._v("标准输入重定向：管道|和<<< 以及命令替换$()：")])]),e._v(" "),n("p",[e._v("首先$()主要则是command substitution，比如")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("rm $(where connect.sh)\n\ndos2unix $(find . -type f)\n")])])]),n("p",[e._v('echo $(cmd) 和 echo "$(cmd)"，结果差不多，但是仍然有区别。注意观察，双引号转义完成的结果会自动增加单引号，而前者不会， 如果 $ 读取出的参数字符串包含空格，应该用双引号括起来，否则就会出错。')]),e._v(" "),n("p",[e._v("管道：")]),e._v(" "),n("p",[n("code",[e._v("ps -aef | grep -v grep | grep \"java -server -jar\" | awk '{print $2}'")]),e._v("\n$(2)获取管道前面等输出结果第二列,此时可以用$2替代；")]),e._v(" "),n("p",[n("code",[e._v("yes|cp -r source_folder target_folder/")])]),e._v(" "),n("p",[e._v("标准输入重定向符：")]),e._v(" "),n("p",[e._v("<<< String 比如脚本中读取第一个参数并取分隔''的第一个值 "),n("code",[e._v("IFS='/' read -ra target_arr <<< \"$1\"")])])]),e._v(" "),n("li",[n("p",[n("strong",[e._v("位置参数${}：")])]),e._v(" "),n("p",[e._v("${}主要是作为positional parameter，")]),e._v(" "),n("p",[e._v("$｛2｝还可以表示获取脚本输入参数等第二个，此时也可以用$2替代，$#是输入参数个数；")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ animal=cat\n$ echo $animals\n# No such variable as “animals”.\n$ echo ${animal}s\ncats\n")])])]),n("p",[e._v("{}https://askubuntu.com/questions/339015/what-does-mean-in-the-find-command")]),e._v(" "),n("p",[e._v("https://labuladong.gitbook.io/algo/di-wu-zhang-ji-suan-ji-ji-shu/linux-jin-cheng https://labuladong.gitbook.io/algo/di-wu-zhang-ji-suan-ji-ji-shu/linuxshell")]),e._v(" "),n("p",[e._v("difference between ${} and $() in shell script https://superuser.com/questions/935374/difference-between-and-in-shell-scriptcd /proc/$$/fd $$代表当前解释程序")])]),e._v(" "),n("li",[n("p",[n("strong",[e._v("哪些命令接受标准输入")])]),e._v(" "),n("p",[e._v('命令默认都接受参数 -argument，有些命令还接受标准输入（可以使用管道符|和重定向符< <<<）,\n简单判别方式：命令是否可以阻塞终端（如cat不加任何命令会阻塞终端）\n如 echo"trade:trade"|chpasswd')])])]),e._v(" "),n("h2",{attrs:{id:"用户身份和权限"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用户身份和权限"}},[e._v("#")]),e._v(" 用户身份和权限")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("sudo 是一种常见的提权方式，它可以让普通用户暂时获得管理员权限。具体来说，用户通过 sudo 命令运行某个命令时，系统将询问用户密码，并验证其是否有权限执行该命令。如果验证通过，则该命令将以管理员身份运行。下面是一个 sudo 的示例")])]),e._v(" "),n("li",[n("p",[e._v('su 命令（即 "superuser"）则是另外一种提权方式，它允许用户将自己切换到 root 用户账户并获取 root 权限。这比 sudo 命令提供的管理员特权更高级。通常情况下，建议尽可能少使用 su 命令，以避免出现安全问题')])]),e._v(" "),n("li",[n("p",[e._v("SUID（Set User ID on Execution）是一种能够直接为二进制可执行文件设置权限的机制。通过它，用户可以在运行某个程序时暂时获取其所有者的权限。在SUID技术中，如果文件属于 root 用户且相应的 SUID 位被设置了，则用户将在运行该程序时以 root 身份运行")])]),e._v(" "),n("li",[n("p",[e._v("SGID 类似SUID，SGID（Set Group ID on Execution）也是一种控制二进制可执行文件权限的方式。通过它，用户可以在运行某些程序时暂时获取文件所在组的身份和权限。当你要涉及到多个用户同步操作同一文件、同一组时，SGID 是非常有用的方式")])])]),e._v(" "),n("p",[e._v("su – The difference between the su and the hyphenated su – commands is the su command without arguments keeps almost all environment variables belonging to the original user. Contrary to this, the hyphenated su – command clears most environment variables.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('su _gvm\nThis account is currently not available.\n\nsudo -u _gvm gvmd --migrate\nsudo su -l _gvm -s /bin/bash\n\nsudo sh -c "cmds"\n\n\n')])])]),n("p",[e._v("Permissions take a different meaning for directories. Here's what they mean:")]),e._v(" "),n("ul",[n("li",[n("strong",[e._v("r")]),e._v("ead determines if a user can view the directory's contents, i.e. do ls in it.")]),e._v(" "),n("li",[n("strong",[e._v("w")]),e._v("rite determines if a user can create new files or delete file in the directory. (Note here that this essentially means that a user with write access toa directory can delete files in the directory "),n("em",[e._v("even")]),e._v(" if he/she doesn't have write permissions for the file! So be careful with this.)")]),e._v(" "),n("li",[e._v("e"),n("strong",[e._v("x")]),e._v("ecute determines if the user can cd into the directory.")])]),e._v(" "),n("p",[e._v("系统启动用户")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("-----------------------------------------------------\n--- mysql\n-----------------------------------------------------\n$ systemctl status mysqld\n● mysqld.service - MySQL Server\n   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)                                                                                          \n   Active: active (running) since Thu 2021-07-08 09:44:33 SGT; 2 months 1 days ago\n     Docs: man:mysqld(8)\n           http://dev.mysql.com/doc/refman/en/using-systemd.html\n  Process: 2934 ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS (code=exited, status=0/SUCCESS)                                             \n  Process: 2913 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS)\n Main PID: 2936 (mysqld)\n   CGroup: /system.slice/mysqld.service\n           └─2936 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid\n\n$ vim /usr/lib/systemd/system/mysqld.service\n[Unit]\nDescription=MySQL Server\nDocumentation=man:mysqld(8)\nDocumentation=http://dev.mysql.com/doc/refman/en/using-systemd.html\nAfter=network.target\nAfter=syslog.target\n\n[Install]\nWantedBy=multi-user.target\n\n[Service]\nUser=mysql\nGroup=mysql\n\nType=forking\n\nPIDFile=/var/run/mysqld/mysqld.pid\n.....\n# Start main service\nExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS\n...........\n\n-----------------------------------------------------\n--- keepalived\n-----------------------------------------------------\n$ systemctl status keepalived\n● keepalived.service - LVS and VRRP High Availability Monitor\n   Loaded: loaded (/usr/lib/systemd/system/keepalived.service; disabled; vendor preset: disabled)\n   Active: active (running) since Sun 2021-08-29 14:39:15 SGT; 1 weeks 2 days ago\n  Process: 15401 ExecStart=/usr/sbin/keepalived $KEEPALIVED_OPTIONS (code=exited, status=0/SUCCESS)\n Main PID: 15402 (keepalived)\n\n$ vim /usr/lib/systemd/system/keepalived.service\n[Unit]\nDescription=LVS and VRRP High Availability Monitor\nAfter=syslog.target network-online.target\n\n[Service]\nType=forking\nPIDFile=/var/run/keepalived.pid\nKillMode=process\nEnvironmentFile=-/etc/sysconfig/keepalived\nExecStart=/usr/sbin/keepalived $KEEPALIVED_OPTIONS\nExecReload=/bin/kill -HUP $MAINPID\n\n[Install]\nWantedBy=multi-user.target\n\n可以看到mysqld的实际用户是mysql，而keepalived没有指定，所以其用户就是执行启动命令systemctl start keepalived的用户\n\n")])])]),n("p",[e._v("系统自动启动程序：\nsudo systemctl list-unit-files --type=service --state=enabled --all")]),e._v(" "),n("h2",{attrs:{id:"文件系统"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#文件系统"}},[e._v("#")]),e._v(" 文件系统")]),e._v(" "),n("p",[e._v("umask 指定在建立文件时预设的权限掩码")]),e._v(" "),n("h2",{attrs:{id:"about-env"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#about-env"}},[e._v("#")]),e._v(" About Env")]),e._v(" "),n("p",[e._v("先确认默认的shell: BASH OR ZSH OR..")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("echo $0 or echo $SHELL or ps -p $$\n\n")])])]),n("p",[e._v("改变默认shell")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("cat /etc/shells\ntype -a bash\nchsh -s /usr/bin/bash\nrestart\n")])])]),n("p",[e._v('"-bash: !": event not found"\n! is a special character to bash, it is used to refer to previous commands;')]),e._v(" "),n("h3",{attrs:{id:"env"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#env"}},[e._v("#")]),e._v(" env")]),e._v(" "),n("p",[e._v("The files in /etc directory sets the respective shell configuration  for all the users on the system. This is normally set up by the system  administrator.")]),e._v(" "),n("p",[e._v("The files in the home directory of the user are user-specific, obviously. This allows users to create alias for frequently used commands or use a custom PATH variable for a program.")]),e._v(" "),n("p",[e._v("i) 特定用户的PATH  ~/bashrc  ~/bash_profile")]),e._v(" "),n("ul",[n("li",[e._v('Bash Startup Files\nWhen a "login shell" starts up, it reads the file /etc/profile and then ~/.bash_profile or ~/.bash_login or ~/.profile (whichever one exists - it only reads ONE of these, checking for them in the order mentioned).\nWhen a "non-login shell" starts up, it reads the file /etc/bashrc and then the file ~/.bashrc.')])]),e._v(" "),n("p",[e._v("ii) system wide全局PATH /etc/profile或/root/.bashrc  (/etc/environment?)")]),e._v(" "),n("p",[e._v("Anything in "),n("code",[e._v("~/.profile")]),e._v(" and "),n("code",[e._v("~/.bashrc")]),e._v(" is run "),n("em",[e._v("after")]),e._v(" "),n("code",[e._v("/etc/profile")]),e._v(" and "),n("code",[e._v("/bash.bashrc")])]),e._v(" "),n("p",[e._v("所以如果是修改了/etc/profile对root或sudo操作无效，要看下root下面的~/.bashXXX是不是有PATH设置，")]),e._v(" "),n("p",[e._v("如果还不生效，就要看下/etc/sudoers: Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin，可以使用 sudo -E 绕过")]),e._v(" "),n("p",[e._v("For some setups the "),n("code",[e._v("-E")]),e._v(' switch will not work. To "workaround" it you can use '),n("code",[e._v('sudo env "PATH=$PATH" bash')]),e._v(". This will also carry your current "),n("code",[e._v("$PATH")]),e._v(" forward to your "),n("code",[e._v("sudo")]),e._v(" environment.")]),e._v(" "),n("h3",{attrs:{id:"登录式-shell-和非登录式-shell"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#登录式-shell-和非登录式-shell"}},[e._v("#")]),e._v(" 登录式 shell 和非登录式 shell")]),e._v(" "),n("p",[e._v("https://linuxhandbook.com/login-shell/")]),e._v(" "),n("p",[e._v("https://unix.stackexchange.com/questions/38175/difference-between-login-shell-and-non-login-shell")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("交互式 shell 指的是"),n("strong",[e._v("在终端有交互的模式，用户输入命令，并在回车后立即执行的 shell")]),e._v("，这种模式也是大部分情况下用户执行的一种方式，比如 ssh 登录")]),e._v(" "),n("p",[e._v("You can start a new shell from your current shell (an interactive shell): $ bash  (subshell)")])]),e._v(" "),n("li",[n("p",[e._v("when you run a shell script, it runs in its own shell (a non-interactive shell).")]),e._v(" "),n("p",[e._v("非交互式 shell 指的"),n("strong",[e._v("是 bash shell 以命令脚本的形式执行")]),e._v("，这种模式下，shell 不会和用户有交互，而是读取脚本文件并执行，直到读取到文件 EOF 时结束")])]),e._v(" "),n("li",[n("p",[e._v("The login shell is the first process that is executed with your user ID when you log into an interactive session.")]),e._v(" "),n("p",[e._v("The login process tells the shell to behave as a login shell with a  convention: passing argument 0, which is normally the name of the shell  executable, with a "),n("code",[e._v("-")]),e._v(" character prepended (e.g. "),n("code",[e._v("-bash")]),e._v(" whereas it would normally be "),n("code",[e._v("bash")]),e._v(".")]),e._v(" "),n("p",[e._v("The login shell reads environment variable and other configuration from  /etc/profile and a profile file in the home directory. This allows you  to have tab completion, colored output and sets other stuff such as  umask etc.")]),e._v(" "),n("p",[e._v("登录式 shell 是"),n("strong",[e._v("用户使用自己的 user ID 登录交互式 shell 的第一个进程")])]),e._v(" "),n("p",[e._v("login shell 会读取不同的配置文件，比如 bash 会读取 "),n("code",[e._v("/etc/profile")]),e._v(" ， "),n("code",[e._v("~/.profile")]),e._v("，"),n("code",[e._v("~/.bash_profile")]),e._v(" 等配置文件。而 zsh 会是 "),n("code",[e._v("/etc/zprofile")]),e._v(" 和 "),n("code",[e._v("~/.zprofile")])]),e._v(" "),n("p",[e._v("When you log in on a text console, or through SSH, or with "),n("code",[e._v("su -")]),e._v(", you get an "),n("strong",[e._v("interactive login")]),e._v(" shell. When you log in in graphical mode (on an "),n("a",{attrs:{href:"http://en.wikipedia.org/wiki/X_display_manager_(program_type)",target:"_blank",rel:"noopener noreferrer"}},[e._v("X display manager"),n("OutboundLink")],1),e._v("), you don't get a login shell, instead you get a session manager or a window manager.")])]),e._v(" "),n("li",[n("p",[e._v("non-login shell")]),e._v(" "),n("p",[e._v("It's rare to run a "),n("strong",[e._v("non-interactive login")]),e._v(" shell, but  some X settings do that when you log in with a display manager, so as to arrange to read the profile files. Other settings (this depends on the  distribution and on the display manager) read "),n("code",[e._v("/etc/profile")]),e._v(" and "),n("code",[e._v("~/.profile")]),e._v(" explicitly, or don't read them. Another way to get a non-interactive  login shell is to log in remotely with a command passed through standard input which is not a terminal, e.g. "),n("code",[e._v("ssh example.com <my-script-which-is-stored-locally")]),e._v(" (as opposed to "),n("code",[e._v("ssh example.com my-script-which-is-on-the-remote-machine")]),e._v(", which runs a non-interactive, non-login shell).")]),e._v(" "),n("ul",[n("li",[n("p",[n("strong",[e._v("interactive, non-login")]),e._v(" shell")]),e._v(" "),n("p",[e._v("When you start a shell in a terminal in an existing session (screen, X  terminal, Emacs terminal buffer, a shell inside another, etc.), you get  an "),n("strong",[e._v("interactive, non-login")]),e._v(" shell. That shell might read a shell configuration file ("),n("code",[e._v("~/.bashrc")]),e._v(" for bash invoked as "),n("code",[e._v("bash")]),e._v(", "),n("code",[e._v("/etc/zshrc")]),e._v(" and "),n("code",[e._v("~/.zshrc")]),e._v(" for zsh, "),n("code",[e._v("/etc/csh.cshrc")]),e._v(" and "),n("code",[e._v("~/.cshrc")]),e._v(" for csh, the file indicated by the "),n("code",[e._v("ENV")]),e._v(" variable for POSIX/XSI-compliant shells such as dash, ksh, and bash when invoked as "),n("code",[e._v("sh")]),e._v(", "),n("code",[e._v("$ENV")]),e._v(" if set and "),n("code",[e._v("~/.mkshrc")]),e._v(" for mksh, etc.).")]),e._v(" "),n("p",[e._v("当你在已经存在的终端 session 中开启一个 shell，比如在 screen, Tmux, X terminal 等中，会得到一个交互式，非登录 shell")]),e._v(" "),n("p",[e._v("只会读取 "),n("code",[e._v("~/.bashrc")]),e._v(" 配置("),n("code",[e._v("~/.bashrc")]),e._v(" for bash, "),n("code",[e._v("/etc/zshrc")]),e._v(" and "),n("code",[e._v("~/.zshrc")]),e._v(" for zsh)。")])]),e._v(" "),n("li",[n("p",[n("strong",[e._v("non-interactive, non-login")]),e._v(" shell")]),e._v(" "),n("p",[e._v("When a shell runs a script or a command passed on its command line, it's a "),n("strong",[e._v("non-interactive, non-login")]),e._v(" shell. Such shells run all the time: it's very common that when a  program calls another program, it really runs a tiny script in a shell  to invoke that other program. Some shells read a startup file in this  case (bash runs the file indicated by the "),n("code",[e._v("BASH_ENV")]),e._v(" variable, zsh runs "),n("code",[e._v("/etc/zshenv")]),e._v(" and "),n("code",[e._v("~/.zshenv")]),e._v("), but this is risky: the shell can be invoked in all sorts of contexts,  and there's hardly anything you can do that might not break something.")]),e._v(" "),n("p",[e._v("当 shell 执行一个脚本，或者通过命令行将命令传送过去执行，这时就是非交互，非登录的 shell")]),e._v(" "),n("p",[e._v("不会读取任何profile 或 rc")])])])])]),e._v(" "),n("p",[e._v("举例1：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("echo $0\n- `-bash` 中 `-` 表示当前是一个 login shell\n- `bash` 表示不是 login shell\n\n用户在当前交互式的shell中执行：\n$ bash\n就会开启一个新的 subshell，这个subshell就是一个 non-login shell，在该subshell中可以读取`~/.bashrc` 也可以读取`~/.bash_profile`（继承parent）\n\nOn desktop Linux, you don't use login shell. Your login is managed by a display manager. This is why when you open a terminal in Linux desktop, you'll see that even the first shell running in the terminal is not login shell. \n")])])]),n("p",[e._v("举例2：")]),e._v(" "),n("p",[e._v("https://www.tecmint.com/change-a-users-default-shell-in-linux/")]),e._v(" "),n("p",[e._v("There are several reasons for changing a user’s shell in Linux including the following:")]),e._v(" "),n("ol",[n("li",[e._v("To "),n("a",{attrs:{href:"https://www.tecmint.com/block-or-disable-normal-user-logins-in-linux/",target:"_blank",rel:"noopener noreferrer"}},[e._v("block or disable normal user logins"),n("OutboundLink")],1),e._v(" in Linux using a nologin shell.")]),e._v(" "),n("li",[e._v("Use a shell wrapper script or program to login user commands before  they are sent to a shell for execution. Here, you specify the shell  wrapper as a user’s login shell.")]),e._v(" "),n("li",[e._v("To meet a user’s demands (wants to use a specific shell), especially those with administrative rights")])]),e._v(" "),n("p",[e._v("举例3 non-interactive, non-login shell：")]),e._v(" "),n("p",[e._v("使用crontab自动启动jar的时候，java代码中getHostName抛错，手动启动则没有问题")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('----------------------------------------------------------------------------------------------------------\n--- java code\n----------------------------------------------------------------------------------------------------------\nprivate Long getDataCenterId(){\n        int[] ints = StringUtils.toCodePoints(SystemUtils.getHostName());\n        int sums = 0;\n        for (int i: ints) {\n            sums += i;\n        }\n        return (long)(sums % 32);\n    }\n    \nCaused by: java.lang.NullPointerException\n\tat com.lyhistory.util.IdWorkerConfiguration.getDataCenterId(IdWorkerConfiguration.java:64)\n\tat com.lyhistory.util.IdWorkerConfiguration.getDateFromConfig(IdWorkerConfiguration.java:43)\n\t\n查了下，在linux下面，SystemUtils.getHostName()实际是去获取linux env的HOSTNAME，\n在该linux机器上使用执行crontab对应相同的用户登录，并执行env，正常显示HOSTNAME（当然了，毕竟手动运行没问题）\n所以合理的怀疑是，crontab没有拿到env\n\n\n----------------------------------------------------------------------------------------------------------\n--- crontab\n----------------------------------------------------------------------------------------------------------\n$ crontab -e\n44 17 * * * /opt/scripts/start_some_service.sh && &>> /opt/logs/start_some_service`date +\\%F`.log   2>&1\n\n----------------------------------------------------------------------------------------------------------\n--- start_some_service.sh\n----------------------------------------------------------------------------------------------------------\n$ vim start_some_service\n#!/bin/bash \n\nreadonly PROGNAME=$(basename $0)\nreadonly PROGDIR=$(readlink -m $(dirname $0))\n\n# source env\nL_INVOCATION_DIR="$(pwd)"\nL_CMD_DIR="/opt/scripts"\n\nif [ "${L_INVOCATION_DIR}" != "${L_CMD_DIR}" ]; then\n  pushd ${L_CMD_DIR} &> /dev/null\nfi\n\nsource ./_set_env.sh\n./start_service.sh A\n./start_service.sh B\n\n----------------------------------------------------------------------------------------------------------\n--- start_service.sh\n----------------------------------------------------------------------------------------------------------\n$ vim start_service.sh\nPID=`ps -aef | grep -v grep | grep "java -server -jar ./${1}.jar" | awk \'{print $2}\'`\n\nif [ ! -z "$PID" ]; then\n        echo "Service $1 already running on the server. PID is [$PID];"\n        exit 0\nfi\n\nulimit -c unlimited\n\nnohup java -server -jar $1.jar > ../logs/`date +\\%F`_$1_`date +\\%H.%M.%S`.log 2>&1 &\nsleep 1\nPID=`ps -aef | grep -v grep | grep "java -server -jar ${1}.jar" | awk \'{print $2}\'`\n\nif [ ! -z "$PID" ]; then\n        echo "Service $1 started. PID is [$PID]"\nelse\n        echo "Failed to start service $1"\nfi\n\npopd &>/dev/null\n\n\n----------------------------------------------------------------------------------------------------------\n--- 修复方式\n----------------------------------------------------------------------------------------------------------\nstart_some_service.sh 替换 #!/bin/bash 为 #!/bin/bash -l\n或者crontab添加bash -l\n44 17 * * * bash -l /opt/scripts/start_some_service.sh && &>> /opt/logs/start_some_service`date +\\%F`.log       2>&1\n----------------------------------------------------------------------------------------------------------\n--- 原因\n----------------------------------------------------------------------------------------------------------\n$ man 5 crontab\n............\nSeveral environment variables are set up automatically by the cron(8) daemon.  SHELL is set to /bin/sh, and LOGNAME and HOME are set from the /etc/passwd line of  the  crontab´s\n       owner.  HOME and SHELL can be overridden by settings in the crontab; LOGNAME can not.\n\n       (Note: the LOGNAME variable is sometimes called USER on BSD systems and is also automatically set).\n.............\n\n$ man bash\n -l        Make bash act as if it had been invoked as a login shell (see INVOCATION below).\n\nThe -l option tells bash to read all the various "profile" scripts, from /etc and from your home directory. Bash normally only does this for interactive sessions (in which bash is run without any command line parameters).\n\nNormal scripts have no business reading the profile; they\'re supposed to run in the environment they were given. That said, you might want to do this for personal scripts, maybe, if they\'re tightly bound to your environment and you plan to run them outside of a normal session.\n\nA crontab is one example of running a script outside your session, so yes, go do it!\n\nrefer:\nhttps://www.baeldung.com/linux/load-env-variables-in-cron-job\nhttps://unix.stackexchange.com/questions/422499/what-are-the-pros-and-cons-in-using-the-l-in-a-script-shebang/422505\nhttps://stackoverflow.com/questions/2229825/where-can-i-set-environment-variables-that-crontab-will-use\nhttps://stackoverflow.com/questions/36885909/cronjob-does-not-execute-a-script-that-works-fine-standalone/69100347#69100347\nhttps://unix.stackexchange.com/questions/321315/get-cron-to-run-in-the-same-environment-as-i-get-with-ssh-login\n')])])]),n("h2",{attrs:{id:"安装包管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装包管理"}},[e._v("#")]),e._v(" 安装包管理")]),e._v(" "),n("h3",{attrs:{id:"不同发行版选择"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#不同发行版选择"}},[e._v("#")]),e._v(" 不同发行版选择")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("Ubuntu / kali / parrotOS")]),e._v(" "),n("p",[e._v("based on debian,")])]),e._v(" "),n("li",[n("p",[e._v("Centos")]),e._v(" "),n("p",[e._v("for bigdata")])]),e._v(" "),n("li",[n("p",[e._v("Redhat")]),e._v(" "),n("p",[e._v("for databases(because those database companies use redhat, it’s tested)")])])]),e._v(" "),n("h3",{attrs:{id:"基本安装方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基本安装方法"}},[e._v("#")]),e._v(" 基本安装方法")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("apt或yum安装")]),e._v(" "),n("p",[e._v("add to apt/yum repository, and then apt-get/yum install ***")]),e._v(" "),n("p",[e._v("Normally will be put in "),n("strong",[e._v("/usr/bin/")])]),e._v(" "),n("p",[e._v("Additionally, you can use "),n("code",[e._v("yum localinstall <packagename>")]),e._v(" to intelligently install dependencies as needed.")]),e._v(" "),n("p",[e._v("Know the version before installing:")]),e._v(" "),n("p",[n("code",[e._v("apt policy <packagename>")])]),e._v(" "),n("p",[n("code",[e._v("yum info/search <packagename>")])])]),e._v(" "),n("li",[n("p",[e._v("deb或rpm安装 / AppImage")]),e._v(" "),n("p",[e._v("download deb for ubuntu or rpm for centos, and install it, it will help you install all related dependencies")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("版本")]),e._v(" "),n("p",[e._v("amd64, i386,x64"),n("a",{attrs:{href:"https://askubuntu.com/questions/32402/amd64-i386-32bit-64bit-which-version-to-choose",target:"_blank",rel:"noopener noreferrer"}},[e._v(" https://askubuntu.com/questions/32402/amd64-i386-32bit-64bit-which-version-to-choose"),n("OutboundLink")],1)])]),e._v(" "),n("li",[n("p",[e._v("包类型：dpkg(Ubuntu) , rpm(centos)")]),e._v(" "),n("p",[e._v("http://linuxintro.org/index.php?title=Dpkg-rpm_equivalent_commands&redirect=no")]),e._v(" "),n("p",[e._v("deb for debian")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("dpkg -i google-chrome-stable_current_amd64.deb\napt install ./google-chrome-stable_current_amd64.deb\n")])])]),n("p",[e._v("rpm for # CentOS/RHEL")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("rpm -Uvh gitlab-ce-<version>.rpm\n如果是第一次安装可以用rpm -ivh gitlab-ce-<version>.rpm\nyum localinstall gitlab-ce-<version>.rpm\n")])])]),n("p",[e._v("AppImage for all:\nis a universal software package format, 只需要下载然后给可执行权限")])])])]),e._v(" "),n("li",[n("p",[e._v("解压直接使用 download tar file, and extract, then:")]),e._v(" "),n("ol",[n("li",[e._v("set env variable or persist it in:")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("​\te.g. vim ~/.bash_profile\nexport PATH=$PATH:/usr/local/go/bin, more read section #About ENV\n\ne.g. Create one file test.sh in /etc/profile.d with following content:\n#!/bin/sh\nexport PATH=/opt/something/bin:$PATH\n")])])]),n("ol",{attrs:{start:"2"}},[n("li",[n("p",[e._v("or just mv it into /usr/local/bin/")])]),e._v(" "),n("li",[n("p",[e._v("or link")])])]),e._v(" "),n("p",[e._v("​\t"),n("code",[e._v("cd /usr/bin sudo ln -s /home/lyhistory/.local/bin/tldr tldr")]),e._v("\nOR")]),e._v(" "),n("p",[e._v("​\t"),n("code",[e._v("sudo ln -sf /usr/local/share/$PHANTOM_JS/bin/phantomjs /usr/local/bin")])]),e._v(" "),n("p",[e._v("缺点: if there is dependencies, you have to manually install them")])]),e._v(" "),n("li",[n("p",[e._v("源码编译安装")]),e._v(" "),n("p",[e._v("configuration(configure --prefix=安装路径)或cmake之后make install，通常安装的路径在 install_manifest.txt，所以删除方式："),n("code",[e._v("cat install_manifest.txt | xargs echo sudo rm | sh")])]),e._v(" "),n("blockquote",[n("p",[e._v("The steps:")]),e._v(" "),n("ol",[n("li",[n("p",[e._v("The "),n("code",[e._v("autogen.sh")]),e._v(" script generates the "),n("code",[e._v("configure")]),e._v(" script (from "),n("code",[e._v("configure.ac")]),e._v(", using autoconf) and any files it needs (like creating "),n("code",[e._v("Makefile.in")]),e._v(" from "),n("code",[e._v("Makefile.am")]),e._v(" using automake). This requires autotools to be installed on your system, and it must be run when checking out the project from source control (if "),n("code",[e._v("configure")]),e._v(" isn’t checked in). People who download source tarballs can usually skip this step, because output of this step is included in source tarballs.")]),e._v(" "),n("p",[n("strong",[e._v("Note")]),e._v(" This is usually equivalent to "),n("code",[e._v("autoreconf --install")]),e._v(". If there is not "),n("code",[e._v("autogen.sh")]),e._v(" file, then just run "),n("code",[e._v("autoreconf --install")]),e._v(" instead. If you have inherited a project with an "),n("code",[e._v("autogen.sh")]),e._v(", consider deleting it if you can use "),n("code",[e._v("autoreconf --install")]),e._v(".")])]),e._v(" "),n("li",[n("p",[e._v("The "),n("code",[e._v("configure")]),e._v(" script generates "),n("code",[e._v("Makefile")]),e._v(" and other files needed to build. Typically "),n("code",[e._v("Makefile.in")]),e._v(" is used as a template to generate "),n("code",[e._v("Makefile")]),e._v(" (and "),n("code",[e._v("config.h.in")]),e._v(" to generate "),n("code",[e._v("config.h")]),e._v("). This process happens using only standard tools installed on your system, like sed and awk, and doesn't require autotools to be installed.")])]),e._v(" "),n("li",[n("p",[e._v("The "),n("code",[e._v("make")]),e._v(" command builds the software.")])]),e._v(" "),n("li",[n("p",[e._v("The "),n("code",[e._v("make install")]),e._v(" command installs it.")])])]),e._v(" "),n("p",[e._v("https://stackoverflow.com/questions/50044091/what-is-the-job-of-autogen-sh-when-building-a-c-package-on-linux")])])])]),e._v(" "),n("p",[e._v("常见问题：")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("前面几种安装方法的比较：rpm -ivh -uvh VS yum install vs yum localinstall")]),e._v(" "),n("p",[e._v("[https://serverfault.com/questions/825320/difference-between-rpm-ivh-package-and-yum-install-package#:~:text=there%20is%20no%20difference%20if,works%20with%20file(s).](https://serverfault.com/questions/825320/difference-between-rpm-ivh-package-and-yum-install-package#:~:text=there is no difference if,works with file(s).)")])]),e._v(" "),n("li",[n("p",[e._v("安装后管理")]),e._v(" "),n("ul",[n("li",[e._v("rpm:"),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('rpm -qa | grep "package name"。\nyum list installed | grep "package name"\n')])])])]),e._v(" "),n("li",[e._v("deb:"),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('dpkg -l | grep "package name"\napt list --installed|grep "package name"\n```；\n')])])])]),e._v(" "),n("li",[e._v("如果是以源码包自己编译安装的，例如.tar.gz或者tar.bz2形式的，这个只能看可执行文件是否存在了，如果是以root用户安装的，可执行程序通常都在/usr/local/sbin:/usr/bin目录下。")])])]),e._v(" "),n("li",[n("p",[e._v("安装后找不到命令，因为安装的位置不在系统path上，可以参考上面的“解压后使用”的方式中的，link或设置环境变量方式来搞；")])])]),e._v(" "),n("h3",{attrs:{id:"apt"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#apt"}},[e._v("#")]),e._v(" apt")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('apt vs apt-get\n更新repo：apt update\napt upgrade / apt full-upgrade\napt search "PKG"\napt list --installed | grep "PKG"\n\n')])])]),n("h3",{attrs:{id:"yum"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#yum"}},[e._v("#")]),e._v(" yum")]),e._v(" "),n("h4",{attrs:{id:"basics"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#basics"}},[e._v("#")]),e._v(" Basics")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("更新repo：yum clean all / yum repolist / yum check-update \nyum provides package-name / rpm -q --provides openssl\nyum list/search/info package-name\nyum update package-name\n# list dependency\nyum deplist package-name\nyum history\nyum history info 21\n\n// find references\nrpm -q --whatrequires openssl\n\n[root@liuyuelocal ~]# yum repolist\nLoaded plugins: fastestmirror, langpacks\nRepodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast\nDetermining fastest mirrors\n * base: mirror.newmediaexpress.com\n * epel: mirrors.aliyun.com\n * extras: mirror.newmediaexpress.com\n * updates: mirror.newmediaexpress.com\nrepo id                                                                                   repo name                                                                                                       status\n\n!base/7/x86_64                                                                            CentOS-7 - Base                                                                                                 10,097\n\n!docker-ce-stable/x86_64                                                                  Docker CE Stable - x86_64                                                                                           63\n\n!epel/x86_64                                                                              Extra Packages for Enterprise Linux 7 - x86_64                                                                  13,499\n\n!extras/7/x86_64                                                                          CentOS-7 - Extras                                                                                                  307\n\n!ius/x86_64                                                                               IUS for Enterprise Linux 7 - x86_64                                                                                714\n\n!updates/7/x86_64                                                                         CentOS-7 - Updates                                                                                                 997\n\nrepolist: 25,677\n\n\n#yum repolist\nLoaded plugins: product-id, search-disabled-repos, subscription-manager\nThis system is not registered with an entitlement server. You can use subscription-manager to register.\nrepo id                                                                              repo name                                                                                                            status\n\nnodesource/x86_64                                                                    Node.js Packages for Enterprise Linux 7 - x86_64                                                                         37\n\nrepolist: 55,117\n")])])]),n("p",[e._v("DNF, or Dandified Yum, which is the next major version of the Yum  package manager was introduced with Fedora 18. As of Fedora 22, it has  become the default package manager.")]),e._v(" "),n("p",[e._v("https://www.rootusers.com/how-to-install-dnf-package-manager-in-centosrhel/")]),e._v(" "),n("h4",{attrs:{id:"offical-repo"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#offical-repo"}},[e._v("#")]),e._v(" offical repo")]),e._v(" "),n("ul",[n("li",[e._v("Remi's RPM repository https://rpms.remirepo.net")])]),e._v(" "),n("h2",{attrs:{id:"服务管理-service-systemctl"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#服务管理-service-systemctl"}},[e._v("#")]),e._v(" 服务管理 service/systemctl")]),e._v(" "),n("h3",{attrs:{id:"system-v"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#system-v"}},[e._v("#")]),e._v(" System V")]),e._v(" "),n("p",[e._v("is the oldest init system, used in\nDebian 6 and earlier\nUbuntu 9.04 and earlier\nCentOS 5 and earlier\nIn System V, an init script is a shell script. They are also called rc (run command) scripts. The scripts are located under the "),n("strong",[e._v("/etc/init.d")]),e._v(" directory")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("To make a service restart after a crash or reboot, you can usually add a line like this to the init script:\nms:2345:respawn:/bin/sh /usr/bin/service_name\n\nTo enable/disable a System V service to start at system boot time, run this command:\nsudo chkconfig service_name on\nsudo chkconfig service_name off\nsudo service service_name status\n\nupdate-rc.d - install and remove System-V style init script links\nhttps://manpages.ubuntu.com/manpages/xenial/man8/update-rc.d.8.html\n  https://askubuntu.com/questions/72127/when-you-run-update-rc-d-myscript-default-what-is-called-on-startup-shutdown#:~:text=If%20defaults%20is%20used%20then,overridden%20if%20there%20are%20dependencies.\n")])])]),n("h3",{attrs:{id:"upstart"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#upstart"}},[e._v("#")]),e._v(" Upstart")]),e._v(" "),n("p",[e._v("came after System V and was used in\nUbuntu 9.10 to Ubuntu 14.10, including Ubuntu 14.04\nCentOS 6")]),e._v(" "),n("p",[e._v("To keep things simple, Upstart is backward-compatible with System V. The /etc/init.d/rc script still runs to manage native System V services. Its main difference is the way it allows multiple events to be associated with a service. This event-based architecture allowed Upstart to be a flexible service manager.\nAt startup, Upstart will run any System V init scripts normally. It will then look under the /etc/init directory and execute the shell commands in each service configuration file.\nThe files have a naming style of service_name.conf")]),e._v(" "),n("h3",{attrs:{id:"systemd"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#systemd"}},[e._v("#")]),e._v(" systemd")]),e._v(" "),n("p",[e._v("is the newest Linux service manager, used in\nDebian 7 and above\nUbuntu 15.04 and above\nCentOS 7 and above")]),e._v(" "),n("p",[e._v("systemd is backward-compatible with System V commands and initialization scripts. That means any System V service will also run under systemd.\nThe main difference between systemd and the other two init methods is that systemd is responsible for the initialization of service daemons and other types of resources like device operating system paths, mount points, sockets, etc. The naming style for a unit file is service_name.unit_type. So, you will see files like dbus.service, sshd.socket, or home.mount")]),e._v(" "),n("p",[e._v("main location:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("/lib/systemd/system/\n/etc/systemd/system\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('ls -l /etc/systemd/system/default.target\nsudo ls -l /etc/systemd/system/multi-user.target.wants/*.service\nsudo systemctl show --property "Requires" multi-user.target | fmt -10\nsudo systemctl show --property "Requires" basic.target | fmt -10\nsudo systemctl show --property "Wants" basic.target | fmt -10\n\nsudo vi /etc/systemd/system/multi-user.target.wants/xxx.service\n\n\nHow To Configure a Linux Service to Start Automatically After a Crash or Reboot https://www.digitalocean.com/community/tutorials/how-to-configure-a-linux-service-to-start-automatically-after-a-crash-or-reboot-part-2-reference\nsudo systemctl daemon-reload\nsudo systemctl restart mysqld.service\n')])])]),n("h3",{attrs:{id:"example-openvpn-on-kali-linux"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#example-openvpn-on-kali-linux"}},[e._v("#")]),e._v(" example -openvpn on kali linux")]),e._v(" "),n("p",[e._v("因为某国直接使用openvpn有问题，所以要开启scramble模式，因此我卸载了kali默认的openvpn，\n安装了scramble option")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("apt remove openvpn\nthen\nmake install the patched version\n")])])]),n("p",[e._v("结果无法用service/systemctl启动openvpn")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$service/systemctl start openvpn\nfailed to start .service unit is masked\n\nCheck that the unit file is a symlink to /dev/null:\n$file /etc/systemd/system/openvpn.service\n\n/lib/systemd/system/openvpn.service: symbolic link to /dev/null\n\n")])])]),n("p",[e._v("删除无效link后重启：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$sudo rm /lib/systemd/system/openvpn.service\n$sudo systemctl daemon-reload\n\n$service/systemctl start openvpn \n\n忘记尝试 sudo systemctl unmask openvpn.service\n")])])]),n("p",[e._v("但是这一次显示状态有点奇怪：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$service/systemctl status openvpn\nState active (exited) \n")])])]),n("p",[e._v("means that systemd has successfully run the commands but that it does not know there is a daemon to monitor.\nhttps://unix.stackexchange.com/questions/241970/what-does-status-active-exited-mean-for-a-systemd-service")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('$which open\n/usr/local/sbin/openvpn\n\n$sudo find / -name "openvpn.service"\n/run/systemd/generator.late/openvpn.service\n\n$/etc/init.d/openvpn still point to:\n/usr/sbin/openvpn\n\nconfiguration file for /etc/init.d/openvpn: /etc/default/openvpn  \n\n修改 /etc/init.d/openvpn指向 /usr/local/sbin/openvpn即可\n')])])]),n("p",[e._v("install /etc/init.d/script\nhttps://askubuntu.com/questions/335242/how-to-install-an-init-d-script")]),e._v(" "),n("h2",{attrs:{id:"基础服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基础服务"}},[e._v("#")]),e._v(" 基础服务")]),e._v(" "),n("h3",{attrs:{id:"网络"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#网络"}},[e._v("#")]),e._v(" 网络")]),e._v(" "),n("h4",{attrs:{id:"ubuntu"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu"}},[e._v("#")]),e._v(" Ubuntu")]),e._v(" "),n("p",[e._v("注意,对于Ubuntu 17.10 switched from ifupdown (which uses the /etc/network/interfaces file) to netplan,")]),e._v(" "),n("p",[e._v("所以新版本已经找不到 /etc/network/interfaces")]),e._v(" "),n("p",[e._v("netplan貌似只是个接口: https://netplan.io/examples/")]),e._v(" "),n("p",[e._v("具体的控制还是: NetworkManager 和 networkd, 其中desktop版本默认是 NetworkManager，而对于无UI的server版本只能用networkd\nhttps://askubuntu.com/questions/1031439/am-i-running-networkmanager-or-networkd")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("To configure netplan, save configuration files under /etc/netplan/ with a .yaml extension (e.g. /etc/netplan/config.yaml), then run sudo netplan apply. This command parses and applies the configuration to the system. Configuration written to disk under /etc/netplan/ will persist between reboots.\n\n---------------------------------------------------------\n对于NetworkManager:\n---------------------------------------------------------\nFirst any interfaces defined in /etc/network/interfaces are ignored by network-manager. (man 5 NetworkManager)\nsystemctl status network-manager\n\nvim /etc/netplan/01-network-manager-all.yaml\n# Let NetworkManager manage all devices on this system\nnetwork:\n  version: 2\n  renderer: NetworkManager       \n\nUI是使用NetworkManager,所以直接打开控制面板来设置静态IP和DNS即可\naddress 192.168.0.109\nnetmask 255.255.255.0\ngateway 192.168.0.1\nDNS: 8.8.8.8\n设置完等一会即可    \n\n---------------------------------------------------------\n对于Networkd：\n---------------------------------------------------------\nsystemd-networkd will only manage network addresses and routes for any link for which it finds a .network file with an appropriate [Match] section. (man 8 systemd-networkd).\nsystemctl status systemd-netword\n\nvim /etc/netplan/01-network-manager-all.yaml\nnetwork:\n    version: 2\n    renderer: networkd\n    ethernets:\n        enp3s0:\n            dhcp4: true\n\n")])])]),n("h4",{attrs:{id:"debain-based-kali"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#debain-based-kali"}},[e._v("#")]),e._v(" Debain based : Kali")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("--- for debain:\n配置静态ip\n/etc/network/interfaces：\n#auto eth0\n#iface eth0 inet dhcp\nauto eth0\niface eth0 inet static\naddress 192.168.0.109\nnetmask 255.255.255.0\ngateway 192.168.0.1\n\nsudo ifdown eth0\nsudo ifup eth0\nor\nsudo /etc/init.d/networking restart\n\n如果还是无法上网（上面172.17.5.36是某ISP提供的，貌似虚拟机无法用）：\n/etc/resolv.conf\nnameserver 8.8.8.8\n\nsudo systemctl restart systemd-resolved.service\n\n解决后看下当前路由情况：\nroute -n\n\n#Verify new IP settings:\nip a s eth0\n#Verify new routing settings:\nip r\n#Verify DNS servers settings:\ncat /etc/resolv.conf\n#Verify the internet connectivity:\nping -c 4 google.com\n\nroot@kali:/home/lyhistory# ip -4 addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    inet 192.168.0.109/24 brd 192.168.0.255 scope global eth0\n       valid_lft forever preferred_lft forever\n\nroot@kali:/home/lyhistory# ip route\ndefault via 192.168.0.1 dev eth0 onlink \n192.168.0.0/24 dev eth0 proto kernel scope link src 192.168.0.109 \n")])])]),n("h4",{attrs:{id:"centos"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#centos"}},[e._v("#")]),e._v(" Centos")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("--- for centos\nvim /etc/sysconfig/network-scripts/ifcfg-eth0\nHWADDR=00:08:A2:0A:BA:B8\nTYPE=Ethernet\n#BOOTPROTO=dhcp\nBOOTPROTO=none\t\n# Server IP #\nIPADDR=192.168.0.110\n# Subnet #\nPREFIX=24\n# Set default gateway IP #\nGATEWAY=192.168.0.1\n# Set dns servers #\nDNS1=8.8.8.8\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\n# Disable ipv6 #\nIPV6INIT=no\nNAME=eth0\n# This is system specific and can be created using 'uuidgen eth0' command #\nUUID=41171a6f-bce1-44de-8a6e-cf5e782f8bd6\nDEVICE=eth0\nONBOOT=yes\n\nsystemctl restart network\n\n\n")])])]),n("h4",{attrs:{id:"proxy"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#proxy"}},[e._v("#")]),e._v(" proxy")]),e._v(" "),n("p",[e._v("/etc/profile http_proxy")]),e._v(" "),n("h2",{attrs:{id:"troubleshooting"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#troubleshooting"}},[e._v("#")]),e._v(" Troubleshooting")]),e._v(" "),n("h3",{attrs:{id:"error-package-requires"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#error-package-requires"}},[e._v("#")]),e._v(" error: Package Requires")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('[lyhistory/opt]#nginx -v\nnginx version: nginx/1.12.1\n[lyhistory/opt]#yum localinstall nginx-1.20.1-1.el7.ngx.x86_64.rpm \nLoaded plugins: product-id, search-disabled-repos, subscription-manager\nThis system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.\nExamining nginx-1.20.1-1.el7.ngx.x86_64.rpm: 1:nginx-1.20.1-1.el7.ngx.x86_64\nMarking nginx-1.20.1-1.el7.ngx.x86_64.rpm as an update to 1:nginx-1.12.1-1.el7.ngx.x86_64\nResolving Dependencies\n--\x3e Running transaction check\n---\x3e Package nginx.x86_64 1:1.12.1-1.el7.ngx will be updated\n---\x3e Package nginx.x86_64 1:1.20.1-1.el7.ngx will be an update\n--\x3e Processing Dependency: libcrypto.so.10(OPENSSL_1.0.2)(64bit) for package: 1:nginx-1.20.1-1.el7.ngx.x86_64\n--\x3e Finished Dependency Resolution\nError: Package: 1:nginx-1.20.1-1.el7.ngx.x86_64 (/nginx-1.20.1-1.el7.ngx.x86_64)\n           Requires: libcrypto.so.10(OPENSSL_1.0.2)(64bit)\n You could try using --skip-broken to work around the problem\n** Found 2 pre-existing rpmdb problem(s), \'yum check\' output follows:\nredhat-access-insights-1.0.6-0.el7.noarch has missing requires of libcgroup\nredhat-access-insights-1.0.6-0.el7.noarch has missing requires of libcgroup-tools\n[lyhistory/opt]#cat /etc/os-release \nNAME="Red Hat Enterprise Linux Server"\nVERSION="7.2 (Maipo)"\nID="rhel"\nID_LIKE="fedora"\nVERSION_ID="7.2"\nPRETTY_NAME="Red Hat Enterprise Linux Server 7.2 (Maipo)"\nANSI_COLOR="0;31"\nCPE_NAME="cpe:/o:redhat:enterprise_linux:7.2:GA:server"\nHOME_URL="https://www.redhat.com/"\nBUG_REPORT_URL="https://bugzilla.redhat.com/"\n\nREDHAT_BUGZILLA_PRODUCT="Red Hat Enterprise Linux 7"\nREDHAT_BUGZILLA_PRODUCT_VERSION=7.2\nREDHAT_SUPPORT_PRODUCT="Red Hat Enterprise Linux"\nREDHAT_SUPPORT_PRODUCT_VERSION="7.2"\n\n\n[lyhistory/opt]#openssl version\nOpenSSL 1.0.1e-fips 11 Feb 2013\n\n[lyhistory/opt]#rpm -q --provides openssl\nopenssl = 1:1.0.1e-42.el7_1.9\nopenssl(x86-64) = 1:1.0.1e-42.el7_1.9\n[lyhistory/opt]#rpm -q --provides openssl-libs | grep libcrypto.so.10\nlibcrypto.so.10()(64bit)\nlibcrypto.so.10(OPENSSL_1.0.1)(64bit)\nlibcrypto.so.10(OPENSSL_1.0.1_EC)(64bit)\nlibcrypto.so.10(libcrypto.so.10)(64bit)\n\n\n[lyhistory/opt]#yum localinstall openssl-libs-1.0.2k-19.el7.x86_64.rpm \nLoaded plugins: product-id, search-disabled-repos, subscription-manager\nThis system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.\nExamining openssl-libs-1.0.2k-19.el7.x86_64.rpm: 1:openssl-libs-1.0.2k-19.el7.x86_64\nMarking openssl-libs-1.0.2k-19.el7.x86_64.rpm as an update to 1:openssl-libs-1.0.1e-42.el7_1.9.x86_64\nResolving Dependencies\n--\x3e Running transaction check\n---\x3e Package openssl-libs.x86_64 1:1.0.1e-42.el7_1.9 will be updated\n--\x3e Processing Dependency: openssl-libs(x86-64) = 1:1.0.1e-42.el7_1.9 for package: 1:openssl-devel-1.0.1e-42.el7_1.9.x86_64\n--\x3e Processing Dependency: openssl-libs(x86-64) = 1:1.0.1e-42.el7_1.9 for package: 1:openssl-1.0.1e-42.el7_1.9.x86_64\n---\x3e Package openssl-libs.x86_64 1:1.0.2k-19.el7 will be an update\n--\x3e Finished Dependency Resolution\nError: Package: 1:openssl-1.0.1e-42.el7_1.9.x86_64 (@anaconda/7.2)\n           Requires: openssl-libs(x86-64) = 1:1.0.1e-42.el7_1.9\n           Removing: 1:openssl-libs-1.0.1e-42.el7_1.9.x86_64 (@anaconda/7.2)\n               openssl-libs(x86-64) = 1:1.0.1e-42.el7_1.9\n           Updated By: 1:openssl-libs-1.0.2k-19.el7.x86_64 (/openssl-libs-1.0.2k-19.el7.x86_64)\n               openssl-libs(x86-64) = 1:1.0.2k-19.el7\nError: Package: 1:openssl-devel-1.0.1e-42.el7_1.9.x86_64 (@local-repo)\n           Requires: openssl-libs(x86-64) = 1:1.0.1e-42.el7_1.9\n           Removing: 1:openssl-libs-1.0.1e-42.el7_1.9.x86_64 (@anaconda/7.2)\n               openssl-libs(x86-64) = 1:1.0.1e-42.el7_1.9\n           Updated By: 1:openssl-libs-1.0.2k-19.el7.x86_64 (/openssl-libs-1.0.2k-19.el7.x86_64)\n               openssl-libs(x86-64) = 1:1.0.2k-19.el7\n You could try using --skip-broken to work around the problem\n** Found 2 pre-existing rpmdb problem(s), \'yum check\' output follows:\nredhat-access-insights-1.0.6-0.el7.noarch has missing requires of libcgroup\nredhat-access-insights-1.0.6-0.el7.noarch has missing requires of libcgroup-tools\n\n[lyhistory]#rpm -q --whatrequires openssl\nnginx-1.12.1-1.el7.ngx.x86_64\n\n\n\n')])])]),n("p",[e._v("尝试解决")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('[lyhistory]#yum remove openssl-libs.x86_64 / yum remove openssl-libs-1.0.1e-42.el7_1.9.x86_64\nLoaded plugins: product-id, search-disabled-repos, subscription-manager\nThis system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.\nResolving Dependencies\n--\x3e Running transaction check\n---\x3e Package openssl-libs.x86_64 1:1.0.1e-42.el7_1.9 will be erased\n....\n--\x3e Finished Dependency Resolution\nError: Trying to remove "systemd", which is protected\nError: Trying to remove "yum", which is protected\n')])])]),n("p",[e._v("失败！")]),e._v(" "),n("p",[e._v("最终解决")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("cd /etc/yum.repos.d/\nvi nginx.repo\n  [nginx]\n  name=nginx repo\n  baseurl=http://nginx.org/packages/centos/$releasever/$basearch/\n  gpgcheck=0\n  enabled=1\n                 \nyum clean all \nyum repolist \nyum update nginx \nrpm -qa | grep nginx \nnginx -v\n")])])]),n("p",[e._v("未尝试的另一种方案：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("yum swap -- remove openssl-libs-1.0.1e-42.el7_1.9.x86_64 -- install openssl-libs-1.0.2k-19.el7.x86_64.rpm \n")])])])])}),[],!1,null,null,null);s.default=a.exports}}]);