<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>web容器： | 计算机基础教程</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script async="true" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9742852210287449" crossorigin="anonymous"></script>
    <script>
			(function() { // DON'T EDIT BELOW THIS LINE
			
			})();
		 </script>
    <meta name="description" content="软件开发教程，白帽黑客入门教程，区块链入门教程，物联网，大数据">
    
    <link rel="preload" href="/docs/assets/css/0.styles.d4eb5ad8.css" as="style"><link rel="preload" href="/docs/assets/js/app.46adcabf.js" as="script"><link rel="preload" href="/docs/assets/js/2.37e66b58.js" as="script"><link rel="preload" href="/docs/assets/js/194.74341f62.js" as="script"><link rel="preload" href="/docs/assets/js/11.f6e7f18e.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.d81249de.js"><link rel="prefetch" href="/docs/assets/js/100.8b06fb79.js"><link rel="prefetch" href="/docs/assets/js/101.fcd42769.js"><link rel="prefetch" href="/docs/assets/js/102.3034f8f8.js"><link rel="prefetch" href="/docs/assets/js/103.e2e5ed72.js"><link rel="prefetch" href="/docs/assets/js/104.e89ac844.js"><link rel="prefetch" href="/docs/assets/js/105.449ed658.js"><link rel="prefetch" href="/docs/assets/js/106.eed851ce.js"><link rel="prefetch" href="/docs/assets/js/107.181136b4.js"><link rel="prefetch" href="/docs/assets/js/108.f481efb7.js"><link rel="prefetch" href="/docs/assets/js/109.a1e9631a.js"><link rel="prefetch" href="/docs/assets/js/110.224dbfd9.js"><link rel="prefetch" href="/docs/assets/js/111.c4135ab1.js"><link rel="prefetch" href="/docs/assets/js/112.24a68a88.js"><link rel="prefetch" href="/docs/assets/js/113.fe99fdb2.js"><link rel="prefetch" href="/docs/assets/js/114.4353af75.js"><link rel="prefetch" href="/docs/assets/js/115.08268ffd.js"><link rel="prefetch" href="/docs/assets/js/116.0448e052.js"><link rel="prefetch" href="/docs/assets/js/117.450dc34a.js"><link rel="prefetch" href="/docs/assets/js/118.d975f230.js"><link rel="prefetch" href="/docs/assets/js/119.dcbc9ce3.js"><link rel="prefetch" href="/docs/assets/js/12.26dc9b65.js"><link rel="prefetch" href="/docs/assets/js/120.2553a944.js"><link rel="prefetch" href="/docs/assets/js/121.b5c8977e.js"><link rel="prefetch" href="/docs/assets/js/122.99a3a311.js"><link rel="prefetch" href="/docs/assets/js/123.fd6a0502.js"><link rel="prefetch" href="/docs/assets/js/124.b9b5f7b4.js"><link rel="prefetch" href="/docs/assets/js/125.a4c19ec4.js"><link rel="prefetch" href="/docs/assets/js/126.071a3628.js"><link rel="prefetch" href="/docs/assets/js/127.b00b488f.js"><link rel="prefetch" href="/docs/assets/js/128.1f028359.js"><link rel="prefetch" href="/docs/assets/js/129.0a990012.js"><link rel="prefetch" href="/docs/assets/js/13.0aab70eb.js"><link rel="prefetch" href="/docs/assets/js/130.9fb09a46.js"><link rel="prefetch" href="/docs/assets/js/131.da9a712b.js"><link rel="prefetch" href="/docs/assets/js/132.b1ded7c1.js"><link rel="prefetch" href="/docs/assets/js/133.23457cc9.js"><link rel="prefetch" href="/docs/assets/js/134.590151ca.js"><link rel="prefetch" href="/docs/assets/js/135.f547776c.js"><link rel="prefetch" href="/docs/assets/js/136.89fcd9b3.js"><link rel="prefetch" href="/docs/assets/js/137.2b32fa83.js"><link rel="prefetch" href="/docs/assets/js/138.477226f5.js"><link rel="prefetch" href="/docs/assets/js/139.4ca6eacd.js"><link rel="prefetch" href="/docs/assets/js/14.10656445.js"><link rel="prefetch" href="/docs/assets/js/140.8e14fbb7.js"><link rel="prefetch" href="/docs/assets/js/141.9056c568.js"><link rel="prefetch" href="/docs/assets/js/142.97f84058.js"><link rel="prefetch" href="/docs/assets/js/143.5e5be8c0.js"><link rel="prefetch" href="/docs/assets/js/144.4e10fd09.js"><link rel="prefetch" href="/docs/assets/js/145.261436e2.js"><link rel="prefetch" href="/docs/assets/js/146.3f8274f4.js"><link rel="prefetch" href="/docs/assets/js/147.4b3cfc65.js"><link rel="prefetch" href="/docs/assets/js/148.ac995f0f.js"><link rel="prefetch" href="/docs/assets/js/149.198d8cc7.js"><link rel="prefetch" href="/docs/assets/js/15.3f619bf5.js"><link rel="prefetch" href="/docs/assets/js/150.d0e85230.js"><link rel="prefetch" href="/docs/assets/js/151.d5731da2.js"><link rel="prefetch" href="/docs/assets/js/152.635f19e1.js"><link rel="prefetch" href="/docs/assets/js/153.fb008088.js"><link rel="prefetch" href="/docs/assets/js/154.cc1e53eb.js"><link rel="prefetch" href="/docs/assets/js/155.dd6834d2.js"><link rel="prefetch" href="/docs/assets/js/156.9f64a5be.js"><link rel="prefetch" href="/docs/assets/js/157.929c5e97.js"><link rel="prefetch" href="/docs/assets/js/158.411d2f05.js"><link rel="prefetch" href="/docs/assets/js/159.2181f79c.js"><link rel="prefetch" href="/docs/assets/js/16.5357e470.js"><link rel="prefetch" href="/docs/assets/js/160.d73d1bdd.js"><link rel="prefetch" href="/docs/assets/js/161.d5d998dd.js"><link rel="prefetch" href="/docs/assets/js/162.70988bef.js"><link rel="prefetch" href="/docs/assets/js/163.8967841c.js"><link rel="prefetch" href="/docs/assets/js/164.57af73eb.js"><link rel="prefetch" href="/docs/assets/js/165.cd4ebe08.js"><link rel="prefetch" href="/docs/assets/js/166.6e015862.js"><link rel="prefetch" href="/docs/assets/js/167.a57b4c71.js"><link rel="prefetch" href="/docs/assets/js/168.8949d7e2.js"><link rel="prefetch" href="/docs/assets/js/169.4a8d6ca5.js"><link rel="prefetch" href="/docs/assets/js/17.c875350a.js"><link rel="prefetch" href="/docs/assets/js/170.d762ddcb.js"><link rel="prefetch" href="/docs/assets/js/171.d2138e78.js"><link rel="prefetch" href="/docs/assets/js/172.2956475b.js"><link rel="prefetch" href="/docs/assets/js/173.045d1d67.js"><link rel="prefetch" href="/docs/assets/js/174.ce6aa53c.js"><link rel="prefetch" href="/docs/assets/js/175.2cebc929.js"><link rel="prefetch" href="/docs/assets/js/176.30d11361.js"><link rel="prefetch" href="/docs/assets/js/177.1da36813.js"><link rel="prefetch" href="/docs/assets/js/178.768404d6.js"><link rel="prefetch" href="/docs/assets/js/179.508e547e.js"><link rel="prefetch" href="/docs/assets/js/18.1022bbc4.js"><link rel="prefetch" href="/docs/assets/js/180.14fc2a06.js"><link rel="prefetch" href="/docs/assets/js/181.0910e012.js"><link rel="prefetch" href="/docs/assets/js/182.ca552fbd.js"><link rel="prefetch" href="/docs/assets/js/183.c7f935a7.js"><link rel="prefetch" href="/docs/assets/js/184.a7990663.js"><link rel="prefetch" href="/docs/assets/js/185.a7ed0e82.js"><link rel="prefetch" href="/docs/assets/js/186.0a9d0f4e.js"><link rel="prefetch" href="/docs/assets/js/187.00b1be5f.js"><link rel="prefetch" href="/docs/assets/js/188.ac823b4a.js"><link rel="prefetch" href="/docs/assets/js/189.f086363a.js"><link rel="prefetch" href="/docs/assets/js/19.a80fda98.js"><link rel="prefetch" href="/docs/assets/js/190.91c68884.js"><link rel="prefetch" href="/docs/assets/js/191.6429825f.js"><link rel="prefetch" href="/docs/assets/js/192.1b126ccf.js"><link rel="prefetch" href="/docs/assets/js/193.b165223a.js"><link rel="prefetch" href="/docs/assets/js/195.48d428c1.js"><link rel="prefetch" href="/docs/assets/js/196.87a17f32.js"><link rel="prefetch" href="/docs/assets/js/197.3082b4b0.js"><link rel="prefetch" href="/docs/assets/js/198.02f69cc8.js"><link rel="prefetch" href="/docs/assets/js/199.d5ffcfc4.js"><link rel="prefetch" href="/docs/assets/js/20.c24504c1.js"><link rel="prefetch" href="/docs/assets/js/200.65c37f0d.js"><link rel="prefetch" href="/docs/assets/js/201.811b908f.js"><link rel="prefetch" href="/docs/assets/js/202.95d1ea6a.js"><link rel="prefetch" href="/docs/assets/js/203.c8cfd168.js"><link rel="prefetch" href="/docs/assets/js/204.18382fac.js"><link rel="prefetch" href="/docs/assets/js/205.4fffa7e7.js"><link rel="prefetch" href="/docs/assets/js/206.b6f02fe0.js"><link rel="prefetch" href="/docs/assets/js/207.f759eadb.js"><link rel="prefetch" href="/docs/assets/js/208.48a5e3e3.js"><link rel="prefetch" href="/docs/assets/js/21.f6d80f99.js"><link rel="prefetch" href="/docs/assets/js/22.47ec8bbc.js"><link rel="prefetch" href="/docs/assets/js/23.ef74f4d3.js"><link rel="prefetch" href="/docs/assets/js/24.79da3a81.js"><link rel="prefetch" href="/docs/assets/js/25.4b549354.js"><link rel="prefetch" href="/docs/assets/js/26.cb59b1f5.js"><link rel="prefetch" href="/docs/assets/js/27.f10e4ebf.js"><link rel="prefetch" href="/docs/assets/js/28.ed56511b.js"><link rel="prefetch" href="/docs/assets/js/29.6eeebd80.js"><link rel="prefetch" href="/docs/assets/js/3.f625c7b3.js"><link rel="prefetch" href="/docs/assets/js/30.a071c984.js"><link rel="prefetch" href="/docs/assets/js/31.42588eb9.js"><link rel="prefetch" href="/docs/assets/js/32.719a76b1.js"><link rel="prefetch" href="/docs/assets/js/33.2abb2d01.js"><link rel="prefetch" href="/docs/assets/js/34.739f1d84.js"><link rel="prefetch" href="/docs/assets/js/35.af768465.js"><link rel="prefetch" href="/docs/assets/js/36.b2773124.js"><link rel="prefetch" href="/docs/assets/js/37.0fef2607.js"><link rel="prefetch" href="/docs/assets/js/38.224358c4.js"><link rel="prefetch" href="/docs/assets/js/39.cf4055d1.js"><link rel="prefetch" href="/docs/assets/js/4.c39d8b88.js"><link rel="prefetch" href="/docs/assets/js/40.55643ea9.js"><link rel="prefetch" href="/docs/assets/js/41.b0d1e127.js"><link rel="prefetch" href="/docs/assets/js/42.3a80d957.js"><link rel="prefetch" href="/docs/assets/js/43.a2715259.js"><link rel="prefetch" href="/docs/assets/js/44.7c194d34.js"><link rel="prefetch" href="/docs/assets/js/45.28873998.js"><link rel="prefetch" href="/docs/assets/js/46.b3e635c9.js"><link rel="prefetch" href="/docs/assets/js/47.069e91ae.js"><link rel="prefetch" href="/docs/assets/js/48.6ea31014.js"><link rel="prefetch" href="/docs/assets/js/49.87fea4c5.js"><link rel="prefetch" href="/docs/assets/js/5.4ced06f7.js"><link rel="prefetch" href="/docs/assets/js/50.214fd00f.js"><link rel="prefetch" href="/docs/assets/js/51.21c64312.js"><link rel="prefetch" href="/docs/assets/js/52.4ddc62bc.js"><link rel="prefetch" href="/docs/assets/js/53.3bdab952.js"><link rel="prefetch" href="/docs/assets/js/54.74d23596.js"><link rel="prefetch" href="/docs/assets/js/55.7fdeaece.js"><link rel="prefetch" href="/docs/assets/js/56.b1f395f5.js"><link rel="prefetch" href="/docs/assets/js/57.67671b24.js"><link rel="prefetch" href="/docs/assets/js/58.e6804971.js"><link rel="prefetch" href="/docs/assets/js/59.ed412c39.js"><link rel="prefetch" href="/docs/assets/js/6.33b2724d.js"><link rel="prefetch" href="/docs/assets/js/60.f64e226b.js"><link rel="prefetch" href="/docs/assets/js/61.27a8f5a5.js"><link rel="prefetch" href="/docs/assets/js/62.711d2d63.js"><link rel="prefetch" href="/docs/assets/js/63.d6b00033.js"><link rel="prefetch" href="/docs/assets/js/64.cca53b0b.js"><link rel="prefetch" href="/docs/assets/js/65.731a831a.js"><link rel="prefetch" href="/docs/assets/js/66.19c81f04.js"><link rel="prefetch" href="/docs/assets/js/67.3534c7dd.js"><link rel="prefetch" href="/docs/assets/js/68.c65e6db6.js"><link rel="prefetch" href="/docs/assets/js/69.c92bf8ca.js"><link rel="prefetch" href="/docs/assets/js/7.dd805d38.js"><link rel="prefetch" href="/docs/assets/js/70.d2d97763.js"><link rel="prefetch" href="/docs/assets/js/71.b3e7b393.js"><link rel="prefetch" href="/docs/assets/js/72.2707e800.js"><link rel="prefetch" href="/docs/assets/js/73.46d81328.js"><link rel="prefetch" href="/docs/assets/js/74.66992af4.js"><link rel="prefetch" href="/docs/assets/js/75.b426a05e.js"><link rel="prefetch" href="/docs/assets/js/76.defadca7.js"><link rel="prefetch" href="/docs/assets/js/77.6d093c2a.js"><link rel="prefetch" href="/docs/assets/js/78.bb428491.js"><link rel="prefetch" href="/docs/assets/js/79.b6e62f10.js"><link rel="prefetch" href="/docs/assets/js/8.4fdc8c38.js"><link rel="prefetch" href="/docs/assets/js/80.942fc22e.js"><link rel="prefetch" href="/docs/assets/js/81.9bfbeb1a.js"><link rel="prefetch" href="/docs/assets/js/82.3db398ca.js"><link rel="prefetch" href="/docs/assets/js/83.e6162d07.js"><link rel="prefetch" href="/docs/assets/js/84.472cf90f.js"><link rel="prefetch" href="/docs/assets/js/85.fd468a49.js"><link rel="prefetch" href="/docs/assets/js/86.125b9e70.js"><link rel="prefetch" href="/docs/assets/js/87.eb1b1d5b.js"><link rel="prefetch" href="/docs/assets/js/88.f47c3e7e.js"><link rel="prefetch" href="/docs/assets/js/89.87bb4686.js"><link rel="prefetch" href="/docs/assets/js/9.c3849850.js"><link rel="prefetch" href="/docs/assets/js/90.02224a0d.js"><link rel="prefetch" href="/docs/assets/js/91.3cd4c430.js"><link rel="prefetch" href="/docs/assets/js/92.bacec9fc.js"><link rel="prefetch" href="/docs/assets/js/93.fbf98404.js"><link rel="prefetch" href="/docs/assets/js/94.b11f033e.js"><link rel="prefetch" href="/docs/assets/js/95.d9d3e783.js"><link rel="prefetch" href="/docs/assets/js/96.d648178b.js"><link rel="prefetch" href="/docs/assets/js/97.14811937.js"><link rel="prefetch" href="/docs/assets/js/98.c1773894.js"><link rel="prefetch" href="/docs/assets/js/99.f0c0ca07.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.d4eb5ad8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">计算机基础教程</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">
  机器指令
</a></div><div class="nav-item"><a href="/docs/software/" class="nav-link router-link-active">
  软件基础
</a></div><div class="nav-item"><a href="/docs/coder2hacker/" class="nav-link">
  白帽黑客
</a></div><div class="nav-item"><a href="/docs/blockchain/" class="nav-link">
  区块链
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">
  机器指令
</a></div><div class="nav-item"><a href="/docs/software/" class="nav-link router-link-active">
  软件基础
</a></div><div class="nav-item"><a href="/docs/coder2hacker/" class="nav-link">
  白帽黑客
</a></div><div class="nav-item"><a href="/docs/blockchain/" class="nav-link">
  区块链
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/software/" aria-current="page" class="sidebar-link">软件基础</a></li><li><a href="/docs/coder2hacker/" class="sidebar-link">黑客入门</a></li><li><a href="/docs/blockchain/" class="sidebar-link">区块链入门</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="web容器"><a href="#web容器" class="header-anchor">#</a> web容器：</h2> <p>tomcat</p> <p>apache</p> <p>iis</p> <p>nginx</p> <p>phpstudy</p> <h2 id="工具"><a href="#工具" class="header-anchor">#</a> 工具</h2> <p>chrome:
chrome://net-export/
https://netlog-viewer.appspot.com/#sockets
https://chromium.googlesource.com/chromium/src/+/HEAD/net/docs/crash-course-in-net-internals.md
https://zhuanlan.zhihu.com/p/266622278</p> <p>firefox:
web developer tool-&gt;performance-&gt;recording
https://firefox-source-docs.mozilla.org/networking/http/logging.html
about:networking#logging</p> <p>When Mozilla’s built-in logging capabilities aren’t good enough, and you need a full-fledged packet tracing tool, two free products are <a href="https://www.wireshark.org/" target="_blank" rel="noopener noreferrer">Wireshark<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://github.com/jpr5/ngrep/" target="_blank" rel="noopener noreferrer">ngrep<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="troubleshooting"><a href="#troubleshooting" class="header-anchor">#</a> Troubleshooting</h2> <h3 id="_301-auto-redirect"><a href="#_301-auto-redirect" class="header-anchor">#</a> 301 auto redirect</h3> <p>事件：dev.site.com 总是自动跳转到www.site.com</p> <p>初步整个服务器上grep -r -l &quot;www.site.com&quot; / 没有结果</p> <p>1.通过nslookup查看了cname，确定没有cname重定向</p> <p>2.查看了apache配置</p> <div class="language- extra-class"><pre class="language-text"><code>vim /etc/httpd/conf/httpd.conf 
vim /etc/httpd/conf.d/demo_http.conf 
vim /etc/httpd/conf.d/demo_https.conf
</code></pre></div><p>确定没有重定向，唯一的重定向是http里面有到https的重定向，不过测试的时候完全可以直接访问
https://dev.site.com 来排除http重定向的问题，依然自动跳转</p> <p>3.怀疑是代码问题，此站点使用的是WordPress代码，备份删除整站代码，创建 index.html: hello world，</p> <p>发现访问https://dev.site.com/index.html不跳转，访问https://dev.site.com依然跳转，</p> <p>刚开始我因此排除了是代码问题，其实301跳转有缓存，此时的跳转是</p> <p>后来才发现network里面这个301 Moved Permanently 是from disk cache！！！</p> <p>清理缓存后（或者浏览器开发者工具，直接勾选Disable cache更容易），再访问https://dev.site.com，发现response如下：</p> <div class="language- extra-class"><pre class="language-text"><code>
HTTP/1.1 301 Moved Permanently
Date: Thu, 28 Oct 2021 07:31:15 GMT
Server: Apache
X-Redirect-By: Polylang
Location: https://www.xxx.com/
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Content-Length: 0
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Content-Type: text/html; charset=UTF-8

</code></pre></div><p>注意到X-Redirect-By: Polylang，就是这个鬼，wordpress一个插件，最后查明原因是，dev的db配置成了生产的，所以估计这个polylang就使用了生产的域名！</p> <h3 id="wordpress-upload-failed-empty-response"><a href="#wordpress-upload-failed-empty-response" class="header-anchor">#</a> wordpress upload failed empty response</h3> <p>描述：</p> <p>wordpress media上传，<strong>开发环境</strong>没有问题，<strong>生产production</strong>上却失败，大小3m也不是很大，</p> <p>/wp-admin/async-upload.php</p> <h4 id="初步观察"><a href="#初步观察" class="header-anchor">#</a> 初步观察</h4> <h5 id="firefox下面"><a href="#firefox下面" class="header-anchor">#</a> firefox下面：</h5> <p>Queued: 21.50 s	Started: 1.60 m	inDownloaded: 2.88 min
Request Timing
Blocked:
1.25 min
DNS Resolution:
0 ms
Connecting:
64 ms
TLS Setup:
69 ms
Sending:
1.27 min
Waiting:
0 ms
Receiving:
0 ms</p> <p>可以发现Blocked时间很长（后面才知道是因为经过waf过滤才导致的）
https://developer.mozilla.org/en-US/docs/Tools/Network_Monitor/request_details#Timings
Blocked解释：
Time spent in a queue waiting for a network connection.</p> <p>The browser imposes a limit on the number of simultaneous connections that can be made to a single server. In Firefox this defaults to 6, but can be changed using the network.http.max-persistent-connections-per-server preference. If all connections are in use, the browser can't download more resources until a connection is released.</p> <p>http://kb.mozillazine.org/Network.http.max-persistent-connections-per-server</p> <p>http://kb.mozillazine.org/Editing_configuration</p> <p>修改（先不要随便修改）：访问 about:config 搜索 Network.http.max-persistent-connections-per-server</p> <h5 id="chrome"><a href="#chrome" class="header-anchor">#</a> chrome：</h5> <p>跟firefox稍有不同，
首先在status一列可以看到 (failed) net::ERR_EMPTY_RESPONSE 在network timing里面看到 stalled</p> <p>搜索这两个关键词无果：</p> <p>https://stackoverflow.com/questions/66036116/wordpress-err-empty-response-on-long-content</p> <p>https://stackoverflow.com/questions/27740692/request-stalled-for-a-long-time-occasionally-in-chrome</p> <p>注意力回到timing解释</p> <p>https://developer.chrome.com/docs/devtools/network/reference/#timing-explanation</p> <p>Queueing. The browser queues requests when:
There are higher priority requests.
There are already six TCP connections open for this origin, which is the limit. Applies to HTTP/1.0 and HTTP/1.1 only.
The browser is briefly allocating space in the disk cache
Stalled. The request could be stalled for any of the reasons described in Queueing.
这里也提到了6个TCP连接的限制</p> <p>Firefox和chrome都可以在network列名上右键添加 Protocol，从而确认确实是HTTP1.1，然后chrome还可以添加 connection id</p> <p>下面这个解释很有帮助</p> <blockquote><p><em>Note 2: If a TCP handshake was needed for a HTTP request, you'll see an orange bar in the DevTools waterfall and, if you hover over it, you'll see &quot;Initial connection&quot; - this tells you how long the handshake took in milliseconds. TCP connections may be reused across tabs and windows so watch out -- you might see an ID for the first time but it may not have a TCP handshake! This likely because you visited the page previously and opened a connection with that host. It may also be because Chrome prefetched a resource from the host -- Chrome prefetches a favicon for example when you type an address in the bar.</em></p> <p>https://stackoverflow.com/questions/34184994/chrome-developer-tools-connection-id</p></blockquote> <p>下面可以排除前面 https://stackoverflow.com/questions/27740692/request-stalled-for-a-long-time-occasionally-in-chrome</p> <p>提到的 <strong>persistent TCP connection</strong>的原因</p> <p>chrome://net-export/</p> <p>https://netlog-viewer.appspot.com/#import</p> <div class="language- extra-class"><pre class="language-text"><code>t=35069 [st=    0] +REQUEST_ALIVE  [dt=34115]
                    --&gt; priority = &quot;MEDIUM&quot;
                    --&gt; traffic_annotation = 101845102
                    --&gt; url = &quot;https://www.xxx.com/wp-admin/async-upload.php&quot;
t=35069 [st=    0]    DELEGATE_INFO  [dt=108]
                      --&gt; delegate_blocked_by = &quot;Opening Files&quot;
t=35177 [st=  108]    NETWORK_DELEGATE_BEFORE_URL_REQUEST  [dt=0]
t=35177 [st=  108]   +URL_REQUEST_START_JOB  [dt=34006]
                      --&gt; initiator = &quot;https://www.xxx.com&quot;
                      --&gt; load_flags = 2 (BYPASS_CACHE)
                      --&gt; method = &quot;POST&quot;
                      --&gt; network_isolation_key = &quot;https://xxx.com https://xxx.com&quot;
                      --&gt; privacy_mode = &quot;disabled&quot;
                      --&gt; request_type = &quot;other&quot;
                      --&gt; site_for_cookies = &quot;SiteForCookies: {site=https://xxx.com; schemefully_same=true}&quot;
                      --&gt; upload_id = &quot;0&quot;
                      --&gt; url = &quot;https://www.xxx.com/wp-admin/async-upload.php&quot;
t=35177 [st=  108]      COOKIE_INCLUSION_STATUS
                        --&gt; operation = &quot;send&quot;
                        --&gt; status = &quot;EXCLUDE_NOT_ON_PATH, DO_NOT_WARN&quot;
t=35177 [st=  108]      COOKIE_INCLUSION_STATUS
                        --&gt; operation = &quot;send&quot;
                        --&gt; status = &quot;EXCLUDE_DOMAIN_MISMATCH, DO_NOT_WARN&quot;
t=35177 [st=  108]      COOKIE_INCLUSION_STATUS
                        --&gt; operation = &quot;send&quot;
                        --&gt; status = &quot;EXCLUDE_DOMAIN_MISMATCH, DO_NOT_WARN&quot;
t=35177 [st=  108]      COOKIE_INCLUSION_STATUS
                        --&gt; operation = &quot;send&quot;
                        --&gt; status = &quot;EXCLUDE_DOMAIN_MISMATCH, DO_NOT_WARN&quot;
t=35177 [st=  108]      COOKIE_INCLUSION_STATUS
                        --&gt; operation = &quot;send&quot;
                        --&gt; status = &quot;INCLUDE, DO_NOT_WARN&quot;
t=35177 [st=  108]      COOKIE_INCLUSION_STATUS
                        --&gt; operation = &quot;send&quot;
                        --&gt; status = &quot;INCLUDE, DO_NOT_WARN&quot;
t=35177 [st=  108]      COOKIE_INCLUSION_STATUS
                        --&gt; operation = &quot;send&quot;
                        --&gt; status = &quot;INCLUDE, DO_NOT_WARN&quot;
t=35177 [st=  108]      COOKIE_INCLUSION_STATUS
                        --&gt; operation = &quot;send&quot;
                        --&gt; status = &quot;INCLUDE, DO_NOT_WARN&quot;
t=35177 [st=  108]      COOKIE_INCLUSION_STATUS
                        --&gt; operation = &quot;send&quot;
                        --&gt; status = &quot;INCLUDE, DO_NOT_WARN&quot;
t=35177 [st=  108]      COOKIE_INCLUSION_STATUS
                        --&gt; operation = &quot;send&quot;
                        --&gt; status = &quot;INCLUDE, DO_NOT_WARN&quot;
t=35177 [st=  108]      COOKIE_INCLUSION_STATUS
                        --&gt; operation = &quot;send&quot;
                        --&gt; status = &quot;INCLUDE, DO_NOT_WARN&quot;
t=35177 [st=  108]      COOKIE_INCLUSION_STATUS
                        --&gt; operation = &quot;send&quot;
                        --&gt; status = &quot;INCLUDE, DO_NOT_WARN&quot;
t=35177 [st=  108]      NETWORK_DELEGATE_BEFORE_START_TRANSACTION  [dt=0]
t=35177 [st=  108]      HTTP_CACHE_GET_BACKEND  [dt=0]
建立连接HTTP_STREAM_JOB_CONTROLLER和HTTP_STREAM_JOB
t=35177 [st=  108]     +HTTP_STREAM_REQUEST  [dt=3]
t=35177 [st=  108]        HTTP_STREAM_JOB_CONTROLLER_BOUND
                          --&gt; source_dependency = 1174836 (HTTP_STREAM_JOB_CONTROLLER)
t=35180 [st=  111]        HTTP_STREAM_REQUEST_BOUND_TO_JOB
                          --&gt; source_dependency = 1174837 (HTTP_STREAM_JOB)
t=35180 [st=  111]     -HTTP_STREAM_REQUEST
t=35181 [st=  112]      UPLOAD_DATA_STREAM_INIT  [dt=0]
                        --&gt; is_chunked = false
                        --&gt; net_error = 0 (?)
                        --&gt; total_size = 3505027
t=35181 [st=  112]     +HTTP_TRANSACTION_SEND_REQUEST  [dt=6769]
t=35181 [st=  112]        HTTP_TRANSACTION_SEND_REQUEST_HEADERS
                          --&gt; POST /wp-admin/async-upload.php HTTP/1.1
                              Host: www.xxx.com
                              Connection: keep-alive
                              Content-Length: 3505027
                              Pragma: no-cache
                              Cache-Control: no-cache
                              sec-ch-ua: &quot; Not A;Brand&quot;;v=&quot;99&quot;, &quot;Chromium&quot;;v=&quot;90&quot;, &quot;Google Chrome&quot;;v=&quot;90&quot;
                              sec-ch-ua-mobile: ?0
                              User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36
                              Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryZinpNBEkQJmJWpBq
                              Accept: */*
                              Origin: https://www.xxx.com
                              Sec-Fetch-Site: same-origin
                              Sec-Fetch-Mode: cors
                              Sec-Fetch-Dest: empty
                              Referer: https://www.xxx.com/wp-admin/upload.php
                              Accept-Encoding: gzip, deflate, br
                              Accept-Language: en-US,en;q=0.9
                              Cookie: [717 bytes were stripped]
t=35181 [st=  112]        HTTP_TRANSACTION_SEND_REQUEST_BODY
                          --&gt; did_merge = false
                          --&gt; is_chunked = false
                          --&gt; length = 3505027
开始上传                          
t=35181 [st=  112]        UPLOAD_DATA_STREAM_READ  [dt=0]
                          --&gt; current_position = 0
t=35182 [st=  113]        UPLOAD_DATA_STREAM_READ  [dt=0]
                          --&gt; current_position = 16384
..............
t=41949 [st= 6880]        UPLOAD_DATA_STREAM_READ  [dt=1]
                          --&gt; current_position = 3505027
上传失败 net_error = -100，但是注意此时current_position = 3505027===length = 3505027
耗时
t = 41950-35181=6769
st = 6881-112=6769
大概6秒
t=41950 [st= 6881]     -HTTP_TRANSACTION_SEND_REQUEST
t=41950 [st= 6881]     +HTTP_TRANSACTION_READ_HEADERS  [dt=10169]
t=41950 [st= 6881]        HTTP_STREAM_PARSER_READ_HEADERS  [dt=10168]
                          --&gt; net_error = -100 (ERR_CONNECTION_CLOSED)
t=52118 [st=17049]        HTTP_TRANSACTION_RESTART_AFTER_ERROR
                          --&gt; net_error = -100 (ERR_CONNECTION_CLOSED)
chrome发起重试                          
t=52119 [st=17050]     -HTTP_TRANSACTION_READ_HEADERS
t=52119 [st=17050]     +HTTP_STREAM_REQUEST  [dt=399]
建立连接HTTP_STREAM_JOB_CONTROLLER和HTTP_STREAM_JOB
t=52119 [st=17050]        HTTP_STREAM_JOB_CONTROLLER_BOUND
                          --&gt; source_dependency = 1174847 (HTTP_STREAM_JOB_CONTROLLER)
t=52518 [st=17449]        HTTP_STREAM_REQUEST_BOUND_TO_JOB
                          --&gt; source_dependency = 1174848 (HTTP_STREAM_JOB)
t=52518 [st=17449]     -HTTP_STREAM_REQUEST
t=52518 [st=17449]      UPLOAD_DATA_STREAM_INIT  [dt=0]
                        --&gt; is_chunked = false
                        --&gt; net_error = 0 (?)
                        --&gt; total_size = 3505027
t=52518 [st=17449]     +HTTP_TRANSACTION_SEND_REQUEST  [dt=6530]
t=52518 [st=17449]        HTTP_TRANSACTION_SEND_REQUEST_HEADERS
                          --&gt; POST /wp-admin/async-upload.php HTTP/1.1
                              Host: www.xxx.com
                              Connection: keep-alive
                              Content-Length: 3505027
                              Pragma: no-cache
                              Cache-Control: no-cache
                              sec-ch-ua: &quot; Not A;Brand&quot;;v=&quot;99&quot;, &quot;Chromium&quot;;v=&quot;90&quot;, &quot;Google Chrome&quot;;v=&quot;90&quot;
                              sec-ch-ua-mobile: ?0
                              User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36
                              Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryZinpNBEkQJmJWpBq
                              Accept: */*
                              Origin: https://www.xxx.com
                              Sec-Fetch-Site: same-origin
                              Sec-Fetch-Mode: cors
                              Sec-Fetch-Dest: empty
                              Referer: https://www.xxx.com/wp-admin/upload.php
                              Accept-Encoding: gzip, deflate, br
                              Accept-Language: en-US,en;q=0.9
                              Cookie: [717 bytes were stripped]
t=52518 [st=17449]        HTTP_TRANSACTION_SEND_REQUEST_BODY
                          --&gt; did_merge = false
                          --&gt; is_chunked = false
                          --&gt; length = 3505027
t=52518 [st=17449]        UPLOAD_DATA_STREAM_READ  [dt=0]
                          --&gt; current_position = 0
..............
又是上传完了但是另外一个错误 net_error = -324
t=59048 [st=23979]        UPLOAD_DATA_STREAM_READ  [dt=0]
                          --&gt; current_position = 3505027
t=59048 [st=23979]     -HTTP_TRANSACTION_SEND_REQUEST
t=59048 [st=23979]     +HTTP_TRANSACTION_READ_HEADERS  [dt=10135]
t=59048 [st=23979]        HTTP_STREAM_PARSER_READ_HEADERS  [dt=10135]
                          --&gt; net_error = -324 (ERR_EMPTY_RESPONSE)
t=69183 [st=34114]     -HTTP_TRANSACTION_READ_HEADERS
                        --&gt; net_error = -324 (ERR_EMPTY_RESPONSE)
t=69183 [st=34114]   -URL_REQUEST_START_JOB
                      --&gt; net_error = -324 (ERR_EMPTY_RESPONSE)
t=69183 [st=34114]    URL_REQUEST_DELEGATE_RESPONSE_STARTED  [dt=0]
t=69184 [st=34115] -REQUEST_ALIVE
                    --&gt; net_error = -324 (ERR_EMPTY_RESPONSE)
                    
看下：HTTP_STREAM_JOB_CONTROLLER和HTTP_STREAM_JOB     
初次是
t=35177 [st=  108]        HTTP_STREAM_JOB_CONTROLLER_BOUND
                          --&gt; source_dependency = 1174836 (HTTP_STREAM_JOB_CONTROLLER)
t=35180 [st=  111]        HTTP_STREAM_REQUEST_BOUND_TO_JOB
                          --&gt; source_dependency = 1174837 (HTTP_STREAM_JOB)
1174836：
1174836: HTTP_STREAM_JOB_CONTROLLER
https://www.xxx.com/wp-admin/async-upload.php
Start Time: 2021-11-29 17:25:53.321

t=35177 [st=0] +HTTP_STREAM_JOB_CONTROLLER  [dt=4]
                --&gt; is_preconnect = false
                --&gt; url = &quot;https://www.xxx.com/wp-admin/async-upload.php&quot;
t=35177 [st=0]    HTTP_STREAM_JOB_CONTROLLER_BOUND
                  --&gt; source_dependency = 1174835 (URL_REQUEST)
t=35177 [st=0]   +PROXY_RESOLUTION_SERVICE  [dt=3]
t=35178 [st=1]     +HOST_RESOLVER_IMPL_REQUEST  [dt=0]
                    --&gt; allow_cached_response = true
                    --&gt; dns_query_type = 1
                    --&gt; host = &quot;www.xxx.com:0&quot;
                    --&gt; is_speculative = false
                    --&gt; network_isolation_key = &quot;null null&quot;
t=35178 [st=1]        HOST_RESOLVER_IMPL_CACHE_HIT
                      --&gt; addresses = [&quot;18.140.49.179&quot;,&quot;203.205.159.22&quot;,&quot;150.109.90.80&quot;,&quot;54.254.71.41&quot;,&quot;54.254.112.6&quot;,&quot;13.251.21.164&quot;]
                      --&gt; expiration = &quot;13282651581632397&quot;
t=35178 [st=1]        HOST_RESOLVER_IMPL_CACHE_HIT
                      --&gt; addresses = [&quot;18.140.49.179&quot;,&quot;203.205.159.22&quot;,&quot;150.109.90.80&quot;,&quot;54.254.71.41&quot;,&quot;54.254.112.6&quot;,&quot;13.251.21.164&quot;]
                      --&gt; expiration = &quot;13282651581632397&quot;
t=35178 [st=1]     -HOST_RESOLVER_IMPL_REQUEST
t=35180 [st=3]      PROXY_RESOLUTION_SERVICE_RESOLVED_PROXY_LIST
                    --&gt; pac_string = &quot;PROXY 172.16.101.100:8080&quot;
t=35180 [st=3]   -PROXY_RESOLUTION_SERVICE
t=35180 [st=3]    HTTP_STREAM_JOB_CONTROLLER_PROXY_SERVER_RESOLVED
                  --&gt; proxy_server = &quot;PROXY 172.16.101.100:8080&quot;
t=35180 [st=3]    HTTP_STREAM_REQUEST_STARTED_JOB
                  --&gt; source_dependency = 1174837 (HTTP_STREAM_JOB)
t=35181 [st=4] -HTTP_STREAM_JOB_CONTROLLER

1174837: HTTP_STREAM_JOB
https://www.xxx.com/
Start Time: 2021-11-29 17:25:53.324

t=35180 [st=0] +HTTP_STREAM_JOB  [dt=0]
                --&gt; expect_spdy = false
                --&gt; original_url = &quot;https://www.xxx.com/&quot;
                --&gt; priority = &quot;MEDIUM&quot;
                --&gt; source_dependency = 1174836 (HTTP_STREAM_JOB_CONTROLLER)
                --&gt; url = &quot;https://www.xxx.com/&quot;
                --&gt; using_quic = false
t=35180 [st=0]    HTTP_STREAM_JOB_WAITING  [dt=0]
                  --&gt; should_wait = false
t=35180 [st=0]   +HTTP_STREAM_JOB_INIT_CONNECTION  [dt=0]
t=35180 [st=0]      TCP_CLIENT_SOCKET_POOL_REQUESTED_SOCKET
                    --&gt; group_id = &quot;ssl/www.xxx.com:443&quot;
t=35180 [st=0]     +SOCKET_POOL  [dt=0]
t=35180 [st=0]        SOCKET_POOL_REUSED_AN_EXISTING_SOCKET	#重用persistent TCP connection，所以就排除了最初查到的原因
                      --&gt; idle_ms = 30348
t=35180 [st=0]        SOCKET_POOL_BOUND_TO_SOCKET
                      --&gt; source_dependency = 1174753 (SOCKET)	#注意这里的SOCKET 1174753就是对应的前面说的connectionID
t=35180 [st=0]     -SOCKET_POOL
t=35180 [st=0]   -HTTP_STREAM_JOB_INIT_CONNECTION
t=35180 [st=0]    HTTP_STREAM_REQUEST_PROTO
                  --&gt; proto = &quot;http/1.1&quot;
t=35180 [st=0]    HTTP_STREAM_JOB_BOUND_TO_REQUEST
                  --&gt; source_dependency = 1174835 (URL_REQUEST)
t=35180 [st=0] -HTTP_STREAM_JO
                          
</code></pre></div><p>对比，正常的上传</p> <div class="language- extra-class"><pre class="language-text"><code>1208145: URL_REQUEST
https://xxxx.com/wp-admin/async-upload.php
Start Time: 2021-11-30 14:27:56.488

t=5339 [st=   0] +REQUEST_ALIVE  [dt=1320]
                  --&gt; priority = &quot;MEDIUM&quot;
                  --&gt; traffic_annotation = 101845102
                  --&gt; url = &quot;https://xxxx.com/wp-admin/async-upload.php&quot;
t=5339 [st=   0]    DELEGATE_INFO  [dt=140]
                    --&gt; delegate_blocked_by = &quot;Opening Files&quot;
t=5479 [st= 140]    NETWORK_DELEGATE_BEFORE_URL_REQUEST  [dt=0]
t=5479 [st= 140]   +URL_REQUEST_START_JOB  [dt=1179]
                    --&gt; initiator = &quot;https://www.xxx.com&quot;
                    --&gt; load_flags = 2 (BYPASS_CACHE)
                    --&gt; method = &quot;POST&quot;
                    --&gt; network_isolation_key = &quot;https://xxx.com https://xxx.com&quot;
                    --&gt; privacy_mode = &quot;disabled&quot;
                    --&gt; request_type = &quot;other&quot;
                    --&gt; site_for_cookies = &quot;SiteForCookies: {site=https://xxx.com; schemefully_same=true}&quot;
                    --&gt; upload_id = &quot;0&quot;
                    --&gt; url = &quot;https://www.xxx.com/wp-admin/async-upload.php&quot;
t=5479 [st= 140]      COOKIE_INCLUSION_STATUS
                      --&gt; operation = &quot;send&quot;
                      --&gt; status = &quot;EXCLUDE_NOT_ON_PATH, DO_NOT_WARN&quot;
t=5479 [st= 140]      COOKIE_INCLUSION_STATUS
                      --&gt; operation = &quot;send&quot;
                      --&gt; status = &quot;EXCLUDE_DOMAIN_MISMATCH, DO_NOT_WARN&quot;
t=5479 [st= 140]      COOKIE_INCLUSION_STATUS
                      --&gt; operation = &quot;send&quot;
                      --&gt; status = &quot;EXCLUDE_DOMAIN_MISMATCH, DO_NOT_WARN&quot;
t=5479 [st= 140]      COOKIE_INCLUSION_STATUS
                      --&gt; operation = &quot;send&quot;
                      --&gt; status = &quot;EXCLUDE_DOMAIN_MISMATCH, DO_NOT_WARN&quot;
t=5479 [st= 140]      COOKIE_INCLUSION_STATUS
                      --&gt; operation = &quot;send&quot;
                      --&gt; status = &quot;INCLUDE, DO_NOT_WARN&quot;
t=5479 [st= 140]      COOKIE_INCLUSION_STATUS
                      --&gt; operation = &quot;send&quot;
                      --&gt; status = &quot;INCLUDE, DO_NOT_WARN&quot;
t=5479 [st= 140]      COOKIE_INCLUSION_STATUS
                      --&gt; operation = &quot;send&quot;
                      --&gt; status = &quot;INCLUDE, DO_NOT_WARN&quot;
t=5479 [st= 140]      COOKIE_INCLUSION_STATUS
                      --&gt; operation = &quot;send&quot;
                      --&gt; status = &quot;INCLUDE, DO_NOT_WARN&quot;
t=5479 [st= 140]      COOKIE_INCLUSION_STATUS
                      --&gt; operation = &quot;send&quot;
                      --&gt; status = &quot;INCLUDE, DO_NOT_WARN&quot;
t=5479 [st= 140]      COOKIE_INCLUSION_STATUS
                      --&gt; operation = &quot;send&quot;
                      --&gt; status = &quot;INCLUDE, DO_NOT_WARN&quot;
t=5479 [st= 140]      COOKIE_INCLUSION_STATUS
                      --&gt; operation = &quot;send&quot;
                      --&gt; status = &quot;INCLUDE, DO_NOT_WARN&quot;
t=5479 [st= 140]      COOKIE_INCLUSION_STATUS
                      --&gt; operation = &quot;send&quot;
                      --&gt; status = &quot;INCLUDE, DO_NOT_WARN&quot;
t=5479 [st= 140]      NETWORK_DELEGATE_BEFORE_START_TRANSACTION  [dt=0]
t=5479 [st= 140]      HTTP_CACHE_GET_BACKEND  [dt=0]
t=5479 [st= 140]     +HTTP_STREAM_REQUEST  [dt=3]
t=5479 [st= 140]        HTTP_STREAM_JOB_CONTROLLER_BOUND
                        --&gt; source_dependency = 1208146 (HTTP_STREAM_JOB_CONTROLLER)
t=5482 [st= 143]        HTTP_STREAM_REQUEST_BOUND_TO_JOB
                        --&gt; source_dependency = 1208147 (HTTP_STREAM_JOB)
t=5482 [st= 143]     -HTTP_STREAM_REQUEST
t=5482 [st= 143]      UPLOAD_DATA_STREAM_INIT  [dt=0]
                      --&gt; is_chunked = false
                      --&gt; net_error = 0 (?)
                      --&gt; total_size = 4792
t=5482 [st= 143]     +HTTP_TRANSACTION_SEND_REQUEST  [dt=1]
t=5482 [st= 143]        HTTP_TRANSACTION_SEND_REQUEST_HEADERS
                        --&gt; POST /wp-admin/async-upload.php HTTP/1.1
                            Host: www.xxx.com
                            Connection: keep-alive
                            Content-Length: 4792
                            Pragma: no-cache
                            Cache-Control: no-cache
                            sec-ch-ua: &quot; Not A;Brand&quot;;v=&quot;99&quot;, &quot;Chromium&quot;;v=&quot;90&quot;, &quot;Google Chrome&quot;;v=&quot;90&quot;
                            sec-ch-ua-mobile: ?0
                            User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36
                            Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryHCDeoH2gO9wCcNFe
                            Accept: */*
                            Origin: https://www.xxx.com
                            Sec-Fetch-Site: same-origin
                            Sec-Fetch-Mode: cors
                            Sec-Fetch-Dest: empty
                            Referer: https://www.xxx.com/wp-admin/upload.php
                            Accept-Encoding: gzip, deflate, br
                            Accept-Language: en-US,en;q=0.9
                            Cookie: [717 bytes were stripped]
t=5483 [st= 144]        HTTP_TRANSACTION_SEND_REQUEST_BODY
                        --&gt; did_merge = false
                        --&gt; is_chunked = false
                        --&gt; length = 4792
t=5483 [st= 144]        UPLOAD_DATA_STREAM_READ  [dt=0]
                        --&gt; current_position = 0
t=5483 [st= 144]        UPLOAD_DATA_STREAM_READ  [dt=0]
                        --&gt; current_position = 4792
t=5483 [st= 144]     -HTTP_TRANSACTION_SEND_REQUEST
t=5483 [st= 144]     +HTTP_TRANSACTION_READ_HEADERS  [dt=1175]
t=5483 [st= 144]        HTTP_STREAM_PARSER_READ_HEADERS  [dt=1175]
t=6658 [st=1319]        HTTP_TRANSACTION_READ_RESPONSE_HEADERS
                        --&gt; HTTP/1.1 200 OK
                            Server: nginx
                            Date: Tue, 30 Nov 2021 06:27:57 GMT
                            Content-Type: text/plain; charset=UTF-8
                            Expires: Wed, 11 Jan 1984 05:00:00 GMT
                            X-Frame-Options: SAMEORIGIN
                            Referrer-Policy: strict-origin-when-cross-origin
                            X-Content-Type-Options: nosniff
                            X-WP-Upload-Attachment-ID: 3447
                            X-XSS-Protection: 1; mode=block
                            Strict-Transport-Security: max-age=31536000; includeSubDomains;
                            X-Cache-Lookup: Cache Miss
                            Content-Encoding: gzip
                            Cache-Control: must-revalidate, no-cache, max-age=0
                            Transfer-Encoding: chunked
                            X-NWS-LOG-UUID: 7691670333191889
                            Connection: keep-alive
                            X-Cache-Lookup: Cache Miss
t=6658 [st=1319]     -HTTP_TRANSACTION_READ_HEADERS
t=6658 [st=1319]      NETWORK_DELEGATE_HEADERS_RECEIVED  [dt=0]
t=6658 [st=1319]      URL_REQUEST_FILTERS_SET
                      --&gt; filters = &quot;GZIP&quot;
t=6658 [st=1319]   -URL_REQUEST_START_JOB
t=6658 [st=1319]    URL_REQUEST_DELEGATE_RESPONSE_STARTED  [dt=0]
t=6658 [st=1319]    HTTP_TRANSACTION_READ_BODY  [dt=0]
t=6658 [st=1319]    URL_REQUEST_JOB_BYTES_READ
                    --&gt; byte_count = 845
t=6658 [st=1319]    URL_REQUEST_JOB_FILTERED_BYTES_READ
                    --&gt; byte_count = 1868
t=6659 [st=1320]    HTTP_TRANSACTION_READ_BODY  [dt=0]
t=6659 [st=1320] -REQUEST_ALIVE
</code></pre></div><p>问题的核心在于为什么明明已经上传完成（current_position = 3505027===length = 3505027），但是</p> <p>HTTP_STREAM_PARSER_READ_HEADERS net_error = -100 (ERR_CONNECTION_CLOSED)</p> <p>为什么服务端会关掉？</p> <p>想起来再抓一下dev环境的netlog，发现dev上速度确实快一点，</p> <p>测试了  vim /etc/httpd/conf/httpd.conf	Timeout 以及 vim /etc/opt/rh/rh-php72/php.ini max_execution_time，把这些时间放到3秒都没有问题，前面测试3M文件上传大概6到10秒</p> <p>并且检查了 /.htaccess 都没有问题</p> <p>再查查其他timeout： 搜索apache httpd http connection closed timeout</p> <p>https://httpd.apache.org/docs/2.4/mod/core.html</p> <p>https://www.oreilly.com/library/view/http-the-definitive/1565925092/ch04s07.html</p> <p>换个关键词吧，毕竟是大文件引起的，测试小图标确实上传没问题，搜索 large file ERR_CONNECTION_CLOSED</p> <p>https://stackoverflow.com/questions/53736912/neterr-connection-reset-when-large-file-takes-longer-than-a-minute</p> <p>但是这个答案总感觉有点不太对</p> <div class="language-php extra-class"><pre class="language-php"><code>RequestReadTimeout header<span class="token operator">=</span><span class="token number">20</span><span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">,</span> MinRate<span class="token operator">=</span><span class="token number">500</span> body<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> MinRate<span class="token operator">=</span><span class="token number">500</span>
https<span class="token punctuation">:</span><span class="token comment">//httpd.apache.org/docs/current/mod/mod_reqtimeout.html</span>
</code></pre></div><p>然后看到另外一个人的回答是因为 ProxyTimeout，回到netlog-viewer：</p> <p>https://netlog-viewer.appspot.com/#sockets</p> <table><thead><tr><th>Name</th> <th>Handed Out</th> <th>Idle</th> <th>Connecting</th> <th>Max</th> <th>Max Per Group</th> <th>Generation</th></tr></thead> <tbody><tr><td>direct:// (transport_socket_pool)</td> <td>0</td> <td><a href="https://netlog-viewer.appspot.com/#events&amp;q=id:1208669,1208667,1208111,1208329" target="_blank" rel="noopener noreferrer">4<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>0</td> <td>256</td> <td>6</td> <td>undefined</td></tr> <tr><td>172.16.101.100:8080 (http_proxy_socket_pool)</td> <td>1</td> <td><a href="https://netlog-viewer.appspot.com/#events&amp;q=id:1203134,1205602,1208691" target="_blank" rel="noopener noreferrer">3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>0</td> <td>32</td> <td>6</td> <td>undefined</td></tr> <tr><td>127.0.0.1:8888 (http_proxy_socket_pool)</td> <td>0</td> <td>0</td> <td>0</td> <td>32</td> <td>6</td> <td>undefined</td></tr></tbody></table> <table><thead><tr><th>direct:// (transport_socket_pool)</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th></tr></thead> <tbody><tr><td>Name</td> <td>Pending</td> <td>Top Priority</td> <td>Active</td> <td>Idle</td> <td>Connect Jobs</td> <td>Backup Timer</td> <td>Stalled</td></tr> <tr><td>ssl/dev.xxx.com:443</td> <td>0</td> <td>-</td> <td>0</td> <td><a href="https://netlog-viewer.appspot.com/#events&amp;q=id:1208669,1208667" target="_blank" rel="noopener noreferrer">2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>0</td> <td>stopped</td> <td>false</td></tr> <tr><td>ssl/hrs.asiapacificex.com:443</td> <td>0</td> <td>-</td> <td>0</td> <td><a href="https://netlog-viewer.appspot.com/#events&amp;q=id:1208111,1208329" target="_blank" rel="noopener noreferrer">2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>0</td> <td>stopped</td> <td>false</td></tr></tbody></table> <table><thead><tr><th>172.16.101.100:8080 (http_proxy_socket_pool)</th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th> <th></th></tr></thead> <tbody><tr><td>Name</td> <td>Pending</td> <td>Top Priority</td> <td>Active</td> <td>Idle</td> <td>Connect Jobs</td> <td>Backup Timer</td> <td>Stalled</td></tr> <tr><td>pm/ssl/sdk.split.io:443</td> <td>0</td> <td>-</td> <td>0</td> <td><a href="https://netlog-viewer.appspot.com/#events&amp;q=id:1203134" target="_blank" rel="noopener noreferrer">1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>0</td> <td>stopped</td> <td>false</td></tr> <tr><td>ssl/d27xxe7juh1us6.cloudfront.net:443</td> <td>0</td> <td>-</td> <td>0</td> <td><a href="https://netlog-viewer.appspot.com/#events&amp;q=id:1205602" target="_blank" rel="noopener noreferrer">1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>0</td> <td>stopped</td> <td>false</td></tr> <tr><td>ssl/www.xxx.com:443</td> <td>0</td> <td>-</td> <td>0</td> <td><a href="https://netlog-viewer.appspot.com/#events&amp;q=id:1208691" target="_blank" rel="noopener noreferrer">1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>0</td> <td>stopped</td> <td>false</td></tr> <tr><td>ssl/www.google.com:443</td> <td>0</td> <td>-</td> <td>1</td> <td>0</td> <td>0</td> <td>stopped</td> <td>false</td></tr></tbody></table> <p>可以看到，dev.xxx.com是直接访问的，而www.xxx.com是通过proxy，所以是不是因为这个proxy的原因</p> <h4 id="问题梳理"><a href="#问题梳理" class="header-anchor">#</a> 问题梳理</h4> <p>首先，chrome使用了机器本身设定的proxy，我是公司电脑，连vpn访问网站会经过默认的proxy server，就是前面的172.16.101.100，</p> <p>firefox可以设定proxy，然后想起来最初使用firefox测试的时候，设置的是no-proxy，</p> <p>经过一番查找，firefox貌似没有类似chrome的net log viewer，只有个</p> <p>https://firefox-source-docs.mozilla.org/networking/http/logging.html
about:networking#logging</p> <p>然后发现web developer tool下面有个performance capture，用了下，发现</p> <div class="language- extra-class"><pre class="language-text"><code>Status:
Response received
URL:
https://www.xxx.com/wp-admin/async-upload.php
Priority:
Normal(0)
Thread:
Web Content (3/9)
URL:
https://www.xxx.com/wp-admin/upload.php (id: 42949673009)
Waiting for socket thread:
42,476ms
DNS request:
0.27ms
After DNS request:
1.2ms
TCP connection:
22,389ms
After TCP connection:
13ms
Establishing TLS session:
311ms
Waiting for HTTP request:
1,549ms
HTTP request and waiting for response:
14,964ms
HTTP response:
15,294ms
Waiting to transmit the response:
32ms
</code></pre></div><p>Response received显然是不对的，不过下面Waiting for socket thread:42,476ms和TCP connection:22,389ms加起来都超过一分钟了，在about:networking#dns可以看到www.xxx.com解析到了一堆ip，经过询问infra，同事说是waf public ip，所以原来是waf导致了tcp connection超时，</p> <p>怪不得跟chrome的时间有点不同，chrome至少可以看到在重用reuse tcp socket connection的时候是很快的，那么就自然要确认下，重新设置firefox auto detect proxy，即使用跟chrome一样的机器的proxy，结果如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Status:
Response received
URL:
https://www.xxx.com/wp-admin/async-upload.php
Priority:
Normal(0)
Thread:
Web Content (1/8)
URL:
https://www.xxx.com/wp-admin/upload.php (id: 42949673012)
Waiting for socket thread:
44ms
HTTP request and waiting for response:
13,371ms
HTTP response:
15,701ms
Waiting to transmit the response:
4.3ms
</code></pre></div><p>先走了proxy，等待socket时间变短了，可能是reuse也不用重新建立tcp连接握手了，不过等待http reponse的时间很长，估计超时了（超过proxy服务器的timeout时长），至少这次跟chrome表现一样了；</p> <p>最后自然是重新设置no-proxy，绕过proxy然后绕过waf（设置hosts直接指向web服务器的ip），果然上传成功！</p> <div class="language- extra-class"><pre class="language-text"><code>Status:
Response received
URL:
https://www.xxx.com/wp-admin/async-upload.php
Priority:
Normal(0)
MIME type:
text/plain
Requested bytes:
2,259B
Thread:
Web Content (1/8)
URL:
https://www.xxx.com/wp-admin/upload.php (id: 42949673015)
Waiting for socket thread:
98ms
DNS request:
0.29ms
After DNS request:
1.3ms
TCP connection:
121ms
After TCP connection:
3.5ms
Establishing TLS session:
114ms
Waiting for HTTP request:
21ms
HTTP request and waiting for response:
18,930ms
HTTP response:
0.67ms
Waiting to transmit the response:
4.1ms
</code></pre></div><p>https://stackoverflow.com/questions/27740692/request-stalled-for-a-long-time-occasionally-in-chrome/70180892#70180892</p> <p>https://stackoverflow.com/questions/53736912/neterr-connection-reset-when-large-file-takes-longer-than-a-minute/70180666#70180666</p> <h3 id="websocket-connection-issue"><a href="#websocket-connection-issue" class="header-anchor">#</a> websocket connection issue</h3> <p>这次遇到的问题：</p> <p>firefox访问没有问题（浏览器连接服务器的nginx并转发到websocket端口），本地vscode debug（连接本地nginx，nginx转发到服务器上的websocket服务端）</p> <p>原因跟上面wordpress large file upload failed一样都是因为公司机器chrome使用了proxy</p> <p>通常websocket连接不成功大概率是client端或者服务端的问题，所以刚开始浪费了不少时间查看服务端的情况以及websocket client端代码，其实可以直接在dev tools里面执行代码片段进行调试</p> <div class="language- extra-class"><pre class="language-text"><code>// Create WebSocket connection.
const socket = new WebSocket('ws://localhost:8080');

// Connection opened
socket.addEventListener('open', function (event) {
    socket.send('Hello Server!');
});

// Listen for messages
socket.addEventListener('message', function (event) {
    console.log('Message from server ', event.data);
});

</code></pre></div><p>观察到，chrome下偶尔成功，多数时间失败，上chrome终极大杀器 netlog viewer，发现跟前面一样的原因；</p> <p>后来才有人反馈firefox可以，才意识到firefox默认proxy设置成了blank，chrome不使用插件的情况下默认是系统的proxy</p> <div id="disqus_thread"></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.46adcabf.js" defer></script><script src="/docs/assets/js/2.37e66b58.js" defer></script><script src="/docs/assets/js/194.74341f62.js" defer></script><script src="/docs/assets/js/11.f6e7f18e.js" defer></script>
  </body>
</html>
