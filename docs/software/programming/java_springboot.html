<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>计算机基础教程</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script async="true" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9742852210287449" crossorigin="anonymous"></script>
    <script>
			(function() { // DON'T EDIT BELOW THIS LINE
			
			})();
		 </script>
    <meta name="description" content="软件开发教程，白帽黑客入门教程，区块链入门教程，物联网，大数据">
    
    <link rel="preload" href="/docs/assets/css/0.styles.d4eb5ad8.css" as="style"><link rel="preload" href="/docs/assets/js/app.49883baf.js" as="script"><link rel="preload" href="/docs/assets/js/2.19baf9f4.js" as="script"><link rel="preload" href="/docs/assets/js/207.8a47ec1d.js" as="script"><link rel="preload" href="/docs/assets/js/11.0d0890d4.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.f3208242.js"><link rel="prefetch" href="/docs/assets/js/100.34b34801.js"><link rel="prefetch" href="/docs/assets/js/101.af7f2f54.js"><link rel="prefetch" href="/docs/assets/js/102.bd6cefa0.js"><link rel="prefetch" href="/docs/assets/js/103.a39dc53e.js"><link rel="prefetch" href="/docs/assets/js/104.76c80b92.js"><link rel="prefetch" href="/docs/assets/js/105.8ee5d42e.js"><link rel="prefetch" href="/docs/assets/js/106.ccd83102.js"><link rel="prefetch" href="/docs/assets/js/107.c1a74c34.js"><link rel="prefetch" href="/docs/assets/js/108.44cccac8.js"><link rel="prefetch" href="/docs/assets/js/109.31226ba2.js"><link rel="prefetch" href="/docs/assets/js/110.488bfb56.js"><link rel="prefetch" href="/docs/assets/js/111.17f61722.js"><link rel="prefetch" href="/docs/assets/js/112.7a5f4175.js"><link rel="prefetch" href="/docs/assets/js/113.556965a4.js"><link rel="prefetch" href="/docs/assets/js/114.09428b63.js"><link rel="prefetch" href="/docs/assets/js/115.1d0138b3.js"><link rel="prefetch" href="/docs/assets/js/116.ef39551d.js"><link rel="prefetch" href="/docs/assets/js/117.5a16702b.js"><link rel="prefetch" href="/docs/assets/js/118.2a8e5ec6.js"><link rel="prefetch" href="/docs/assets/js/119.3437c19b.js"><link rel="prefetch" href="/docs/assets/js/12.eec9a325.js"><link rel="prefetch" href="/docs/assets/js/120.db539d71.js"><link rel="prefetch" href="/docs/assets/js/121.4111e132.js"><link rel="prefetch" href="/docs/assets/js/122.13196a62.js"><link rel="prefetch" href="/docs/assets/js/123.a6605530.js"><link rel="prefetch" href="/docs/assets/js/124.939b025e.js"><link rel="prefetch" href="/docs/assets/js/125.6c1ca36f.js"><link rel="prefetch" href="/docs/assets/js/126.99bda05a.js"><link rel="prefetch" href="/docs/assets/js/127.04ef74ad.js"><link rel="prefetch" href="/docs/assets/js/128.6d16ddf7.js"><link rel="prefetch" href="/docs/assets/js/129.2184f3f0.js"><link rel="prefetch" href="/docs/assets/js/13.b2e18add.js"><link rel="prefetch" href="/docs/assets/js/130.d32b1b00.js"><link rel="prefetch" href="/docs/assets/js/131.a3651be7.js"><link rel="prefetch" href="/docs/assets/js/132.9675361d.js"><link rel="prefetch" href="/docs/assets/js/133.20c1b5f2.js"><link rel="prefetch" href="/docs/assets/js/134.a3db549e.js"><link rel="prefetch" href="/docs/assets/js/135.13451c8f.js"><link rel="prefetch" href="/docs/assets/js/136.14a8fd3a.js"><link rel="prefetch" href="/docs/assets/js/137.e6a30f08.js"><link rel="prefetch" href="/docs/assets/js/138.33b3330f.js"><link rel="prefetch" href="/docs/assets/js/139.eb1130be.js"><link rel="prefetch" href="/docs/assets/js/14.d62fcd5d.js"><link rel="prefetch" href="/docs/assets/js/140.bde84b4d.js"><link rel="prefetch" href="/docs/assets/js/141.66e28bad.js"><link rel="prefetch" href="/docs/assets/js/142.13c6aaa9.js"><link rel="prefetch" href="/docs/assets/js/143.321bc581.js"><link rel="prefetch" href="/docs/assets/js/144.28a02ffd.js"><link rel="prefetch" href="/docs/assets/js/145.099b6798.js"><link rel="prefetch" href="/docs/assets/js/146.aa59b1d2.js"><link rel="prefetch" href="/docs/assets/js/147.60e8d6c0.js"><link rel="prefetch" href="/docs/assets/js/148.b2758ce1.js"><link rel="prefetch" href="/docs/assets/js/149.189e0de2.js"><link rel="prefetch" href="/docs/assets/js/15.eedbe3b9.js"><link rel="prefetch" href="/docs/assets/js/150.303986ad.js"><link rel="prefetch" href="/docs/assets/js/151.1d6677bd.js"><link rel="prefetch" href="/docs/assets/js/152.055d17d4.js"><link rel="prefetch" href="/docs/assets/js/153.088637c7.js"><link rel="prefetch" href="/docs/assets/js/154.d7998496.js"><link rel="prefetch" href="/docs/assets/js/155.7474dd63.js"><link rel="prefetch" href="/docs/assets/js/156.7afc871c.js"><link rel="prefetch" href="/docs/assets/js/157.37e7d304.js"><link rel="prefetch" href="/docs/assets/js/158.b3295e6a.js"><link rel="prefetch" href="/docs/assets/js/159.f345336e.js"><link rel="prefetch" href="/docs/assets/js/16.784ee092.js"><link rel="prefetch" href="/docs/assets/js/160.a13a6d8e.js"><link rel="prefetch" href="/docs/assets/js/161.cf319c7f.js"><link rel="prefetch" href="/docs/assets/js/162.6edd6d5b.js"><link rel="prefetch" href="/docs/assets/js/163.c0d3895d.js"><link rel="prefetch" href="/docs/assets/js/164.a7e08ab7.js"><link rel="prefetch" href="/docs/assets/js/165.c86211c9.js"><link rel="prefetch" href="/docs/assets/js/166.c89530c7.js"><link rel="prefetch" href="/docs/assets/js/167.6afaee52.js"><link rel="prefetch" href="/docs/assets/js/168.0e50ff8f.js"><link rel="prefetch" href="/docs/assets/js/169.e5723154.js"><link rel="prefetch" href="/docs/assets/js/17.2465e8bf.js"><link rel="prefetch" href="/docs/assets/js/170.899d82ac.js"><link rel="prefetch" href="/docs/assets/js/171.7a1ca828.js"><link rel="prefetch" href="/docs/assets/js/172.78517550.js"><link rel="prefetch" href="/docs/assets/js/173.59b07da6.js"><link rel="prefetch" href="/docs/assets/js/174.a6b975e8.js"><link rel="prefetch" href="/docs/assets/js/175.5109e3f2.js"><link rel="prefetch" href="/docs/assets/js/176.f09ca503.js"><link rel="prefetch" href="/docs/assets/js/177.4032e8c6.js"><link rel="prefetch" href="/docs/assets/js/178.75a3f68f.js"><link rel="prefetch" href="/docs/assets/js/179.87279b8a.js"><link rel="prefetch" href="/docs/assets/js/18.a77e21de.js"><link rel="prefetch" href="/docs/assets/js/180.784b8565.js"><link rel="prefetch" href="/docs/assets/js/181.0fc65a8a.js"><link rel="prefetch" href="/docs/assets/js/182.d51675fa.js"><link rel="prefetch" href="/docs/assets/js/183.387d456d.js"><link rel="prefetch" href="/docs/assets/js/184.81ab0af9.js"><link rel="prefetch" href="/docs/assets/js/185.4eb00d74.js"><link rel="prefetch" href="/docs/assets/js/186.1614dd4e.js"><link rel="prefetch" href="/docs/assets/js/187.55d61730.js"><link rel="prefetch" href="/docs/assets/js/188.b297ebec.js"><link rel="prefetch" href="/docs/assets/js/189.6dee6da2.js"><link rel="prefetch" href="/docs/assets/js/19.aac1e6bd.js"><link rel="prefetch" href="/docs/assets/js/190.503ca6ff.js"><link rel="prefetch" href="/docs/assets/js/191.4ce2bdd3.js"><link rel="prefetch" href="/docs/assets/js/192.0f090be6.js"><link rel="prefetch" href="/docs/assets/js/193.c5dce545.js"><link rel="prefetch" href="/docs/assets/js/194.68f00cb7.js"><link rel="prefetch" href="/docs/assets/js/195.8467cbbc.js"><link rel="prefetch" href="/docs/assets/js/196.50206800.js"><link rel="prefetch" href="/docs/assets/js/197.f0b66157.js"><link rel="prefetch" href="/docs/assets/js/198.92040b96.js"><link rel="prefetch" href="/docs/assets/js/199.3398b875.js"><link rel="prefetch" href="/docs/assets/js/20.9126bc4a.js"><link rel="prefetch" href="/docs/assets/js/200.4ceba18f.js"><link rel="prefetch" href="/docs/assets/js/201.0b57243f.js"><link rel="prefetch" href="/docs/assets/js/202.d674eda2.js"><link rel="prefetch" href="/docs/assets/js/203.a2332d57.js"><link rel="prefetch" href="/docs/assets/js/204.bf4b91b0.js"><link rel="prefetch" href="/docs/assets/js/205.8f75459f.js"><link rel="prefetch" href="/docs/assets/js/206.ff9d7921.js"><link rel="prefetch" href="/docs/assets/js/208.2fef9bc5.js"><link rel="prefetch" href="/docs/assets/js/209.1ebcceee.js"><link rel="prefetch" href="/docs/assets/js/21.d433d4fb.js"><link rel="prefetch" href="/docs/assets/js/210.19a18164.js"><link rel="prefetch" href="/docs/assets/js/211.2be2838b.js"><link rel="prefetch" href="/docs/assets/js/212.9d5bd703.js"><link rel="prefetch" href="/docs/assets/js/213.ce2ae9bd.js"><link rel="prefetch" href="/docs/assets/js/214.d68eb15c.js"><link rel="prefetch" href="/docs/assets/js/215.02314dd1.js"><link rel="prefetch" href="/docs/assets/js/216.693a59c3.js"><link rel="prefetch" href="/docs/assets/js/217.9658c379.js"><link rel="prefetch" href="/docs/assets/js/218.2120e314.js"><link rel="prefetch" href="/docs/assets/js/219.9b73157d.js"><link rel="prefetch" href="/docs/assets/js/22.3f55b99c.js"><link rel="prefetch" href="/docs/assets/js/220.1ae63d0d.js"><link rel="prefetch" href="/docs/assets/js/221.aa7916d2.js"><link rel="prefetch" href="/docs/assets/js/222.80c88a80.js"><link rel="prefetch" href="/docs/assets/js/223.1a5adb5b.js"><link rel="prefetch" href="/docs/assets/js/224.50b874fa.js"><link rel="prefetch" href="/docs/assets/js/225.b25cddfa.js"><link rel="prefetch" href="/docs/assets/js/226.5733e49c.js"><link rel="prefetch" href="/docs/assets/js/227.80dc70b3.js"><link rel="prefetch" href="/docs/assets/js/228.76149288.js"><link rel="prefetch" href="/docs/assets/js/229.b1893856.js"><link rel="prefetch" href="/docs/assets/js/23.547a66f7.js"><link rel="prefetch" href="/docs/assets/js/230.c696f69a.js"><link rel="prefetch" href="/docs/assets/js/231.2f113ec3.js"><link rel="prefetch" href="/docs/assets/js/232.3bc56b04.js"><link rel="prefetch" href="/docs/assets/js/233.721258a5.js"><link rel="prefetch" href="/docs/assets/js/234.b5e91737.js"><link rel="prefetch" href="/docs/assets/js/235.9b6ce10e.js"><link rel="prefetch" href="/docs/assets/js/236.9851c541.js"><link rel="prefetch" href="/docs/assets/js/237.f51aaa90.js"><link rel="prefetch" href="/docs/assets/js/238.187a44a7.js"><link rel="prefetch" href="/docs/assets/js/239.2dc6ec06.js"><link rel="prefetch" href="/docs/assets/js/24.eb5f62f5.js"><link rel="prefetch" href="/docs/assets/js/240.a6bda33d.js"><link rel="prefetch" href="/docs/assets/js/241.56161a67.js"><link rel="prefetch" href="/docs/assets/js/242.1f9e9000.js"><link rel="prefetch" href="/docs/assets/js/243.1854a5f6.js"><link rel="prefetch" href="/docs/assets/js/244.9f84fa19.js"><link rel="prefetch" href="/docs/assets/js/25.f0981e34.js"><link rel="prefetch" href="/docs/assets/js/26.fc846c4d.js"><link rel="prefetch" href="/docs/assets/js/27.7fd0ccb6.js"><link rel="prefetch" href="/docs/assets/js/28.c10db3d8.js"><link rel="prefetch" href="/docs/assets/js/29.cd1f4e0c.js"><link rel="prefetch" href="/docs/assets/js/3.8f7dc1c0.js"><link rel="prefetch" href="/docs/assets/js/30.11611413.js"><link rel="prefetch" href="/docs/assets/js/31.10dbb1c1.js"><link rel="prefetch" href="/docs/assets/js/32.46121326.js"><link rel="prefetch" href="/docs/assets/js/33.7cbffa3a.js"><link rel="prefetch" href="/docs/assets/js/34.36d3f73c.js"><link rel="prefetch" href="/docs/assets/js/35.688eca7f.js"><link rel="prefetch" href="/docs/assets/js/36.a12c7fa4.js"><link rel="prefetch" href="/docs/assets/js/37.20f72743.js"><link rel="prefetch" href="/docs/assets/js/38.405a2d12.js"><link rel="prefetch" href="/docs/assets/js/39.4d2114b8.js"><link rel="prefetch" href="/docs/assets/js/4.e8f06238.js"><link rel="prefetch" href="/docs/assets/js/40.2f68d359.js"><link rel="prefetch" href="/docs/assets/js/41.8e2458e1.js"><link rel="prefetch" href="/docs/assets/js/42.f37a7f6d.js"><link rel="prefetch" href="/docs/assets/js/43.0a80e1e4.js"><link rel="prefetch" href="/docs/assets/js/44.9c454c1b.js"><link rel="prefetch" href="/docs/assets/js/45.c6507eea.js"><link rel="prefetch" href="/docs/assets/js/46.1b098329.js"><link rel="prefetch" href="/docs/assets/js/47.929e3fa1.js"><link rel="prefetch" href="/docs/assets/js/48.00a2de40.js"><link rel="prefetch" href="/docs/assets/js/49.0b067e31.js"><link rel="prefetch" href="/docs/assets/js/5.3c957d36.js"><link rel="prefetch" href="/docs/assets/js/50.c9a6caf5.js"><link rel="prefetch" href="/docs/assets/js/51.2907acf7.js"><link rel="prefetch" href="/docs/assets/js/52.e5950ece.js"><link rel="prefetch" href="/docs/assets/js/53.4c2e76e4.js"><link rel="prefetch" href="/docs/assets/js/54.b9aa7640.js"><link rel="prefetch" href="/docs/assets/js/55.953ca9cd.js"><link rel="prefetch" href="/docs/assets/js/56.8f87377c.js"><link rel="prefetch" href="/docs/assets/js/57.b61da3ed.js"><link rel="prefetch" href="/docs/assets/js/58.e49ea6ff.js"><link rel="prefetch" href="/docs/assets/js/59.0f7ebeb3.js"><link rel="prefetch" href="/docs/assets/js/6.74dfb144.js"><link rel="prefetch" href="/docs/assets/js/60.593f72de.js"><link rel="prefetch" href="/docs/assets/js/61.d2b19c14.js"><link rel="prefetch" href="/docs/assets/js/62.b4c267e9.js"><link rel="prefetch" href="/docs/assets/js/63.c4dbe72a.js"><link rel="prefetch" href="/docs/assets/js/64.6de0e9ae.js"><link rel="prefetch" href="/docs/assets/js/65.86edbb5b.js"><link rel="prefetch" href="/docs/assets/js/66.3c96449c.js"><link rel="prefetch" href="/docs/assets/js/67.d931edb8.js"><link rel="prefetch" href="/docs/assets/js/68.609e2a40.js"><link rel="prefetch" href="/docs/assets/js/69.43bd1b13.js"><link rel="prefetch" href="/docs/assets/js/7.0673e18c.js"><link rel="prefetch" href="/docs/assets/js/70.9f479f58.js"><link rel="prefetch" href="/docs/assets/js/71.1e2071bd.js"><link rel="prefetch" href="/docs/assets/js/72.4d8f1b81.js"><link rel="prefetch" href="/docs/assets/js/73.b34f5eaf.js"><link rel="prefetch" href="/docs/assets/js/74.9cb0fa89.js"><link rel="prefetch" href="/docs/assets/js/75.d00ffaeb.js"><link rel="prefetch" href="/docs/assets/js/76.491f29d9.js"><link rel="prefetch" href="/docs/assets/js/77.fce944b5.js"><link rel="prefetch" href="/docs/assets/js/78.d0974e5e.js"><link rel="prefetch" href="/docs/assets/js/79.0598d5a3.js"><link rel="prefetch" href="/docs/assets/js/8.10f1c9a6.js"><link rel="prefetch" href="/docs/assets/js/80.5f3d8798.js"><link rel="prefetch" href="/docs/assets/js/81.b1718dcc.js"><link rel="prefetch" href="/docs/assets/js/82.44ce1c88.js"><link rel="prefetch" href="/docs/assets/js/83.a16d3b67.js"><link rel="prefetch" href="/docs/assets/js/84.b84e5731.js"><link rel="prefetch" href="/docs/assets/js/85.4e056ace.js"><link rel="prefetch" href="/docs/assets/js/86.2b1abc24.js"><link rel="prefetch" href="/docs/assets/js/87.d8d8fc35.js"><link rel="prefetch" href="/docs/assets/js/88.e5fa63f5.js"><link rel="prefetch" href="/docs/assets/js/89.997da928.js"><link rel="prefetch" href="/docs/assets/js/9.d2c64cad.js"><link rel="prefetch" href="/docs/assets/js/90.1686f9ff.js"><link rel="prefetch" href="/docs/assets/js/91.e8c4a859.js"><link rel="prefetch" href="/docs/assets/js/92.b340992c.js"><link rel="prefetch" href="/docs/assets/js/93.8f4fb736.js"><link rel="prefetch" href="/docs/assets/js/94.de9935a4.js"><link rel="prefetch" href="/docs/assets/js/95.235d9074.js"><link rel="prefetch" href="/docs/assets/js/96.4cd90841.js"><link rel="prefetch" href="/docs/assets/js/97.913e4467.js"><link rel="prefetch" href="/docs/assets/js/98.9c44312a.js"><link rel="prefetch" href="/docs/assets/js/99.09e2def6.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.d4eb5ad8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">计算机基础教程</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">
  机器指令
</a></div><div class="nav-item"><a href="/docs/software/" class="nav-link router-link-active">
  软件基础
</a></div><div class="nav-item"><a href="/docs/coder2hacker/" class="nav-link">
  白帽黑客
</a></div><div class="nav-item"><a href="/docs/blockchain/" class="nav-link">
  区块链
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">
  机器指令
</a></div><div class="nav-item"><a href="/docs/software/" class="nav-link router-link-active">
  软件基础
</a></div><div class="nav-item"><a href="/docs/coder2hacker/" class="nav-link">
  白帽黑客
</a></div><div class="nav-item"><a href="/docs/blockchain/" class="nav-link">
  区块链
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/software/programming/java_springboot.html#_1-知识点overview" class="sidebar-link">1.知识点Overview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_1-1-spring-ioc容器" class="sidebar-link">1.1 Spring IoC容器</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#spring装配bean的三种方法" class="sidebar-link" style="padding-left:3rem;">Spring装配bean的三种方法：</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#基于xml的三种注入方式" class="sidebar-link" style="padding-left:3rem;">基于XML的三种注入方式：</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#基于autowired-的三种注入方式" class="sidebar-link" style="padding-left:3rem;">基于Autowired 的三种注入方式</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_1-2-javaconfig与常见annotation" class="sidebar-link">1.2. JavaConfig与常见Annotation</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_1-3-启动加载器-springfactoriesloader" class="sidebar-link">1.3. 启动加载器 SpringFactoriesLoader</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_1-4-spring容器的事件监听机制" class="sidebar-link">1.4. Spring容器的事件监听机制</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_1-5-自动配置原理" class="sidebar-link">1.5. 自动配置原理</a></li></ul></li><li><a href="/docs/software/programming/java_springboot.html#_2-springapplication启动流程" class="sidebar-link">2. SpringApplication启动流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_2-1-springapplication初始化" class="sidebar-link">2.1. SpringApplication初始化</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_2-2-启动流程" class="sidebar-link">2.2. 启动流程</a></li></ul></li><li><a href="/docs/software/programming/java_springboot.html#_3-使用springboot开发应用" class="sidebar-link">3. 使用springboot开发应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_3-0-项目技巧" class="sidebar-link">3.0 项目技巧</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#include" class="sidebar-link" style="padding-left:3rem;">include</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#multiple-env-dev-prod" class="sidebar-link" style="padding-left:3rem;">multiple env: dev prod</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_3-1-业务开发" class="sidebar-link">3.1 业务开发</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_3-1-1-使用starter" class="sidebar-link" style="padding-left:3rem;">3.1.1 使用starter</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#pom-depenedency" class="sidebar-link" style="padding-left:4rem;">POM depenedency</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#configuration" class="sidebar-link" style="padding-left:4rem;">Configuration</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_3-1-2-springboot-mvc" class="sidebar-link" style="padding-left:3rem;">3.1.2 springboot mvc</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_3-2-框架开发-starter" class="sidebar-link">3.2 框架开发（starter）</a></li></ul></li><li><a href="/docs/software/programming/java_springboot.html#_4-troubleshooting" class="sidebar-link">4. Troubleshooting</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#beandefinitionoverrideexception" class="sidebar-link">BeanDefinitionOverrideException</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#beancurrentlyincreationexception-circular-reference" class="sidebar-link">BeanCurrentlyInCreationException/circular reference</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#nohup-ignoring-input-no-main-manifest-attribute" class="sidebar-link">nohup: ignoring input no main manifest attribute</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-documentation" target="_blank" rel="noopener noreferrer">official documents<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>自动配置、起步依赖、Actuator、命令行界面(CLI) 是Spring Boot最重要的4大核心特性</p> <p>Servlet-&gt;EJB-&gt;Struts-&gt;SpringMVC-&gt;SpringBoot</p> <p>New-&gt;Factory-&gt;容器</p> <h2 id="_1-知识点overview"><a href="#_1-知识点overview" class="header-anchor">#</a> 1.知识点Overview</h2> <h3 id="_1-1-spring-ioc容器"><a href="#_1-1-spring-ioc容器" class="header-anchor">#</a> 1.1 Spring IoC容器</h3> <p>IoC容器是大管家，你只需要告诉它需要某个bean，它就把对应的实例（instance）扔给你，至于这个bean是否依赖其他组件，怎样完成它的初始化，根本就不需要你关心。</p> <p>bean是什么？</p> <blockquote><p>The objects that form the backbone of your application and that are managed by the Spring IoC container are called beans. A bean is an object that is instantiated, assembled, and otherwise managed by a Spring IoC container.
https://www.tutorialspoint.com/spring/spring_bean_definition.htm</p></blockquote> <p>IoC容器想要管理各个业务对象以及它们之间的依赖关系，需要通过某种途径来记录和管理这些信息。
BeanDefinition对象就承担了这个责任：容器中的每一个bean都会有一个对应的BeanDefinition实例，该实例负责保存bean对象的所有必要信息，包括bean对象的class类型、是否是抽象类、构造方法和参数、其它属性等等。
当客户端向容器请求相应对象时，容器就会通过这些信息为客户端返回一个完整可用的bean实例；
默认是单例模式；</p> <p>事先这些bean需要向大管家注册，BeanDefinitionRegistry抽象出bean的注册逻辑，BeanFactory则抽象出了bean的管理逻辑，而各个BeanFactory的实现类就具体承担了bean的注册以及管理工作
然后大管家生成bean也是通过这个工厂模式；
DefaultListableBeanFactory作为一个比较通用的BeanFactory实现，它同时也实现了BeanDefinitionRegistry接口，因此它就承担了Bean的注册管理工作，
具体的beanFactory实现类就是实现了DefaultListableBeanFactory这个接口；</p> <p><img src="/docs/docs_image/software/java/spring/java_spring_bean01.png" alt="spring揭秘"></p> <p>Spring提供了两种容器类型：BeanFactory和ApplicationContext：</p> <p><img src="/docs/docs_image/software/java/spring/java_spring_bean02.png" alt="spring揭秘"></p> <p><strong>Spring IoC容器的整个工作流程大致可以分为两个阶段：</strong></p> <ul><li><p>容器启动阶段</p> <p>容器启动时，会通过某种途径加载 ConfigurationMetaData，
ConfigurationMetaData可能定义在代码中，比如注解方式，也可能在在外部配置文件(XML/Properties)中，
，容器需要依赖某些工具类如BeanDefinitionReader，BeanDefinitionReader会对加载的 ConfigurationMetaData进行解析和分析，并将分析后的信息组装为相应的BeanDefinition，
最后把这些保存了bean定义的BeanDefinition，注册到相应的BeanDefinitionRegistry，
这样容器的启动工作就完成了。</p></li> <li><p>Bean的实例化阶段</p> <p>这个阶段触发是:当某个请求通过容器的getBean方法请求某个对象，或者因为依赖关系容器需要隐式的调用getBean时（如bean的注解@DependsOn 或者Autowired）;
容器会首先检查所请求的对象之前是否已经实例化完成。如果没有，则会根据注册的BeanDefinition所提供的信息实例化被请求对象，并为其注入依赖。当该对象装配完毕后，容器会立即将其返回给请求方法使用。</p> <p><em>Notes:Autowire vs getbean</em></p> <blockquote><p>Injecting a Prototype Bean into a Singleton Bean Problem https://www.logicbig.com/tutorials/spring-framework/spring-core/injecting-singleton-with-prototype-bean.html</p></blockquote> <blockquote><p>You can then use getBean to retrieve instances of your beans. The ApplicationContext interface has a few other methods for retrieving beans, but, ideally, your application code should never use them. Indeed, your application code should have no calls to the getBean() method at all and thus have no dependency on Spring APIs at all.
https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html</p></blockquote> <p>BeanFactory只是Spring IoC容器的一种实现，如果没有特殊指定，它采用采用延迟初始化策略：只有当访问容器中的某个对象时，才对该对象进行初始化和依赖注入操作。
对于资源有限，并且功能要求不是很严格的场景，BeanFactory是比较合适的IoC容器选择。</p> <p>而在实际场景下，我们更多的使用另外一种类型的容器： ApplicationContext，它构建在BeanFactory之上，属于更高级的容器，除了具有BeanFactory的所有能力之外，还提供对事件监听机制以及国际化的支持等。它管理的bean，在容器启动时全部完成初始化和依赖注入操作。
ApplicationContext所管理的对象，在该类型容器启动之后，默认全部初始化并绑定完成。所以，相对于BeanFactory来说，ApplicationContext要求更多的系统资源，同时，因为在启动时就完成所有初始化，容器启动时间较之BeanFactory也会长一些。
在那些系统资源充足，并且要求更多功能的场景中，ApplicationContext类型的容器是比较合适的选择。</p></li></ul> <p><strong>bean生命周期接口</strong></p> <p>https://www.huaweicloud.com/articles/b59be8ffdcfbd1f8a1fe28bffe848d20.html</p> <p>IoC容器负责管理容器中所有bean的生命周期，而在bean生命周期的不同阶段，Spring提供了不同的扩展点来改变bean的命运，例如EnvironmentPostProcessor、BeanFactoryPostProcessor等（具体参照：第2节 SpringApplication启动流程）:</p> <p><strong>单例模式</strong></p> <p>spring boot默认bean是单例的，spring mvc默认的servlet也是单例的，当然bean @Controller也是单例的，多线程体现在httpservletrequest本身是线程间互相隔离的，
一般都是通过ThreadLocal实现，
之所以默认单例是因为，springboot本身就是ioc容器，启动过程很长，启动时会实例化加载bean（当然也有lazy模式），bean的实例化通常需要读取配置文件或者有很多其他bean的依赖，
所以每次都重建销毁性能很差，而且浪费内存；
https://stackoverflow.com/questions/10096483/is-threadlocal-preferable-to-httpservletrequest-setattributekey-value</p> <p>单例就是为了共享从而减少内存开销，多线程就是为了区别每个线程的上下文或者working thread context，所以线程上下文一定不能被共享，
比如ThreadLocal不能跟ExecutorService共用，就是因为ExecutorService破坏了线程间的隔离
Do Not Use ThreadLocal With ExecutorService
https://www.baeldung.com/java-threadlocal
https://www.cnblogs.com/MrSaver/p/11191028.html</p> <p>单例模式 工厂模式 建造者模式</p> <blockquote><p>Spring单例Bean与单例模式的区别在于它们关联的环境不一样，单例模式是指在一个JVM进程中仅有一个实例，而Spring单例是指一个Spring Bean容器(ApplicationContext)中仅有一个实例。
首先看单例模式，在一个JVM进程中（理论上，一个运行的JAVA程序就必定有自己一个独立的JVM）仅有一个实例，于是无论在程序中的何处获取实例，始终都返回同一个对象，以Java内置的Runtime为例（现在枚举是单例模式的最佳实践），无论何时何处获取，下面的判断始终为真：
Runtime.getRuntime() == Runtime.getRuntime()
与此相比，Spring的单例Bean是与其容器（ApplicationContext）密切相关的，所以在一个JVM进程中，如果有多个Spring容器，即使是单例bean，也一定会创建多个实例，代码示例如下：</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>//  第一个Spring Bean容器
ApplicationContext context_1 = new FileSystemXmlApplicationContext(&quot;classpath:/ApplicationContext.xml&quot;);
Person yiifaa_1 = context_1.getBean(&quot;yiifaa&quot;, Person.class);
//  第二个Spring Bean容器
ApplicationContext context_2 = new FileSystemXmlApplicationContext(&quot;classpath:/ApplicationContext.xml&quot;);
Person yiifaa_2 = context_2.getBean(&quot;yiifaa&quot;, Person.class);
//  这里绝对不会相等，因为创建了多个实例
System.out.println(yiifaa_1 == yiifaa_2);

&lt;!-- 即使声明了为单例，只要有多个容器，也一定会创建多个实例 --&gt;
&lt;bean id=&quot;yiifaa&quot; class=&quot;com.stixu.anno.Person&quot; scope=&quot;singleton&quot;&gt;
    &lt;constructor-arg name=&quot;username&quot;&gt;
        &lt;value&gt;yiifaa&lt;/value&gt;
    &lt;/constructor-arg&gt;
&lt;/bean&gt;
</code></pre></div><blockquote><p>https://blog.csdn.net/yiifaa/java/article/details/74852425</p></blockquote> <p>@bean方法调用的特殊性：</p> <p>https://www.racecoder.com/archives/787/</p> <p>https://stackoverflow.com/questions/27990060/calling-a-bean-annotated-method-in-spring-java-configuration</p> <p><a href="https://blog.csdn.net/TheLudlows/article/details/81360067" target="_blank" rel="noopener noreferrer">Spring Boot 2.0 ：深入分析Spring Boot原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>spring boot之自动装配（spring-boot-autoconfigure） https://blog.csdn.net/wangjie5540/article/details/99542777</p> <p>原创 | 我被面试官给虐懵了，竟然是因为我不懂Spring中的@Configuration
https://juejin.im/post/5d005860f265da1b7f297630</p> <h4 id="spring装配bean的三种方法"><a href="#spring装配bean的三种方法" class="header-anchor">#</a> Spring装配bean的三种方法：</h4> <p>The interface <code>org.springframework.context.ApplicationContext</code> represents the Spring IoC container and is responsible for instantiating, configuring, and assembling the aforementioned beans. The container gets its instructions on what objects to instantiate, configure, and assemble by reading configuration metadata. The configuration metadata is represented in：</p> <p>XML, Java annotations, or Java code:</p> <p>https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/beans.html</p> <ul><li><p><a href="https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/beans.html#beans-annotation-config" target="_blank" rel="noopener noreferrer">Annotation-based configuration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 使用注解Annotation定义Bean</p> <p>Spring 2.5 introduced support for annotation-based configuration metadata.</p> <p>spring从两个角度实现自动化装配：组件扫描和自动装配</p> <ol><li>创建可被发现的bean</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
这个简单的注解表明该类会作为组件类<span class="token punctuation">,</span>并告知<span class="token class-name">Spring</span>要为这个类创建bean

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">--</span><span class="token operator">-</span> 命名 bean id
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 
如果没有个bean设置ID<span class="token punctuation">,</span><span class="token class-name">Spring</span>会根据类名为其指定一个ID<span class="token punctuation">,</span>默认名字就是把类名的第一个字母变为小写<span class="token punctuation">.</span>
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">&quot;lonelyHeartsClub&quot;</span><span class="token punctuation">)</span> <span class="token comment">//设置期望的ID</span>
	<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SgtPeppers</span> <span class="token keyword">implements</span> <span class="token class-name">CompactDisc</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span>
另外还一种为bean命名的方式<span class="token punctuation">,</span>使用<span class="token class-name">Java</span>依赖注入规范中所提供的<span class="token annotation punctuation">@Named</span>注解来为bean设置ID
<span class="token annotation punctuation">@Named</span><span class="token punctuation">(</span><span class="token string">&quot;lonelyHeartsClub&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SgtPeppers</span> <span class="token keyword">implements</span> <span class="token class-name">CompactDisc</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">--</span><span class="token operator">-</span> 设置组件扫描的基础包
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
当对一个类标注<span class="token annotation punctuation">@Component</span>注解时，表明该类会作为组件类，spring将为这个类创建bean。当在应用文中引用这个bean，spring会自动扫描事先指定的包查找这个  bean。但spring默认是不启用组件扫描的，可以在XML中配置加上。还有一种方法：在新建一个配置类，类中可以什么不用写，在配置类上加上<span class="token annotation punctuation">@ComponentScan</span>注解，spring会自动扫描改配置类所在的包。
<span class="token comment">//直接在value属性中指明包的名称</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;soundsystem&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayerConfig</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//通过basePackages属性配置</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages<span class="token operator">=</span><span class="token string">&quot;soundsystem&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayerConfig</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//设置多个基础包,用数组表示</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;soundsystem&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;video&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayerConfig</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//基础包以String类型表示是不安全的,如果重构代码的话,指定的基础包可能会出现错误,用指定为包中所包含的类或接口的方法</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackageClasses<span class="token operator">=</span><span class="token punctuation">{</span><span class="token class-name">CDPlayer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">DVDPlayer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayerConfig</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">--</span><span class="token operator">-</span> 添加注解自动装配<span class="token class-name">Autowired</span>
<span class="token annotation punctuation">@Autowired</span>可以换成<span class="token annotation punctuation">@Inject</span><span class="token punctuation">,</span><span class="token annotation punctuation">@Inject</span>注解来源于<span class="token class-name">Java</span>依赖注入规范<span class="token punctuation">,</span>该规范同时还为我们定义了<span class="token annotation punctuation">@Named</span>注解<span class="token punctuation">.</span>
尽管<span class="token annotation punctuation">@Inject</span>和<span class="token annotation punctuation">@Autowierd</span>有细微的差别<span class="token punctuation">,</span>但大多数场景下<span class="token punctuation">,</span>它们都可以互换<span class="token punctuation">.</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token annotation punctuation">@Autowired</span>注解构造器：
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayer</span> <span class="token keyword">implements</span> <span class="token class-name">MediaPlayer</span><span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">CompactDisc</span> cd<span class="token punctuation">;</span>

  <span class="token annotation punctuation">@Autowired</span><span class="token comment">//这表明当Spring创建CDPlayer bean的时候,会通过这个构造器来进行实例化并且会传入一个可设置给CompactDisc类型的bean.</span>
  <span class="token keyword">public</span> <span class="token class-name">CDPlayer</span><span class="token punctuation">(</span><span class="token class-name">CompactDisc</span> cd<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//构造器</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cd <span class="token operator">=</span> cd<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">paly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    cd<span class="token punctuation">.</span><span class="token function">paly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Autowired</span>注解属性的<span class="token class-name">Setter</span>方法：
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCompactDisc</span><span class="token punctuation">(</span><span class="token class-name">CompactDisc</span> cd<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cd <span class="token operator">=</span> cd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

如果没有匹配的bean<span class="token punctuation">,</span>那么在应用上下文创建的时候<span class="token punctuation">,</span><span class="token class-name">Spring</span>会抛出一个异常<span class="token punctuation">,</span>为了避免异常的出现<span class="token punctuation">,</span>你可以将<span class="token annotation punctuation">@Autowired</span>的requied属性设置为<span class="token boolean">false</span>
<span class="token annotation punctuation">@Autowired</span><span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCompactDisc</span><span class="token punctuation">(</span><span class="token class-name">CompactDisc</span> cd<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cd <span class="token operator">=</span> cd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

如果有多个bean都能满足依赖关系的话<span class="token punctuation">,</span><span class="token class-name">Spring</span>将会抛出一个异常<span class="token punctuation">,</span>表明没有明确指定要选择哪个bean进行自动装配<span class="token punctuation">,</span> 一般在组件类上添加注解<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span>括号写这个bean的id，在注入时也加上<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>写上bean的id
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;postdao&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Postdao</span><span class="token punctuation">{</span>
<span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;userdao&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Userdao</span><span class="token punctuation">{</span>
<span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;usedao&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUserdao</span><span class="token punctuation">(</span><span class="token class-name">Userdao</span> userdao<span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;postdao&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUserdao</span><span class="token punctuation">(</span><span class="token class-name">Postdao</span> postdao<span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><a href="https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/beans.html#beans-java" target="_blank" rel="noopener noreferrer">Java-based configuration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 基于java类提供Bean定义信息</p> <p>所谓java based 我的理解是这里是说不需要依赖于spring，普通的java项目也可以用</p> <p>Starting with Spring 3.0, many features provided by the <a href="http://www.springsource.org/javaconfig" target="_blank" rel="noopener noreferrer">Spring JavaConfig project<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> became part of the core Spring Framework. Thus you can define beans external to your application classes by using Java rather than XML files. To use these new features, see the <code>@Configuration</code>, <code>@Bean, @Import</code> and <code>@DependsOn</code> annotations.</p> <p>有些情况下,比如说,要将第三方库的组件装配到你的应用中,就不能使用前面的自动化装配方法 到第三方库中去给类加@Component和@Autowired注解,
在这种情况下,就需要采用显示装配的方式.在进行显示配置有Java和XML两种方案显示装配bean.</p> <p>使用java代码，先新建一个配置类JavaConfig，里面都是配置所需的bean，不应该有业务逻辑代码，所以单独建一个类。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Bean</span>
  <span class="token keyword">public</span> <span class="token class-name">MyService</span> <span class="token function">myService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">AppConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">MyService</span> myService <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">MyService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  myService<span class="token punctuation">.</span><span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">AnnotationConfigApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">AppConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">OtherConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">AdditionalConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">MyService</span> myService <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">MyService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  myService<span class="token punctuation">.</span><span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//创建JavaConfig类的关键在于为其添加@Configruation注解,表明这是一个配置类</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayerConfig</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CompactDisc</span> <span class="token function">sgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//@Bean注解会告诉Spring这个方法将会返回一个对象,该对象要注册为Spring应用上下文的bean,默认情况下,</span>
    bean的ID于带有<span class="token annotation punctuation">@Bean</span>注解的方法名一样<span class="token punctuation">,</span>也可以重命名

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;lonelyHeartsClubBand&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CompactDisc</span> <span class="token function">sgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	
    声明<span class="token class-name">CompactDisc</span> bean是非常简单<span class="token punctuation">,</span>它自身没有其他依赖<span class="token punctuation">,</span>但现在<span class="token punctuation">,</span>我们需要声明<span class="token class-name">CDPlayer</span> bean<span class="token punctuation">,</span>它依赖于<span class="token class-name">CompactDisc</span><span class="token punctuation">,</span>在<span class="token class-name">JavaConfig</span>中<span class="token punctuation">,</span>如何将他们装配在一起呢<span class="token operator">?</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CDPlayer</span> <span class="token function">cdPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CDPlayer</span><span class="token punctuation">(</span><span class="token function">sgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//因为sgtPeppers()方法上添加了@Bean注解,Spring将会拦截所有对它的调用,</span>
    <span class="token comment">//并确保直接返回该方法创建的bean,而不是每次都对其进行实际的调用.</span>
    <span class="token punctuation">}</span>
    等价于下面这种方式
        
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CDPlayer</span> <span class="token function">cdPlayer</span><span class="token punctuation">(</span><span class="token class-name">CompactDisc</span> compactDisc<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//在这里,cdPlayer()方法请求一个CompactDisc作为参数,当Springs调用cdPlayer()创建CDPlayer bean的时候,</span>
<span class="token comment">//它会自动装配一个CompactDisc到配置方法之中,然后方法体按照合适的方法来使用它.</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CDPlayer</span><span class="token punctuation">(</span>compactDisc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;lonelyHeartsClubBandPlayer&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CDPlayer</span> <span class="token function">cdPlayer</span><span class="token punctuation">(</span><span class="token class-name">CompactDisc</span> lonelyHeartsClubBand<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CDPlayer</span><span class="token punctuation">(</span>compactDisc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name">More</span> example：

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;classpath:spring/spring-dao.xml&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;classpath:scan.xml&quot;</span><span class="token punctuation">}</span>）
<span class="token keyword">public</span> <span class="token keyword">class</span> bbsConfig<span class="token punctuation">{</span>
　　<span class="token keyword">private</span> <span class="token class-name">Postdao</span> postdao<span class="token punctuation">;</span>
　　<span class="token keyword">private</span> <span class="token class-name">Userdao</span> userdao<span class="token punctuation">;</span>
　　<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;postservice&quot;</span><span class="token punctuation">)</span>
   <span class="token keyword">public</span> <span class="token class-name">PostService</span> <span class="token function">getPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
　　<span class="token punctuation">{</span>
　　<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PostserviceImpl</span><span class="token punctuation">(</span>postdao<span class="token punctuation">,</span>userdao<span class="token punctuation">)</span><span class="token punctuation">;</span>
　　<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

在对<span class="token class-name">PostService</span>的bean注入时，同时又依赖了两个bean，postdao和userdao。直接引用beanID就可以，spring会自动地从容器中获取这些bean，只要他们的配置是正确的就行。这个例子中userdao、postdao是<span class="token class-name">Mybatis</span>配置自动扫描将dao接口生成代理注入到spring的，其实也算是xml装配bean
这里如果再声明一个bean，返回的仍是postserviceImpl对象，和之前的那个bean完全一样，是同一个实例。一般spring <span class="token annotation punctuation">@bean</span>如果是同一个beanID，默认返回的是一个单例bean，注入的是同一个实例。如果修改其中一个会都改变的。
不过在这里要注意进行测试时，由于spring的单元测试和springIoc容器是完全独立的，postdao和userdao注入检测时是使用locations加载xml文件，而postservice使用classes加载config类的，但是两个不能同时混用在<span class="token annotation punctuation">@ContextConfiguration</span>中。所以非要都测试的话，就分开测试吧。
</code></pre></div></li> <li><p>基于xml配置Bean</p> <p>Configuration metadata is traditionally supplied in a simple and intuitive XML format</p> <p>https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/beans.html</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//XML装配bean的缺点</span>
<span class="token comment">//1.当Spring发现这个&lt;bean&gt;元素时,它将会调用SgtPeppers的默认构造器来创建bean.在XML配置中,bean的创建显得更加被动</span>
<span class="token comment">//2.不如JavaConfig强大,在JavaConfig配置中,可以通过任何想象到的方法来创建bean实例(构造器,set方法等)</span>
<span class="token comment">//3.在简单的&lt;bean&gt;声明中,将bean的类型以字符串的形式设置在了class属性中,不能保证设置给class属性的值是真正的类</span>
<span class="token comment">//4.重命名了类,也会引起麻烦</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">--</span><span class="token operator">-</span>基本
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">&quot;http://........&quot;</span>
             xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span>&quot;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>''<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>  configuration details go here <span class="token operator">--</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>bean <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.SgtPeppers&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token comment">//这里声明一个很简单的bean,因为没有明确给定ID,所以这个bean将会根据全限定类名来进行命名,</span>
	<span class="token comment">//这里的bean的ID将会是&quot;soundsystem.SgtPeppers#0&quot;.其中,&quot;#0&quot;是一个计数的形式,来区分相同类型的bean.</span>

	<span class="token comment">//更好的方法是借助id属性</span>
	<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.SgtPeppers&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

	
 	<span class="token comment">//当Spring遇到&lt;bean&gt;这个元素时,它会创建一个CDPlayer实例.&lt;constructor-arg&gt;元素会告知Spring要将</span>
    <span class="token comment">//一个ID为compactDisc的bean引用传递到CDPlayer的构造器中.</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;cdPlayer&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.CDPlayer&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg ref<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
        
<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">&gt;</span>

作为替代方案<span class="token punctuation">,</span>也可以使用<span class="token class-name">Spring</span>的c<span class="token operator">-</span>命名空间（<span class="token class-name">Spring3</span><span class="token number">.0</span>所引入的c<span class="token operator">-</span>命名空间）
<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">&quot;http://........&quot;</span>
            xmlns<span class="token operator">:</span>c<span class="token operator">=</span><span class="token string">&quot;http://www.springframework.org/schema/c&quot;</span>
             xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span>&quot;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>''<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>  configuration details go here <span class="token operator">--</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;cdPlayer&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.CDPlayer&quot;</span>
   	c<span class="token operator">:</span>cd<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span><span class="token operator">&gt;</span>
    <span class="token comment">//&quot;c:&quot; 命名空间的前缀</span>
    <span class="token comment">//&quot;cd&quot; 构造器参数名</span>
    <span class="token comment">//&quot;-ref&quot;注入bean引用</span>
    <span class="token comment">//&quot;compactDisc&quot; 要注入bean 的ID</span>
	
    如果在优化构建的过程<span class="token punctuation">,</span>将调试标志移除掉<span class="token punctuation">,</span>那么这种方式可能无法正常执行<span class="token punctuation">.</span>代替方案：
	<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;cdPlayer&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.CDPlayer&quot;</span>
   c<span class="token operator">:</span>_0<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span><span class="token operator">&gt;</span>
	<span class="token comment">//把参数名换成&quot;0&quot;,也就是参数的索引,但XML中不允许数字作为属性的第一个字符,因此添加下划线&quot;_&quot;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">&gt;</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">--</span><span class="token operator">-</span> 字面量string注入
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlankDisc</span> <span class="token keyword">implements</span> <span class="token class-name">CompactDisc</span><span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> artist<span class="token punctuation">;</span>
  
  <span class="token keyword">public</span> <span class="token class-name">BlandDisc</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span><span class="token class-name">String</span> artist<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>artist <span class="token operator">=</span> artist<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">paly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Playing&quot;</span><span class="token operator">+</span>title<span class="token operator">+</span><span class="token string">&quot;by&quot;</span><span class="token operator">+</span>artist<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span>
    <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundysytem.BlankDisc&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg value<span class="token operator">=</span><span class="token string">&quot;Sgt.Peper's Lonely Hearts&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg value<span class="token operator">=</span><span class="token string">&quot;The beatles&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
等价
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span>
    <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.BlanDisc&quot;</span>
    c<span class="token operator">:</span>_title<span class="token operator">=</span><span class="token string">&quot;Sgt.Peper's Lonely Hearts&quot;</span>
    c<span class="token operator">:</span>_artist<span class="token operator">=</span><span class="token string">&quot;The beatles&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
或
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span>
    <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.BlanDisc&quot;</span>
    c<span class="token operator">:</span>_0<span class="token operator">=</span><span class="token string">&quot;Sgt.Peper's Lonely Hearts&quot;</span>
    c<span class="token operator">:</span>_1<span class="token operator">=</span><span class="token string">&quot;The beatles&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">--</span><span class="token operator">-</span> 集合注入
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlankDisc</span> <span class="token keyword">implements</span> <span class="token class-name">CompactDisc</span><span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> artist<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tracks<span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTitel</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setArtist</span><span class="token punctuation">(</span><span class="token class-name">String</span> artist<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>artist<span class="token operator">=</span> artist<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTracks</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tracks<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tracks<span class="token operator">=</span> tracks<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span>
    <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.BlankDisc&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg value<span class="token operator">=</span><span class="token string">&quot;Sgt.Peper's Lonely Hearts&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg value<span class="token operator">=</span><span class="token string">&quot;The beatles&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>list<span class="token punctuation">&gt;</span></span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token class-name">Sgt<span class="token punctuation">.</span> Pepper</span>'s <span class="token class-name">Lonely</span> <span class="token class-name">Heats</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token class-name">With</span> a <span class="token class-name">Little</span> <span class="token class-name">Help</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token class-name">Lucy</span> in the <span class="token class-name">Sky</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token class-name">Getting</span> <span class="token class-name">Better</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token class-name">Fixing</span> a <span class="token class-name">Hole</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>list<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
等价于p命名空间
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span>
      <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.BlankDisc&quot;</span>
      p<span class="token operator">:</span>title<span class="token operator">=</span><span class="token string">&quot;Sgt.peper's loney hearts club&quot;</span>
      p<span class="token operator">:</span>artist<span class="token operator">=</span><span class="token string">&quot;The Beatles&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;tracks&quot;</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>list<span class="token punctuation">&gt;</span></span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token class-name">Sgt</span><span class="token punctuation">.</span>peper's loney hearts club<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>loney hearts club<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>hearts club<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>club hearts<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>list<span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
注意list不能直接使用p空间，可以借用util<span class="token operator">-</span>命名空间
<span class="token operator">&lt;</span>util<span class="token operator">:</span>list id<span class="token operator">=</span><span class="token string">&quot;trackList&quot;</span><span class="token operator">&gt;</span>
     <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token class-name">Sgt</span><span class="token punctuation">.</span>peper's loney hearts club<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
     <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>loney hearts club<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
     <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>hearts club<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
     <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>club hearts<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>util<span class="token operator">:</span>lsit<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span>
           <span class="token keyword">class</span> <span class="token operator">=</span> <span class="token string">&quot;soundsystem.BlankDisc&quot;</span>
           p<span class="token operator">:</span>title<span class="token operator">=</span><span class="token string">&quot;Sgt.pepers lonely hearts&quot;</span>
           p<span class="token operator">:</span>artist<span class="token operator">=</span><span class="token string">&quot;The Beatles&quot;</span>
           p<span class="token operator">:</span>tracks<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">&quot;trackList&quot;</span><span class="token operator">&gt;</span>     

复杂类型的list：
<span class="token keyword">public</span> <span class="token class-name">Discography</span><span class="token punctuation">(</span><span class="token class-name">String</span> artist<span class="token punctuation">,</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CompactDisc</span><span class="token punctuation">&gt;</span></span> cds<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;beatlesDiscography&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.Discography&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg value<span class="token operator">=</span><span class="token string">&quot;The Beatles&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>list<span class="token punctuation">&gt;</span></span>
      <span class="token operator">&lt;</span>ref bean<span class="token operator">=</span><span class="token string">&quot;sgtPeppers&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>ref bean<span class="token operator">=</span><span class="token string">&quot;whiteAlbum&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>lsit<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">--</span><span class="token operator">-</span> 属性注入
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>    
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">soundsystem<span class="token punctuation">.</span></span><span class="token class-name">CompactDisc</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">soundsystem<span class="token punctuation">.</span></span><span class="token class-name">MediaPlayer</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayer</span> <span class="token keyword">implements</span> <span class="token class-name">MediaPlayer</span><span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">CompactDisc</span> compactDisc<span class="token punctuation">;</span>

  <span class="token annotation punctuation">@Autowired</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCompactDisc</span><span class="token punctuation">(</span><span class="token class-name">CompactDisc</span> compactDisc<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>compactDisc <span class="token operator">=</span> compactDisc<span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">paly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    compactDisc<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;cdPlayer&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.CDPlayer&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span> ref<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
<span class="token comment">//通过ref引用了ID为compactDisc的bean,将其注入到compactDisc属性中(通过setCompactDisc()方法)</span>

等价于通过p命名空间
<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">&quot;http://........&quot;</span>
       xmlns<span class="token operator">:</span>p<span class="token operator">=</span><span class="token string">&quot;http://www.springframework.org/schema/p&quot;</span>
       xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span>&quot;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>''<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>  configuration details go here <span class="token operator">--</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;cdPlayer&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.CDPlayer&quot;</span>
    p<span class="token operator">:</span>compactDisc<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
<span class="token comment">//&quot;p:&quot; :前缀</span>
<span class="token comment">//前面的compactDisc: 属性名</span>
<span class="token comment">//-ref:  注入bean引用</span>
<span class="token comment">//后面的compactDisc: 所注入bean的ID</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">&gt;</span>
 

<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span> <span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">&quot;http://www.springframework.org/schema/beans&quot;</span>
       xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span>&quot;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans
            http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans<span class="token operator">/</span>spring<span class="token operator">-</span>beans<span class="token punctuation">.</span>xsd
            http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>context&quot;<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">import</span> <span class="token namespace">resource</span><span class="token operator">=</span><span class="token string">&quot;spring/spring-dao.xml&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;postservice&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.bbs.service.impl.PostserviceImpl&quot;</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg ref<span class="token operator">=</span><span class="token string">&quot;postdao&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg ref<span class="token operator">=</span><span class="token string">&quot;userdao&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">&gt;</span>

配置postservice的bean时需要引入两个bean，postdao和userdao，放到constructor<span class="token operator">-</span>arg的标签中，ref指的是依赖的bean的ID。如果是在javaConfig中配置的，就写<span class="token annotation punctuation">@Bean</span>的内容。如果是<span class="token annotation punctuation">@Component</span>就写<span class="token annotation punctuation">@Qualifier</span>的内容。这里是引入的是动态实现的dao接口的bean，是在spring<span class="token operator">-</span>dao<span class="token punctuation">.</span>xml中配置的，引入这个配置文件就可以自动获得beanID。
</code></pre></div><p><strong>混合使用三种装配</strong></p> <ol><li>在类上可以使用 @import(bbsConfig.class)组合其他java注解</li> <li>在类上使用 @importResource(&quot;classpath:spring-dao.xml&quot;)组合其他xml注解</li> <li>在类上可以使用@ContenxtConfiguration包含class或者xml</li> <li>在xml中可以用引入xml注解，也可以使用引入java注解</li></ol></li></ul> <h4 id="基于xml的三种注入方式"><a href="#基于xml的三种注入方式" class="header-anchor">#</a> 基于XML的三种注入方式：</h4> <p>https://www.cnblogs.com/wuchanming/p/5426746.html</p> <ul><li><p>属性注入</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>java<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">People</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//调用默认的构造方法</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
      <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;People{&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;id=&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span>
                <span class="token string">&quot;, name='&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">&quot;, age=&quot;</span> <span class="token operator">+</span> age <span class="token operator">+</span>
                <span class="token char">'}'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">&quot;http://www.springframework.org/schema/beans&quot;</span>
    xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span>&quot;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans
        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans<span class="token operator">/</span>spring<span class="token operator">-</span>beans<span class="token punctuation">.</span>xsd&quot;<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;people&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.java.entity.People&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
    <span class="token comment">//属性注入</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;people2&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.java.entity.People&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;id&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;1&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;age&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;18&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;name&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;张三&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">&gt;</span>
        
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//加载beans.xml文件，调用Spring接口</span>
        <span class="token class-name">ApplicationContext</span> ac<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;beans.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//通过id获取bean，返回一个对象</span>
        <span class="token class-name">People</span> people<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">)</span>ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;people&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用方法</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>people<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
        <span class="token comment">//属性注入</span>
        <span class="token class-name">People</span> people2<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">)</span>ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;people2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>people2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>构造函数注入</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>类型注入<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;people3&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.java.entity.People&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg type<span class="token operator">=</span><span class="token string">&quot;int&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg type<span class="token operator">=</span><span class="token string">&quot;String&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;李四&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg type<span class="token operator">=</span><span class="token string">&quot;int&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;19&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>索引注入<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;people4&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.java.entity.People&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">&quot;0&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;3&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">&quot;1&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;王五&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">&quot;2&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;20&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>联合使用<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;people5&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.java.entity.People&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg type<span class="token operator">=</span><span class="token string">&quot;int&quot;</span> index<span class="token operator">=</span><span class="token string">&quot;0&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;4&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg type<span class="token operator">=</span><span class="token string">&quot;String&quot;</span> index<span class="token operator">=</span><span class="token string">&quot;1&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;赵六&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg type<span class="token operator">=</span><span class="token string">&quot;int&quot;</span> index<span class="token operator">=</span><span class="token string">&quot;2&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;21&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>

<span class="token comment">//类型注入</span>
<span class="token class-name">People</span> people3<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">)</span>ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;people3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>people3<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//类型注入</span>
<span class="token class-name">People</span> people4<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">)</span>ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;people4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>people4<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//联合使用</span>
<span class="token class-name">People</span> people5<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">)</span>ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;people5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>people5<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>工厂方法注入，分为静态工厂和非静态工厂； 一般用得多的都是静态工厂；</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>java<span class="token punctuation">.</span>factory</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>java<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">People</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PeopleFactory</span> <span class="token punctuation">{</span>
    <span class="token comment">//非静态工厂</span>
    <span class="token keyword">public</span> <span class="token class-name">People</span> <span class="token function">createPeople</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">People</span> p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;阿七&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//静态工厂</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">People</span> <span class="token function">createPeople1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">People</span> p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;阿八&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

 <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>工厂模式的非静态方法<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;peopleFactory&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.java.factory.PeopleFactory&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;people6&quot;</span> factory<span class="token operator">-</span>bean<span class="token operator">=</span><span class="token string">&quot;peopleFactory&quot;</span> factory<span class="token operator">-</span>method<span class="token operator">=</span><span class="token string">&quot;createPeople&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>工厂模式的静态方法<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;people7&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.java.factory.PeopleFactory&quot;</span> factory<span class="token operator">-</span>method<span class="token operator">=</span><span class="token string">&quot;createPeople1&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
        
 <span class="token comment">//工厂方式注入，非静态</span>
<span class="token class-name">People</span> people6<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">)</span>ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;people6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>people6<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//工厂方式注入，静态</span>
<span class="token class-name">People</span> people7<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">)</span>ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;people7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>people7<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="基于autowired-的三种注入方式"><a href="#基于autowired-的三种注入方式" class="header-anchor">#</a> 基于Autowired 的三种注入方式</h4> <p>https://stackoverflow.com/questions/39890849/what-exactly-is-field-injection-and-how-to-avoid-it</p> <p>https://medium.com/@ilyailin7777/all-dependency-injection-types-spring-336da7baf51b</p> <p>如果你使用的是构造器注入
恭喜你，当你有十几个甚至更多对象需要注入时，你的构造函数的参数个数可能会长到无法想像。</p> <p>如果你使用的是field反射注入
如果不使用Spring框架，这个属性只能通过反射注入，太麻烦了！这根本不符合JavaBean规范。
还有，当你不是用过Spring创建的对象时，还可能引起NullPointerException。
并且，你不能用final修饰这个属性。</p> <p>如果你使用的是setter方法注入
那么你将不能将属性设置为final。
两者取其轻</p> <p>Spring3.0官方文档建议使用setter注入覆盖构造器注入。
Spring4.0官方文档建议使用构造器注入。
结论</p> <p>如果注入的属性是必选的属性，则通过构造器注入。
如果注入的属性是可选的属性，则通过setter方法注入。
至于field注入，不建议使用。</p> <ul><li><p>通过field反射注入, field injection (不推荐)</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dependency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">Dependency</span> dependency<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
     
</code></pre></div></li> <li><p>通过构造器注入</p> <div class="language- extra-class"><pre class="language-text"><code>public class DI(){
	//通过构造器注入
	private DependencyA a;
	@Autowired
	public DI(DependencyA a){
		this.a = a;
	}
   
}
</code></pre></div></li> <li><p>通过setter方法注入</p> <div class="language- extra-class"><pre class="language-text"><code>public class DI(){
	//通过setter方法注入
	private DependencyB b;
	@Autowired
	public void setDependencyB(DependencyB b){
		this.b = b;
	}
    
}
     
</code></pre></div></li></ul> <h3 id="_1-2-javaconfig与常见annotation"><a href="#_1-2-javaconfig与常见annotation" class="header-anchor">#</a> 1.2. JavaConfig与常见Annotation</h3> <p><strong>1.2.1. JavaConfig</strong></p> <p>@SpringBootApplication 等同于 @EnableAutoConfiguration + @ComponentScan + @Configuration, 后面启动原理部分有详解</p> <p>All of your application components (@Component, @Service, @Repository, @Controller etc.) are automatically registered as Spring Beans.</p> <p>Components(@Component @Service @Controller @Repository) VS Beans (@Beans):
all component types are treated in the same way. The subtypes are mere markers, think code readability rather than features.
https://www.tomaszezula.com/2014/02/09/spring-series-part-5-component-vs-bean/</p> <p><strong>1.2.2. @ComponentScan</strong></p> <p><strong>1.2.3. @Import</strong></p> <p>在4.2之前， @Import注解只支持导入配置类，但是在4.2之后，它支持导入普通类</p> <p><strong>1.2.4. @Conditional @ConditionalOn*</strong></p> <p>表示在满足某种条件后才初始化一个bean或者启用某些配置。它一般用在由 @Component、 @Service、 @Configuration等注解标识的类上面，或者由 @Bean标记的方法上。如果一个 @Configuration类标记了 @Conditional，则该类中所有标识了 @Bean的方法和 @Import注解导入的相关类将遵从这些条件。</p> <p><strong>1.2.5. @ConfigurationProperties与@EnableConfigurationProperties</strong></p> <p>当某些属性的值需要配置的时候，我们一般会在 application.properties文件中新建配置项，然后在bean中使用 @Value注解来获取配置的值;</p> <div class="language- extra-class"><pre class="language-text"><code>@Configuration
public class MyBatisConfiguration { 
	@Value(&quot;${spring.datasource.driverClassName}&quot;)
    private String jdbcDriverClassName;
	@Value(&quot;${spring.datasource.url}&quot;)
    private String jdbcUrl;
    @Value(&quot;${spring.datasource.username}&quot;)
    private String jdbcUsername;
    @Value(&quot;${spring.datasource.password}&quot;)
    private String jdbcPassword;
    
	@Bean(name = &quot;dataSource&quot;,destroyMethod = &quot;close&quot;)
    public DataSource dataSource() {
    	DruidDataSource datasource = new DruidDataSource();
    	datasource.setDriverClassName(jdbcDriverClassName);
    	datasource.setUrl(jdbcUrl);
    	datasource.setUsername(jdbcUsername);
    	datasource.setPassword(jdbcPassword);
        return datasource;
    }
	
	@Bean(name = {&quot;sqlSessionFactory&quot;})
	@ConditionalOnMissingBean(name = {&quot;sqlSessionFactory&quot;})
	public SqlSessionFactory sqlSessionFactory(DataSource dataSource) throws Exception {
	....
</code></pre></div><p>但是如果同一个配置在多个地方使用，也存在不方便维护的问题，对于更为复杂的配置，Spring Boot提供了更优雅的实现方式，那就是 @ConfigurationProperties注解
而@EnableConfigurationProperties的作用是将其注册为bean，否则项目不会将其scan为bean，具体：</p> <blockquote><p>In order to use a configuration class in our project, we need to register it as a regular Spring bean.</p></blockquote> <blockquote><p>First of all, we can annotate such a class with @Component. Alternatively, we can use a @Bean factory method.</p></blockquote> <blockquote><p>However, <strong>in certain situations, we may prefer to keep a @ConfigurationProperties class as a simple POJO</strong>. This is when @EnableConfigurationProperties comes in handy. We can specify all configuration beans directly on this annotation.</p></blockquote> <blockquote><p>This is a convenient way to quickly register @ConfigurationProperties annotated beans.</p></blockquote> <p>通过上面等表述，我们大概知道，如果用@component就会将其变成增强类，而不是plain old java object了，而是多了很多冗余的功能；</p> <div class="language- extra-class"><pre class="language-text"><code>@ConfigurationProperties(prefix = &quot;additional&quot;)
public class AdditionalProperties {
 
    private String unit;
    private int max;
 
    // standard getters and setters
}
@Configuration
@EnableConfigurationProperties(AdditionalProperties.class)
public class AdditionalConfiguration {
     
    @Autowired
    private AdditionalProperties additionalProperties;
     
    // make use of the bound properties
}
</code></pre></div><p><strong>1.2.6 配置属性加载顺序</strong></p> <div class="language- extra-class"><pre class="language-text"><code>1、开发者工具 `Devtools` 全局配置参数；

2、单元测试上的 `@TestPropertySource` 注解指定的参数；

3、单元测试上的 `@SpringBootTest` 注解指定的参数；

4、命令行指定的参数，如 `java -jar springboot.jar --name=&quot;Java技术栈&quot;`；

5、命令行中的 `SPRING_APPLICATION_JSONJSON` 指定参数, 如 `java -Dspring.application.json='{&quot;name&quot;:&quot;Java技术栈&quot;}' -jar springboot.jar`

6、`ServletConfig` 初始化参数；

7、`ServletContext` 初始化参数；

8、JNDI参数（如 `java:comp/env/spring.application.json`）；

9、Java系统参数（来源：`System.getProperties()`）；

10、操作系统环境变量参数；

11、`RandomValuePropertySource` 随机数，仅匹配：`ramdom.*`；

12、JAR包外面的配置文件参数（`application-{profile}.properties（YAML）`）

13、JAR包里面的配置文件参数（`application-{profile}.properties（YAML）`）

14、JAR包外面的配置文件参数（`application.properties（YAML）`）

15、JAR包里面的配置文件参数（`application.properties（YAML）`）

16、`@Configuration`配置文件上 `@PropertySource` 注解加载的参数；

17、默认参数（通过 `SpringApplication.setDefaultProperties` 指定）；
</code></pre></div><h3 id="_1-3-启动加载器-springfactoriesloader"><a href="#_1-3-启动加载器-springfactoriesloader" class="header-anchor">#</a> 1.3. 启动加载器 SpringFactoriesLoader</h3> <p>JVM提供了3种类加载器： BootstrapClassLoader、 ExtClassLoader、 AppClassLoader分别加载Java核心类库、扩展类库以及应用的类路径( CLASSPATH)下的类库。JVM通过双亲委派模型进行类的加载，我们也可以通过继承 java.lang.classloader实现自己的类加载器。</p> <p>何为双亲委派模型？当一个类加载器收到类加载任务时，会先交给自己的父加载器去完成，因此最终加载任务都会传递到最顶层的BootstrapClassLoader，只有当父加载器无法完成加载任务时，才会尝试自己来加载。</p> <p>采用双亲委派模型的一个好处是保证使用不同类加载器最终得到的都是同一个对象，这样就可以保证Java 核心库的类型安全，比如，加载位于rt.jar包中的 java.lang.Object类，不管是哪个加载器加载这个类，最终都是委托给顶层的BootstrapClassLoader来加载的，这样就可以保证任何的类加载器最终得到的都是同样一个Object对象。</p> <p>SpringFactoriesLoader，它本质上属于Spring框架私有的一种扩展方案，类似于SPI，Spring Boot在Spring基础上的很多核心功能都是基于此</p> <h3 id="_1-4-spring容器的事件监听机制"><a href="#_1-4-spring容器的事件监听机制" class="header-anchor">#</a> 1.4. Spring容器的事件监听机制</h3> <p>Java提供了实现事件监听机制的两个基础类：自定义事件类型扩展自 java.util.EventObject、事件的监听器扩展自 java.util.EventListener</p> <p>Spring的ApplicationContext容器内部中的所有事件类型均继承自 org.springframework.context.AppliationEvent，容器中的所有监听器都实现 org.springframework.context.ApplicationListener接口，并且以bean的形式注册在容器中。一旦在容器内发布ApplicationEvent及其子类型的事件，注册到容器的ApplicationListener就会对这些事件进行处理。</p> <p>ApplicationEvent继承自EventObject，Spring提供了一些默认的实现，比如： ContextClosedEvent表示容器在即将关闭时发布的事件类型， ContextRefreshedEvent表示容器在初始化或者刷新的时候发布的事件类型......</p> <p>容器内部使用ApplicationListener作为事件监听器接口定义，它继承自EventListener。ApplicationContext容器在启动时，会自动识别并加载EventListener类型的bean，一旦容器内有事件发布，将通知这些注册到容器的EventListener。</p> <p>ApplicationContext接口继承了ApplicationEventPublisher接口，该接口提供了 voidpublishEvent(ApplicationEventevent)方法定义，不难看出，ApplicationContext容器担当的就是事件发布者的角色。如果有兴趣可以查看 AbstractApplicationContext.publishEvent(ApplicationEventevent)方法的源码：ApplicationContext将事件的发布以及监听器的管理工作委托给 ApplicationEventMulticaster接口的实现类。在容器启动时，会检查容器内是否存在名为applicationEventMulticaster的ApplicationEventMulticaster对象实例。如果有就使用其提供的实现，没有就默认初始化一个SimpleApplicationEventMulticaster作为实现。</p> <p>最后，如果我们业务需要在容器内部发布事件，只需要为其注入ApplicationEventPublisher依赖即可：实现ApplicationEventPublisherAware接口或者ApplicationContextAware接口</p> <h3 id="_1-5-自动配置原理"><a href="#_1-5-自动配置原理" class="header-anchor">#</a> 1.5. 自动配置原理</h3> <p>@SpringBootApplication开启<strong>组件扫描和自动配置</strong>，
而 SpringApplication.run则负责<strong>启动引导应用程序</strong>。 @SpringBootApplication是一个复合 Annotation，它将三个注解组合在一起：</p> <ul><li><p><strong>@SpringBootConfiguration</strong>就是 @Configuration，它是Spring框架的注解，标明该类是一个 JavaConfig配置类; allow to register extra beans in the context or import additional configuration classes;</p></li> <li><p><strong>@ComponentScan</strong>启用组件扫描;enable @Component scan on the package where the application is located;</p></li> <li><p><strong>@EnableAutoConfiguration</strong>注解：
表示开启Spring Boot自动配置功能，Spring Boot会根据应用的依赖、自定义的bean、classpath下有没有某个类 等等因素来猜测你需要的bean，然后注册到IOC容器中;
enable <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-auto-configuration" target="_blank" rel="noopener noreferrer">Spring Boot’s auto-configuration mechanism<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <p><em>Notes:</em></p> <blockquote><p>You should only ever add one @SpringBootApplication or @EnableAutoConfiguration annotation. We generally recommend that you add one or the other to your primary @Configuration class only.
https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-auto-configuration</p></blockquote> <p>开始讲解原理，先看EnableAutoConfiguration：</p> <div class="language- extra-class"><pre class="language-text"><code>@Target(value=TYPE)
 @Retention(value=RUNTIME)
 @Documented
 @Inherited
 @AutoConfigurationPackage
 @Import(value=AutoConfigurationImportSelector.class)
public @interface EnableAutoConfiguration
</code></pre></div><p>重点是@Import(EnableAutoConfigurationImportSelector.class)，这里它将把 EnableAutoConfigurationImportSelector作为bean注入到容器中，</p> <div class="language- extra-class"><pre class="language-text"><code>@Override
	public String[] selectImports(AnnotationMetadata metadata) {
		try {
			AnnotationAttributes attributes = getAttributes(metadata);
			List&lt;String&gt; configurations = getCandidateConfigurations(metadata,
					attributes);
			configurations = removeDuplicates(configurations);
			Set&lt;String&gt; exclusions = getExclusions(metadata, attributes);
			configurations.removeAll(exclusions);
			configurations = sort(configurations);
			recordWithConditionEvaluationReport(configurations, exclusions);
			return configurations.toArray(new String[configurations.size()]);
		}
		catch (IOException ex) {
			throw new IllegalStateException(ex);
		}
	}
</code></pre></div><p>EnableAutoConfigurationImportSelector.selectImports()是何时执行的？其实这个方法会在容器启动过程中执行： AbstractApplicationContext.refresh(),
这个EnableAutoConfigurationImportSelector类会扫描所有的jar包，将所有符合条件的@Configuration配置类注入的容器中，何为符合条件，看看 META-INF/spring.factories的文件内容：</p> <div class="language- extra-class"><pre class="language-text"><code>https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/resources/META-INF/spring.factories
.....
org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\
.....
</code></pre></div><p>然后举例看 DataSourceAutoConfiguration：</p> <div class="language- extra-class"><pre class="language-text"><code>https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/DataSourceAutoConfiguration.java
@Configuration(proxyBeanMethods = false)
@ConditionalOnClass({ DataSource.class, EmbeddedDatabaseType.class })
@ConditionalOnMissingBean(type = &quot;io.r2dbc.spi.ConnectionFactory&quot;)
@EnableConfigurationProperties(DataSourceProperties.class)
@Import({ DataSourcePoolMetadataProvidersConfiguration.class, DataSourceInitializationConfiguration.class })
public class DataSourceAutoConfiguration {
</code></pre></div><p>@ConditionalOnClass({DataSource.class,EmbeddedDatabaseType.class})：当Classpath中存在DataSource或者EmbeddedDatabaseType类时才启用这个配置，否则这个配置将被忽略。
注意上面的DataSourceProperties，
@EnableConfigurationProperties(DataSourceProperties.class)：将DataSource的默认配置类注入到IOC容器中，DataSourceproperties定义为：</p> <div class="language- extra-class"><pre class="language-text"><code>@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)
public class DataSourceProperties implements BeanClassLoaderAware, InitializingBean {
	private ClassLoader classLoader;
	/**
	 * Name of the datasource. Default to &quot;testdb&quot; when using an embedded database.
	 */
	private String name;
	/**
	 * Whether to generate a random datasource name.
	 */
	private boolean generateUniqueName = true;
	/**
	 * Fully qualified name of the connection pool implementation to use. By default, it
	 * is auto-detected from the classpath.
	 */
	private Class&lt;? extends DataSource&gt; type;

	/**
	 * Fully qualified name of the JDBC driver. Auto-detected based on the URL by default.
	 */
	private String driverClassName;

	/**
	 * JDBC URL of the database.
	 */
	private String url;

	/**
	 * Login username of the database.
	 */
	private String username;

	/**
	 * Login password of the database.
	 */
	private String password;
	
</code></pre></div><p>很清晰对应配置spring.datasource，然后是连接池配置：</p> <p>@Import({ Registrar.class, DataSourcePoolMetadataProvidersConfiguration.class })：导入其他额外的配置，就以DataSourcePoolMetadataProvidersConfiguration为例吧,
DataSourcePoolMetadataProvidersConfiguration是数据库连接池提供者的一个配置类，即Classpath中存在 org.apache.tomcat.jdbc.pool.DataSource.class，则使用tomcat-jdbc连接池，如果Classpath中存在 HikariDataSource.class则使用Hikari连接池。</p> <h2 id="_2-springapplication启动流程"><a href="#_2-springapplication启动流程" class="header-anchor">#</a> 2. SpringApplication启动流程</h2> <h3 id="_2-1-springapplication初始化"><a href="#_2-1-springapplication初始化" class="header-anchor">#</a> 2.1. SpringApplication初始化</h3> <p>SpringBoot整个启动流程分为两个步骤：初始化一个SpringApplication对象、执行该对象的run方法。看下SpringApplication的初始化流程，SpringApplication的构造方法：</p> <div class="language- extra-class"><pre class="language-text"><code>public SpringApplication(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources) {
	this.resourceLoader = resourceLoader;
	Assert.notNull(primarySources, &quot;PrimarySources must not be null&quot;);
	this.primarySources = new LinkedHashSet&lt;&gt;(Arrays.asList(primarySources));
	this.webApplicationType = WebApplicationType.deduceFromClasspath();
	setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));
	setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));
	this.mainApplicationClass = deduceMainApplicationClass();
}
</code></pre></div><p>初始化流程中最重要的就是通过 SpringFactoriesLoader 找到 spring.factories 文件中配置的 ApplicationContextInitializer 和 ApplicationListener 两个接口的实现类名称，以便后期构造相应的实例。 ApplicationContextInitializer 的主要目的是在 ConfigurableApplicationContext 做 refresh之前，对ConfigurableApplicationContext实例做进一步的设置或处理。ConfigurableApplicationContext继承自 ApplicationContext ，其主要提供了对 ApplicationContext 进行设置的能力。</p> <p>Spring Boot提供两种方式来添加<strong>自定义监听器</strong>：</p> <p>通过 SpringApplication.addListeners()或者 SpringApplication.setListeners()两个方法来添加一个或者多个自定义监听器</p> <p>既然SpringApplication的初始化流程中已经从 spring.factories中获取到 ApplicationListener的实现类，那么我们直接在自己的jar包的 META-INF/spring.factories文件中新增配置即可：</p> <h3 id="_2-2-启动流程"><a href="#_2-2-启动流程" class="header-anchor">#</a> 2.2. 启动流程</h3> <p>Spring Boot应用的整个启动流程都封装在 SpringApplication.run 方法中，其整个流程真的是太长太长了，但本质上就是在Spring容器启动的基础上做了大量的扩展，按照这个思路来看看源码</p> <div class="language- extra-class"><pre class="language-text"><code>/**
	 * Run the Spring application, creating and refreshing a new
	 * {@link ApplicationContext}.
	 * @param args the application arguments (usually passed from a Java main method)
	 * @return a running {@link ApplicationContext}
	 */
	public ConfigurableApplicationContext run(String... args) {
		StopWatch stopWatch = new StopWatch();
		stopWatch.start();
		ConfigurableApplicationContext context = null;
		Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = new ArrayList&lt;&gt;();
		configureHeadlessProperty();
		SpringApplicationRunListeners listeners = getRunListeners(args);
		listeners.starting();
		try {
			ApplicationArguments applicationArguments = new DefaultApplicationArguments(args);
			ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments);
			configureIgnoreBeanInfo(environment);
			Banner printedBanner = printBanner(environment);
			context = createApplicationContext();
			exceptionReporters = getSpringFactoriesInstances(SpringBootExceptionReporter.class,
					new Class[] { ConfigurableApplicationContext.class }, context);
			prepareContext(context, environment, listeners, applicationArguments, printedBanner);
			refreshContext(context);
			afterRefresh(context, applicationArguments);
			stopWatch.stop();
			if (this.logStartupInfo) {
				new StartupInfoLogger(this.mainApplicationClass).logStarted(getApplicationLog(), stopWatch);
			}
			listeners.started(context);
			callRunners(context, applicationArguments);
		}
		catch (Throwable ex) {
			handleRunFailure(context, ex, exceptionReporters, listeners);
			throw new IllegalStateException(ex);
		}

		try {
			listeners.running(context);
		}
		catch (Throwable ex) {
			handleRunFailure(context, ex, exceptionReporters, null);
			throw new IllegalStateException(ex);
		}
		return context;
	}
</code></pre></div><ol><li><p>通过 SpringFactoriesLoader 查找并加载所有的 SpringApplicationRunListeners，通过调用starting()方法通知所有的SpringApplicationRunListener：应用开始启动了。SpringApplicationRunListener 其本质上就是一个事件发布者，它在SpringBoot应用启动的不同时间点发布不同应用事件类型(ApplicationEvent)，如果有哪些事件监听者(ApplicationListener)对这些事件感兴趣，则可以接收并且处理。前面的初始化流程中，SpringApplication 加载了一系列 ApplicationListener。发布事件的代码已经在SpringApplicationRunListeners中实现了。
SpringApplicationRunListener只有一个实现类： EventPublishingRunListener。此处的代码只会返回一个 SpringApplicationRunListeners ，注意后面多了一个s字母，看下源码就会发现该类就是包含了一个SpringApplicationRunListener的List。操作SpringApplicationRunListeners ，在内部会遍历每一个SpringApplicationRunListener，调用每一个SpringApplicationRunListener的实现类的starting方法</p></li> <li><p>创建并配置当前应用将要使用的 Environment，Environment用于描述应用程序当前的运行环境，其抽象了两个方面的内容：配置文件(profile)和属性(properties)，开发经验丰富的同学对这两个东西一定不会陌生：不同的环境(eg：生产环境、预发布环境)可以使用不同的配置文件，而属性则可以从配置文件、环境变量、命令行参数等来源获取。因此，当Environment准备好后，在整个应用的任何时候，都可以从Environment中获取资源。</p> <p>总结起来，主要完成以下几件事：</p> <ul><li><p>判断Environment是否存在，不存在就创建（如果是web项目就创建 StandardServletEnvironment，否则创建 StandardEnvironment）</p></li> <li><p>配置Environment：配置profile以及properties</p></li> <li><p>调用SpringApplicationRunListener的 environmentPrepared()方法，通知事件监听者：应用的Environment已经准备好</p></li></ul></li> <li><p>打印Banner图案</p></li> <li><p>根据不同的ApplicationType创建不同的Context，具体的类型回顾初始化中App类型的介绍</p></li> <li><p>初始化ApplicationContext，主要完成以下工作：</p> <ul><li><p>将准备好的Environment设置给ApplicationContext</p></li> <li><p>遍历调用所有的ApplicationContextInitializer的 initialize()方法来对已经创建好的ApplicationContext进行进一步的处理</p></li> <li><p>调用SpringApplicationRunListener的 contextPrepared()方法，通知所有的监听者：ApplicationContext已经准备完毕</p></li> <li><p>将所有的bean加载到容器中</p></li> <li><p>调用SpringApplicationRunListener的 contextLoaded()方法，通知所有的监听者：ApplicationContext已经装载完毕</p></li></ul></li> <li><p>refresh完成配置类的解析、各种BeanFactoryPostProcessor和BeanPostProcessor的注册、国际化配置的初始化、web内置容器的构造等等。</p></li></ol> <p>以上就是Spring Boot的整个启动流程，其核心就是在Spring容器初始化并启动的基础上加入各种扩展点，这些扩展点包括：</p> <ul><li>ApplicationContextInitializer</li> <li>ApplicationListener</li> <li>自动配置自定义
org.springframework.boot.env.EnvironmentPostProcessor:
Allows for customization of the application's {@link Environment} prior to the application context being refreshed.</li> <li>各种BeanFactoryPostProcessor等等
org.springframework.beans.factory.config.BeanFactoryPostProcessor：
允许我们在容器实例化相应对象之前，对注册到容器的BeanDefinition所保存的信息做一些额外的操作，比如修改bean定义的某些属性或者增加其他信息等。</li></ul> <h2 id="_3-使用springboot开发应用"><a href="#_3-使用springboot开发应用" class="header-anchor">#</a> 3. 使用springboot开发应用</h2> <h3 id="_3-0-项目技巧"><a href="#_3-0-项目技巧" class="header-anchor">#</a> 3.0 项目技巧</h3> <h4 id="include"><a href="#include" class="header-anchor">#</a> include</h4> <p>application.yml</p> <p>application-datasource.yml</p> <div class="language- extra-class"><pre class="language-text"><code>spring:
  profiles:
    #split into multiple profile files
    include: datasource
</code></pre></div><h4 id="multiple-env-dev-prod"><a href="#multiple-env-dev-prod" class="header-anchor">#</a> multiple env: dev prod</h4> <p>application.properties</p> <div class="language- extra-class"><pre class="language-text"><code>spring.profiles.active:@spring.profiles.active@
</code></pre></div><p>application-dev.yml</p> <p>application-prod.yml</p> <div class="language- extra-class"><pre class="language-text"><code>mvn spring-boot:run -Dspring.profiles.active=dev
mvn clean install -Dspring.profiles.active=dev
</code></pre></div><p>~pom.xml(不需要）~</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;profiles&gt;
        &lt;profile&gt;
            &lt;id&gt;dev&lt;/id&gt;
            &lt;properties&gt;
                &lt;myActiveProfile&gt;dev&lt;/myActiveProfile&gt;
            &lt;/properties&gt;
        &lt;/profile&gt;
        &lt;profile&gt;
            &lt;id&gt;prod&lt;/id&gt;
            &lt;properties&gt;
                &lt;myActiveProfile&gt;prod&lt;/myActiveProfile&gt;
            &lt;/properties&gt;
        &lt;/profile&gt;
    &lt;/profiles&gt;
</code></pre></div><h3 id="_3-1-业务开发"><a href="#_3-1-业务开发" class="header-anchor">#</a> 3.1 业务开发</h3> <h4 id="_3-1-1-使用starter"><a href="#_3-1-1-使用starter" class="header-anchor">#</a> 3.1.1 使用starter</h4> <h5 id="pom-depenedency"><a href="#pom-depenedency" class="header-anchor">#</a> POM depenedency</h5> <p>spring boot官方提供了很多现成的starter，可以直接引用其depdendency使用比如
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-starter" target="_blank" rel="noopener noreferrer">starters<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <table><thead><tr><th><code>spring-boot-starter</code></th> <th>Core starter, including auto-configuration support, logging and YAML</th></tr></thead> <tbody><tr><td>spring-boot-starter-web</td> <td>Starter for building web, including RESTful, applications using Spring MVC. Uses Tomcat as the default embedded container</td></tr> <tr><td>spring-boot-starter-jdbc</td> <td>Starter for using JDBC with the HikariCP connection pool</td></tr></tbody></table> <p>但是问题是引用时需要加版本号，很多starter之间以及跟其他的dependency之间可能有版本依赖冲突，
所以官方推荐使用parent方式或者import方式引入某个版本的spring-boot-starter-parent，因为这个parent里面已经定义好了各个版本号，
所以在引用比如spring-boot-starter-web的时候就不需要添加版本号了</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;!-- Inherit defaults from Spring Boot --&gt;
&lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;
&lt;/parent&gt;

&lt;dependencyManagement&gt;
	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;
&lt;/dependencyManagement&gt;

&lt;!--The spring-boot-starter-parent POM includes &lt;executions&gt; configuration to bind the repackage goal.--&gt;
&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;

&lt;!-- Dependence Override 
full list: https://github.com/spring-projects/spring-boot/blob/v2.2.6.RELEASE/spring-boot-project/spring-boot-dependencies/pom.xml
--&gt;
&lt;properties&gt;
    &lt;spring-data-releasetrain.version&gt;Fowler-SR2&lt;/spring-data-releasetrain.version&gt;
&lt;/properties&gt;

</code></pre></div><h5 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h5> <p>默认是 application.properties，也可以使用yaml</p> <p>都在这里：</p> <p>https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html</p> <p>另外一种稍微硬核的通过查阅代码获取的方式：</p> <p>所有的配置都可以在 spring-boot-autoconfigure里面找到，比如</p> <p>org.springframework.boot.autoconfigure.data.redis/RedisProperties</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.redis&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisProperties</span> <span class="token punctuation">{</span>

	<span class="token comment">/**
	 * Database index used by the connection factory.
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">int</span> database <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * Connection URL. Overrides host, port, and password. User is ignored. Example:
	 * redis://user:password@example.com:6379
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>

	<span class="token comment">/**
	 * Redis server host.
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * Login password of the redis server.
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

	<span class="token comment">/**
	 * Redis server port.
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">6379</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * Whether to enable SSL support.
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> ssl<span class="token punctuation">;</span>

	<span class="token comment">/**
	 * Connection timeout.
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">Duration</span> timeout<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">Sentinel</span> sentinel<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">Cluster</span> cluster<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Lettuce</span> lettuce <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lettuce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>database<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDatabase</span><span class="token punctuation">(</span><span class="token keyword">int</span> database<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>database <span class="token operator">=</span> database<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>host<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setHost</span><span class="token punctuation">(</span><span class="token class-name">String</span> host<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>host <span class="token operator">=</span> host<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> password<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>port<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPort</span><span class="token punctuation">(</span><span class="token keyword">int</span> port<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>port <span class="token operator">=</span> port<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSsl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ssl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> ssl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>ssl <span class="token operator">=</span> ssl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>timeout <span class="token operator">=</span> timeout<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Duration</span> <span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>timeout<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Sentinel</span> <span class="token function">getSentinel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sentinel<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSentinel</span><span class="token punctuation">(</span><span class="token class-name">Sentinel</span> sentinel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>sentinel <span class="token operator">=</span> sentinel<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Cluster</span> <span class="token function">getCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cluster<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCluster</span><span class="token punctuation">(</span><span class="token class-name">Cluster</span> cluster<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>cluster <span class="token operator">=</span> cluster<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Jedis</span> <span class="token function">getJedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jedis<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Lettuce</span> <span class="token function">getLettuce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lettuce<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * Pool properties.
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Pool</span> <span class="token punctuation">{</span>

		<span class="token comment">/**
		 * Maximum number of &quot;idle&quot; connections in the pool. Use a negative value to
		 * indicate an unlimited number of idle connections.
		 */</span>
		<span class="token keyword">private</span> <span class="token keyword">int</span> maxIdle <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>

		<span class="token comment">/**
		 * Target for the minimum number of idle connections to maintain in the pool. This
		 * setting only has an effect if it is positive.
		 */</span>
		<span class="token keyword">private</span> <span class="token keyword">int</span> minIdle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

		<span class="token comment">/**
		 * Maximum number of connections that can be allocated by the pool at a given
		 * time. Use a negative value for no limit.
		 */</span>
		<span class="token keyword">private</span> <span class="token keyword">int</span> maxActive <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>

		<span class="token comment">/**
		 * Maximum amount of time a connection allocation should block before throwing an
		 * exception when the pool is exhausted. Use a negative value to block
		 * indefinitely.
		 */</span>
		<span class="token keyword">private</span> <span class="token class-name">Duration</span> maxWait <span class="token operator">=</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMaxIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxIdle<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMaxIdle</span><span class="token punctuation">(</span><span class="token keyword">int</span> maxIdle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>maxIdle <span class="token operator">=</span> maxIdle<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMinIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>minIdle<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMinIdle</span><span class="token punctuation">(</span><span class="token keyword">int</span> minIdle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>minIdle <span class="token operator">=</span> minIdle<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMaxActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxActive<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMaxActive</span><span class="token punctuation">(</span><span class="token keyword">int</span> maxActive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>maxActive <span class="token operator">=</span> maxActive<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token class-name">Duration</span> <span class="token function">getMaxWait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxWait<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMaxWait</span><span class="token punctuation">(</span><span class="token class-name">Duration</span> maxWait<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>maxWait <span class="token operator">=</span> maxWait<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * Cluster properties.
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Cluster</span> <span class="token punctuation">{</span>

		<span class="token comment">/**
		 * Comma-separated list of &quot;host:port&quot; pairs to bootstrap from. This represents an
		 * &quot;initial&quot; list of cluster nodes and is required to have at least one entry.
		 */</span>
		<span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> nodes<span class="token punctuation">;</span>

		<span class="token comment">/**
		 * Maximum number of redirects to follow when executing commands across the
		 * cluster.
		 */</span>
		<span class="token keyword">private</span> <span class="token class-name">Integer</span> maxRedirects<span class="token punctuation">;</span>

		<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNodes</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> nodes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>nodes <span class="token operator">=</span> nodes<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getMaxRedirects</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxRedirects<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMaxRedirects</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> maxRedirects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>maxRedirects <span class="token operator">=</span> maxRedirects<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment">/**
	 * Lettuce client properties.
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Lettuce</span> <span class="token punctuation">{</span>

		<span class="token comment">/**
		 * Shutdown timeout.
		 */</span>
		<span class="token keyword">private</span> <span class="token class-name">Duration</span> shutdownTimeout <span class="token operator">=</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">/**
		 * Lettuce pool configuration.
		 */</span>
		<span class="token keyword">private</span> <span class="token class-name">Pool</span> pool<span class="token punctuation">;</span>

		<span class="token keyword">public</span> <span class="token class-name">Duration</span> <span class="token function">getShutdownTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shutdownTimeout<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setShutdownTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span> shutdownTimeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>shutdownTimeout <span class="token operator">=</span> shutdownTimeout<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token class-name">Pool</span> <span class="token function">getPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pool<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPool</span><span class="token punctuation">(</span><span class="token class-name">Pool</span> pool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>pool <span class="token operator">=</span> pool<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>可以看到前缀是 spring.redis ，具体配置举例：</p> <ul><li><p>其中最简单的string类型</p> <div class="language- extra-class"><pre class="language-text"><code>spring.redis.host=x.x.x.48
spring.redis.port=6379
</code></pre></div></li> <li><p>复杂类型如private Cluster cluster，很简单，进去看Cluster的成员即可，只是注意maxRedirects在application.properties写作：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.redis.cluster.nodes=x.x.x.48:6379,x.x.x.48:6380,x.x.x.48:6381,x.x.x.49:6379,x.x.x.49:6380,x.x.x.49:6381,x.x.x.50:6379,x.x.x.50:6380,x.x.x.50:6381
spring.redis.cluster.max-redirects=3
</code></pre></div></li> <li><p>使用yaml</p> <div class="language- extra-class"><pre class="language-text"><code>spring:
  #Redis缓存配置(RedisProperties)
  redis:
#    database: 0
#    host: localhost
#    port: 6380
#    password:
    #timeout: 6000
    #redis cluster
    cluster:
      nodes: 1.1.1.1:6379,1.1.1.1:6380,1.1.1.1:6381
      maxRedirects: 3
    lettuce:
      pool:
        max-active: 200
        max-wait: 3000
        max-idle: -1
        min-idle: 10
</code></pre></div></li></ul> <h6 id="案例分析"><a href="#案例分析" class="header-anchor">#</a> 案例分析：</h6> <p>某次项目使用 spring-boot-starter版本为2.0.5</p> <div class="language- extra-class"><pre class="language-text"><code>    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.0.5.RELEASE&lt;/version&gt;
        &lt;relativePath /&gt;
    &lt;/parent&gt;
</code></pre></div><p>使用其 spring-boot-starter-data-redis 遇到RedisExcpetion 后来没能重现，不过也能重现出类似的WARN级别信息：</p> <p>l.c.c.t.ClusterTopologyRefresh^[[m : Unable to connect to xxxx:6379</p> <p>java.util.concurrent.CompletionException: io.netty.channel.ConnectTimeoutException: connection timed out: /xxxx:6379</p> <p>经过查阅，client端的RedisConnectionFactory需要增加 ClusterTopologyRefreshOptions  这个option，</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisProperties</span> redisProperties<span class="token punctuation">;</span>
 
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${redis.maxRedirects:3}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> maxRedirects<span class="token punctuation">;</span>
 
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${redis.refreshTime:5}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> refreshTime<span class="token punctuation">;</span>
 
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">LettuceConnectionFactory</span> <span class="token function">redisConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 
        <span class="token class-name">RedisClusterConfiguration</span> redisClusterConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisClusterConfiguration</span><span class="token punctuation">(</span>redisProperties<span class="token punctuation">.</span><span class="token function">getCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        redisClusterConfiguration<span class="token punctuation">.</span><span class="token function">setMaxRedirects</span><span class="token punctuation">(</span>maxRedirects<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token operator">/</span> <span class="token operator">/</span> <span class="token class-name">Support</span> adaptive cluster topology refresh and <span class="token keyword">static</span> refresh source
        <span class="token class-name">ClusterTopologyRefreshOptions</span> clusterTopologyRefreshOptions <span class="token operator">=</span>  <span class="token class-name">ClusterTopologyRefreshOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">enablePeriodicRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">enableAllAdaptiveRefreshTriggers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">refreshPeriod</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span>refreshTime<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token class-name">ClusterClientOptions</span> clusterClientOptions <span class="token operator">=</span> <span class="token class-name">ClusterClientOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">topologyRefreshOptions</span><span class="token punctuation">(</span>clusterTopologyRefreshOptions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
                 <span class="token operator">/</span> <span class="token operator">/</span> <span class="token class-name">From</span> the priority<span class="token punctuation">,</span> read and write separation<span class="token punctuation">,</span> read from the possible inconsistency<span class="token punctuation">,</span> the <span class="token keyword">final</span> consistency CP
        <span class="token class-name">LettuceClientConfiguration</span> lettuceClientConfiguration <span class="token operator">=</span> <span class="token class-name">LettuceClientConfiguration</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">readFrom</span><span class="token punctuation">(</span><span class="token class-name">ReadFrom</span><span class="token punctuation">.</span>SLAVE_PREFERRED<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">clientOptions</span><span class="token punctuation">(</span>clusterClientOptions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LettuceConnectionFactory</span><span class="token punctuation">(</span>redisClusterConfiguration<span class="token punctuation">,</span> lettuceClientConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>而实际上为什么这个不提供配置呢，查阅了前面说的官方配置：</p> <p>https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html</p> <p>发现实际有这个选项</p> <div class="language- extra-class"><pre class="language-text"><code>spring.redis.lettuce.cluster.refresh.dynamic-refresh-sources
spring.redis.lettuce.cluster.refresh.period
</code></pre></div><p>而进一步看到第一个config是在spring boot 2.4.0引入的</p> <p>https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.4.0-Configuration-Changelog</p> <p>而第二个period是2.3.0</p> <p>https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.3.0-Configuration-Changelog</p> <p>直接搜源码 ClusterTopologyRefreshOptions 确认下：</p> <p>https://github.com/spring-projects/spring-boot/blob/47516b50c39bd6ea924a1f6720ce6d4a71088651/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/redis/LettuceConnectionConfiguration.java</p> <p>点击blame，找到这行</p> <div class="language- extra-class"><pre class="language-text"><code>			if (refreshProperties.getPeriod() != null) {
				refreshBuilder.enablePeriodicRefresh(refreshProperties.getPeriod());
			}
</code></pre></div><p>点击左侧对应的提交：</p> <p>https://github.com/spring-projects/spring-boot/commit/dfac3a282b98bd480c5acf778dbfbce994051dad</p> <p>可以看到这次提交的comment：Add configuration to enable Redis Cluster topology refresh</p> <p>然后从左上角可以看到是从 <a href="https://github.com/spring-projects/spring-boot/releases/tag/v2.3.0.M4" target="_blank" rel="noopener noreferrer">v2.3.0.M4<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 最开始引入的，之后是 v2.3.0.RC1，v2.3.0.RELEASE，直到最新的v2.5.0-RC1</p> <hr> <p>REFERENCE:</p> <p>https://github.com/javastacks/spring-boot-best-practice
https://github.com/YunaiV/SpringBoot-Labs</p> <p><a href="https://mp.weixin.qq.com/s/1yxsCD3IxopIWYceA54Ayw" target="_blank" rel="noopener noreferrer">给你一份超详细 Spring Boot 知识清单<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-starter" target="_blank" rel="noopener noreferrer">一站式starter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-auto-configuration" target="_blank" rel="noopener noreferrer">About AutoConfig<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
Gradually Replacing Auto-configuration
Disabling Specific Auto-configuration Classes
(exclude={DataSourceAutoConfiguration.class})</p> <p>spring boot 中的 Parent POM 和 Starter 的作用什么
https://cloud.tencent.com/developer/article/1362790</p> <p>EnvironmentPostProcessor
BeanPostProcessor</p> <h4 id="_3-1-2-springboot-mvc"><a href="#_3-1-2-springboot-mvc" class="header-anchor">#</a> 3.1.2 springboot mvc</h4> <p>so by default, tomcat will create some temp folder under /tmp and use it later on</p> <p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#spring.servlet.multipart.location" target="_blank" rel="noopener noreferrer"><code>spring.servlet.multipart.location</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>https://stackoverflow.com/questions/50523407/the-temporary-upload-location-tmp-tomcat-4296537502689403143-5000-work-tomcat/50523578</p> <h3 id="_3-2-框架开发-starter"><a href="#_3-2-框架开发-starter" class="header-anchor">#</a> 3.2 框架开发（starter）</h3> <p>ConfigurationProperties和EnableConfigurationProperties是一对，
前者定义对应配置文件的属性，后者是激活读取；
同样，
Configuration或AutoConfiguration跟EnableAutoConfiguration是一对，
前者相当于component就是定义为bean，而后者是激活这个自动配置/装配（具体参考springboot源码分析一文），</p> <p>https://docs.spring.io/spring-boot/docs/1.3.8.RELEASE/reference/html/using-boot-auto-configuration.html</p> <p>Create a Custom Auto-Configuration with Spring Boot</p> <p>https://www.baeldung.com/spring-boot-custom-auto-configuration</p> <p>创建一个starter
hello-spring-boot-starter</p> <div class="language- extra-class"><pre class="language-text"><code>写一个服务类
public class HelloService {

  private String msg;

  public String sayHello() {
    return &quot;hello &quot; + msg;
  }

  public String getMsg() {
    return msg;
  }

  public void setMsg(String msg) {
    this.msg = msg;
  }
}
@ConfigurationProperties(prefix = &quot;hello&quot;) //获取属性值
public class HelloProperties {

  private static final String MSG = &quot;world&quot;;

  private String msg = MSG ;

  public String getMsg() {
    return msg;
  }

  public void setMsg(String msg) {
    this.msg = msg;
  }

}
@Configuration
//为带有@ConfigurationProperties注解的Bean提供有效的支持。
// 这个注解可以提供一种方便的方式来将带有@ConfigurationProperties注解的类注入为Spring容器的Bean。
@EnableConfigurationProperties(HelloProperties.class)//开启属性注入,通过@autowired注入
@ConditionalOnClass(Hello.class)//判断这个类是否在classpath中存在，如果存在，才会实例化一个Bean
// The Hello bean will be created if the hello.enable property exists and has a value other than false
// or the property doesn't exist at all.
@ConditionalOnProperty(prefix=&quot;hello&quot;, value=&quot;enabled&quot;, matchIfMissing = true)
public class HelloAutoConfiguration {

  @Autowired
  private HelloProperties helloProperties;

  @Bean
  @ConditionalOnMissingBean(Hello.class)//容器中如果没有Hello这个类,那么自动配置这个Hello
  public HelloService hello() {
    HelloService hello = new HelloService();
    hello.setMsg(helloProperties.getMsg());
    return hello;
  }

}

application.properties
\#可以不配置
hello.enabled=true

hello.msg=charmingfst

\#以debug模式运行
debug=true

\src\main\resources\META-INF\spring.factories
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.chm.test.HelloAutoConfiguration

https://blog.csdn.net/zxc123e/article/details/80222967
</code></pre></div><h2 id="_4-troubleshooting"><a href="#_4-troubleshooting" class="header-anchor">#</a> 4. Troubleshooting</h2> <h3 id="beandefinitionoverrideexception"><a href="#beandefinitionoverrideexception" class="header-anchor">#</a> BeanDefinitionOverrideException</h3> <p>https://www.baeldung.com/spring-boot-bean-definition-override-exception</p> <h3 id="beancurrentlyincreationexception-circular-reference"><a href="#beancurrentlyincreationexception-circular-reference" class="header-anchor">#</a> BeanCurrentlyInCreationException/circular reference</h3> <p>Caused by: org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'AAAA': Bean with name 'AAAA' has been injected into other beans [BBBB] in its raw version as part of a circular reference, but has eventually been wrapped. This means that said other beans do not use the final version of the bean. This is often the result of over-eager type matching - consider using 'getBeanNamesForType' with the 'allowEagerInit' flag turned off, for example.</p> <p>解决：加@Lazy</p> <h3 id="nohup-ignoring-input-no-main-manifest-attribute"><a href="#nohup-ignoring-input-no-main-manifest-attribute" class="header-anchor">#</a> nohup: ignoring input no main manifest attribute</h3> <div class="language- extra-class"><pre class="language-text"><code>执行 
nohup java -server -jar test.jar &gt; `date +\%F`_funding-rate-datasource_`date +\%H.%M.%S`.log 2&gt;&amp;1
log中内容为：
nohup: ignoring input no main manifest attribute
解决方法，pom增加：
&lt;build&gt;
        &lt;finalName&gt;funding-rate-datasource&lt;/finalName&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;attach&gt;true&lt;/attach&gt;
                &lt;/configuration&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;compile&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;jar&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
            &lt;!-- package --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;fork&gt;true&lt;/fork&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;!-- deploy --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-deploy-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;skip&gt;true&lt;/skip&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
</code></pre></div><div id="disqus_thread"></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.49883baf.js" defer></script><script src="/docs/assets/js/2.19baf9f4.js" defer></script><script src="/docs/assets/js/207.8a47ec1d.js" defer></script><script src="/docs/assets/js/11.0d0890d4.js" defer></script>
  </body>
</html>
