<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>计算机基础教程</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script async="true" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9742852210287449" crossorigin="anonymous"></script>
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=AW-748196294"></script>
    <script>
          window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());
		  
		  gtag('config', 'AW-748196294');
        </script>
    <script>
			(function() { // DON'T EDIT BELOW THIS LINE
			
			})();
		 </script>
    <meta name="description" content="软件开发教程，白帽黑客入门教程，区块链入门教程，物联网，大数据">
    
    <link rel="preload" href="/docs/assets/css/0.styles.4f35daf1.css" as="style"><link rel="preload" href="/docs/assets/js/app.9414df7f.js" as="script"><link rel="preload" href="/docs/assets/js/2.4a937564.js" as="script"><link rel="preload" href="/docs/assets/js/399.f2abe701.js" as="script"><link rel="preload" href="/docs/assets/js/8.3332a15d.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.7ffa0160.js"><link rel="prefetch" href="/docs/assets/js/100.6efa38e0.js"><link rel="prefetch" href="/docs/assets/js/101.09eb8feb.js"><link rel="prefetch" href="/docs/assets/js/102.0e8a690e.js"><link rel="prefetch" href="/docs/assets/js/103.7eaaaf2c.js"><link rel="prefetch" href="/docs/assets/js/104.18812184.js"><link rel="prefetch" href="/docs/assets/js/105.69104658.js"><link rel="prefetch" href="/docs/assets/js/106.586a9326.js"><link rel="prefetch" href="/docs/assets/js/107.eeda1ab5.js"><link rel="prefetch" href="/docs/assets/js/108.5704d1cb.js"><link rel="prefetch" href="/docs/assets/js/109.02d3f27b.js"><link rel="prefetch" href="/docs/assets/js/11.41c54743.js"><link rel="prefetch" href="/docs/assets/js/110.796fec87.js"><link rel="prefetch" href="/docs/assets/js/111.c84d396d.js"><link rel="prefetch" href="/docs/assets/js/112.0284f9ba.js"><link rel="prefetch" href="/docs/assets/js/113.cd5708cd.js"><link rel="prefetch" href="/docs/assets/js/114.b235e31b.js"><link rel="prefetch" href="/docs/assets/js/115.f9961f19.js"><link rel="prefetch" href="/docs/assets/js/116.93213d11.js"><link rel="prefetch" href="/docs/assets/js/117.6cbec99b.js"><link rel="prefetch" href="/docs/assets/js/118.390f6b46.js"><link rel="prefetch" href="/docs/assets/js/119.977511e9.js"><link rel="prefetch" href="/docs/assets/js/12.5ff3d2c0.js"><link rel="prefetch" href="/docs/assets/js/120.2def8bb5.js"><link rel="prefetch" href="/docs/assets/js/121.e8334185.js"><link rel="prefetch" href="/docs/assets/js/122.264cd45c.js"><link rel="prefetch" href="/docs/assets/js/123.d6eee8b7.js"><link rel="prefetch" href="/docs/assets/js/124.e635ebb0.js"><link rel="prefetch" href="/docs/assets/js/125.b8c637f2.js"><link rel="prefetch" href="/docs/assets/js/126.631fbfb8.js"><link rel="prefetch" href="/docs/assets/js/127.bcf4974e.js"><link rel="prefetch" href="/docs/assets/js/128.2f79959e.js"><link rel="prefetch" href="/docs/assets/js/129.a34e58dd.js"><link rel="prefetch" href="/docs/assets/js/13.3b4294a5.js"><link rel="prefetch" href="/docs/assets/js/130.c110feed.js"><link rel="prefetch" href="/docs/assets/js/131.1b67d8d8.js"><link rel="prefetch" href="/docs/assets/js/132.743d3ef6.js"><link rel="prefetch" href="/docs/assets/js/133.6d46468f.js"><link rel="prefetch" href="/docs/assets/js/134.06538217.js"><link rel="prefetch" href="/docs/assets/js/135.fd8e3583.js"><link rel="prefetch" href="/docs/assets/js/136.09ba1524.js"><link rel="prefetch" href="/docs/assets/js/137.315f80c1.js"><link rel="prefetch" href="/docs/assets/js/138.9962c4e7.js"><link rel="prefetch" href="/docs/assets/js/139.0883b541.js"><link rel="prefetch" href="/docs/assets/js/14.0589c7a8.js"><link rel="prefetch" href="/docs/assets/js/140.2bcf7829.js"><link rel="prefetch" href="/docs/assets/js/141.827ffc68.js"><link rel="prefetch" href="/docs/assets/js/142.dcdfb8cd.js"><link rel="prefetch" href="/docs/assets/js/143.7fb119e9.js"><link rel="prefetch" href="/docs/assets/js/144.9a572928.js"><link rel="prefetch" href="/docs/assets/js/145.aa9710ea.js"><link rel="prefetch" href="/docs/assets/js/146.7631dc13.js"><link rel="prefetch" href="/docs/assets/js/147.8af6fb67.js"><link rel="prefetch" href="/docs/assets/js/148.8cb955c8.js"><link rel="prefetch" href="/docs/assets/js/149.28febc04.js"><link rel="prefetch" href="/docs/assets/js/15.8cd8477b.js"><link rel="prefetch" href="/docs/assets/js/150.38331ccc.js"><link rel="prefetch" href="/docs/assets/js/151.8defbb33.js"><link rel="prefetch" href="/docs/assets/js/152.138a8431.js"><link rel="prefetch" href="/docs/assets/js/153.3c6e811a.js"><link rel="prefetch" href="/docs/assets/js/154.a69842be.js"><link rel="prefetch" href="/docs/assets/js/155.18ab140d.js"><link rel="prefetch" href="/docs/assets/js/156.5d4bb312.js"><link rel="prefetch" href="/docs/assets/js/157.6b0d91b4.js"><link rel="prefetch" href="/docs/assets/js/158.26fb8091.js"><link rel="prefetch" href="/docs/assets/js/159.b9d640ea.js"><link rel="prefetch" href="/docs/assets/js/16.dcda2b38.js"><link rel="prefetch" href="/docs/assets/js/160.dbb5cf5b.js"><link rel="prefetch" href="/docs/assets/js/161.7dc15b62.js"><link rel="prefetch" href="/docs/assets/js/162.44faadbc.js"><link rel="prefetch" href="/docs/assets/js/163.8b4d16be.js"><link rel="prefetch" href="/docs/assets/js/164.ab786498.js"><link rel="prefetch" href="/docs/assets/js/165.b1aa751c.js"><link rel="prefetch" href="/docs/assets/js/166.5e38134e.js"><link rel="prefetch" href="/docs/assets/js/167.cae1eb80.js"><link rel="prefetch" href="/docs/assets/js/168.df9c0109.js"><link rel="prefetch" href="/docs/assets/js/169.54dff595.js"><link rel="prefetch" href="/docs/assets/js/17.1c025c2b.js"><link rel="prefetch" href="/docs/assets/js/170.63f316f7.js"><link rel="prefetch" href="/docs/assets/js/171.54954b83.js"><link rel="prefetch" href="/docs/assets/js/172.d6343524.js"><link rel="prefetch" href="/docs/assets/js/173.929e5c3b.js"><link rel="prefetch" href="/docs/assets/js/174.96421530.js"><link rel="prefetch" href="/docs/assets/js/175.a638e109.js"><link rel="prefetch" href="/docs/assets/js/176.4329a6fc.js"><link rel="prefetch" href="/docs/assets/js/177.dc2e2ca9.js"><link rel="prefetch" href="/docs/assets/js/178.a09248aa.js"><link rel="prefetch" href="/docs/assets/js/179.5e32d8da.js"><link rel="prefetch" href="/docs/assets/js/18.8fa28354.js"><link rel="prefetch" href="/docs/assets/js/180.1605940d.js"><link rel="prefetch" href="/docs/assets/js/181.05044a56.js"><link rel="prefetch" href="/docs/assets/js/182.2b2fb40d.js"><link rel="prefetch" href="/docs/assets/js/183.f9610d13.js"><link rel="prefetch" href="/docs/assets/js/184.a8f43a4b.js"><link rel="prefetch" href="/docs/assets/js/185.b720caf7.js"><link rel="prefetch" href="/docs/assets/js/186.f16e7a94.js"><link rel="prefetch" href="/docs/assets/js/187.b1378b4d.js"><link rel="prefetch" href="/docs/assets/js/188.7ab5a0ef.js"><link rel="prefetch" href="/docs/assets/js/189.a66badd8.js"><link rel="prefetch" href="/docs/assets/js/19.02fb7bb0.js"><link rel="prefetch" href="/docs/assets/js/190.b218f212.js"><link rel="prefetch" href="/docs/assets/js/191.528b4042.js"><link rel="prefetch" href="/docs/assets/js/192.5b021ecc.js"><link rel="prefetch" href="/docs/assets/js/193.7e7a5219.js"><link rel="prefetch" href="/docs/assets/js/194.6aacefaf.js"><link rel="prefetch" href="/docs/assets/js/195.f5e88fad.js"><link rel="prefetch" href="/docs/assets/js/196.3356651f.js"><link rel="prefetch" href="/docs/assets/js/197.17ccec8f.js"><link rel="prefetch" href="/docs/assets/js/198.b2efcf12.js"><link rel="prefetch" href="/docs/assets/js/199.0ab94f57.js"><link rel="prefetch" href="/docs/assets/js/20.042d9ca7.js"><link rel="prefetch" href="/docs/assets/js/200.a9d4c712.js"><link rel="prefetch" href="/docs/assets/js/201.ef9468b7.js"><link rel="prefetch" href="/docs/assets/js/202.d9147a9d.js"><link rel="prefetch" href="/docs/assets/js/203.85bfcc1a.js"><link rel="prefetch" href="/docs/assets/js/204.735fdfd4.js"><link rel="prefetch" href="/docs/assets/js/205.f85dc22a.js"><link rel="prefetch" href="/docs/assets/js/206.849ff1a7.js"><link rel="prefetch" href="/docs/assets/js/207.a837e229.js"><link rel="prefetch" href="/docs/assets/js/208.fd34541c.js"><link rel="prefetch" href="/docs/assets/js/209.35136a12.js"><link rel="prefetch" href="/docs/assets/js/21.b6950900.js"><link rel="prefetch" href="/docs/assets/js/210.a40c865a.js"><link rel="prefetch" href="/docs/assets/js/211.9fa379d1.js"><link rel="prefetch" href="/docs/assets/js/212.cb6e26b8.js"><link rel="prefetch" href="/docs/assets/js/213.4865d4c2.js"><link rel="prefetch" href="/docs/assets/js/214.b5019079.js"><link rel="prefetch" href="/docs/assets/js/215.54973a0d.js"><link rel="prefetch" href="/docs/assets/js/216.4063b326.js"><link rel="prefetch" href="/docs/assets/js/217.2239dfc9.js"><link rel="prefetch" href="/docs/assets/js/218.fd0ea346.js"><link rel="prefetch" href="/docs/assets/js/219.e2954a21.js"><link rel="prefetch" href="/docs/assets/js/22.e6a20328.js"><link rel="prefetch" href="/docs/assets/js/220.c2867fd2.js"><link rel="prefetch" href="/docs/assets/js/221.ae2492f7.js"><link rel="prefetch" href="/docs/assets/js/222.945b91e6.js"><link rel="prefetch" href="/docs/assets/js/223.1a45c797.js"><link rel="prefetch" href="/docs/assets/js/224.1a0a7b83.js"><link rel="prefetch" href="/docs/assets/js/225.5057094c.js"><link rel="prefetch" href="/docs/assets/js/226.b4794200.js"><link rel="prefetch" href="/docs/assets/js/227.ef14b233.js"><link rel="prefetch" href="/docs/assets/js/228.07f54332.js"><link rel="prefetch" href="/docs/assets/js/229.6f816bd1.js"><link rel="prefetch" href="/docs/assets/js/23.1788a5af.js"><link rel="prefetch" href="/docs/assets/js/230.ef806306.js"><link rel="prefetch" href="/docs/assets/js/231.f81ab46e.js"><link rel="prefetch" href="/docs/assets/js/232.f80fa37c.js"><link rel="prefetch" href="/docs/assets/js/233.f4003ad1.js"><link rel="prefetch" href="/docs/assets/js/234.f26d214c.js"><link rel="prefetch" href="/docs/assets/js/235.a0153c2b.js"><link rel="prefetch" href="/docs/assets/js/236.97143958.js"><link rel="prefetch" href="/docs/assets/js/237.f26e4270.js"><link rel="prefetch" href="/docs/assets/js/238.526ed906.js"><link rel="prefetch" href="/docs/assets/js/239.d0716895.js"><link rel="prefetch" href="/docs/assets/js/24.8351e501.js"><link rel="prefetch" href="/docs/assets/js/240.5dbaad18.js"><link rel="prefetch" href="/docs/assets/js/241.3e5a79aa.js"><link rel="prefetch" href="/docs/assets/js/242.ee003c12.js"><link rel="prefetch" href="/docs/assets/js/243.f8748a6a.js"><link rel="prefetch" href="/docs/assets/js/244.fc03d769.js"><link rel="prefetch" href="/docs/assets/js/245.a14ce062.js"><link rel="prefetch" href="/docs/assets/js/246.a74ab801.js"><link rel="prefetch" href="/docs/assets/js/247.d1620570.js"><link rel="prefetch" href="/docs/assets/js/248.14461745.js"><link rel="prefetch" href="/docs/assets/js/249.5e3b73d0.js"><link rel="prefetch" href="/docs/assets/js/25.b49d5b13.js"><link rel="prefetch" href="/docs/assets/js/250.f5845ed3.js"><link rel="prefetch" href="/docs/assets/js/251.5241f844.js"><link rel="prefetch" href="/docs/assets/js/252.a80f214d.js"><link rel="prefetch" href="/docs/assets/js/253.160445ff.js"><link rel="prefetch" href="/docs/assets/js/254.ab06db99.js"><link rel="prefetch" href="/docs/assets/js/255.1fd0163f.js"><link rel="prefetch" href="/docs/assets/js/256.b2eeddb6.js"><link rel="prefetch" href="/docs/assets/js/257.92532069.js"><link rel="prefetch" href="/docs/assets/js/258.89f6d1a4.js"><link rel="prefetch" href="/docs/assets/js/259.92b76a96.js"><link rel="prefetch" href="/docs/assets/js/26.4505b299.js"><link rel="prefetch" href="/docs/assets/js/260.2fb46ea7.js"><link rel="prefetch" href="/docs/assets/js/261.053b45aa.js"><link rel="prefetch" href="/docs/assets/js/262.a2b7be22.js"><link rel="prefetch" href="/docs/assets/js/263.87525883.js"><link rel="prefetch" href="/docs/assets/js/264.22794840.js"><link rel="prefetch" href="/docs/assets/js/265.f770376c.js"><link rel="prefetch" href="/docs/assets/js/266.d856812b.js"><link rel="prefetch" href="/docs/assets/js/267.7d2fadbd.js"><link rel="prefetch" href="/docs/assets/js/268.a87cd73c.js"><link rel="prefetch" href="/docs/assets/js/269.f2b3239f.js"><link rel="prefetch" href="/docs/assets/js/27.d6d7c342.js"><link rel="prefetch" href="/docs/assets/js/270.b6205097.js"><link rel="prefetch" href="/docs/assets/js/271.aa1b383a.js"><link rel="prefetch" href="/docs/assets/js/272.2fc41242.js"><link rel="prefetch" href="/docs/assets/js/273.c49da5c4.js"><link rel="prefetch" href="/docs/assets/js/274.72599d79.js"><link rel="prefetch" href="/docs/assets/js/275.e2b7a8ae.js"><link rel="prefetch" href="/docs/assets/js/276.fcdf6b4f.js"><link rel="prefetch" href="/docs/assets/js/277.3e50f439.js"><link rel="prefetch" href="/docs/assets/js/278.e43b11d7.js"><link rel="prefetch" href="/docs/assets/js/279.c5de5774.js"><link rel="prefetch" href="/docs/assets/js/28.fe46fba9.js"><link rel="prefetch" href="/docs/assets/js/280.fc6628f2.js"><link rel="prefetch" href="/docs/assets/js/281.e23b7b91.js"><link rel="prefetch" href="/docs/assets/js/282.1dc71c28.js"><link rel="prefetch" href="/docs/assets/js/283.c341b644.js"><link rel="prefetch" href="/docs/assets/js/284.0ba48351.js"><link rel="prefetch" href="/docs/assets/js/285.9d92bc81.js"><link rel="prefetch" href="/docs/assets/js/286.fa884b7c.js"><link rel="prefetch" href="/docs/assets/js/287.6afa9d38.js"><link rel="prefetch" href="/docs/assets/js/288.af7fe773.js"><link rel="prefetch" href="/docs/assets/js/289.189a4d70.js"><link rel="prefetch" href="/docs/assets/js/29.c3d177bd.js"><link rel="prefetch" href="/docs/assets/js/290.fe70f723.js"><link rel="prefetch" href="/docs/assets/js/291.fc483e5a.js"><link rel="prefetch" href="/docs/assets/js/292.2c765993.js"><link rel="prefetch" href="/docs/assets/js/293.6fdcedde.js"><link rel="prefetch" href="/docs/assets/js/294.ba8329b1.js"><link rel="prefetch" href="/docs/assets/js/295.b74147d4.js"><link rel="prefetch" href="/docs/assets/js/296.5e87bfa4.js"><link rel="prefetch" href="/docs/assets/js/297.a2554e16.js"><link rel="prefetch" href="/docs/assets/js/298.49c7bb6e.js"><link rel="prefetch" href="/docs/assets/js/299.78ed988d.js"><link rel="prefetch" href="/docs/assets/js/3.f44e92e7.js"><link rel="prefetch" href="/docs/assets/js/30.8953a6b2.js"><link rel="prefetch" href="/docs/assets/js/300.a6c53a8a.js"><link rel="prefetch" href="/docs/assets/js/301.77ceed74.js"><link rel="prefetch" href="/docs/assets/js/302.ba56e09b.js"><link rel="prefetch" href="/docs/assets/js/303.8f2013f5.js"><link rel="prefetch" href="/docs/assets/js/304.06d9fb9d.js"><link rel="prefetch" href="/docs/assets/js/305.baee596c.js"><link rel="prefetch" href="/docs/assets/js/306.2f443847.js"><link rel="prefetch" href="/docs/assets/js/307.f5e20307.js"><link rel="prefetch" href="/docs/assets/js/308.01983e31.js"><link rel="prefetch" href="/docs/assets/js/309.6417dfe5.js"><link rel="prefetch" href="/docs/assets/js/31.bed90218.js"><link rel="prefetch" href="/docs/assets/js/310.bbd96ef0.js"><link rel="prefetch" href="/docs/assets/js/311.a552cc91.js"><link rel="prefetch" href="/docs/assets/js/312.8f121048.js"><link rel="prefetch" href="/docs/assets/js/313.da91b13f.js"><link rel="prefetch" href="/docs/assets/js/314.5da5ee81.js"><link rel="prefetch" href="/docs/assets/js/315.2413dfd9.js"><link rel="prefetch" href="/docs/assets/js/316.0d160e0e.js"><link rel="prefetch" href="/docs/assets/js/317.5e1ba176.js"><link rel="prefetch" href="/docs/assets/js/318.c46ada39.js"><link rel="prefetch" href="/docs/assets/js/319.294cf9fa.js"><link rel="prefetch" href="/docs/assets/js/32.0457c298.js"><link rel="prefetch" href="/docs/assets/js/320.791b9efe.js"><link rel="prefetch" href="/docs/assets/js/321.ed45d9c6.js"><link rel="prefetch" href="/docs/assets/js/322.b6e04711.js"><link rel="prefetch" href="/docs/assets/js/323.55ff0129.js"><link rel="prefetch" href="/docs/assets/js/324.5900989f.js"><link rel="prefetch" href="/docs/assets/js/325.51f078f9.js"><link rel="prefetch" href="/docs/assets/js/326.fdb6a62e.js"><link rel="prefetch" href="/docs/assets/js/327.97db1d5e.js"><link rel="prefetch" href="/docs/assets/js/328.ff44aa25.js"><link rel="prefetch" href="/docs/assets/js/329.157e2294.js"><link rel="prefetch" href="/docs/assets/js/33.2b613da8.js"><link rel="prefetch" href="/docs/assets/js/330.bd683b68.js"><link rel="prefetch" href="/docs/assets/js/331.dd87300b.js"><link rel="prefetch" href="/docs/assets/js/332.6f4ed714.js"><link rel="prefetch" href="/docs/assets/js/333.4e08c0a8.js"><link rel="prefetch" href="/docs/assets/js/334.a8cfd00b.js"><link rel="prefetch" href="/docs/assets/js/335.38b1f803.js"><link rel="prefetch" href="/docs/assets/js/336.f2766a91.js"><link rel="prefetch" href="/docs/assets/js/337.3a5f9665.js"><link rel="prefetch" href="/docs/assets/js/338.372be354.js"><link rel="prefetch" href="/docs/assets/js/339.da6f0f2f.js"><link rel="prefetch" href="/docs/assets/js/34.0a72d60f.js"><link rel="prefetch" href="/docs/assets/js/340.1e48cc27.js"><link rel="prefetch" href="/docs/assets/js/341.4f655917.js"><link rel="prefetch" href="/docs/assets/js/342.dae9346f.js"><link rel="prefetch" href="/docs/assets/js/343.2d5c9a8a.js"><link rel="prefetch" href="/docs/assets/js/344.982962b5.js"><link rel="prefetch" href="/docs/assets/js/345.40ccf7c3.js"><link rel="prefetch" href="/docs/assets/js/346.b5569677.js"><link rel="prefetch" href="/docs/assets/js/347.2ed65ccd.js"><link rel="prefetch" href="/docs/assets/js/348.ccc6a46e.js"><link rel="prefetch" href="/docs/assets/js/349.f43ef320.js"><link rel="prefetch" href="/docs/assets/js/35.0fb0e473.js"><link rel="prefetch" href="/docs/assets/js/350.4bab8d98.js"><link rel="prefetch" href="/docs/assets/js/351.9d73d699.js"><link rel="prefetch" href="/docs/assets/js/352.78cf9cf6.js"><link rel="prefetch" href="/docs/assets/js/353.19f83375.js"><link rel="prefetch" href="/docs/assets/js/354.fe270e10.js"><link rel="prefetch" href="/docs/assets/js/355.cbe4827a.js"><link rel="prefetch" href="/docs/assets/js/356.ab7a3510.js"><link rel="prefetch" href="/docs/assets/js/357.157b4350.js"><link rel="prefetch" href="/docs/assets/js/358.c0236cb6.js"><link rel="prefetch" href="/docs/assets/js/359.621f175e.js"><link rel="prefetch" href="/docs/assets/js/36.3d5bde6e.js"><link rel="prefetch" href="/docs/assets/js/360.1135c2da.js"><link rel="prefetch" href="/docs/assets/js/361.dc53198b.js"><link rel="prefetch" href="/docs/assets/js/362.1485449a.js"><link rel="prefetch" href="/docs/assets/js/363.72ff4a64.js"><link rel="prefetch" href="/docs/assets/js/364.37249a4c.js"><link rel="prefetch" href="/docs/assets/js/365.da4767a9.js"><link rel="prefetch" href="/docs/assets/js/366.e82d108c.js"><link rel="prefetch" href="/docs/assets/js/367.40bff0ae.js"><link rel="prefetch" href="/docs/assets/js/368.328b9c71.js"><link rel="prefetch" href="/docs/assets/js/369.cf96c7ef.js"><link rel="prefetch" href="/docs/assets/js/37.98af3713.js"><link rel="prefetch" href="/docs/assets/js/370.3f10aaa4.js"><link rel="prefetch" href="/docs/assets/js/371.44f61567.js"><link rel="prefetch" href="/docs/assets/js/372.1d6e304a.js"><link rel="prefetch" href="/docs/assets/js/373.c78e4b72.js"><link rel="prefetch" href="/docs/assets/js/374.8ddeb757.js"><link rel="prefetch" href="/docs/assets/js/375.77ed2aa4.js"><link rel="prefetch" href="/docs/assets/js/376.65ebab76.js"><link rel="prefetch" href="/docs/assets/js/377.978f9e65.js"><link rel="prefetch" href="/docs/assets/js/378.0a0f14e1.js"><link rel="prefetch" href="/docs/assets/js/379.10dd42df.js"><link rel="prefetch" href="/docs/assets/js/38.64288572.js"><link rel="prefetch" href="/docs/assets/js/380.8822e764.js"><link rel="prefetch" href="/docs/assets/js/381.cdb72bc7.js"><link rel="prefetch" href="/docs/assets/js/382.015a3048.js"><link rel="prefetch" href="/docs/assets/js/383.d0c1e134.js"><link rel="prefetch" href="/docs/assets/js/384.5603f964.js"><link rel="prefetch" href="/docs/assets/js/385.ab35aa95.js"><link rel="prefetch" href="/docs/assets/js/386.656b7755.js"><link rel="prefetch" href="/docs/assets/js/387.28808419.js"><link rel="prefetch" href="/docs/assets/js/388.5c127a94.js"><link rel="prefetch" href="/docs/assets/js/389.5885a0f7.js"><link rel="prefetch" href="/docs/assets/js/39.ce70c0ac.js"><link rel="prefetch" href="/docs/assets/js/390.5b6cf586.js"><link rel="prefetch" href="/docs/assets/js/391.1910133c.js"><link rel="prefetch" href="/docs/assets/js/392.965722a2.js"><link rel="prefetch" href="/docs/assets/js/393.4f10c67a.js"><link rel="prefetch" href="/docs/assets/js/394.56b9858b.js"><link rel="prefetch" href="/docs/assets/js/395.c943baa5.js"><link rel="prefetch" href="/docs/assets/js/396.0bb7c8c3.js"><link rel="prefetch" href="/docs/assets/js/397.0674cf34.js"><link rel="prefetch" href="/docs/assets/js/398.eadd5aee.js"><link rel="prefetch" href="/docs/assets/js/4.8dddf48b.js"><link rel="prefetch" href="/docs/assets/js/40.e4fbfea0.js"><link rel="prefetch" href="/docs/assets/js/400.f2921f2c.js"><link rel="prefetch" href="/docs/assets/js/401.8be0fed8.js"><link rel="prefetch" href="/docs/assets/js/402.33935b48.js"><link rel="prefetch" href="/docs/assets/js/403.9f93ddca.js"><link rel="prefetch" href="/docs/assets/js/404.6c23a826.js"><link rel="prefetch" href="/docs/assets/js/405.166c48a5.js"><link rel="prefetch" href="/docs/assets/js/406.555ba600.js"><link rel="prefetch" href="/docs/assets/js/407.745a9da8.js"><link rel="prefetch" href="/docs/assets/js/408.5664787d.js"><link rel="prefetch" href="/docs/assets/js/409.0d5c07b9.js"><link rel="prefetch" href="/docs/assets/js/41.9cb8c9ab.js"><link rel="prefetch" href="/docs/assets/js/410.ff49a75a.js"><link rel="prefetch" href="/docs/assets/js/411.5f58f063.js"><link rel="prefetch" href="/docs/assets/js/412.f08c4c2b.js"><link rel="prefetch" href="/docs/assets/js/413.0d04e2c3.js"><link rel="prefetch" href="/docs/assets/js/414.eff67855.js"><link rel="prefetch" href="/docs/assets/js/415.948cb5f0.js"><link rel="prefetch" href="/docs/assets/js/416.7fdde785.js"><link rel="prefetch" href="/docs/assets/js/417.d414e9fc.js"><link rel="prefetch" href="/docs/assets/js/418.4a9519f2.js"><link rel="prefetch" href="/docs/assets/js/419.f400d685.js"><link rel="prefetch" href="/docs/assets/js/42.04473d03.js"><link rel="prefetch" href="/docs/assets/js/420.db1dfaef.js"><link rel="prefetch" href="/docs/assets/js/421.e46de3ec.js"><link rel="prefetch" href="/docs/assets/js/422.3cd641dc.js"><link rel="prefetch" href="/docs/assets/js/423.e6168819.js"><link rel="prefetch" href="/docs/assets/js/424.825de0ef.js"><link rel="prefetch" href="/docs/assets/js/425.7f6dc52f.js"><link rel="prefetch" href="/docs/assets/js/426.e3664985.js"><link rel="prefetch" href="/docs/assets/js/427.bd992197.js"><link rel="prefetch" href="/docs/assets/js/428.b9539fb3.js"><link rel="prefetch" href="/docs/assets/js/429.c53e2362.js"><link rel="prefetch" href="/docs/assets/js/43.1ad308e2.js"><link rel="prefetch" href="/docs/assets/js/430.a50cd6aa.js"><link rel="prefetch" href="/docs/assets/js/431.f6d1c100.js"><link rel="prefetch" href="/docs/assets/js/432.475b157a.js"><link rel="prefetch" href="/docs/assets/js/433.2c266369.js"><link rel="prefetch" href="/docs/assets/js/434.b7283885.js"><link rel="prefetch" href="/docs/assets/js/435.ac9c0094.js"><link rel="prefetch" href="/docs/assets/js/436.7509d2b0.js"><link rel="prefetch" href="/docs/assets/js/437.c776853b.js"><link rel="prefetch" href="/docs/assets/js/438.f58858fa.js"><link rel="prefetch" href="/docs/assets/js/439.aed81e81.js"><link rel="prefetch" href="/docs/assets/js/44.6a284c35.js"><link rel="prefetch" href="/docs/assets/js/440.673da964.js"><link rel="prefetch" href="/docs/assets/js/441.f57fab18.js"><link rel="prefetch" href="/docs/assets/js/442.334c165e.js"><link rel="prefetch" href="/docs/assets/js/443.0aea0d2d.js"><link rel="prefetch" href="/docs/assets/js/444.fd1619b8.js"><link rel="prefetch" href="/docs/assets/js/445.1cea6a88.js"><link rel="prefetch" href="/docs/assets/js/446.3edd7a81.js"><link rel="prefetch" href="/docs/assets/js/447.81a3f569.js"><link rel="prefetch" href="/docs/assets/js/448.8ad4228a.js"><link rel="prefetch" href="/docs/assets/js/449.89f36f24.js"><link rel="prefetch" href="/docs/assets/js/45.9b24b018.js"><link rel="prefetch" href="/docs/assets/js/450.0c185ee8.js"><link rel="prefetch" href="/docs/assets/js/451.b1ea49c5.js"><link rel="prefetch" href="/docs/assets/js/452.93c96b58.js"><link rel="prefetch" href="/docs/assets/js/453.93a00b67.js"><link rel="prefetch" href="/docs/assets/js/46.cc200107.js"><link rel="prefetch" href="/docs/assets/js/47.a090dbec.js"><link rel="prefetch" href="/docs/assets/js/48.6cfe957a.js"><link rel="prefetch" href="/docs/assets/js/49.caccea52.js"><link rel="prefetch" href="/docs/assets/js/5.dfa4a989.js"><link rel="prefetch" href="/docs/assets/js/50.03bca138.js"><link rel="prefetch" href="/docs/assets/js/51.ce779969.js"><link rel="prefetch" href="/docs/assets/js/52.6157e984.js"><link rel="prefetch" href="/docs/assets/js/53.0d002823.js"><link rel="prefetch" href="/docs/assets/js/54.3ab4c11c.js"><link rel="prefetch" href="/docs/assets/js/55.72f16253.js"><link rel="prefetch" href="/docs/assets/js/56.7321f4d3.js"><link rel="prefetch" href="/docs/assets/js/57.7e18d70b.js"><link rel="prefetch" href="/docs/assets/js/58.f1243e10.js"><link rel="prefetch" href="/docs/assets/js/59.08bbba9d.js"><link rel="prefetch" href="/docs/assets/js/6.e0523d1a.js"><link rel="prefetch" href="/docs/assets/js/60.f8d29dfa.js"><link rel="prefetch" href="/docs/assets/js/61.6e0b1240.js"><link rel="prefetch" href="/docs/assets/js/62.c33e6f85.js"><link rel="prefetch" href="/docs/assets/js/63.28d78b17.js"><link rel="prefetch" href="/docs/assets/js/64.0629c9f0.js"><link rel="prefetch" href="/docs/assets/js/65.879cd510.js"><link rel="prefetch" href="/docs/assets/js/66.76015883.js"><link rel="prefetch" href="/docs/assets/js/67.72bbd09e.js"><link rel="prefetch" href="/docs/assets/js/68.0e2abd78.js"><link rel="prefetch" href="/docs/assets/js/69.f43f92a7.js"><link rel="prefetch" href="/docs/assets/js/7.c5cdf00a.js"><link rel="prefetch" href="/docs/assets/js/70.ceaf8c6e.js"><link rel="prefetch" href="/docs/assets/js/71.6c5daeca.js"><link rel="prefetch" href="/docs/assets/js/72.c5783904.js"><link rel="prefetch" href="/docs/assets/js/73.33bcdcd9.js"><link rel="prefetch" href="/docs/assets/js/74.6354d4c0.js"><link rel="prefetch" href="/docs/assets/js/75.778fdecf.js"><link rel="prefetch" href="/docs/assets/js/76.b33d179b.js"><link rel="prefetch" href="/docs/assets/js/77.9f7a0d6f.js"><link rel="prefetch" href="/docs/assets/js/78.46b032e7.js"><link rel="prefetch" href="/docs/assets/js/79.2470753c.js"><link rel="prefetch" href="/docs/assets/js/80.343f5643.js"><link rel="prefetch" href="/docs/assets/js/81.27b3cb81.js"><link rel="prefetch" href="/docs/assets/js/82.e1c2c61c.js"><link rel="prefetch" href="/docs/assets/js/83.6af31664.js"><link rel="prefetch" href="/docs/assets/js/84.7fdfe2f3.js"><link rel="prefetch" href="/docs/assets/js/85.0ce1fefa.js"><link rel="prefetch" href="/docs/assets/js/86.f1fb1bff.js"><link rel="prefetch" href="/docs/assets/js/87.12c9ed71.js"><link rel="prefetch" href="/docs/assets/js/88.904ae208.js"><link rel="prefetch" href="/docs/assets/js/89.239bca9f.js"><link rel="prefetch" href="/docs/assets/js/9.59295926.js"><link rel="prefetch" href="/docs/assets/js/90.d66b4f36.js"><link rel="prefetch" href="/docs/assets/js/91.4d68907b.js"><link rel="prefetch" href="/docs/assets/js/92.46ec36d6.js"><link rel="prefetch" href="/docs/assets/js/93.4cde6279.js"><link rel="prefetch" href="/docs/assets/js/94.d1380125.js"><link rel="prefetch" href="/docs/assets/js/95.6fa22e05.js"><link rel="prefetch" href="/docs/assets/js/96.00c7552c.js"><link rel="prefetch" href="/docs/assets/js/97.1b401ae1.js"><link rel="prefetch" href="/docs/assets/js/98.c2b53a1e.js"><link rel="prefetch" href="/docs/assets/js/99.a5b15c45.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.4f35daf1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">计算机基础教程</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">
  机器指令
</a></div><div class="nav-item"><a href="/docs/software/" class="nav-link router-link-active">
  软件基础
</a></div><div class="nav-item"><a href="/docs/coder2hacker/" class="nav-link">
  白帽黑客
</a></div><div class="nav-item"><a href="/docs/blockchain/" class="nav-link">
  区块链
</a></div><div class="nav-item"><a href="/docs/biography/" class="nav-link">
  少儿教育
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">
  机器指令
</a></div><div class="nav-item"><a href="/docs/software/" class="nav-link router-link-active">
  软件基础
</a></div><div class="nav-item"><a href="/docs/coder2hacker/" class="nav-link">
  白帽黑客
</a></div><div class="nav-item"><a href="/docs/blockchain/" class="nav-link">
  区块链
</a></div><div class="nav-item"><a href="/docs/biography/" class="nav-link">
  少儿教育
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/software/programming/java_springboot.html#_1-知识点overview" class="sidebar-link">1.知识点Overview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#启动加载器-springfactoriesloader" class="sidebar-link">启动加载器 SpringFactoriesLoader</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#spring-ioc容器" class="sidebar-link">Spring IoC容器</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#bean-是什么-spring-bean" class="sidebar-link" style="padding-left:3rem;">Bean 是什么？(Spring bean)</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#ioc容器" class="sidebar-link" style="padding-left:3rem;">IoC容器</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#bean生命周期接口" class="sidebar-link" style="padding-left:3rem;">bean生命周期接口</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#bean定义-spring装配bean的三种方法" class="sidebar-link" style="padding-left:3rem;">bean定义 - Spring装配bean的三种方法</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#基于xml配置bean" class="sidebar-link" style="padding-left:4rem;">基于xml配置Bean</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#annotation-based-configuration-使用注解annotation定义bean" class="sidebar-link" style="padding-left:4rem;">Annotation-based configuration 使用注解Annotation定义Bean</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#java-based-configuration-基于java类提供bean定义信息" class="sidebar-link" style="padding-left:4rem;">Java-based configuration 基于java类提供Bean定义信息</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#bean注入" class="sidebar-link" style="padding-left:3rem;">bean注入</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#早期基于xml显式配置三种注入方式" class="sidebar-link" style="padding-left:4rem;">早期基于XML显式配置三种注入方式</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#中期基于xml-autowire-no-byname-bytype-constructor-default" class="sidebar-link" style="padding-left:4rem;">中期基于XML autowire=&quot;no|byName|byType|constructor|default&quot;</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#现代基于autowired-的三种注入方式" class="sidebar-link" style="padding-left:4rem;">现代基于Autowired 的三种注入方式</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#配置属性加载顺序" class="sidebar-link">配置属性加载顺序</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#spring容器的事件监听机制" class="sidebar-link">Spring容器的事件监听机制</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#自动配置原理" class="sidebar-link">自动配置原理</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#environment-vs-applicationcontext" class="sidebar-link">Environment vs ApplicationContext</a></li></ul></li><li><a href="/docs/software/programming/java_springboot.html#_2-springapplication启动流程" class="sidebar-link">2. SpringApplication启动流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#jvm启动和类加载" class="sidebar-link">JVM启动和类加载</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#初始化springapplication对象" class="sidebar-link">初始化SpringApplication对象</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#执行该对象的run方法" class="sidebar-link">执行该对象的run方法</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#获取并启动所有springapplicationrunlistener" class="sidebar-link" style="padding-left:3rem;">获取并启动所有SpringApplicationRunListener</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#准备环境" class="sidebar-link" style="padding-left:3rem;">准备环境</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#打印banner图案" class="sidebar-link" style="padding-left:3rem;">打印Banner图案</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#创建应用上下文" class="sidebar-link" style="padding-left:3rem;">创建应用上下文</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#准备上下文" class="sidebar-link" style="padding-left:3rem;">准备上下文</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#容器刷新" class="sidebar-link" style="padding-left:3rem;">容器刷新</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#实例分析启动流程" class="sidebar-link">实例分析启动流程</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#阶段1-jvm启动-底层准备" class="sidebar-link" style="padding-left:3rem;">阶段1: JVM启动（底层准备）</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#阶段2-springapplication-run-初始化" class="sidebar-link" style="padding-left:3rem;">阶段2: SpringApplication.run() 初始化</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#发布启动事件-⭐扩展点1-启动事件监听" class="sidebar-link" style="padding-left:4rem;">发布启动事件 ⭐扩展点1: 启动事件监听</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#阶段3-环境准备-加载配置" class="sidebar-link" style="padding-left:3rem;">阶段3: 环境准备（加载配置）</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#加载配置源-⭐扩展点2-自定义propertysource" class="sidebar-link" style="padding-left:4rem;">加载配置源 ⭐扩展点2: 自定义PropertySource</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#printbanner" class="sidebar-link" style="padding-left:4rem;">printBanner</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#阶段4-应用上下文创建" class="sidebar-link" style="padding-left:3rem;">阶段4: 应用上下文创建</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#阶段5-上下文预处理" class="sidebar-link" style="padding-left:3rem;">阶段5: 上下文预处理</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#执行applicationcontextinitializer-⭐扩展点3-上下文初始化器" class="sidebar-link" style="padding-left:4rem;">执行ApplicationContextInitializer ⭐扩展点3: 上下文初始化器</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#beanfactory-registersingleton" class="sidebar-link" style="padding-left:4rem;">beanFactory.registerSingleton</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#为什么需要类型判断-beanfactory-instanceof-defaultlistablebeanfactory" class="sidebar-link" style="padding-left:4rem;">为什么需要类型判断 beanFactory instanceof DefaultListableBeanFactory</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#发布准备事件-⭐扩展点4-准备事件监听" class="sidebar-link" style="padding-left:4rem;">发布准备事件 ⭐扩展点4: 准备事件监听</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#阶段6-容器刷新-核心" class="sidebar-link" style="padding-left:3rem;">阶段6: 容器刷新（核心！）</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_6-1-6-4-准备阶段" class="sidebar-link" style="padding-left:4rem;">6.1-6.4: 准备阶段</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_6-5-执行beanfactorypostprocessor-⭐扩展点5-bean工厂后处理" class="sidebar-link" style="padding-left:4rem;">6.5: 执行BeanFactoryPostProcessor ⭐扩展点5: Bean工厂后处理</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_6-6-注册beanpostprocessor-⭐扩展点6-bean后处理" class="sidebar-link" style="padding-left:4rem;">6.6: 注册BeanPostProcessor ⭐扩展点6: Bean后处理</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_6-7-6-8-消息源和事件广播器" class="sidebar-link" style="padding-left:4rem;">6.7-6.8: 消息源和事件广播器</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_6-9-子类特定刷新-⭐扩展点7-内嵌服务器自定义" class="sidebar-link" style="padding-left:4rem;">6.9: 子类特定刷新 ⭐扩展点7: 内嵌服务器自定义</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_6-10-注册监听器" class="sidebar-link" style="padding-left:4rem;">6.10: 注册监听器</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_6-11-完成beanfactory初始化-⭐扩展点8-bean生命周期回调" class="sidebar-link" style="padding-left:4rem;">6.11: 完成BeanFactory初始化 ⭐扩展点8: Bean生命周期回调</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_6-12-完成刷新-⭐扩展点9-上下文刷新事件" class="sidebar-link" style="padding-left:4rem;">6.12: 完成刷新 ⭐扩展点9: 上下文刷新事件</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#阶段7-启动收尾" class="sidebar-link" style="padding-left:3rem;">阶段7: 启动收尾</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#时序状态和最终状态" class="sidebar-link" style="padding-left:3rem;">时序状态和最终状态</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#bean的时序状态细节" class="sidebar-link" style="padding-left:3rem;">Bean的时序状态细节</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#创建-注入-回调" class="sidebar-link" style="padding-left:4rem;">创建-注入-回调</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#增强实例" class="sidebar-link" style="padding-left:4rem;">增强实例</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#bean时序状态" class="sidebar-link" style="padding-left:4rem;">Bean时序状态</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#扩展点场景" class="sidebar-link">扩展点场景</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#具体业务场景1-加密配置解密服务" class="sidebar-link" style="padding-left:3rem;">具体业务场景1：加密配置解密服务</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#具体业务场景2-环境检测服务" class="sidebar-link" style="padding-left:3rem;">具体业务场景2：环境检测服务</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#具体业务场景3-功能开关服务" class="sidebar-link" style="padding-left:3rem;">具体业务场景3：功能开关服务</a></li></ul></li><li><a href="/docs/software/programming/java_springboot.html#_3-spring-boot应用监控与调优方案" class="sidebar-link">3. Spring Boot应用监控与调优方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#依赖配置" class="sidebar-link">依赖配置</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#启动过程专项监控" class="sidebar-link">启动过程专项监控</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#bean加载性能监控" class="sidebar-link">Bean加载性能监控</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#配置类加载监控" class="sidebar-link">配置类加载监控</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#jvm级别监控配置" class="sidebar-link">JVM级别监控配置</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#自定义健康检查与指标" class="sidebar-link">自定义健康检查与指标</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#日志监控配置" class="sidebar-link">日志监控配置</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#grafana监控面板配置" class="sidebar-link">Grafana监控面板配置</a></li></ul></li><li><a href="/docs/software/programming/java_springboot.html#_4-使用springboot开发应用" class="sidebar-link">4. 使用springboot开发应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_4-0-项目技巧" class="sidebar-link">4.0 项目技巧</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#include" class="sidebar-link" style="padding-left:3rem;">include</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#multiple-env-dev-prod" class="sidebar-link" style="padding-left:3rem;">multiple env: dev prod</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_4-1-业务开发" class="sidebar-link">4.1 业务开发</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_4-1-1-使用starter" class="sidebar-link" style="padding-left:3rem;">4.1.1 使用starter</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#pom-depenedency" class="sidebar-link" style="padding-left:4rem;">POM depenedency</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#configuration" class="sidebar-link" style="padding-left:4rem;">Configuration</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_4-1-2-springboot-mvc" class="sidebar-link" style="padding-left:3rem;">4.1.2 springboot mvc</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_4-2-框架开发-starter" class="sidebar-link">4.2 框架开发（starter）</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#_4-3-aop切面编程" class="sidebar-link">4.3 AOP切面编程</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#什么是aop" class="sidebar-link" style="padding-left:3rem;">什么是AOP</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#spring-aop实现机制-spring-boot-starter-aop" class="sidebar-link" style="padding-left:3rem;">Spring AOP实现机制-spring-boot-starter-aop</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#示例1-性能监控aop" class="sidebar-link" style="padding-left:3rem;">示例1：性能监控AOP</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#示例2-事务管理aop" class="sidebar-link" style="padding-left:3rem;">示例2：事务管理AOP</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#示例3-缓存aop" class="sidebar-link" style="padding-left:3rem;">示例3：缓存AOP</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#示例4-安全权限aop" class="sidebar-link" style="padding-left:3rem;">示例4：安全权限AOP</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#示例5-日志记录aop" class="sidebar-link" style="padding-left:3rem;">示例5：日志记录AOP</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#aop最佳实践" class="sidebar-link" style="padding-left:3rem;">AOP最佳实践</a></li></ul></li><li><a href="/docs/software/programming/java_springboot.html#_5-spring-boot启动优化" class="sidebar-link">5. Spring Boot启动优化</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/software/programming/java_springboot.html#_6-troubleshooting" class="sidebar-link">6. Troubleshooting</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#beandefinitionoverrideexception" class="sidebar-link">BeanDefinitionOverrideException</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#beancurrentlyincreationexception-circular-reference" class="sidebar-link">BeanCurrentlyInCreationException/circular reference</a></li><li class="sidebar-sub-header"><a href="/docs/software/programming/java_springboot.html#nohup-ignoring-input-no-main-manifest-attribute" class="sidebar-link">nohup: ignoring input no main manifest attribute</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-documentation" target="_blank" rel="noopener noreferrer">official documents<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>自动配置、起步依赖、Actuator、命令行界面(CLI) 是Spring Boot最重要的4大核心特性</p> <p>Servlet-&gt;EJB-&gt;Struts-&gt;SpringMVC-&gt;SpringBoot</p> <p>New-&gt;Factory-&gt;容器</p> <h2 id="_1-知识点overview"><a href="#_1-知识点overview" class="header-anchor">#</a> 1.知识点Overview</h2> <h3 id="启动加载器-springfactoriesloader"><a href="#启动加载器-springfactoriesloader" class="header-anchor">#</a> 启动加载器 SpringFactoriesLoader</h3> <p>JVM提供了3种类加载器： BootstrapClassLoader、 ExtClassLoader、 AppClassLoader分别加载Java核心类库、扩展类库以及应用的类路径( CLASSPATH)下的类库。JVM通过双亲委派模型进行类的加载，我们也可以通过继承 java.lang.classloader实现自己的类加载器。</p> <p>何为双亲委派模型？当一个类加载器收到类加载任务时，会先交给自己的父加载器去完成，因此最终加载任务都会传递到最顶层的BootstrapClassLoader，只有当父加载器无法完成加载任务时，才会尝试自己来加载。</p> <p>采用双亲委派模型的一个好处是保证使用不同类加载器最终得到的都是同一个对象，这样就可以保证Java 核心库的类型安全，比如，加载位于rt.jar包中的 java.lang.Object类，不管是哪个加载器加载这个类，最终都是委托给顶层的BootstrapClassLoader来加载的，这样就可以保证任何的类加载器最终得到的都是同样一个Object对象。</p> <p>SpringFactoriesLoader，它本质上属于Spring框架私有的一种扩展方案，类似于SPI，Spring Boot在Spring基础上的很多核心功能都是基于此</p> <h3 id="spring-ioc容器"><a href="#spring-ioc容器" class="header-anchor">#</a> Spring IoC容器</h3> <h4 id="bean-是什么-spring-bean"><a href="#bean-是什么-spring-bean" class="header-anchor">#</a> Bean 是什么？(Spring bean)</h4> <blockquote><p>The objects that form the backbone of your application and that are managed by the Spring IoC container are called beans. A bean is an object that is instantiated, assembled, and otherwise managed by a Spring IoC container.
https://www.tutorialspoint.com/spring/spring_bean_definition.htm</p></blockquote> <p><strong>Spring Bean VS Java Bean:</strong></p> <p>Java Beans are simple Java classes that encapsulate objects, while Spring Beans are managed by the Spring Framework and are used for dependency injection and lifecycle management.</p> <p>IoC容器想要管理各个业务对象以及它们之间的依赖关系，需要通过某种途径来记录和管理这些信息。
BeanDefinition对象就承担了这个责任：容器中的每一个bean都会有一个对应的BeanDefinition实例，该实例负责保存bean对象的所有必要信息，包括bean对象的class类型、是否是抽象类、构造方法和参数、其它属性等等。
当客户端向容器请求相应对象时，容器就会通过这些信息为客户端返回一个完整可用的bean实例；
默认是单例模式；</p> <p>事先这些bean需要向大管家注册，BeanDefinitionRegistry抽象出bean的注册逻辑，BeanFactory则抽象出了bean的管理逻辑，而各个BeanFactory的实现类就具体承担了bean的注册以及管理工作
然后大管家生成bean也是通过这个工厂模式；
DefaultListableBeanFactory作为一个比较通用的BeanFactory实现，它同时也实现了BeanDefinitionRegistry接口，因此它就承担了Bean的注册管理工作，
具体的beanFactory实现类就是实现了DefaultListableBeanFactory这个接口；</p> <p><img src="/docs/docs_image/software/java/spring/java_spring_bean01.png" alt="spring揭秘"></p> <h4 id="ioc容器"><a href="#ioc容器" class="header-anchor">#</a> IoC容器</h4> <p>IoC容器是大管家，你只需要告诉它需要某个bean，它就把对应的实例（instance）扔给你，至于这个bean是否依赖其他组件，怎样完成它的初始化，根本就不需要你关心。</p> <p>Spring提供了两种容器类型：BeanFactory和ApplicationContext：</p> <p><img src="/docs/docs_image/software/java/spring/java_spring_bean02.png" alt="spring揭秘"></p> <p>BeanFactory只是Spring IoC容器的一种实现，如果没有特殊指定，它采用采用延迟初始化策略：只有当访问容器中的某个对象时，才对该对象进行初始化和依赖注入操作。
对于资源有限，并且功能要求不是很严格的场景，BeanFactory是比较合适的IoC容器选择。</p> <div class="language- extra-class"><pre><code>而在实际场景下，我们更多的使用另外一种类型的容器： ApplicationContext，它构建在BeanFactory之上，属于更高级的容器，除了具有BeanFactory的所有能力之外，还提供对事件监听机制以及国际化的支持等。它管理的bean，在容器启动时全部完成初始化和依赖注入操作。
ApplicationContext所管理的对象，在该类型容器启动之后，默认全部初始化并绑定完成。所以，相对于BeanFactory来说，ApplicationContext要求更多的系统资源，同时，因为在启动时就完成所有初始化，容器启动时间较之BeanFactory也会长一些。
在那些系统资源充足，并且要求更多功能的场景中，ApplicationContext类型的容器是比较合适的选择。
</code></pre></div><p><strong>Spring IoC容器的整个工作流程大致可以分为两个阶段：</strong></p> <ul><li><p>容器启动阶段</p> <p>容器启动时，会通过某种途径加载 ConfigurationMetaData，
ConfigurationMetaData可能定义在代码中，比如注解方式，也可能在在外部配置文件(XML/Properties)中，
，容器需要依赖某些工具类如BeanDefinitionReader，BeanDefinitionReader会对加载的 ConfigurationMetaData进行解析和分析，并将分析后的信息组装为相应的BeanDefinition，
最后把这些保存了bean定义的BeanDefinition，注册到相应的BeanDefinitionRegistry，
这样容器的启动工作就完成了。</p></li> <li><p>Bean的实例化阶段</p> <p>这个阶段触发是:当某个请求通过容器的getBean方法请求某个对象，或者因为依赖关系容器需要隐式的调用getBean时（如bean的注解@DependsOn 或者Autowired）;
容器会首先检查所请求的对象之前是否已经实例化完成。如果没有，则会根据注册的BeanDefinition所提供的信息实例化被请求对象，并为其注入依赖。当该对象装配完毕后，容器会立即将其返回给请求方法使用。</p> <p><strong>Notes:Autowire vs getbean:</strong></p> <blockquote><p><a href="https://www.logicbig.com/tutorials/spring-framework/spring-core/injecting-singleton-with-prototype-bean.html" target="_blank" rel="noopener noreferrer">Injecting a Prototype Bean into a Singleton Bean Problem<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html" target="_blank" rel="noopener noreferrer">You can then use getBean to retrieve instances of your beans. The ApplicationContext interface has a few other methods for retrieving beans, but, ideally, your application code should never use them. Indeed, your application code should have no calls to the getBean() method at all and thus have no dependency on Spring APIs at all.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></li></ul> <h4 id="bean生命周期接口"><a href="#bean生命周期接口" class="header-anchor">#</a> bean生命周期接口</h4> <p>Bean的生命周期：从配置到实例化:</p> <ol><li><p>建立Bean定义注册表：Spring容器（如ClassPathXmlApplicationContext）启动时，会读取配置信息（XML、注解等），解析每个<code>&lt;bean&gt;</code>或@Component注解，在内存中创建一个BeanDefinition对象来存储所有配置信息。这就是配置阶段。</p></li> <li><p>实例化Bean：当应用程序向容器请求一个Bean（或容器初始化所有单例Bean）时，容器会根据BeanDefinition的信息，通过Java反射机制调用构造方法来创建对象。这就是new一个对象的过程。</p></li> <li><p>Bean注入（依赖注入）：对象被创建后，它里面的属性可能还是null。此时，Spring容器会根据配置（如<code>&lt;property&gt;</code>标签或@Autowired注解），将这个Bean所依赖的其他Bean注入（设置）到相应的属性中。这就是“注入”发生的关键步骤！</p></li></ol> <p>IoC容器负责管理容器中所有bean的生命周期，而在bean生命周期的不同阶段，Spring提供了不同的扩展点来改变bean的命运，例如EnvironmentPostProcessor、BeanFactoryPostProcessor等（具体参照：第2节 SpringApplication启动流程）:</p> <p><strong>单例模式</strong></p> <p>spring boot默认bean是单例的，spring mvc默认的servlet也是单例的，当然bean @Controller也是单例的，多线程体现在httpservletrequest本身是线程间互相隔离的，
一般都是通过ThreadLocal实现，
之所以默认单例是因为，springboot本身就是ioc容器，启动过程很长，启动时会实例化加载bean（当然也有lazy模式），bean的实例化通常需要读取配置文件或者有很多其他bean的依赖，
所以每次都重建销毁性能很差，而且浪费内存；
https://stackoverflow.com/questions/10096483/is-threadlocal-preferable-to-httpservletrequest-setattributekey-value</p> <p>单例就是为了共享从而减少内存开销，多线程就是为了区别每个线程的上下文或者working thread context，所以线程上下文一定不能被共享，
比如ThreadLocal不能跟ExecutorService共用，就是因为ExecutorService破坏了线程间的隔离
Do Not Use ThreadLocal With ExecutorService
https://www.baeldung.com/java-threadlocal
https://www.cnblogs.com/MrSaver/p/11191028.html</p> <p>单例模式 工厂模式 建造者模式</p> <blockquote><p>Spring单例Bean与单例模式的区别在于它们关联的环境不一样，单例模式是指在一个JVM进程中仅有一个实例，而Spring单例是指一个Spring Bean容器(ApplicationContext)中仅有一个实例。
首先看单例模式，在一个JVM进程中（理论上，一个运行的JAVA程序就必定有自己一个独立的JVM）仅有一个实例，于是无论在程序中的何处获取实例，始终都返回同一个对象，以Java内置的Runtime为例（现在枚举是单例模式的最佳实践），无论何时何处获取，下面的判断始终为真：
Runtime.getRuntime() == Runtime.getRuntime()
与此相比，Spring的单例Bean是与其容器（ApplicationContext）密切相关的，所以在一个JVM进程中，如果有多个Spring容器，即使是单例bean，也一定会创建多个实例，代码示例如下：</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>//  第一个Spring Bean容器
ApplicationContext context_1 = new FileSystemXmlApplicationContext(&quot;classpath:/ApplicationContext.xml&quot;);
Person yiifaa_1 = context_1.getBean(&quot;yiifaa&quot;, Person.class);
//  第二个Spring Bean容器
ApplicationContext context_2 = new FileSystemXmlApplicationContext(&quot;classpath:/ApplicationContext.xml&quot;);
Person yiifaa_2 = context_2.getBean(&quot;yiifaa&quot;, Person.class);
//  这里绝对不会相等，因为创建了多个实例
System.out.println(yiifaa_1 == yiifaa_2);

&lt;!-- 即使声明了为单例，只要有多个容器，也一定会创建多个实例 --&gt;
&lt;bean id=&quot;yiifaa&quot; class=&quot;com.stixu.anno.Person&quot; scope=&quot;singleton&quot;&gt;
    &lt;constructor-arg name=&quot;username&quot;&gt;
        &lt;value&gt;yiifaa&lt;/value&gt;
    &lt;/constructor-arg&gt;
&lt;/bean&gt;
</code></pre></div><h4 id="bean定义-spring装配bean的三种方法"><a href="#bean定义-spring装配bean的三种方法" class="header-anchor">#</a> bean定义 - Spring装配bean的三种方法</h4> <p><a href="https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/beans.html" target="_blank" rel="noopener noreferrer">The interface <code>org.springframework.context.ApplicationContext</code> represents the Spring IoC container and is responsible for instantiating, configuring, and assembling the aforementioned beans. The container gets its instructions on what objects to instantiate, configure, and assemble by reading configuration metadata. The configuration metadata is represented in：<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><p>XML</p></li> <li><p><a href="https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/beans.html#beans-annotation-config" target="_blank" rel="noopener noreferrer">Java annotations<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>: 在业务类上使用注解（如@Component, @Autowired）</p></li> <li><p><a href="https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/beans.html#beans-java" target="_blank" rel="noopener noreferrer">Java code / JavaConfig<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>: 在专门的配置类中使用Java代码+注解（如@Configuration+@Bean）</p> <p><strong>混合使用三种装配</strong></p> <ol><li>在类上可以使用 @import(bbsConfig.class)组合其他java注解</li> <li>在类上使用 @importResource(&quot;classpath:spring-dao.xml&quot;)组合其他xml注解</li> <li>在类上可以使用@ContenxtConfiguration包含class或者xml</li> <li>在xml中可以用引入xml注解，也可以使用引入java注解</li></ol></li></ul> <h5 id="基于xml配置bean"><a href="#基于xml配置bean" class="header-anchor">#</a> 基于xml配置Bean</h5> <p>Configuration metadata is traditionally supplied in a simple and intuitive XML format</p> <p>https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/beans.html</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//XML装配bean的缺点</span>
<span class="token comment">//1.当Spring发现这个&lt;bean&gt;元素时,它将会调用SgtPeppers的默认构造器来创建bean.在XML配置中,bean的创建显得更加被动</span>
<span class="token comment">//2.不如JavaConfig强大,在JavaConfig配置中,可以通过任何想象到的方法来创建bean实例(构造器,set方法等)</span>
<span class="token comment">//3.在简单的&lt;bean&gt;声明中,将bean的类型以字符串的形式设置在了class属性中,不能保证设置给class属性的值是真正的类</span>
<span class="token comment">//4.重命名了类,也会引起麻烦</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">--</span><span class="token operator">-</span>基本
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">&quot;http://........&quot;</span>
             xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span>&quot;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>''<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>  configuration details go here <span class="token operator">--</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>bean <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.SgtPeppers&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token comment">//这里声明一个很简单的bean,因为没有明确给定ID,所以这个bean将会根据全限定类名来进行命名,</span>
	<span class="token comment">//这里的bean的ID将会是&quot;soundsystem.SgtPeppers#0&quot;.其中,&quot;#0&quot;是一个计数的形式,来区分相同类型的bean.</span>

	<span class="token comment">//更好的方法是借助id属性</span>
	<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.SgtPeppers&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

	
 	<span class="token comment">//当Spring遇到&lt;bean&gt;这个元素时,它会创建一个CDPlayer实例.&lt;constructor-arg&gt;元素会告知Spring要将</span>
    <span class="token comment">//一个ID为compactDisc的bean引用传递到CDPlayer的构造器中.</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;cdPlayer&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.CDPlayer&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg ref<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
        
<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">&gt;</span>

作为替代方案<span class="token punctuation">,</span>也可以使用<span class="token class-name">Spring</span>的c<span class="token operator">-</span>命名空间（<span class="token class-name">Spring3</span><span class="token number">.0</span>所引入的c<span class="token operator">-</span>命名空间）
<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">&quot;http://........&quot;</span>
            xmlns<span class="token operator">:</span>c<span class="token operator">=</span><span class="token string">&quot;http://www.springframework.org/schema/c&quot;</span>
             xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span>&quot;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>''<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>  configuration details go here <span class="token operator">--</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;cdPlayer&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.CDPlayer&quot;</span>
   	c<span class="token operator">:</span>cd<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span><span class="token operator">&gt;</span>
    <span class="token comment">//&quot;c:&quot; 命名空间的前缀</span>
    <span class="token comment">//&quot;cd&quot; 构造器参数名</span>
    <span class="token comment">//&quot;-ref&quot;注入bean引用</span>
    <span class="token comment">//&quot;compactDisc&quot; 要注入bean 的ID</span>
	
    如果在优化构建的过程<span class="token punctuation">,</span>将调试标志移除掉<span class="token punctuation">,</span>那么这种方式可能无法正常执行<span class="token punctuation">.</span>代替方案：
	<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;cdPlayer&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.CDPlayer&quot;</span>
   c<span class="token operator">:</span>_0<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span><span class="token operator">&gt;</span>
	<span class="token comment">//把参数名换成&quot;0&quot;,也就是参数的索引,但XML中不允许数字作为属性的第一个字符,因此添加下划线&quot;_&quot;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">&gt;</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">--</span><span class="token operator">-</span> 字面量string注入
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlankDisc</span> <span class="token keyword">implements</span> <span class="token class-name">CompactDisc</span><span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> artist<span class="token punctuation">;</span>
  
  <span class="token keyword">public</span> <span class="token class-name">BlandDisc</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span><span class="token class-name">String</span> artist<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>artist <span class="token operator">=</span> artist<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">paly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Playing&quot;</span><span class="token operator">+</span>title<span class="token operator">+</span><span class="token string">&quot;by&quot;</span><span class="token operator">+</span>artist<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span>
    <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundysytem.BlankDisc&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg value<span class="token operator">=</span><span class="token string">&quot;Sgt.Peper's Lonely Hearts&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg value<span class="token operator">=</span><span class="token string">&quot;The beatles&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
等价
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span>
    <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.BlanDisc&quot;</span>
    c<span class="token operator">:</span>_title<span class="token operator">=</span><span class="token string">&quot;Sgt.Peper's Lonely Hearts&quot;</span>
    c<span class="token operator">:</span>_artist<span class="token operator">=</span><span class="token string">&quot;The beatles&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
或
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span>
    <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.BlanDisc&quot;</span>
    c<span class="token operator">:</span>_0<span class="token operator">=</span><span class="token string">&quot;Sgt.Peper's Lonely Hearts&quot;</span>
    c<span class="token operator">:</span>_1<span class="token operator">=</span><span class="token string">&quot;The beatles&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">--</span><span class="token operator">-</span> 集合注入
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlankDisc</span> <span class="token keyword">implements</span> <span class="token class-name">CompactDisc</span><span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> artist<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tracks<span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTitel</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setArtist</span><span class="token punctuation">(</span><span class="token class-name">String</span> artist<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>artist<span class="token operator">=</span> artist<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTracks</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tracks<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tracks<span class="token operator">=</span> tracks<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span>
    <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.BlankDisc&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg value<span class="token operator">=</span><span class="token string">&quot;Sgt.Peper's Lonely Hearts&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg value<span class="token operator">=</span><span class="token string">&quot;The beatles&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>list<span class="token punctuation">&gt;</span></span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token class-name">Sgt<span class="token punctuation">.</span> Pepper</span>'s <span class="token class-name">Lonely</span> <span class="token class-name">Heats</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token class-name">With</span> a <span class="token class-name">Little</span> <span class="token class-name">Help</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token class-name">Lucy</span> in the <span class="token class-name">Sky</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token class-name">Getting</span> <span class="token class-name">Better</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token class-name">Fixing</span> a <span class="token class-name">Hole</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>list<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
等价于p命名空间
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span>
      <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.BlankDisc&quot;</span>
      p<span class="token operator">:</span>title<span class="token operator">=</span><span class="token string">&quot;Sgt.peper's loney hearts club&quot;</span>
      p<span class="token operator">:</span>artist<span class="token operator">=</span><span class="token string">&quot;The Beatles&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;tracks&quot;</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>list<span class="token punctuation">&gt;</span></span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token class-name">Sgt</span><span class="token punctuation">.</span>peper's loney hearts club<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>loney hearts club<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>hearts club<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
      <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>club hearts<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>list<span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
注意list不能直接使用p空间，可以借用util<span class="token operator">-</span>命名空间
<span class="token operator">&lt;</span>util<span class="token operator">:</span>list id<span class="token operator">=</span><span class="token string">&quot;trackList&quot;</span><span class="token operator">&gt;</span>
     <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token class-name">Sgt</span><span class="token punctuation">.</span>peper's loney hearts club<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
     <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>loney hearts club<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
     <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>hearts club<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
     <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>club hearts<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>util<span class="token operator">:</span>lsit<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span>
           <span class="token keyword">class</span> <span class="token operator">=</span> <span class="token string">&quot;soundsystem.BlankDisc&quot;</span>
           p<span class="token operator">:</span>title<span class="token operator">=</span><span class="token string">&quot;Sgt.pepers lonely hearts&quot;</span>
           p<span class="token operator">:</span>artist<span class="token operator">=</span><span class="token string">&quot;The Beatles&quot;</span>
           p<span class="token operator">:</span>tracks<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">&quot;trackList&quot;</span><span class="token operator">&gt;</span>     

复杂类型的list：
<span class="token keyword">public</span> <span class="token class-name">Discography</span><span class="token punctuation">(</span><span class="token class-name">String</span> artist<span class="token punctuation">,</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CompactDisc</span><span class="token punctuation">&gt;</span></span> cds<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;beatlesDiscography&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.Discography&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg value<span class="token operator">=</span><span class="token string">&quot;The Beatles&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>list<span class="token punctuation">&gt;</span></span>
      <span class="token operator">&lt;</span>ref bean<span class="token operator">=</span><span class="token string">&quot;sgtPeppers&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>ref bean<span class="token operator">=</span><span class="token string">&quot;whiteAlbum&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>lsit<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">--</span><span class="token operator">-</span> 属性注入
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>    
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">soundsystem<span class="token punctuation">.</span></span><span class="token class-name">CompactDisc</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">soundsystem<span class="token punctuation">.</span></span><span class="token class-name">MediaPlayer</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayer</span> <span class="token keyword">implements</span> <span class="token class-name">MediaPlayer</span><span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">CompactDisc</span> compactDisc<span class="token punctuation">;</span>

  <span class="token annotation punctuation">@Autowired</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCompactDisc</span><span class="token punctuation">(</span><span class="token class-name">CompactDisc</span> compactDisc<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>compactDisc <span class="token operator">=</span> compactDisc<span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">paly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    compactDisc<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;cdPlayer&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.CDPlayer&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span> ref<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
<span class="token comment">//通过ref引用了ID为compactDisc的bean,将其注入到compactDisc属性中(通过setCompactDisc()方法)</span>

等价于通过p命名空间
<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">&quot;http://........&quot;</span>
       xmlns<span class="token operator">:</span>p<span class="token operator">=</span><span class="token string">&quot;http://www.springframework.org/schema/p&quot;</span>
       xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span>&quot;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>''<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>  configuration details go here <span class="token operator">--</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;cdPlayer&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;soundsystem.CDPlayer&quot;</span>
    p<span class="token operator">:</span>compactDisc<span class="token operator">-</span>ref<span class="token operator">=</span><span class="token string">&quot;compactDisc&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
<span class="token comment">//&quot;p:&quot; :前缀</span>
<span class="token comment">//前面的compactDisc: 属性名</span>
<span class="token comment">//-ref:  注入bean引用</span>
<span class="token comment">//后面的compactDisc: 所注入bean的ID</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">&gt;</span>
 

<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span> <span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">&quot;http://www.springframework.org/schema/beans&quot;</span>
       xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span>&quot;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans
            http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans<span class="token operator">/</span>spring<span class="token operator">-</span>beans<span class="token punctuation">.</span>xsd
            http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>context&quot;<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">import</span> <span class="token namespace">resource</span><span class="token operator">=</span><span class="token string">&quot;spring/spring-dao.xml&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;postservice&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.bbs.service.impl.PostserviceImpl&quot;</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg ref<span class="token operator">=</span><span class="token string">&quot;postdao&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg ref<span class="token operator">=</span><span class="token string">&quot;userdao&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">&gt;</span>

配置postservice的bean时需要引入两个bean，postdao和userdao，放到constructor<span class="token operator">-</span>arg的标签中，ref指的是依赖的bean的ID。如果是在javaConfig中配置的，就写<span class="token annotation punctuation">@Bean</span>的内容。如果是<span class="token annotation punctuation">@Component</span>就写<span class="token annotation punctuation">@Qualifier</span>的内容。这里是引入的是动态实现的dao接口的bean，是在spring<span class="token operator">-</span>dao<span class="token punctuation">.</span>xml中配置的，引入这个配置文件就可以自动获得beanID。
</code></pre></div><h5 id="annotation-based-configuration-使用注解annotation定义bean"><a href="#annotation-based-configuration-使用注解annotation定义bean" class="header-anchor">#</a> <a href="https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/beans.html#beans-annotation-config" target="_blank" rel="noopener noreferrer">Annotation-based configuration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 使用注解Annotation定义Bean</h5> <p>Spring 2.5 introduced support for annotation-based configuration metadata.</p> <p>spring从两个角度实现自动化装配：组件扫描和自动装配</p> <ol><li>创建可被发现的bean</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
这个简单的注解表明该类会作为组件类<span class="token punctuation">,</span>并告知<span class="token class-name">Spring</span>要为这个类创建bean

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">--</span><span class="token operator">-</span> 命名 bean id
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 
如果没有个bean设置ID<span class="token punctuation">,</span><span class="token class-name">Spring</span>会根据类名为其指定一个ID<span class="token punctuation">,</span>默认名字就是把类名的第一个字母变为小写<span class="token punctuation">.</span>
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">&quot;lonelyHeartsClub&quot;</span><span class="token punctuation">)</span> <span class="token comment">//设置期望的ID</span>
	<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SgtPeppers</span> <span class="token keyword">implements</span> <span class="token class-name">CompactDisc</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span>
另外还一种为bean命名的方式<span class="token punctuation">,</span>使用<span class="token class-name">Java</span>依赖注入规范中所提供的<span class="token annotation punctuation">@Named</span>注解来为bean设置ID
<span class="token annotation punctuation">@Named</span><span class="token punctuation">(</span><span class="token string">&quot;lonelyHeartsClub&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SgtPeppers</span> <span class="token keyword">implements</span> <span class="token class-name">CompactDisc</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">--</span><span class="token operator">-</span> 设置组件扫描的基础包
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
当对一个类标注<span class="token annotation punctuation">@Component</span>注解时，表明该类会作为组件类，spring将为这个类创建bean。当在应用文中引用这个bean，spring会自动扫描事先指定的包查找这个  bean。但spring默认是不启用组件扫描的，可以在XML中配置加上。还有一种方法：在新建一个配置类，类中可以什么不用写，在配置类上加上<span class="token annotation punctuation">@ComponentScan</span>注解，spring会自动扫描改配置类所在的包。
<span class="token comment">//直接在value属性中指明包的名称</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;soundsystem&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayerConfig</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//通过basePackages属性配置</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages<span class="token operator">=</span><span class="token string">&quot;soundsystem&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayerConfig</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//设置多个基础包,用数组表示</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;soundsystem&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;video&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayerConfig</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//基础包以String类型表示是不安全的,如果重构代码的话,指定的基础包可能会出现错误,用指定为包中所包含的类或接口的方法</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackageClasses<span class="token operator">=</span><span class="token punctuation">{</span><span class="token class-name">CDPlayer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">DVDPlayer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayerConfig</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">--</span><span class="token operator">-</span> 添加注解自动装配<span class="token class-name">Autowired</span>
<span class="token annotation punctuation">@Autowired</span>可以换成<span class="token annotation punctuation">@Inject</span><span class="token punctuation">,</span><span class="token annotation punctuation">@Inject</span>注解来源于<span class="token class-name">Java</span>依赖注入规范<span class="token punctuation">,</span>该规范同时还为我们定义了<span class="token annotation punctuation">@Named</span>注解<span class="token punctuation">.</span>
尽管<span class="token annotation punctuation">@Inject</span>和<span class="token annotation punctuation">@Autowierd</span>有细微的差别<span class="token punctuation">,</span>但大多数场景下<span class="token punctuation">,</span>它们都可以互换<span class="token punctuation">.</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token annotation punctuation">@Autowired</span>注解构造器：
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayer</span> <span class="token keyword">implements</span> <span class="token class-name">MediaPlayer</span><span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">CompactDisc</span> cd<span class="token punctuation">;</span>

  <span class="token annotation punctuation">@Autowired</span><span class="token comment">//这表明当Spring创建CDPlayer bean的时候,会通过这个构造器来进行实例化并且会传入一个可设置给CompactDisc类型的bean.</span>
  <span class="token keyword">public</span> <span class="token class-name">CDPlayer</span><span class="token punctuation">(</span><span class="token class-name">CompactDisc</span> cd<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//构造器</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cd <span class="token operator">=</span> cd<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">paly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    cd<span class="token punctuation">.</span><span class="token function">paly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Autowired</span>注解属性的<span class="token class-name">Setter</span>方法：
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCompactDisc</span><span class="token punctuation">(</span><span class="token class-name">CompactDisc</span> cd<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cd <span class="token operator">=</span> cd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

如果没有匹配的bean<span class="token punctuation">,</span>那么在应用上下文创建的时候<span class="token punctuation">,</span><span class="token class-name">Spring</span>会抛出一个异常<span class="token punctuation">,</span>为了避免异常的出现<span class="token punctuation">,</span>你可以将<span class="token annotation punctuation">@Autowired</span>的requied属性设置为<span class="token boolean">false</span>
<span class="token annotation punctuation">@Autowired</span><span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCompactDisc</span><span class="token punctuation">(</span><span class="token class-name">CompactDisc</span> cd<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cd <span class="token operator">=</span> cd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

如果有多个bean都能满足依赖关系的话<span class="token punctuation">,</span><span class="token class-name">Spring</span>将会抛出一个异常<span class="token punctuation">,</span>表明没有明确指定要选择哪个bean进行自动装配<span class="token punctuation">,</span> 一般在组件类上添加注解<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span>括号写这个bean的id，在注入时也加上<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>写上bean的id
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;postdao&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Postdao</span><span class="token punctuation">{</span>
<span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;userdao&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Userdao</span><span class="token punctuation">{</span>
<span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;usedao&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUserdao</span><span class="token punctuation">(</span><span class="token class-name">Userdao</span> userdao<span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;postdao&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUserdao</span><span class="token punctuation">(</span><span class="token class-name">Postdao</span> postdao<span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="java-based-configuration-基于java类提供bean定义信息"><a href="#java-based-configuration-基于java类提供bean定义信息" class="header-anchor">#</a> <a href="https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/beans.html#beans-java" target="_blank" rel="noopener noreferrer">Java-based configuration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 基于java类提供Bean定义信息</h5> <p>所谓java based 我的理解是这里是说不需要依赖于spring，普通的java项目也可以用</p> <p>Starting with Spring 3.0, many features provided by the <a href="http://www.springsource.org/javaconfig" target="_blank" rel="noopener noreferrer">Spring JavaConfig project<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> became part of the core Spring Framework. Thus you can define beans external to your application classes by using Java rather than XML files. To use these new features, see the <code>@Configuration</code>, <code>@Bean, @Import</code> and <code>@DependsOn</code> annotations.</p> <p>有些情况下,比如说,要将第三方库的组件装配到你的应用中,就不能使用前面的自动化装配方法 到第三方库中去给类加@Component和@Autowired注解,
在这种情况下,就需要采用显示装配的方式.在进行显示配置有Java和XML两种方案显示装配bean.</p> <p>使用java代码，先新建一个配置类JavaConfig，里面都是配置所需的bean，不应该有业务逻辑代码，所以单独建一个类。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Bean</span>
  <span class="token keyword">public</span> <span class="token class-name">MyService</span> <span class="token function">myService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">ApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">AppConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">MyService</span> myService <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">MyService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  myService<span class="token punctuation">.</span><span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">AnnotationConfigApplicationContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">AppConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">OtherConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">AdditionalConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">MyService</span> myService <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">MyService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  myService<span class="token punctuation">.</span><span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//创建JavaConfig类的关键在于为其添加@Configruation注解,表明这是一个配置类</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CDPlayerConfig</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CompactDisc</span> <span class="token function">sgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//@Bean注解会告诉Spring这个方法将会返回一个对象,该对象要注册为Spring应用上下文的bean,默认情况下,</span>
    bean的ID于带有<span class="token annotation punctuation">@Bean</span>注解的方法名一样<span class="token punctuation">,</span>也可以重命名

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;lonelyHeartsClubBand&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CompactDisc</span> <span class="token function">sgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	
    声明<span class="token class-name">CompactDisc</span> bean是非常简单<span class="token punctuation">,</span>它自身没有其他依赖<span class="token punctuation">,</span>但现在<span class="token punctuation">,</span>我们需要声明<span class="token class-name">CDPlayer</span> bean<span class="token punctuation">,</span>它依赖于<span class="token class-name">CompactDisc</span><span class="token punctuation">,</span>在<span class="token class-name">JavaConfig</span>中<span class="token punctuation">,</span>如何将他们装配在一起呢<span class="token operator">?</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CDPlayer</span> <span class="token function">cdPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CDPlayer</span><span class="token punctuation">(</span><span class="token function">sgtPeppers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//因为sgtPeppers()方法上添加了@Bean注解,Spring将会拦截所有对它的调用,</span>
    <span class="token comment">//并确保直接返回该方法创建的bean,而不是每次都对其进行实际的调用.</span>
    <span class="token punctuation">}</span>
    等价于下面这种方式
        
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CDPlayer</span> <span class="token function">cdPlayer</span><span class="token punctuation">(</span><span class="token class-name">CompactDisc</span> compactDisc<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//在这里,cdPlayer()方法请求一个CompactDisc作为参数,当Springs调用cdPlayer()创建CDPlayer bean的时候,</span>
<span class="token comment">//它会自动装配一个CompactDisc到配置方法之中,然后方法体按照合适的方法来使用它.</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CDPlayer</span><span class="token punctuation">(</span>compactDisc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;lonelyHeartsClubBandPlayer&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CDPlayer</span> <span class="token function">cdPlayer</span><span class="token punctuation">(</span><span class="token class-name">CompactDisc</span> lonelyHeartsClubBand<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CDPlayer</span><span class="token punctuation">(</span>compactDisc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name">More</span> example：

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;classpath:spring/spring-dao.xml&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;classpath:scan.xml&quot;</span><span class="token punctuation">}</span>）
<span class="token keyword">public</span> <span class="token keyword">class</span> bbsConfig<span class="token punctuation">{</span>
　　<span class="token keyword">private</span> <span class="token class-name">Postdao</span> postdao<span class="token punctuation">;</span>
　　<span class="token keyword">private</span> <span class="token class-name">Userdao</span> userdao<span class="token punctuation">;</span>
　　<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;postservice&quot;</span><span class="token punctuation">)</span>
   <span class="token keyword">public</span> <span class="token class-name">PostService</span> <span class="token function">getPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
　　<span class="token punctuation">{</span>
　　<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PostserviceImpl</span><span class="token punctuation">(</span>postdao<span class="token punctuation">,</span>userdao<span class="token punctuation">)</span><span class="token punctuation">;</span>
　　<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

在对<span class="token class-name">PostService</span>的bean注入时，同时又依赖了两个bean，postdao和userdao。直接引用beanID就可以，spring会自动地从容器中获取这些bean，只要他们的配置是正确的就行。这个例子中userdao、postdao是<span class="token class-name">Mybatis</span>配置自动扫描将dao接口生成代理注入到spring的，其实也算是xml装配bean
这里如果再声明一个bean，返回的仍是postserviceImpl对象，和之前的那个bean完全一样，是同一个实例。一般spring <span class="token annotation punctuation">@bean</span>如果是同一个beanID，默认返回的是一个单例bean，注入的是同一个实例。如果修改其中一个会都改变的。
不过在这里要注意进行测试时，由于spring的单元测试和springIoc容器是完全独立的，postdao和userdao注入检测时是使用locations加载xml文件，而postservice使用classes加载config类的，但是两个不能同时混用在<span class="token annotation punctuation">@ContextConfiguration</span>中。所以非要都测试的话，就分开测试吧。
</code></pre></div><p>@SpringBootApplication 等同于 @EnableAutoConfiguration + @ComponentScan + @Configuration, 后面启动原理部分有详解</p> <p>All of your application components (@Component, @Service, @Repository, @Controller etc.) are automatically registered as Spring Beans.</p> <p>Components(@Component @Service @Controller @Repository) VS Beans (@Beans):
all component types are treated in the same way. The subtypes are mere markers, think code readability rather than features.
https://www.tomaszezula.com/2014/02/09/spring-series-part-5-component-vs-bean/</p> <p>** @ComponentScan**</p> <p>** @Import**</p> <p>在4.2之前， @Import注解只支持导入配置类，但是在4.2之后，它支持导入普通类</p> <p><strong>@Conditional @ConditionalOn*</strong></p> <p>表示在满足某种条件后才初始化一个bean或者启用某些配置。它一般用在由 @Component、 @Service、 @Configuration等注解标识的类上面，或者由 @Bean标记的方法上。如果一个 @Configuration类标记了 @Conditional，则该类中所有标识了 @Bean的方法和 @Import注解导入的相关类将遵从这些条件。</p> <p><strong>@ConfigurationProperties与@EnableConfigurationProperties</strong></p> <p>当某些属性的值需要配置的时候，我们一般会在 application.properties文件中新建配置项，然后在bean中使用 @Value注解来获取配置的值;</p> <div class="language- extra-class"><pre class="language-text"><code>@Configuration
public class MyBatisConfiguration { 
	@Value(&quot;${spring.datasource.driverClassName}&quot;)
    private String jdbcDriverClassName;
	@Value(&quot;${spring.datasource.url}&quot;)
    private String jdbcUrl;
    @Value(&quot;${spring.datasource.username}&quot;)
    private String jdbcUsername;
    @Value(&quot;${spring.datasource.password}&quot;)
    private String jdbcPassword;
    
	@Bean(name = &quot;dataSource&quot;,destroyMethod = &quot;close&quot;)
    public DataSource dataSource() {
    	DruidDataSource datasource = new DruidDataSource();
    	datasource.setDriverClassName(jdbcDriverClassName);
    	datasource.setUrl(jdbcUrl);
    	datasource.setUsername(jdbcUsername);
    	datasource.setPassword(jdbcPassword);
        return datasource;
    }
	
	@Bean(name = {&quot;sqlSessionFactory&quot;})
	@ConditionalOnMissingBean(name = {&quot;sqlSessionFactory&quot;})
	public SqlSessionFactory sqlSessionFactory(DataSource dataSource) throws Exception {
	....
</code></pre></div><p>但是如果同一个配置在多个地方使用，也存在不方便维护的问题，对于更为复杂的配置，Spring Boot提供了更优雅的实现方式，那就是 @ConfigurationProperties注解
而@EnableConfigurationProperties的作用是将其注册为bean，否则项目不会将其scan为bean，具体：</p> <blockquote><p>In order to use a configuration class in our project, we need to register it as a regular Spring bean.</p></blockquote> <blockquote><p>First of all, we can annotate such a class with @Component. Alternatively, we can use a @Bean factory method.</p></blockquote> <blockquote><p>However, <strong>in certain situations, we may prefer to keep a @ConfigurationProperties class as a simple POJO</strong>. This is when @EnableConfigurationProperties comes in handy. We can specify all configuration beans directly on this annotation.</p></blockquote> <blockquote><p>This is a convenient way to quickly register @ConfigurationProperties annotated beans.</p></blockquote> <p>通过上面等表述，我们大概知道，如果用@component就会将其变成增强类，而不是plain old java object了，而是多了很多冗余的功能；</p> <div class="language- extra-class"><pre class="language-text"><code>@ConfigurationProperties(prefix = &quot;additional&quot;)
public class AdditionalProperties {
 
    private String unit;
    private int max;
 
    // standard getters and setters
}
@Configuration
@EnableConfigurationProperties(AdditionalProperties.class)
public class AdditionalConfiguration {
     
    @Autowired
    private AdditionalProperties additionalProperties;
     
    // make use of the bound properties
}
</code></pre></div><h4 id="bean注入"><a href="#bean注入" class="header-anchor">#</a> bean注入</h4> <div class="language- extra-class"><pre class="language-text"><code>Spring依赖注入技术演进：
┌────────────────────────────────────────────────────────┐
│                  配置方式演进                           │
├────────────────────────────────────────────────────────┤
│ 1. XML显式配置 (Spring 1.x)                            │
│    ├── &lt;property name=&quot;...&quot; ref=&quot;...&quot;/&gt;               │
│    ├── &lt;constructor-arg ref=&quot;...&quot;/&gt;                  │
│    └── 工厂方法注入                                   │
│                                                        │
│ 2. XML自动装配 (Spring 2.0)                            │
│    ├── autowire=&quot;byName&quot;                              │
│    ├── autowire=&quot;byType&quot;                              │
│    ├── autowire=&quot;constructor&quot;                         │
│    ├── autowire=&quot;default&quot;                             │
│    └── autowire=&quot;no&quot;                                  │
│                                                        │
│ 3. 注解驱动 (Spring 2.5)                                │
│    ├── @Autowired (字段/构造器/方法注入)               │
│    ├── @Resource (JSR-250)                            │
│    ├── @Inject (JSR-330)                              │
│    └── @Required                                      │
│                                                        │
│ 4. Java配置 (Spring 3.0)                               │
│    ├── @Configuration + @Bean                         │
│    └── 方法参数自动注入                               │
└────────────────────────────────────────────────────────┘
</code></pre></div><h5 id="早期基于xml显式配置三种注入方式"><a href="#早期基于xml显式配置三种注入方式" class="header-anchor">#</a> 早期基于XML显式配置三种注入方式</h5> <ul><li><p>属性注入</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>java<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">People</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//调用默认的构造方法</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
      <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;People{&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;id=&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span>
                <span class="token string">&quot;, name='&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">&quot;, age=&quot;</span> <span class="token operator">+</span> age <span class="token operator">+</span>
                <span class="token char">'}'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">&quot;http://www.springframework.org/schema/beans&quot;</span>
    xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span>&quot;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans
        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans<span class="token operator">/</span>spring<span class="token operator">-</span>beans<span class="token punctuation">.</span>xsd&quot;<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;people&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.java.entity.People&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
    <span class="token comment">//属性注入</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;people2&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.java.entity.People&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;id&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;1&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;age&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;18&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;name&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;张三&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">&gt;</span>
        
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//加载beans.xml文件，调用Spring接口</span>
        <span class="token class-name">ApplicationContext</span> ac<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;beans.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//通过id获取bean，返回一个对象</span>
        <span class="token class-name">People</span> people<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">)</span>ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;people&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用方法</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>people<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
        <span class="token comment">//属性注入</span>
        <span class="token class-name">People</span> people2<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">)</span>ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;people2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>people2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>构造函数注入</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>类型注入<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;people3&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.java.entity.People&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg type<span class="token operator">=</span><span class="token string">&quot;int&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg type<span class="token operator">=</span><span class="token string">&quot;String&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;李四&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg type<span class="token operator">=</span><span class="token string">&quot;int&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;19&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>索引注入<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;people4&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.java.entity.People&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">&quot;0&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;3&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">&quot;1&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;王五&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg index<span class="token operator">=</span><span class="token string">&quot;2&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;20&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>联合使用<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;people5&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.java.entity.People&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg type<span class="token operator">=</span><span class="token string">&quot;int&quot;</span> index<span class="token operator">=</span><span class="token string">&quot;0&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;4&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg type<span class="token operator">=</span><span class="token string">&quot;String&quot;</span> index<span class="token operator">=</span><span class="token string">&quot;1&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;赵六&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg type<span class="token operator">=</span><span class="token string">&quot;int&quot;</span> index<span class="token operator">=</span><span class="token string">&quot;2&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;21&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>

<span class="token comment">//类型注入</span>
<span class="token class-name">People</span> people3<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">)</span>ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;people3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>people3<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//类型注入</span>
<span class="token class-name">People</span> people4<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">)</span>ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;people4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>people4<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//联合使用</span>
<span class="token class-name">People</span> people5<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">)</span>ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;people5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>people5<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>工厂方法注入，分为静态工厂和非静态工厂； 一般用得多的都是静态工厂；</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>java<span class="token punctuation">.</span>factory</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>java<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">People</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PeopleFactory</span> <span class="token punctuation">{</span>
    <span class="token comment">//非静态工厂</span>
    <span class="token keyword">public</span> <span class="token class-name">People</span> <span class="token function">createPeople</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">People</span> p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;阿七&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//静态工厂</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">People</span> <span class="token function">createPeople1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">People</span> p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;阿八&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

 <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>工厂模式的非静态方法<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;peopleFactory&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.java.factory.PeopleFactory&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;people6&quot;</span> factory<span class="token operator">-</span>bean<span class="token operator">=</span><span class="token string">&quot;peopleFactory&quot;</span> factory<span class="token operator">-</span>method<span class="token operator">=</span><span class="token string">&quot;createPeople&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>工厂模式的静态方法<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;people7&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;com.java.factory.PeopleFactory&quot;</span> factory<span class="token operator">-</span>method<span class="token operator">=</span><span class="token string">&quot;createPeople1&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
        
 <span class="token comment">//工厂方式注入，非静态</span>
<span class="token class-name">People</span> people6<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">)</span>ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;people6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>people6<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//工厂方式注入，静态</span>
<span class="token class-name">People</span> people7<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">)</span>ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;people7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>people7<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h5 id="中期基于xml-autowire-no-byname-bytype-constructor-default"><a href="#中期基于xml-autowire-no-byname-bytype-constructor-default" class="header-anchor">#</a> 中期基于XML autowire=&quot;no|byName|byType|constructor|default&quot;</h5> <h5 id="现代基于autowired-的三种注入方式"><a href="#现代基于autowired-的三种注入方式" class="header-anchor">#</a> 现代基于Autowired 的三种注入方式</h5> <p>如果你使用的是构造器注入
恭喜你，当你有十几个甚至更多对象需要注入时，你的构造函数的参数个数可能会长到无法想像。</p> <p>如果你使用的是field反射注入
如果不使用Spring框架，这个属性只能通过反射注入，太麻烦了！这根本不符合JavaBean规范。
还有，当你不是用过Spring创建的对象时，还可能引起NullPointerException。
并且，你不能用final修饰这个属性。</p> <p>如果你使用的是setter方法注入
那么你将不能将属性设置为final。
两者取其轻</p> <p>Spring3.0官方文档建议使用setter注入覆盖构造器注入。
Spring4.0官方文档建议使用构造器注入。
结论</p> <p>如果注入的属性是必选的属性，则通过构造器注入。
如果注入的属性是可选的属性，则通过setter方法注入。
至于field注入，不建议使用。</p> <ul><li><p>通过field反射注入, field injection (不推荐)</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dependency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">Dependency</span> dependency<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
     
</code></pre></div></li> <li><p>通过构造器注入</p> <div class="language- extra-class"><pre class="language-text"><code>public class DI(){
	//通过构造器注入
	private DependencyA a;
	@Autowired
	public DI(DependencyA a){
		this.a = a;
	}
   
}
</code></pre></div></li> <li><p>通过setter方法注入</p> <div class="language- extra-class"><pre class="language-text"><code>public class DI(){
	//通过setter方法注入
	private DependencyB b;
	@Autowired
	public void setDependencyB(DependencyB b){
		this.b = b;
	}
    
}
     
</code></pre></div></li></ul> <h3 id="配置属性加载顺序"><a href="#配置属性加载顺序" class="header-anchor">#</a> 配置属性加载顺序</h3> <div class="language- extra-class"><pre class="language-text"><code>1、开发者工具 `Devtools` 全局配置参数；

2、单元测试上的 `@TestPropertySource` 注解指定的参数；

3、单元测试上的 `@SpringBootTest` 注解指定的参数；

4、命令行指定的参数，如 `java -jar springboot.jar --name=&quot;Java技术栈&quot;`；

5、命令行中的 `SPRING_APPLICATION_JSONJSON` 指定参数, 如 `java -Dspring.application.json='{&quot;name&quot;:&quot;Java技术栈&quot;}' -jar springboot.jar`

6、`ServletConfig` 初始化参数；

7、`ServletContext` 初始化参数；

8、JNDI参数（如 `java:comp/env/spring.application.json`）；

9、Java系统参数（来源：`System.getProperties()`）；

10、操作系统环境变量参数；

11、`RandomValuePropertySource` 随机数，仅匹配：`ramdom.*`；

12、JAR包外面的配置文件参数（`application-{profile}.properties（YAML）`）

13、JAR包里面的配置文件参数（`application-{profile}.properties（YAML）`）

14、JAR包外面的配置文件参数（`application.properties（YAML）`）

15、JAR包里面的配置文件参数（`application.properties（YAML）`）

16、`@Configuration`配置文件上 `@PropertySource` 注解加载的参数；

17、默认参数（通过 `SpringApplication.setDefaultProperties` 指定）；
</code></pre></div><h3 id="spring容器的事件监听机制"><a href="#spring容器的事件监听机制" class="header-anchor">#</a> Spring容器的事件监听机制</h3> <p>Java提供了实现事件监听机制的两个基础类：自定义事件类型扩展自 java.util.EventObject、事件的监听器扩展自 java.util.EventListener</p> <p>Spring的ApplicationContext容器内部中的所有事件类型均继承自 org.springframework.context.AppliationEvent，容器中的所有监听器都实现 org.springframework.context.ApplicationListener接口，并且以bean的形式注册在容器中。一旦在容器内发布ApplicationEvent及其子类型的事件，注册到容器的ApplicationListener就会对这些事件进行处理。</p> <p>ApplicationEvent继承自EventObject，Spring提供了一些默认的实现，比如： ContextClosedEvent表示容器在即将关闭时发布的事件类型， ContextRefreshedEvent表示容器在初始化或者刷新的时候发布的事件类型......</p> <p>容器内部使用ApplicationListener作为事件监听器接口定义，它继承自EventListener。ApplicationContext容器在启动时，会自动识别并加载EventListener类型的bean，一旦容器内有事件发布，将通知这些注册到容器的EventListener。</p> <p>ApplicationContext接口继承了ApplicationEventPublisher接口，该接口提供了 voidpublishEvent(ApplicationEventevent)方法定义，不难看出，ApplicationContext容器担当的就是事件发布者的角色。如果有兴趣可以查看 AbstractApplicationContext.publishEvent(ApplicationEventevent)方法的源码：ApplicationContext将事件的发布以及监听器的管理工作委托给 ApplicationEventMulticaster接口的实现类。在容器启动时，会检查容器内是否存在名为applicationEventMulticaster的ApplicationEventMulticaster对象实例。如果有就使用其提供的实现，没有就默认初始化一个SimpleApplicationEventMulticaster作为实现。</p> <p>最后，如果我们业务需要在容器内部发布事件，只需要为其注入ApplicationEventPublisher依赖即可：实现ApplicationEventPublisherAware接口或者ApplicationContextAware接口</p> <h3 id="自动配置原理"><a href="#自动配置原理" class="header-anchor">#</a> 自动配置原理</h3> <p>@SpringBootApplication开启<strong>组件扫描和自动配置</strong>，
而 SpringApplication.run则负责<strong>启动引导应用程序</strong>。 @SpringBootApplication是一个复合 Annotation，它将三个注解组合在一起：</p> <ul><li><p><strong>@SpringBootConfiguration</strong>就是 @Configuration，它是Spring框架的注解，标明该类是一个 JavaConfig配置类; allow to register extra beans in the context or import additional configuration classes;</p></li> <li><p><strong>@ComponentScan</strong>启用组件扫描;enable @Component scan on the package where the application is located;</p></li> <li><p><strong>@EnableAutoConfiguration</strong>注解：
表示开启Spring Boot自动配置功能，Spring Boot会根据应用的依赖、自定义的bean、classpath下有没有某个类 等等因素来猜测你需要的bean，然后注册到IOC容器中;
enable <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-auto-configuration" target="_blank" rel="noopener noreferrer">Spring Boot’s auto-configuration mechanism<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <p><em>Notes:</em></p> <blockquote><p>You should only ever add one @SpringBootApplication or @EnableAutoConfiguration annotation. We generally recommend that you add one or the other to your primary @Configuration class only.
https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-auto-configuration</p></blockquote> <p>开始讲解原理，先看EnableAutoConfiguration：</p> <div class="language- extra-class"><pre class="language-text"><code>@Target(value=TYPE)
 @Retention(value=RUNTIME)
 @Documented
 @Inherited
 @AutoConfigurationPackage
 @Import(value=AutoConfigurationImportSelector.class)
public @interface EnableAutoConfiguration
</code></pre></div><p>重点是@Import(EnableAutoConfigurationImportSelector.class)，这里它将把 EnableAutoConfigurationImportSelector作为bean注入到容器中，</p> <div class="language- extra-class"><pre class="language-text"><code>@Override
	public String[] selectImports(AnnotationMetadata metadata) {
		try {
			AnnotationAttributes attributes = getAttributes(metadata);
			List&lt;String&gt; configurations = getCandidateConfigurations(metadata,
					attributes);
			configurations = removeDuplicates(configurations);
			Set&lt;String&gt; exclusions = getExclusions(metadata, attributes);
			configurations.removeAll(exclusions);
			configurations = sort(configurations);
			recordWithConditionEvaluationReport(configurations, exclusions);
			return configurations.toArray(new String[configurations.size()]);
		}
		catch (IOException ex) {
			throw new IllegalStateException(ex);
		}
	}
</code></pre></div><p>EnableAutoConfigurationImportSelector.selectImports()是何时执行的？其实这个方法会在容器启动过程中执行： AbstractApplicationContext.refresh(),
这个EnableAutoConfigurationImportSelector类会扫描所有的jar包，将所有符合条件的@Configuration配置类注入的容器中，何为符合条件，看看 META-INF/spring.factories的文件内容：</p> <div class="language- extra-class"><pre class="language-text"><code>https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/resources/META-INF/spring.factories
.....
org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\
.....
</code></pre></div><p>然后举例看 DataSourceAutoConfiguration：</p> <div class="language- extra-class"><pre class="language-text"><code>https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/DataSourceAutoConfiguration.java
@Configuration(proxyBeanMethods = false)
@ConditionalOnClass({ DataSource.class, EmbeddedDatabaseType.class })
@ConditionalOnMissingBean(type = &quot;io.r2dbc.spi.ConnectionFactory&quot;)
@EnableConfigurationProperties(DataSourceProperties.class)
@Import({ DataSourcePoolMetadataProvidersConfiguration.class, DataSourceInitializationConfiguration.class })
public class DataSourceAutoConfiguration {
</code></pre></div><p>@ConditionalOnClass({DataSource.class,EmbeddedDatabaseType.class})：当Classpath中存在DataSource或者EmbeddedDatabaseType类时才启用这个配置，否则这个配置将被忽略。
注意上面的DataSourceProperties，
@EnableConfigurationProperties(DataSourceProperties.class)：将DataSource的默认配置类注入到IOC容器中，DataSourceproperties定义为：</p> <div class="language- extra-class"><pre class="language-text"><code>@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)
public class DataSourceProperties implements BeanClassLoaderAware, InitializingBean {
	private ClassLoader classLoader;
	/**
	 * Name of the datasource. Default to &quot;testdb&quot; when using an embedded database.
	 */
	private String name;
	/**
	 * Whether to generate a random datasource name.
	 */
	private boolean generateUniqueName = true;
	/**
	 * Fully qualified name of the connection pool implementation to use. By default, it
	 * is auto-detected from the classpath.
	 */
	private Class&lt;? extends DataSource&gt; type;

	/**
	 * Fully qualified name of the JDBC driver. Auto-detected based on the URL by default.
	 */
	private String driverClassName;

	/**
	 * JDBC URL of the database.
	 */
	private String url;

	/**
	 * Login username of the database.
	 */
	private String username;

	/**
	 * Login password of the database.
	 */
	private String password;
	
</code></pre></div><p>很清晰对应配置spring.datasource，然后是连接池配置：</p> <p>@Import({ Registrar.class, DataSourcePoolMetadataProvidersConfiguration.class })：导入其他额外的配置，就以DataSourcePoolMetadataProvidersConfiguration为例吧,
DataSourcePoolMetadataProvidersConfiguration是数据库连接池提供者的一个配置类，即Classpath中存在 org.apache.tomcat.jdbc.pool.DataSource.class，则使用tomcat-jdbc连接池，如果Classpath中存在 HikariDataSource.class则使用Hikari连接池。</p> <h3 id="environment-vs-applicationcontext"><a href="#environment-vs-applicationcontext" class="header-anchor">#</a> Environment vs ApplicationContext</h3> <p>Environment是ApplicationContext的一部分</p> <p>Environment（环境）:</p> <ul><li>配置数据管理</li> <li>属性、Profile、配置源</li> <li>房子的水电配置系统</li> <li>配置信息存取</li></ul> <p>ApplicationContext（应用上下文）:</p> <ul><li>完整的容器生态系统</li> <li>Bean工厂、事件发布、资源加载等</li> <li>整个房子+家具+设施</li> <li>完整的应用生命周期管理</li></ul> <p>ApplicationContext（应用上下文）
├── Environment（环境配置）
│   ├── PropertySources（属性源）
│   ├── Profiles（环境配置）
│   └── 配置数据存取API
│
├── BeanFactory（Bean管理）
├── MessageSource（国际化）
├── ApplicationEventPublisher（事件发布）
├── ResourceLoader（资源加载）
└── 其他容器服务</p> <h2 id="_2-springapplication启动流程"><a href="#_2-springapplication启动流程" class="header-anchor">#</a> 2. SpringApplication启动流程</h2> <p><a href="/docs/software/programming/java_springboot_sourcecode.html">Springboot Source Code</a></p> <p>Spring Boot应用启动流程：</p> <div class="language- extra-class"><pre class="language-text"><code>┌─────────────────────────────────────────────────┐
│               1. JVM启动阶段                    │
├─────────────────────────────────────────────────┤
│ 加载JVM → 类加载器初始化 → 字节码验证            │
└───────────────────────┬─────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────┐
│          2. SpringApplication.run()             │
├─────────────────────────────────────────────────┤
│ 设置无头模式 → 启动监听器 → 发布启动事件          │
└───────────────────────┬─────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────┐
│          3. 环境准备阶段                        │
├─────────────────────────────────────────────────┤
│ 创建应用参数 → 准备环境 → 加载配置 → 打印Banner  │
└───────────────────────┬─────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────┐
│          4. 应用上下文创建                      │
├─────────────────────────────────────────────────┤
│ 创建空容器实例 → 初始化异常报告器                 │
└───────────────────────┬─────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────┐
│          5. 上下文预处理                        │
├─────────────────────────────────────────────────┤
│ 设置环境 → 执行ApplicationContextInitializer     │
│ → 加载Bean定义源                                │
└───────────────────────┬─────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────┐
│          6. ApplicationContext.refresh()        │
├─────────────────────────────────────────────────┤
│ 这是Spring容器的核心启动方法，包含所有子阶段       │
└───────────────────────┬─────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────┐
│          7. 嵌套子阶段（按顺序执行）             │
├─────────────────────────────────────────────────┤
│ 7.1 prepareRefresh()                            │
│ 7.2 obtainFreshBeanFactory()                    │
│ 7.3 prepareBeanFactory()                        │
│ 7.4 postProcessBeanFactory()                    │
│ 7.5 invokeBeanFactoryPostProcessors() ← 重要！  │
│     ├── 扫描@Component注解类                    │
│     ├── 创建BeanDefinition                     │
│     ├── 注册到BeanFactory                      │
│     └── 处理@AutoConfiguration                 │
│ 7.6 registerBeanPostProcessors()                │
│ 7.7 initMessageSource()                         │
│ 7.8 initApplicationEventMulticaster()           │
│ 7.9 onRefresh() ← 启动内嵌服务器！              │
│ 7.10 registerListeners()                        │
│ 7.11 finishBeanFactoryInitialization() ← 重要！ │
│     ├── 实例化所有非懒加载单例Bean               │
│     ├── 注入依赖                               │
│     └── 调用生命周期回调                        │
│ 7.12 finishRefresh()                            │
└───────────────────────┬─────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────┐
│          8. 启动收尾阶段                        │
├─────────────────────────────────────────────────┤
│ 后处理 → 发布启动事件 → 执行Runner → 发布就绪事件│
└─────────────────────────────────────────────────┘
</code></pre></div><h3 id="jvm启动和类加载"><a href="#jvm启动和类加载" class="header-anchor">#</a> JVM启动和类加载</h3> <div class="language- extra-class"><pre class="language-text"><code>// 阶段1：JVM层面的准备工作
public class JVMStartupPhase {
    public void execute() {
        // 1. 加载JVM核心库
        loadJVMCoreLibraries();          // rt.jar, charsets.jar等
        
        // 2. 初始化类加载器层次结构
        initializeClassLoaders();        // Bootstrap → Extension → Application
        
        // 3. 加载SpringApplication主类
        Class&lt;?&gt; mainClass = Class.forName(&quot;com.example.MyApplication&quot;);
        
        // 4. 验证字节码安全性
        verifyBytecode(mainClass);       // 检查魔数、版本、指令合法性
        
        // 5. 准备静态变量和常量池
        prepareStaticFields();          // 初始化静态常量
        
        // 6. 调用main方法入口
        Method mainMethod = mainClass.getMethod(&quot;main&quot;, String[].class);
        mainMethod.invoke(null, (Object) args);
    }
}

// SpringBootApplication.java
@SpringBootApplication
public class MyApplication {
    public static void main(String[] args) {
        // 阶段1: JVM启动
        SpringApplication.run(MyApplication.class, args);
    }
}

1. 加载SpringApplication类到方法区
2. 加载@SpringBootApplication注解元数据
3. 验证字节码，准备静态变量
4. 初始化Spring核心类（BeanFactory、ApplicationContext等）
</code></pre></div><h3 id="初始化springapplication对象"><a href="#初始化springapplication对象" class="header-anchor">#</a> 初始化SpringApplication对象</h3> <p>SpringBoot整个启动流程分为两个步骤：初始化一个SpringApplication对象、执行该对象的run方法。看下SpringApplication的初始化流程，SpringApplication的构造方法：</p> <div class="language- extra-class"><pre class="language-text"><code>public SpringApplication(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources) {
	this.resourceLoader = resourceLoader;
	Assert.notNull(primarySources, &quot;PrimarySources must not be null&quot;);
	this.primarySources = new LinkedHashSet&lt;&gt;(Arrays.asList(primarySources));
	this.webApplicationType = WebApplicationType.deduceFromClasspath();
	setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));
	setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));
	this.mainApplicationClass = deduceMainApplicationClass();
}
</code></pre></div><p>初始化流程中最重要的就是通过 SpringFactoriesLoader 找到 spring.factories 文件中配置的 ApplicationContextInitializer 和 ApplicationListener 两个接口的实现类名称，以便后期构造相应的实例。 ApplicationContextInitializer 的主要目的是在 ConfigurableApplicationContext 做 refresh之前，对ConfigurableApplicationContext实例做进一步的设置或处理。ConfigurableApplicationContext继承自 ApplicationContext ，其主要提供了对 ApplicationContext 进行设置的能力。</p> <p>Spring Boot提供两种方式来添加<strong>自定义监听器</strong>：</p> <p>通过 SpringApplication.addListeners()或者 SpringApplication.setListeners()两个方法来添加一个或者多个自定义监听器</p> <p>既然SpringApplication的初始化流程中已经从 spring.factories中获取到 ApplicationListener的实现类，那么我们直接在自己的jar包的 META-INF/spring.factories文件中新增配置即可：</p> <h3 id="执行该对象的run方法"><a href="#执行该对象的run方法" class="header-anchor">#</a> 执行该对象的run方法</h3> <p>Spring Boot应用的整个启动流程都封装在 SpringApplication.run 方法中，其整个流程真的是太长太长了，但本质上就是在Spring容器启动的基础上做了大量的扩展，按照这个思路来看看源码</p> <p>Spring Boot启动调用栈（层次化视图）：</p> <div class="language- extra-class"><pre class="language-text"><code>┌─────────────────────────────────────────────────┐
│           SpringApplication.run()               │
├─────────────────────────────────────────────────┤
│ 1. 启动准备                                      │
│    ├── configureHeadlessProperty()              │
│    ├── getRunListeners()                        │
│    └── listeners.starting() ← 发布启动事件       │
│                                                │
│ 2. 环境准备                                      │
│    ├── new DefaultApplicationArguments(args)    │
│    ├── prepareEnvironment() ← 核心！            │
│    │   └── 加载所有配置源                        │
│    │       ├── application.properties          │
│    │       ├── application.yml                 │
│    │       ├── 环境变量                         │
│    │       └── 命令行参数                       │
│    ├── configureIgnoreBeanInfo()               │
│    └── printBanner()                           │
│                                                │
│ 3. 应用上下文创建                                │
│    └── createApplicationContext()               │
│        ├── Web应用: AnnotationConfigServletWebServerApplicationContext│
│        └── 普通应用: AnnotationConfigApplicationContext│
│                                                │
│ 4. 异常报告器初始化                              │
│    └── getSpringFactoriesInstances()            │
│                                                │
│ 5. 上下文预处理                                  │
│    └── prepareContext()                         │
│        ├── 设置环境environment                 │
│        ├── 执行ApplicationContextInitializer    │
│        ├── 发布ApplicationPreparedEvent        │
│        └── 加载Bean定义源                      │
│                                                │
│ 6. 容器刷新 ← 真正核心！                        │
│    └── refreshContext() → context.refresh()     │
│        ├── 6.1 prepareRefresh()                │
│        ├── 6.2 obtainFreshBeanFactory()        │
│        ├── 6.3 prepareBeanFactory()            │
│        ├── 6.4 postProcessBeanFactory()        │
│        ├── 6.5 invokeBeanFactoryPostProcessors() ← 重要！│
│        │   ├── 处理@Configuration类            │
│        │   ├── 扫描@Component注解类            │
│        │   ├── 解析@PropertySource            │
│        │   └── 加载@AutoConfiguration         │
│        ├── 6.6 registerBeanPostProcessors()     │
│        ├── 6.7 initMessageSource()             │
│        ├── 6.8 initApplicationEventMulticaster()│
│        ├── 6.9 onRefresh() ← 重要！            │
│        │   └── 创建并启动内嵌服务器             │
│        ├── 6.10 registerListeners()            │
│        ├── 6.11 finishBeanFactoryInitialization() ← 重要！│
│        │   └── 实例化所有非懒加载单例Bean        │
│        │       ├── 创建Bean实例               │
│        │       ├── 依赖注入                   │
│        │       └── 初始化回调                 │
│        └── 6.12 finishRefresh()                │
│                                                │
│ 7. 启动收尾                                      │
│    ├── afterRefresh()                          │
│    ├── listeners.started() ← 发布启动完成事件    │
│    ├── callRunners() ← 执行ApplicationRunner   │
│    └── listeners.running() ← 发布应用就绪事件    │
└─────────────────────────────────────────────────┘
</code></pre></div><p>核心代码</p> <div class="language- extra-class"><pre class="language-text"><code>/**
	 * Run the Spring application, creating and refreshing a new
	 * {@link ApplicationContext}.
	 * @param args the application arguments (usually passed from a Java main method)
	 * @return a running {@link ApplicationContext}
	 */
	public ConfigurableApplicationContext run(String... args) {
		// ============ 阶段0: 启动准备 ============
		StopWatch stopWatch = new StopWatch();
		stopWatch.start();
		ConfigurableApplicationContext context = null;
		Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = new ArrayList&lt;&gt;();
		// 1. 设置无头模式（确保在服务器环境运行）
		configureHeadlessProperty();
		// 2. 获取并启动所有SpringApplicationRunListener
		SpringApplicationRunListeners listeners = getRunListeners(args);
		listeners.starting(); // 发布ApplicationStartingEvent
		try {
			// ============ 阶段1: 环境准备 ============
			// 3. 创建应用参数封装
			ApplicationArguments applicationArguments = new DefaultApplicationArguments(args);
			// 4. 准备环境（⚠️ 这是真正的第一步核心操作！）
			ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments);
			// ✅ 这里加载所有配置：application.properties → application.yml → 环境变量 → 命令行参数
        
			// 5. 配置忽略的Bean信息（AOP相关）
			configureIgnoreBeanInfo(environment);
			// 6. 打印Banner（应用启动logo）
			Banner printedBanner = printBanner(environment);
			
			// ============ 阶段2: 上下文创建 ============
			// 7. 创建应用上下文（根据应用类型）
			context = createApplicationContext(); 
			// Web应用: AnnotationConfigServletWebServerApplicationContext
			// 普通应用: AnnotationConfigApplicationContext
			
			// 8. 初始化异常报告器
			exceptionReporters = getSpringFactoriesInstances(SpringBootExceptionReporter.class,
					new Class[] { ConfigurableApplicationContext.class }, context);
			
			// ============ 阶段3: 上下文预处理 ============
			// 9. 准备上下文（⚠️ 关键预处理）
			prepareContext(context, environment, listeners, applicationArguments, printedBanner);
			// ✅ 这里包含：设置环境、执行ApplicationContextInitializer、加载Bean定义等
			
			// ============ 阶段4: 容器刷新 ============
			// 10. 刷新上下文（⚠️ 最核心的阶段！）
			refreshContext(context);
			// ✅ 这里执行完整的ApplicationContext.refresh()，包含：
			//    - BeanFactory准备
			//    - 执行BeanFactoryPostProcessor（包括组件扫描）
			//    - 注册BeanPostProcessor
			//    - 初始化MessageSource
			//    - 初始化事件广播器
			//    - onRefresh() → 创建内嵌Web服务器
			//    - 注册监听器
			//    - 实例化所有非懒加载单例Bean
			//    - 完成刷新
			
			// 11. 后刷新处理（空方法，可扩展）
			afterRefresh(context, applicationArguments);
			
			// ============ 阶段5: 启动完成 ============
			stopWatch.stop();
			if (this.logStartupInfo) {
				new StartupInfoLogger(this.mainApplicationClass).logStarted(getApplicationLog(), stopWatch);
			}
			
			// 12. 发布应用启动完成事件
			listeners.started(context); // 发布ApplicationStartedEvent
			
			// 13. 执行所有Runner（ApplicationRunner/CommandLineRunner）
			callRunners(context, applicationArguments);
		}
		catch (Throwable ex) {
			handleRunFailure(context, ex, exceptionReporters, listeners);
			throw new IllegalStateException(ex);
		}

		try {
			// 14. 发布应用就绪事件
			listeners.running(context);
		}
		catch (Throwable ex) {
			handleRunFailure(context, ex, exceptionReporters, null);
			throw new IllegalStateException(ex);
		}
		return context;
	}
</code></pre></div><h4 id="获取并启动所有springapplicationrunlistener"><a href="#获取并启动所有springapplicationrunlistener" class="header-anchor">#</a> 获取并启动所有SpringApplicationRunListener</h4> <p>通过 SpringFactoriesLoader 查找并加载所有的 SpringApplicationRunListeners，通过调用starting()方法通知所有的SpringApplicationRunListener：应用开始启动了。SpringApplicationRunListener 其本质上就是一个事件发布者，它在SpringBoot应用启动的不同时间点发布不同应用事件类型(ApplicationEvent)，如果有哪些事件监听者(ApplicationListener)对这些事件感兴趣，则可以接收并且处理。前面的初始化流程中，SpringApplication 加载了一系列 ApplicationListener。发布事件的代码已经在SpringApplicationRunListeners中实现了。
SpringApplicationRunListener只有一个实现类： EventPublishingRunListener。此处的代码只会返回一个 SpringApplicationRunListeners ，注意后面多了一个s字母，看下源码就会发现该类就是包含了一个SpringApplicationRunListener的List。操作SpringApplicationRunListeners ，在内部会遍历每一个SpringApplicationRunListener，调用每一个SpringApplicationRunListener的实现类的starting方法</p> <h4 id="准备环境"><a href="#准备环境" class="header-anchor">#</a> 准备环境</h4> <p>创建并配置当前应用将要使用的 Environment，Environment用于描述应用程序当前的运行环境，其抽象了两个方面的内容：配置文件(profile)和属性(properties)，开发经验丰富的同学对这两个东西一定不会陌生：不同的环境(eg：生产环境、预发布环境)可以使用不同的配置文件，而属性则可以从配置文件、环境变量、命令行参数等来源获取。因此，当Environment准备好后，在整个应用的任何时候，都可以从Environment中获取资源。</p> <div class="language- extra-class"><pre><code>总结起来，主要完成以下几件事：

- 判断Environment是否存在，不存在就创建（如果是web项目就创建 StandardServletEnvironment，否则创建 StandardEnvironment）

- 配置Environment：配置profile以及properties

- 调用SpringApplicationRunListener的 environmentPrepared()方法，通知事件监听者：应用的Environment已经准备好
</code></pre></div><h4 id="打印banner图案"><a href="#打印banner图案" class="header-anchor">#</a> 打印Banner图案</h4> <h4 id="创建应用上下文"><a href="#创建应用上下文" class="header-anchor">#</a> 创建应用上下文</h4> <p>根据不同的ApplicationType创建不同的Context，具体的类型回顾初始化中App类型的介绍</p> <h4 id="准备上下文"><a href="#准备上下文" class="header-anchor">#</a> 准备上下文</h4> <p>初始化ApplicationContext，主要完成以下工作：</p> <div class="language- extra-class"><pre><code>- 将准备好的Environment设置给ApplicationContext

- 遍历调用所有的ApplicationContextInitializer的 initialize()方法来对已经创建好的ApplicationContext进行进一步的处理

- 调用SpringApplicationRunListener的 contextPrepared()方法，通知所有的监听者：ApplicationContext已经准备完毕

- 将所有的bean加载到容器中

- 调用SpringApplicationRunListener的 contextLoaded()方法，通知所有的监听者：ApplicationContext已经装载完毕
</code></pre></div><h4 id="容器刷新"><a href="#容器刷新" class="header-anchor">#</a> 容器刷新</h4> <p>refresh完成配置类的解析、各种BeanFactoryPostProcessor和BeanPostProcessor的注册、国际化配置的初始化、web内置容器的构造等等。</p> <p>以上就是Spring Boot的整个启动流程，其核心就是在Spring容器初始化并启动的基础上加入各种扩展点，这些扩展点包括：</p> <ul><li>ApplicationContextInitializer</li> <li>ApplicationListener</li> <li>自动配置自定义
org.springframework.boot.env.EnvironmentPostProcessor:
Allows for customization of the application's {@link Environment} prior to the application context being refreshed.</li> <li>各种BeanFactoryPostProcessor等等
org.springframework.beans.factory.config.BeanFactoryPostProcessor：
允许我们在容器实例化相应对象之前，对注册到容器的BeanDefinition所保存的信息做一些额外的操作，比如修改bean定义的某些属性或者增加其他信息等。</li></ul> <h3 id="实例分析启动流程"><a href="#实例分析启动流程" class="header-anchor">#</a> 实例分析启动流程</h3> <div class="language- extra-class"><pre class="language-text"><code>// 1. 主启动类
@SpringBootApplication
public class SimpleApplication {
    public static void main(String[] args) {
        SpringApplication.run(SimpleApplication.class, args);
    }
}

// 2. 一个简单的RestController
@RestController
public class HelloController {
    @GetMapping(&quot;/hello&quot;)
    public String hello() {
        return &quot;Hello World!&quot;;
    }
}

// 3. 配置文件application.properties
server.port=8080
spring.application.name=simple-demo
</code></pre></div><h4 id="阶段1-jvm启动-底层准备"><a href="#阶段1-jvm启动-底层准备" class="header-anchor">#</a> 阶段1: JVM启动（底层准备）</h4> <p><code>java -jar simple-app.jar</code></p> <p>加载JVM核心库</p> <p>初始化类加载器层次结构</p> <p>加载SimpleApplication.class到内存</p> <p>验证字节码安全性</p> <p>调用main方法入口</p> <h4 id="阶段2-springapplication-run-初始化"><a href="#阶段2-springapplication-run-初始化" class="header-anchor">#</a> 阶段2: SpringApplication.run() 初始化</h4> <p><code>SpringApplication.run(SimpleApplication.class, args);</code></p> <div class="language- extra-class"><pre class="language-text"><code>// 内部创建SpringApplication实例
SpringApplication app = new SpringApplication(SimpleApplication.class);
app.run(args);

// 2.1 配置无头模式（确保在服务器环境运行）
configureHeadlessProperty(); // java.awt.headless=true

// 2.2 获取并启动监听器
SpringApplicationRunListeners listeners = getRunListeners(args);
listeners.starting(); // 发布ApplicationStartingEvent

// 2.3 创建应用参数封装
ApplicationArguments appArgs = new DefaultApplicationArguments(args);
// 解析命令行参数：--server.port=9090 等
</code></pre></div><h5 id="发布启动事件-⭐扩展点1-启动事件监听"><a href="#发布启动事件-⭐扩展点1-启动事件监听" class="header-anchor">#</a> 发布启动事件 ⭐扩展点1: 启动事件监听</h5> <p><code>listeners.starting(); // 发布ApplicationStartingEvent</code></p> <p>开发者扩展方式：</p> <div class="language- extra-class"><pre class="language-text"><code>// 方式1: 实现ApplicationListener
@Component
public class MyStartingListener implements ApplicationListener&lt;ApplicationStartingEvent&gt; {
    @Override
    public void onApplicationEvent(ApplicationStartingEvent event) {
        System.out.println(&quot;应用开始启动...&quot;);
        // 场景：记录启动日志、初始化监控指标
    }
}

// 方式2: 使用@EventListener注解
@Component
public class EventListenerService {
    @EventListener
    public void handleStartingEvent(ApplicationStartingEvent event) {
        // 场景：验证环境配置、检查依赖服务
        checkRequiredProperties();
    }
    
    private void checkRequiredProperties() {
        // 检查必需配置是否存在
        if (System.getProperty(&quot;required.config&quot;) == null) {
            throw new IllegalStateException(&quot;缺少必需配置&quot;);
        }
    }
}
</code></pre></div><p>常见场景：</p> <p>启动日志记录：记录应用启动时间和参数</p> <p>环境验证：检查必需的环境变量和配置</p> <p>资源预加载：提前加载常用资源</p> <p>监控指标初始化：设置应用监控</p> <p><strong>完整事件顺序：</strong></p> <p>ApplicationStartingEvent- 最早，环境还未准备</p> <p>ApplicationEnvironmentPreparedEvent- 环境已准备，上下文未创建</p> <p>ApplicationContextInitializedEvent- 上下文已创建，Initializer已执行</p> <p>ApplicationPreparedEvent- 上下文已准备，refresh()未调用</p> <p>ApplicationStartedEvent- refresh()已完成，Runner未执行</p> <p>ApplicationReadyEvent- 完全就绪，Runner已执行</p> <h4 id="阶段3-环境准备-加载配置"><a href="#阶段3-环境准备-加载配置" class="header-anchor">#</a> 阶段3: 环境准备（加载配置）</h4> <div class="language- extra-class"><pre class="language-text"><code>// 3.1 加载所有配置源（按优先级）
ConfigurableEnvironment environment = prepareEnvironment(listeners, appArgs);
// 1.  application.properties → server.port=8080
// 2.  application.yml (不存在)
// 3.  环境变量 (SPRING_APPLICATION_JSON等)  
// 4.  命令行参数 (--server.port=9090)
// 5.  默认属性

</code></pre></div><p>=&gt;</p> <div class="language- extra-class"><pre class="language-text"><code>// SpringApplication.java
private ConfigurableEnvironment prepareEnvironment(...) {
    // 1. 创建环境对象（根据应用类型）
    ConfigurableEnvironment environment = createEnvironment(); 
    // Web应用: StandardServletEnvironment
    // 普通应用: StandardEnvironment
    
    // 2. 配置PropertySource（配置源加载在这里发生！）
    configurePropertySources(environment, args);
    
    // 3. 配置Profile
    configureProfiles(environment, args);
    
    return environment;
}

// configurePropertySources内部的加载顺序：
public void configurePropertySources(ConfigurableEnvironment environment, String[] args) {
    // 配置源优先级（从高到低）：
    // 1. 命令行参数 (--server.port=8080)
    environment.getPropertySources().addFirst(new SimpleCommandLinePropertySource(args));
    
    // 2. ServletConfig参数 (Web应用)
    // 3. ServletContext参数 (Web应用) 
    // 4. JNDI属性
    // 5. 系统环境变量
    // 6. 系统属性
    // 7. 随机值属性
    // 8. 应用配置文件 ← 主要配置来源！
    //    - application.properties
    //    - application.yml  
    //    - application-{profile}.properties
    // 9. 默认属性
}
</code></pre></div><h5 id="加载配置源-⭐扩展点2-自定义propertysource"><a href="#加载配置源-⭐扩展点2-自定义propertysource" class="header-anchor">#</a> 加载配置源 ⭐扩展点2: 自定义PropertySource</h5> <p>开发者扩展方式：</p> <div class="language- extra-class"><pre class="language-text"><code>
@Component
public class CustomPropertySourceConfig {
    @PostConstruct
    public void addCustomPropertySource() {
        // 添加自定义配置源
        MapPropertySource customSource = new MapPropertySource(&quot;custom&quot;, 
            Collections.singletonMap(&quot;custom.property&quot;, &quot;value&quot;));
        environment.getPropertySources().addFirst(customSource);
    }
}

// 或者实现EnvironmentPostProcessor
public class CustomEnvironmentPostProcessor implements EnvironmentPostProcessor {
    @Override
    public void postProcessEnvironment(ConfigurableEnvironment env, 
                                     SpringApplication application) {
        // 修改或添加配置源
        env.getPropertySources().addFirst(...);

        // 开发者在这里操作PropertySources
        MutablePropertySources propertySources = environment.getPropertySources();
        // 添加自定义配置源或修改现有配置
        Map&lt;String, Object&gt; customProperties = new HashMap&lt;&gt;();
        customProperties.put(&quot;custom.property&quot;, &quot;value&quot;);
        propertySources.addFirst(new MapPropertySource(&quot;custom&quot;, customProperties));
    }
}
</code></pre></div><p>常见场景：</p> <p>数据库配置加密：解密加密的数据库密码</p> <p>外部配置集成：从外部配置中心加载配置</p> <p>环境特定配置：根据运行环境动态调整配置</p> <h5 id="printbanner"><a href="#printbanner" class="header-anchor">#</a> printBanner</h5> <div class="language- extra-class"><pre class="language-text"><code>// 3.2 配置忽略的Bean信息（AOP相关）
configureIgnoreBeanInfo(environment);

// 3.3 打印Banner
// 控制台输出Spring logo和版本信息
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
</code></pre></div><p>=&gt;</p> <div class="language- extra-class"><pre class="language-text"><code>// configureIgnoreBeanInfo的实际作用：
protected void configureIgnoreBeanInfo(ConfigurableEnvironment environment) {
    // 设置系统属性，告诉Spring跳过某些Bean的元数据解析
    // 这可以显著提高启动性能，特别是当有大量Bean时
    
    String ignore = environment.getProperty(&quot;spring.aop.ignore&quot;, &quot;true&quot;);
    if (&quot;true&quot;.equals(ignore)) {
        // 设置系统属性，优化AOP处理
        System.setProperty(&quot;spring.aop.auto&quot;, &quot;false&quot;);
        
        // 对于某些已知的基础设施Bean，跳过AOP代理创建
        // 比如：BeanFactoryPostProcessor, BeanPostProcessor等
        // 这些Bean不需要AOP代理，跳过检查可以提高性能
    }
}
</code></pre></div><p>开发者扩展方式：</p> <div class="language- extra-class"><pre class="language-text"><code>// 自定义Banner
public class CustomBanner implements Banner {
    @Override
    public void printBanner(Environment environment, 
                           Class&lt;?&gt; sourceClass, PrintStream out) {
        out.println(&quot;=== 我的应用 ===&quot;);
        out.println(&quot;版本: &quot; + environment.getProperty(&quot;app.version&quot;));
    }
}

// 在application.properties中指定
spring.banner.location=classpath:my-banner.txt
</code></pre></div><h4 id="阶段4-应用上下文创建"><a href="#阶段4-应用上下文创建" class="header-anchor">#</a> 阶段4: 应用上下文创建</h4> <div class="language- extra-class"><pre class="language-text"><code>context = createApplicationContext();
// 对于AnnotationConfigApplicationContext：
// 在构造器中就创建了DefaultListableBeanFactory
// 但此时是空的，只有基础设施
</code></pre></div><p>=&gt;</p> <div class="language- extra-class"><pre class="language-text"><code>// 检测到有spring-web依赖，创建Web容器
return new AnnotationConfigServletWebServerApplicationContext();

// 此时还是空容器，没有任何Bean
</code></pre></div><h4 id="阶段5-上下文预处理"><a href="#阶段5-上下文预处理" class="header-anchor">#</a> 阶段5: 上下文预处理</h4> <p><code>prepareContext(context, environment, listeners, appArgs, printedBanner);</code>
=&gt;</p> <div class="language- extra-class"><pre class="language-text"><code>// 5.1 设置环境到上下文
context.setEnvironment(environment);

// 5.2 执行ApplicationContextInitializer（如果有）
applyInitializers(context);

// 发布ApplicationContextInitializedEvent
listeners.contextInitialized(context);

// 注册特定的单例Bean
ConfigurableListableBeanFactory beanFactory = context.getBeanFactory();
// 这里注册的是已经实例化的对象，不是BeanDefinition
beanFactory.registerSingleton(&quot;springApplicationArguments&quot;, applicationArguments);
if (printedBanner != null) {
    beanFactory.registerSingleton(&quot;springBootBanner&quot;, printedBanner);
}

if (beanFactory instanceof DefaultListableBeanFactory) {
    ((DefaultListableBeanFactory) beanFactory)
        .setAllowBeanDefinitionOverriding(this.allowBeanDefinitionOverriding);
}

// 设置懒初始化（Spring Boot 2.2+）
if (this.lazyInitialization) {
    context.addBeanFactoryPostProcessor(new LazyInitializationBeanFactoryPostProcessor());
}

// 加载源（不是register(SimpleApplication.class)）
// 将SimpleApplication.class转换为BeanDefinition存入BeanFactory
// 但此时只是蓝图，还没有实例化
Set&lt;Object&gt; sources = getAllSources(); // 获取所有配置源，包括主类SimpleApplication
// load方法会处理配置类
load(context, sources.toArray(new Object[0]));
// BeanDefinitionLoader.load() 方法会：
// 1. 如果source是Class且有@Configuration注解，注册为配置类
// 2. 处理@ComponentScan，扫描指定包下的@Component类
// 3. 处理@Import、@ImportResource等注解
// 4. 为SimpleApplication创建BeanDefinition并注册到BeanFactory

// 简单说：load()将SimpleApplication.class转换为BeanDefinition并注册
// SimpleApplication.class → 作为配置类注册 → 解析注解 → 扫描包 → 注册其他Bean
// 所以不是注册SimpleApplication本身，而是：
// 注册SimpleApplication为配置类（BeanDefinition）
// 解析其上的注解（@ComponentScan, @EnableAutoConfiguration）
// 执行组件扫描找到其他Bean
// 处理自动配置加载spring.factories中的配置

// 5.4 发布ApplicationPreparedEvent
listeners.contextPrepared(context);
</code></pre></div><h5 id="执行applicationcontextinitializer-⭐扩展点3-上下文初始化器"><a href="#执行applicationcontextinitializer-⭐扩展点3-上下文初始化器" class="header-anchor">#</a> 执行ApplicationContextInitializer ⭐扩展点3: 上下文初始化器</h5> <p><code>applyInitializers(context);</code>
=&gt;</p> <div class="language- extra-class"><pre class="language-text"><code>// 执行所有ApplicationContextInitializer
for (ApplicationContextInitializer initializer : initializers) {
    initializer.initialize(context);
}
</code></pre></div><p>开发者扩展方式：</p> <div class="language- extra-class"><pre class="language-text"><code>// 方式1: 实现ApplicationContextInitializer
public class MyContextInitializer implements ApplicationContextInitializer&lt;ConfigurableApplicationContext&gt; {
    @Override
    public void initialize(ConfigurableApplicationContext context) {
        // 场景1: 早期Bean注册,实际用例：需要在其他组件的配置阶段就提供服务的基础设施Bean。
        context.getBeanFactory().registerSingleton(&quot;earlyService&quot;, new EarlyService());
        // 这个Bean现在可以在任何BeanFactoryPostProcessor中使用
        // 比如在自定义的BeanFactoryPostProcessor中：
        // ConfigService config = beanFactory.getBean(&quot;configService&quot;);

        // 场景2: 环境验证
        Environment env = context.getEnvironment();
        if (!env.containsProperty(&quot;db.url&quot;)) {
            throw new IllegalStateException(&quot;数据库配置缺失&quot;);
        }
        
        // 场景3: 动态配置
        if (env.acceptsProfiles(&quot;cloud&quot;)) {
            System.setProperty(&quot;server.port&quot;, &quot;8081&quot;);
        }
    }
}

// 注册方式1: spring.factories
// META-INF/spring.factories:
org.springframework.context.ApplicationContextInitializer=com.example.MyContextInitializer

// 注册方式2: 启动类设置
new SpringApplicationBuilder(MyApp.class)
    .initializers(new MyContextInitializer())
    .run(args);
</code></pre></div><p>常见场景：</p> <p>早期Bean注册：在容器刷新前注册单例Bean</p> <p>环境验证：检查必需配置是否就绪</p> <p>动态配置：根据环境动态修改配置</p> <p>自定义BeanFactory设置：修改BeanFactory配置</p> <h5 id="beanfactory-registersingleton"><a href="#beanfactory-registersingleton" class="header-anchor">#</a> beanFactory.registerSingleton</h5> <p>注意: beanFactory.registerSingleton(&quot;springApplicationArguments&quot;, applicationArguments);</p> <div class="language- extra-class"><pre class="language-text"><code># 启动Spring Boot应用时传入命令行参数
java -jar myapp.jar --debug --server.port=9090 --spring.profiles.active=dev inputfile.txt

在Spring Boot中，这些参数被封装为：
ApplicationArguments applicationArguments = new DefaultApplicationArguments(args);

选项参数（Option Arguments）：以--开头

--debug→ 选项名：&quot;debug&quot;，值：空列表

--server.port=9090→ 选项名：&quot;server.port&quot;，值：[&quot;9090&quot;]

--spring.profiles.active=dev→ 选项名：&quot;spring.profiles.active&quot;，值：[&quot;dev&quot;]

非选项参数（Non-option Arguments）：不以--开头

inputfile.txt→ 非选项参数


// 方式1：注入使用
@Component
public class MyComponent {
    @Autowired
    private ApplicationArguments args;
    
    public void checkArgs() {
        // 检查是否有debug选项
        if (args.containsOption(&quot;debug&quot;)) {
            System.out.println(&quot;Debug模式已启用&quot;);
        }
        
        // 获取server.port的值
        List&lt;String&gt; portValues = args.getOptionValues(&quot;server.port&quot;);
        if (!portValues.isEmpty()) {
            String port = portValues.get(0);
            System.out.println(&quot;端口号: &quot; + port);
        }
        
        // 获取非选项参数
        List&lt;String&gt; nonOptionArgs = args.getNonOptionArgs();
        System.out.println(&quot;非选项参数: &quot; + nonOptionArgs);
    }
}

// 方式2：在BeanFactoryPostProcessor中使用
@Component
public class MyBeanFactoryPostProcessor implements BeanFactoryPostProcessor {
    @Override
    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) {
        ApplicationArguments args = beanFactory.getBean(&quot;springApplicationArguments&quot;, ApplicationArguments.class);
        
        if (args.containsOption(&quot;dev&quot;)) {
            // 开发环境特殊配置
            enableDevelopmentFeatures();
        }
    }
}
</code></pre></div><h5 id="为什么需要类型判断-beanfactory-instanceof-defaultlistablebeanfactory"><a href="#为什么需要类型判断-beanfactory-instanceof-defaultlistablebeanfactory" class="header-anchor">#</a> 为什么需要类型判断 beanFactory instanceof DefaultListableBeanFactory</h5> <div class="language- extra-class"><pre class="language-text"><code>// 在prepareContext方法中：
if (beanFactory instanceof DefaultListableBeanFactory) {
    // 只有DefaultListableBeanFactory才有这个方法
    ((DefaultListableBeanFactory) beanFactory)
        .setAllowBeanDefinitionOverriding(this.allowBeanDefinitionOverriding);
        // true：允许同名Bean定义覆盖（后注册的覆盖先注册的）
        // false：不允许覆盖，遇到同名Bean定义时抛出异常
}
</code></pre></div><p>核心原因：Spring的设计支持多种BeanFactory实现, 虽然Spring Boot默认使用DefaultListableBeanFactory，但框架设计上支持多种实现：</p> <div class="language- extra-class"><pre class="language-text"><code>// Spring支持的不同BeanFactory实现：
public interface ConfigurableListableBeanFactory 
    extends ListableBeanFactory, ConfigurableBeanFactory, AutowireCapableBeanFactory {
    // 基础接口
}

// 主要实现类：
public class DefaultListableBeanFactory extends AbstractAutowireCapableBeanFactory
    implements ConfigurableListableBeanFactory, BeanDefinitionRegistry, Serializable {
    // Spring默认使用的实现
}

// 其他可能的实现（理论上）：
public class CustomBeanFactory implements ConfigurableListableBeanFactory {
    // 用户自定义的BeanFactory实现
}
</code></pre></div><p>实际应用场景：</p> <div class="language- extra-class"><pre class="language-text"><code>// 场景1：Spring Boot测试中可能使用不同的BeanFactory
@SpringBootTest
@TestPropertySource(properties = &quot;spring.main.allow-bean-definition-overriding=true&quot;)
public class MyTest {
    // 测试环境可能使用特殊的BeanFactory配置
}

// 场景2：自定义BeanFactory（虽然少见，但框架设计上支持）
@Configuration
public class CustomBeanFactoryConfig {
    @Bean
    public ConfigurableListableBeanFactory customBeanFactory() {
        return new CustomBeanFactoryImplementation(); // 用户自定义实现
    }
}
</code></pre></div><h5 id="发布准备事件-⭐扩展点4-准备事件监听"><a href="#发布准备事件-⭐扩展点4-准备事件监听" class="header-anchor">#</a> 发布准备事件 ⭐扩展点4: 准备事件监听</h5> <p><code>listeners.contextPrepared(context); // ApplicationPreparedEvent</code>
开发者扩展方式：</p> <div class="language- extra-class"><pre class="language-text"><code>@Component
public class PreparedEventListener implements ApplicationListener&lt;ApplicationPreparedEvent&gt; {
    @Override
    public void onApplicationEvent(ApplicationPreparedEvent event) {
        ConfigurableApplicationContext context = event.getApplicationContext();
        ConfigurableListableBeanFactory beanFactory = context.getBeanFactory();
        
        // 场景1: Bean定义分析（在实例化前）
        String[] beanNames = beanFactory.getBeanDefinitionNames();
        log.info(&quot;已注册Bean定义数量: {}&quot;, beanNames.length);
        
        // 场景2: 条件配置验证
        if (!beanFactory.containsBeanDefinition(&quot;requiredBean&quot;)) {
            throw new IllegalStateException(&quot;必需Bean未配置&quot;);
        }
        
        // 场景3: 动态注册配置（基于现有Bean定义）
        if (beanFactory.containsBeanDefinition(&quot;dataSource&quot;)) {
            // 根据现有配置决定是否注册额外组件
            registerAdditionalComponents(beanFactory);
        }
        
        // 场景4: 性能监控设置
        setupPerformanceMonitoring(beanFactory);
        
        // 预加载缓存
        preloadCacheData();
    }
}
</code></pre></div><h4 id="阶段6-容器刷新-核心"><a href="#阶段6-容器刷新-核心" class="header-anchor">#</a> 阶段6: 容器刷新（核心！）</h4> <p><code>refreshContext(context); // → 调用context.refresh()</code>
=&gt;</p> <div class="language- extra-class"><pre class="language-text"><code>AbstractApplicationContext:

public void refresh() {
    // 7.1 prepareRefresh() - 设置上下文激活状态、初始化属性源等
    prepareRefresh();
    
    // 7.2 obtainFreshBeanFactory() - 获取或刷新BeanFactory
    // 对于AnnotationConfigApplicationContext，这里会创建DefaultListableBeanFactory
    // 但此时是空的，还没有Bean定义
    ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();
    
    // 7.3 prepareBeanFactory() - 配置BeanFactory的基础设施
    // 设置类加载器、表达式解析器、属性编辑器
    // 注册环境Bean等基础配置：environment、systemProperties、systemEnvironment
    prepareBeanFactory(beanFactory);
    // 此时BeanFactory中已有：
    // - 几个registerSingleton的单例Bean
    // - 一些BeanDefinition（来自load()）
    // 但基础设施（如环境Bean、解析器等）还需要配置
    
    
    // 7.4 postProcessBeanFactory() - 空方法，子类可重写
    postProcessBeanFactory(beanFactory);
    // Web应用在这里注册Servlet相关的Scope
}
</code></pre></div><h5 id="_6-1-6-4-准备阶段"><a href="#_6-1-6-4-准备阶段" class="header-anchor">#</a> 6.1-6.4: 准备阶段</h5> <div class="language- extra-class"><pre class="language-text"><code>prepareRefresh();
obtainFreshBeanFactory();
prepareBeanFactory(beanFactory);
postProcessBeanFactory(beanFactory);
</code></pre></div><p>=&gt;</p> <div class="language- extra-class"><pre class="language-text"><code>// BeanFactory基础设施设置过程：
prepareBeanFactory(beanFactory)
│
├── 设置类加载器
│   └── beanFactory.setBeanClassLoader()
│
├── 设置表达式解析器
│   └── beanFactory.setBeanExpressionResolver()
│       └── StandardBeanExpressionResolver ← 支持SPEL表达式
│
├── 添加属性编辑器注册器
│   └── beanFactory.addPropertyEditorRegistrar()
│       └── ResourceEditorRegistrar ← 注册资源编辑器
│
├── 添加ApplicationContextAware处理器
│   └── beanFactory.addBeanPostProcessor()
│       └── ApplicationContextAwareProcessor ← 处理Aware接口
│
├── 设置忽略的依赖接口
│   └── beanFactory.ignoreDependencyInterface()
│       └── 避免某些接口的自动注入
│
├── 注册可解析的依赖
│   └── beanFactory.registerResolvableDependency()
│       └── 注册BeanFactory、ResourceLoader等
│
└── 添加其他后处理器
    └── beanFactory.addBeanPostProcessor()
        └── ApplicationListenerDetector ← 检测应用监听器
</code></pre></div><p>Spring基础设施组件对比总结表</p> <table><thead><tr><th>组件</th> <th>在BeanFactory中的角色</th> <th>主要功能</th> <th>典型使用场景</th> <th>关联注解/表达式</th> <th>配置时机</th></tr></thead> <tbody><tr><td>EmbeddedValueResolver(嵌入式值解析器)</td> <td>解析字符串中的占位符和SpEL表达式</td> <td>将包含${...}和#{...}的字符串解析为实际值</td> <td>@Value注解处理配置文件占位符解析SpEL表达式求值</td> <td>@Value(&quot;${server.port}&quot;)@Value(&quot;#{T(java.lang.Math).random() * 100.0}&quot;)@Value(&quot;#{systemProperties['user.home']}&quot;)</td> <td>prepareBeanFactory()阶段</td></tr> <tr><td>PropertyEditor(属性编辑器)</td> <td>传统类型转换机制</td> <td>将字符串转换为目标类型（如String→Date）</td> <td>XML配置中的类型转换@Value注解的简单类型转换表单数据绑定</td> <td>@Value(&quot;2023-01-01&quot;) → Date对象XML配置中的属性转换</td> <td>prepareBeanFactory()阶段注册</td></tr> <tr><td>ExpressionParser(表达式解析器)</td> <td>SpEL表达式求值引擎</td> <td>解析和执行Spring表达式语言</td> <td>@Value中的复杂表达式安全导航操作符条件表达式</td> <td>@Value(&quot;#{user?.address?.city}&quot;)@Value(&quot;#{environment.acceptsProfiles('dev') ? 'dev' : 'prod'}&quot;)@Value(&quot;#{users.}&quot;)</td> <td>prepareBeanFactory()阶段配置</td></tr> <tr><td>ScopeManager(作用域管理器)</td> <td>管理Bean的生命周期范围</td> <td>控制Bean的创建、缓存和销毁策略</td> <td>单例vs原型作用域Request/Session作用域自定义作用域</td> <td>@Scope(&quot;prototype&quot;)@Scope(&quot;request&quot;)@Scope(&quot;session&quot;)</td> <td>BeanFactory初始化阶段</td></tr> <tr><td>ConversionService(类型转换服务)</td> <td>现代统一类型转换API</td> <td>提供类型安全的转换机制，支持泛型和集合</td> <td>配置属性转换表单数据绑定自定义类型转换</td> <td>@Value(&quot;${some.list}&quot;) List@Value(&quot;${some.map}&quot;) Map自定义类型转换</td> <td>BeanFactory后处理阶段</td></tr> <tr><td>Conditional系统(条件化配置)</td> <td>基于条件的Bean创建</td> <td>根据条件决定是否创建Bean</td> <td>环境特定配置特性开关控制类路径检测</td> <td>@Profile(&quot;cloud&quot;)@ConditionalOnProperty(&quot;feature.enabled&quot;)@ConditionalOnClass(&quot;com.example.Service&quot;)</td> <td>Bean定义加载阶段</td></tr></tbody></table> <h5 id="_6-5-执行beanfactorypostprocessor-⭐扩展点5-bean工厂后处理"><a href="#_6-5-执行beanfactorypostprocessor-⭐扩展点5-bean工厂后处理" class="header-anchor">#</a> 6.5: 执行BeanFactoryPostProcessor ⭐扩展点5: Bean工厂后处理</h5> <p><code>invokeBeanFactoryPostProcessors();</code>
=&gt;</p> <div class="language- extra-class"><pre class="language-text"><code>// 6.5.1 处理@SpringBootApplication
// → 包含@ComponentScan，扫描com.example包

// 6.5.2 找到HelloController（有@RestController注解）
// @RestController包含@Component，所以被扫描到

// 6.5.3 创建BeanDefinition（Bean蓝图）
BeanDefinition controllerDef = new RootBeanDefinition(HelloController.class);
controllerDef.setScope(SCOPE_SINGLETON);

// 6.5.4 注册到BeanFactory
beanFactory.registerBeanDefinition(&quot;helloController&quot;, controllerDef);

// 6.5.5 处理自动配置（@EnableAutoConfiguration）
// 自动配置内嵌服务器、JSON转换器等
</code></pre></div><p>为什么需要 BeanFactoryPostProcessor（后处理）</p> <p>核心答案：动态性和条件化。有些配置无法在编写代码时确定，需要在运行时根据环境决定.</p> <p>处理对象:BeanDefinition（Bean蓝图）</p> <p>开发者扩展方式：</p> <div class="language- extra-class"><pre class="language-text"><code>// 方式1: 实现BeanFactoryPostProcessor
@Component
public class MyBeanFactoryPostProcessor implements BeanFactoryPostProcessor {
    @Override
    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) {
        Environment env = beanFactory.getBean(Environment.class);
        
        // 场景1: 根据环境动态修改配置
        if (env.acceptsProfiles(&quot;cloud&quot;)) {
            BeanDefinition dbDef = beanFactory.getBeanDefinition(&quot;dataSource&quot;);
            // 云环境使用连接池配置
            dbDef.getPropertyValues().add(&quot;url&quot;, env.getProperty(&quot;CLOUD_DB_URL&quot;));
        }
        
        // 场景2: 条件注册Bean
        if (isFeatureEnabled(env)) {
            GenericBeanDefinition featureBean = new GenericBeanDefinition();
            featureBean.setBeanClass(FeatureService.class);
            ((DefaultListableBeanFactory) beanFactory)
                .registerBeanDefinition(&quot;featureService&quot;, featureBean);
        }
        
        // 场景3: 属性解密
        BeanDefinition[] beanDefs = beanFactory.getBeanDefinitions();
        for (BeanDefinition beanDef : beanDefs) {
            decryptPropertyValues(beanDef); // 解密加密的属性值
        }
    }
}
</code></pre></div><p>常见场景：</p> <p>Bean定义修改：改变作用域、懒加载设置等</p> <p>条件注册：根据条件动态注册Bean</p> <p>AOP代理设置：为特定Bean设置代理</p> <p>属性加密解密：处理加密的配置属性</p> <h5 id="_6-6-注册beanpostprocessor-⭐扩展点6-bean后处理"><a href="#_6-6-注册beanpostprocessor-⭐扩展点6-bean后处理" class="header-anchor">#</a> 6.6: 注册BeanPostProcessor ⭐扩展点6: Bean后处理</h5> <div class="language- extra-class"><pre class="language-text"><code>// 注册AutowiredAnnotationBeanPostProcessor
// 用于后续处理@Autowired注入
registerBeanPostProcessors(beanFactory);
</code></pre></div><p>处理对象:Bean实例（实际对象）</p> <p>开发者扩展方式：</p> <div class="language- extra-class"><pre class="language-text"><code>@Component
public class MyBeanPostProcessor implements BeanPostProcessor {
    
    // Bean初始化前调用
    @Override
    public Object postProcessBeforeInitialization(Object bean, String beanName) {
        // 场景1: 监控统计
        if (bean instanceof RestController) {
            monitorBeanCreation(beanName, bean.getClass());
        }
        
        // 场景2: 自定义注解处理
        if (bean.getClass().isAnnotationPresent(MyAnnotation.class)) {
            processCustomAnnotation(bean);
        }
        
        return bean;
    }
    
    // Bean初始化后调用
    @Override
    public Object postProcessAfterInitialization(Object bean, String beanName) {
        // 场景1: AOP代理创建 这个不是正常的场景而是springboot源码spring-boot-starter-aop的实现,纯粹是举例
        if (bean instanceof MyService) {
            return createProxy(bean); // 返回代理对象
        }
        
        // 场景2: 缓存包装
        if (bean instanceof Repository) {
            return new CachingRepositoryWrapper((Repository) bean);
        }
        
        return bean;
    }
}
</code></pre></div><p>常见场景：</p> <p>AOP代理：为Bean创建动态代理</p> <p>监控统计：记录Bean创建和调用统计</p> <p>缓存包装：为数据访问层添加缓存</p> <p>自定义注解处理：处理业务自定义注解</p> <h5 id="_6-7-6-8-消息源和事件广播器"><a href="#_6-7-6-8-消息源和事件广播器" class="header-anchor">#</a> 6.7-6.8: 消息源和事件广播器</h5> <div class="language- extra-class"><pre class="language-text"><code>initMessageSource();
initApplicationEventMulticaster();
</code></pre></div><h5 id="_6-9-子类特定刷新-⭐扩展点7-内嵌服务器自定义"><a href="#_6-9-子类特定刷新-⭐扩展点7-内嵌服务器自定义" class="header-anchor">#</a> 6.9: 子类特定刷新 ⭐扩展点7: 内嵌服务器自定义</h5> <p><code>onRefresh(); // ServletWebServerApplicationContext.onRefresh()</code>
=&gt;</p> <div class="language- extra-class"><pre class="language-text"><code>// 6.9.1 创建内嵌Tomcat服务器
Tomcat tomcat = new Tomcat();
tomcat.setPort(8080); // 从配置读取

// 6.9.2 创建DispatcherServlet（Spring MVC核心）
DispatcherServlet dispatcherServlet = new DispatcherServlet(context);

// 6.9.3 注册Servlet映射
context.addServlet(&quot;dispatcher&quot;, dispatcherServlet).addMapping(&quot;/&quot;);

// 6.9.4 启动Tomcat（但还没开始监听端口）
tomcat.start();
</code></pre></div><p>开发者扩展方式：</p> <div class="language- extra-class"><pre class="language-text"><code>// 自定义内嵌服务器配置
@Configuration
public class ServerConfig {
    
    @Bean
    public ServletWebServerFactory servletContainer() {
        TomcatServletWebServerFactory tomcat = new TomcatServletWebServerFactory();
        tomcat.setPort(8080);
        tomcat.addConnectorCustomizers(connector -&gt; {
            // 自定义连接器配置
            connector.setProperty(&quot;maxThreads&quot;, &quot;200&quot;);
        });
        return tomcat;
    }
    
    @Bean
    public DispatcherServlet dispatcherServlet() {
        return new DispatcherServlet();
    }
}
</code></pre></div><h5 id="_6-10-注册监听器"><a href="#_6-10-注册监听器" class="header-anchor">#</a> 6.10: 注册监听器</h5> <p><code>registerListeners();</code></p> <h5 id="_6-11-完成beanfactory初始化-⭐扩展点8-bean生命周期回调"><a href="#_6-11-完成beanfactory初始化-⭐扩展点8-bean生命周期回调" class="header-anchor">#</a> 6.11: 完成BeanFactory初始化 ⭐扩展点8: Bean生命周期回调</h5> <p><code>finishBeanFactoryInitialization();</code>
=&gt;</p> <div class="language- extra-class"><pre class="language-text"><code>// 6.11.1 实例化HelloController
HelloController controller = new HelloController(); // 调用构造方法

// 6.11.2 依赖注入（本例没有依赖，跳过）

// 6.11.3 初始化回调
// 调用@PostConstruct方法（本例没有）

// 6.11.4 注册到单例池
singletonObjects.put(&quot;helloController&quot;, controller);
</code></pre></div><p>开发者扩展方式：</p> <div class="language- extra-class"><pre class="language-text"><code>@Component
public class MyService implements InitializingBean, DisposableBean {
    
    // InitializingBean - 初始化回调
    @Override
    public void afterPropertiesSet() throws Exception {
        // 场景：资源初始化
        initializeResources();
        loadReferenceData();
    }
    
    // DisposableBean - 销毁回调  
    @Override
    public void destroy() throws Exception {
        // 场景：资源清理
        cleanupResources();
        closeConnections();
    }
    
    // 或使用注解方式
    @PostConstruct
    public void init() {
        // 初始化逻辑
    }
    
    @PreDestroy
    public void cleanup() {
        // 清理逻辑
    }
}
</code></pre></div><h5 id="_6-12-完成刷新-⭐扩展点9-上下文刷新事件"><a href="#_6-12-完成刷新-⭐扩展点9-上下文刷新事件" class="header-anchor">#</a> 6.12: 完成刷新 ⭐扩展点9: 上下文刷新事件</h5> <div class="language- extra-class"><pre class="language-text"><code>// 发布ContextRefreshedEvent事件
// 完成容器初始化
finishRefresh();
</code></pre></div><p>开发者扩展方式：</p> <div class="language- extra-class"><pre class="language-text"><code>@Component
public class ContextRefreshedListener implements ApplicationListener&lt;ContextRefreshedEvent&gt; {
    @Override
    public void onApplicationEvent(ContextRefreshedEvent event) {
        // 场景：容器刷新完成后执行初始化
        ApplicationContext context = event.getApplicationContext();
        
        // 验证所有必需Bean是否就绪
        validateRequiredBeans(context);
        
        // 启动后台任务
        startBackgroundJobs();
    }
}
</code></pre></div><h4 id="阶段7-启动收尾"><a href="#阶段7-启动收尾" class="header-anchor">#</a> 阶段7: 启动收尾</h4> <div class="language- extra-class"><pre class="language-text"><code>// 7.1 后处理（空方法，可扩展）
afterRefresh(context, applicationArguments);

// 7.2 发布启动完成事件 ⭐扩展点10: 启动完成事件
listeners.started(context); // ApplicationStartedEvent

// 7.3 执行Runner（如果有ApplicationRunner/CommandLineRunner）⭐扩展点11: 启动Runner
callRunners(context, appArgs);

// 7.4 发布应用就绪事件 ⭐扩展点12: 应用就绪事件 
listeners.running(context); // ApplicationReadyEvent

// 7.5 Tomcat开始监听端口（真正接受请求）
// 控制台输出: Tomcat started on port(s): 8080 (http)
</code></pre></div><p>Runner扩展方式：</p> <div class="language- extra-class"><pre class="language-text"><code>@Component
public class MyApplicationRunner implements ApplicationRunner {
    @Override
    public void run(ApplicationArguments args) throws Exception {
        // 场景1: 数据初始化
        if (args.containsOption(&quot;init-data&quot;)) {
            initializeSampleData();
        }
        
        // 场景2: 连接检查
        checkExternalServices();
        
        // 场景3: 缓存预热
        warmUpCaches();
    }
}

@Component  
public class MyCommandLineRunner implements CommandLineRunner {
    @Override
    public void run(String... args) throws Exception {
        // 处理命令行参数
        for (String arg : args) {
            if (arg.equals(&quot;--debug&quot;)) {
                enableDebugMode();
            }
        }
    }
}
</code></pre></div><h4 id="时序状态和最终状态"><a href="#时序状态和最终状态" class="header-anchor">#</a> 时序状态和最终状态</h4> <p>时间点 T0: 创建BeanFactory（空）</p> <div class="language- extra-class"><pre class="language-text"><code>// 刚创建时的BeanFactory内容：
BeanFactory状态：
├── singletonObjects: {}                    // 空单例池
├── beanDefinitionMap: {}                  // 空Bean定义映射
├── embeddedValueResolvers: []              // 空值解析器
└── 基本基础设施: 
    ├── 类加载器
    ├── 类型转换服务
    └── 基本属性编辑器
</code></pre></div><p>时间点 T1: registerSingleton(&quot;springApplicationArguments&quot;) → 添加具体对象</p> <div class="language- extra-class"><pre class="language-text"><code>// 添加具体对象后的状态：
BeanFactory状态：
├── singletonObjects: 
│   └── &quot;springApplicationArguments&quot; → ApplicationArguments实例
├── beanDefinitionMap: {}                  // 仍然无Bean定义
├── embeddedValueResolvers: []
└── 基本基础设施
</code></pre></div><p>时间点 T2: load() → 注册BeanDefinition（蓝图）</p> <div class="language- extra-class"><pre class="language-text"><code>// load()处理SimpleApplication.class后的状态：
BeanFactory状态：
├── singletonObjects: 
│   └── &quot;springApplicationArguments&quot; → ApplicationArguments实例
├── beanDefinitionMap: 
│   ├── &quot;simpleApplication&quot; → BeanDefinition(SimpleApplication.class)
│   ├── &quot;helloController&quot; → BeanDefinition(HelloController.class)   // 扫描到的
│   ├── &quot;userService&quot; → BeanDefinition(UserService.class)           // 扫描到的
│   └── 其他自动配置的BeanDefinition...
├── embeddedValueResolvers: []
└── 基本基础设施
</code></pre></div><p>时间点 T3: prepareBeanFactory() → 配置BeanFactory基础设施</p> <div class="language- extra-class"><pre class="language-text"><code>// 配置基础设施后的状态：
BeanFactory状态：
├── singletonObjects: 
│   ├── &quot;springApplicationArguments&quot; → ApplicationArguments实例
│   └── &quot;environment&quot; → Environment实例              // 新添加的环境Bean
├── beanDefinitionMap: 
│   ├── &quot;simpleApplication&quot; → BeanDefinition
│   ├── &quot;helloController&quot; → BeanDefinition
│   └── ...
├── embeddedValueResolvers: [默认值解析器]           // 新增
└── 增强的基础设施:
    ├── 完整的属性编辑器
    ├── 表达式解析器
    ├── 作用域管理器
    └── 类型转换服务
</code></pre></div><p>时间点 T4: invokeBeanFactoryPostProcessors() → 处理所有BeanDefinition</p> <div class="language- extra-class"><pre class="language-text"><code>// 处理后处理器后的状态（可能的变化）：
BeanFactory状态：
├── singletonObjects: 
│   ├── &quot;springApplicationArguments&quot; → ApplicationArguments实例
│   └── &quot;environment&quot; → Environment实例
├── beanDefinitionMap: 
│   ├── &quot;simpleApplication&quot; → BeanDefinition（可能被修改）
│   ├── &quot;helloController&quot; → BeanDefinition（可能被修改）
│   ├── &quot;userService&quot; → BeanDefinition（可能被修改）
│   ├── &quot;newDynamicBean&quot; → BeanDefinition（可能新增） // 动态注册的
│   └── ...
├── embeddedValueResolvers: [默认值解析器]
└── 基础设施
</code></pre></div><p>时间点 T5: finishBeanFactoryInitialization() → 实例化所有单例Bean</p> <div class="language- extra-class"><pre class="language-text"><code>// 实例化所有单例Bean后的状态：
BeanFactory状态：
├── singletonObjects: 
│   ├── &quot;springApplicationArguments&quot; → ApplicationArguments实例
│   ├── &quot;environment&quot; → Environment实例
│   ├── &quot;simpleApplication&quot; → SimpleApplication实例（已实例化）
│   ├── &quot;helloController&quot; → HelloController实例（已实例化+依赖注入）
│   ├── &quot;userService&quot; → UserService实例（已实例化+依赖注入）
│   └── 所有其他单例Bean...
├── beanDefinitionMap: 
│   ├── &quot;simpleApplication&quot; → BeanDefinition
│   ├── &quot;helloController&quot; → BeanDefinition
│   └── ...（定义仍然保留）
├── embeddedValueResolvers: [默认值解析器]
└── 基础设施
</code></pre></div><p>应用启动完成后的状态：</p> <div class="language- extra-class"><pre class="language-text"><code>├── BeanFactory中有：
│   └── helloController : HelloController实例
├── Web服务器：
│   └── Tomcat运行在8080端口
├── URL映射：
│   └── /hello → HelloController.hello()方法
└── 可以处理请求：
    GET http://localhost:8080/hello → &quot;Hello World!&quot;
</code></pre></div><h4 id="bean的时序状态细节"><a href="#bean的时序状态细节" class="header-anchor">#</a> Bean的时序状态细节</h4> <h5 id="创建-注入-回调"><a href="#创建-注入-回调" class="header-anchor">#</a> 创建-注入-回调</h5> <p>更深一步观察bean的整个生命周期：</p> <div class="language- extra-class"><pre class="language-text"><code>// Spring容器启动入口
SpringApplication.run()
└── AbstractApplicationContext.refresh()
    └── finishBeanFactoryInitialization(beanFactory)
        └── DefaultListableBeanFactory.preInstantiateSingletons()
            └── 遍历所有Bean定义，对每个Bean执行：
                getBean(beanName) → doGetBean() → createBean() → doCreateBean()
                    ├── createBeanInstance()    // 阶段1: 实例化（构造器注入）
                    ├── populateBean()          // 阶段2: 依赖注入  （字段/setter注入）  
                    └── initializeBean()        // 阶段3: 初始化生命周期回调）
					
// 单个Bean的详细创建过程：
doCreateBean(beanName, mbd, args)
│
├── 1. createBeanInstance()     ← 实例化阶段（构造器注入在这里完成）
│   │
│   ├── 1.1 确定实例化策略
│   │   ├── determineConstructorsFromBeanPostProcessors()  // 通过后处理器选择构造器
│   │   └── 根据配置选择三种路径之一：
│   │
│   ├── 1.2 构造器注入路径 (autowireConstructor) ← 主要注入方式
│   │   ├── determineConstructor()              // 确定使用哪个构造器
│   │   ├── resolveConstructorArguments()      // 解析构造器参数（核心依赖解析！）
│   │   │   └── resolveDependency()             // 解析单个依赖
│   │   │       └── getBean()                  // 可能递归获取依赖Bean
│   │   └── constructor.newInstance(args)      // 使用参数创建实例
│   │
│   ├── 1.3 默认构造器路径 (instantiateBean)
│   │   ├── getInstantiationStrategy()          // 获取实例化策略
│   │   └── instantiate()                       // 反射创建空实例
│   │
│   └── 1.4 工厂方法路径 (instantiateUsingFactoryMethod)
│       ├── determineFactoryMethod()            // 确定工厂方法
│       ├── resolveArguments()                  // 解析方法参数
│       └── method.invoke()                     // 调用工厂方法
│
├── 2. populateBean()          ← 依赖注入阶段（字段/setter注入在这里完成）
│   │
│   ├── 2.1 自动注入基础支持
│   │   ├── autowireByName()                    // 按名称自动注入
│   │   └── autowireByType()                    // 按类型自动注入
│   │
│   ├── 2.2 注解驱动注入（核心！）
│   │   └── postProcessProperties()            // 调用InstantiationAwareBeanPostProcessor
│   │       └── AutowiredAnnotationBeanPostProcessor工作流程：
│   │           ├── findAutowiringMetadata()    // 查找@Autowired、@Value、@Inject注解
│   │           ├── resolveDependency()          // 解析依赖
│   │           ├── Field.set(bean, value)      // 字段反射注入
│   │           └── Method.invoke(bean, args)   // setter方法调用注入
│   │
│   └── 2.3 应用属性值
│       └── applyPropertyValues()              // 最终设置属性值
│
└── 3. initializeBean()         ← 初始化阶段（方法注入在这里完成 这里说的&quot;方法注入&quot;不是依赖注入，而是指初始化方法的调用）
    │
    ├── 3.1 Aware接口回调
    │   └── invokeAwareMethods()
    │       ├── setBeanName()                   // BeanNameAware
    │       ├── setBeanFactory()                // BeanFactoryAware
    │       └── setApplicationContext()         // ApplicationContextAware
    │
    ├── 3.2 前置初始化处理
    │   └── applyBeanPostProcessorsBeforeInitialization()
    │       └── CommonAnnotationBeanPostProcessor处理：
    │           └── postProcessBeforeInitialization() // 调用@PostConstruct方法
    │
    ├── 3.3 初始化方法调用
    │   └── invokeInitMethods()
    │       ├── afterPropertiesSet()            // InitializingBean接口
    │       └── initMethod.invoke()             // 自定义init方法
    │
    └── 3.4 后置初始化处理
        └── applyBeanPostProcessorsAfterInitialization()
            └── AbstractAutoProxyCreator处理：
                └── postProcessAfterInitialization() // AOP代理在这里创建
</code></pre></div><h5 id="增强实例"><a href="#增强实例" class="header-anchor">#</a> 增强实例</h5> <div class="language- extra-class"><pre class="language-text"><code>// 1. 主启动类（不变）
@SpringBootApplication
public class SimpleApplication {
    public static void main(String[] args) {
        SpringApplication.run(SimpleApplication.class, args);
    }
}

// 2. 增强的RestController，添加各种初始化方法
@RestController
public class HelloController implements InitializingBean, ApplicationContextAware {
    
    private ApplicationContext applicationContext;
    private String startupTime;
    
    // 构造器注入（阶段1）
    public HelloController() {
        System.out.println(&quot;1. 构造器调用 - HelloController实例创建&quot;);
        // environment.getProperty(&quot;spring.application.name&quot;); // ❌ 这里不能调用 environment，可以用下面方法：
        /**
        public HelloController(Environment environment) {
            this.environment = environment;
            this.appName = environment.getProperty(&quot;spring.application.name&quot;);
            
            System.out.println(&quot;构造器中使用配置: &quot; + appName); // ✅ 安全
        }**/

        // ❌ 输出: applicationContext = null
        // ❌ 不能在这里使用applicationContext!
        // 跟environment不同，不建议构造器注入ApplicationContext    public HelloController(ApplicationContext applicationContext) ⚠️ 技术上可用，但有风险！	有循环依赖风险，比如：
        //❌ 危险操作1: 获取其他Bean可能触发循环依赖        SomeService service = context.getBean(SomeService.class);
        // ❌ 危险操作2: 如果SomeService也依赖HelloController，会导致栈溢出    service.initialize();
        // ❌ 危险操作3: Bean可能还未完全初始化 SomeBean bean = context.getBean(SomeBean.class);
    }
    

    // 字段注入（阶段2）
    @Autowired
    private Environment environment;
    
    // Setter注入（阶段2）
    private MessageService messageService;
    
    @Autowired
    public void setMessageService(MessageService messageService) {
        System.out.println(&quot;2. Setter注入 - MessageService注入&quot;);
        this.messageService = messageService;

        // ❌ 不安全操作：
        // - 调用messageService的方法（可能其他依赖还未注入）
        // - 访问其他@Autowired字段（可能还未注入）
    }
    
    // ApplicationContextAware接口（阶段3-1）
    @Override
    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
        System.out.println(&quot;3. Aware接口 - ApplicationContext设置&quot;);
        this.applicationContext = applicationContext;
    }
    
    // @PostConstruct方法（阶段3-2）
    @PostConstruct
    public void init() {
        System.out.println(&quot;4. @PostConstruct - 自定义初始化&quot;);
        this.startupTime = LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
        
        // 此时所有依赖都已注入完成
        String appName = environment.getProperty(&quot;spring.application.name&quot;); // 可以安全调用 environment
        System.out.println(&quot;应用名称: &quot; + appName);

        // ✅ 这里可以安全使用 context
        // 1. 获取Bean
        MyService service = context.getBean(MessageService.class);

        // 2. 发布应用事件
        context.publishEvent(new CustomEvent(this, &quot;事件数据&quot;));

        // 3. 获取环境信息（Environment是ApplicationContext的一部分）
        Environment env = context.getEnvironment();
        String configValue = env.getProperty(&quot;some.config&quot;);

        // 4. 国际化消息
        String message = context.getMessage(&quot;hello.message&quot;, null, Locale.CHINA);

        // 5. 资源访问
        Resource resource = context.getResource(&quot;classpath:config/file.txt&quot;);
    }
    
    // InitializingBean接口（阶段3-3）
    @Override
    public void afterPropertiesSet() throws Exception {
        System.out.println(&quot;5. InitializingBean - 属性设置后初始化&quot;);
        // 可以执行额外的初始化逻辑
    }
    
    // 业务方法
    @GetMapping(&quot;/hello&quot;)
    public String hello() {
        return messageService.getMessage() + &quot; at &quot; + startupTime;
    }
}

// 3. 简单的Service类，用于演示依赖
@Service
public class MessageService {
    
    public MessageService() {
        System.out.println(&quot;1. MessageService构造器调用&quot;);
    }
    
    @PostConstruct
    public void init() {
        System.out.println(&quot;4. MessageService @PostConstruct&quot;);
    }
    
    public String getMessage() {
        return &quot;Hello World from Spring Boot!&quot;;
    }
}

// 4. 配置文件application.properties
server.port=8080
spring.application.name=simple-demo
</code></pre></div><h5 id="bean时序状态"><a href="#bean时序状态" class="header-anchor">#</a> Bean时序状态</h5> <div class="language- extra-class"><pre class="language-text"><code>// HelloController的完整创建过程：
doCreateBean(&quot;helloController&quot;)
│
├── 阶段1: createBeanInstance()     ← 实例化
│   └── 调用HelloController构造器
│       ✅ 状态: Bean实例已创建，但所有字段为null
│       📝 控制台输出: &quot;1. 构造器调用 - HelloController实例创建&quot;
│
├── 阶段2: populateBean()          ← 依赖注入
│   ├── 注入@Autowired字段: Environment environment
│   ├── 调用setter方法: setMessageService(messageService实例)
│       ✅ 状态: 依赖已注入，但未初始化
│       📝 控制台输出: &quot;2. Setter注入 - MessageService注入&quot;
│   └── MessageService的创建过程（递归）:
│       doCreateBean(&quot;messageService&quot;)
│       ├── createBeanInstance() → &quot;1. MessageService构造器调用&quot;
│       ├── populateBean()        // 无依赖需要注入
│       └── initializeBean()     → &quot;4. MessageService @PostConstruct&quot;
│
└── 阶段3: initializeBean()         ← 初始化
    ├── 3.1 invokeAwareMethods()
    │   └── 调用setApplicationContext()
    │       ✅ 状态: ApplicationContext已设置
    │       📝 控制台输出: &quot;3. Aware接口 - ApplicationContext设置&quot;
    │
    ├── 3.2 applyBeanPostProcessorsBeforeInitialization()
    │   └── CommonAnnotationBeanPostProcessor处理@PostConstruct
    │       └── 调用init()方法
    │           ✅ 状态: 自定义初始化完成，Bean已就绪
    │           📝 控制台输出: &quot;4. @PostConstruct - 自定义初始化&quot;
    │
    ├── 3.3 invokeInitMethods()
    │   ├── 调用afterPropertiesSet() (InitializingBean接口)
    │       📝 控制台输出: &quot;5. InitializingBean - 属性设置后初始化&quot;
    │   └── 如果有自定义init-method，也会在这里调用
    │
    └── 3.4 applyBeanPostProcessorsAfterInitialization()
        └── 可能创建AOP代理（本例不需要）
            ✅ 最终状态: Bean完全初始化完成，可正常使用
</code></pre></div><h3 id="扩展点场景"><a href="#扩展点场景" class="header-anchor">#</a> 扩展点场景</h3> <h4 id="具体业务场景1-加密配置解密服务"><a href="#具体业务场景1-加密配置解密服务" class="header-anchor">#</a> 具体业务场景1：加密配置解密服务</h4> <div class="language- extra-class"><pre class="language-text"><code>// 在ApplicationContextInitializer中早期注册解密服务
public class DecryptionInitializer implements ApplicationContextInitializer {
    @Override
    public void initialize(ConfigurableApplicationContext context) {
        // 早期注册解密服务
        context.getBeanFactory().registerSingleton(&quot;configDecryptor&quot;, new ConfigDecryptor());
        
        // 现在其他BeanFactoryPostProcessor可以使用这个解密服务
        // 例如：解密数据库密码、API密钥等敏感配置
    }
}

// 在BeanFactoryPostProcessor中使用早期注册的Bean
@Component
public class DecryptionPostProcessor implements BeanFactoryPostProcessor {
    @Override
    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) {
        // 获取早期注册的解密服务
        ConfigDecryptor decryptor = beanFactory.getBean(&quot;configDecryptor&quot;, ConfigDecryptor.class);
        
        // 解密所有加密属性
        BeanDefinition definition = beanFactory.getBeanDefinition(&quot;dataSource&quot;);
        String encryptedPassword = (String) definition.getPropertyValues().get(&quot;password&quot;);
        String decryptedPassword = decryptor.decrypt(encryptedPassword);
        definition.getPropertyValues().add(&quot;password&quot;, decryptedPassword);
    }
}
</code></pre></div><h4 id="具体业务场景2-环境检测服务"><a href="#具体业务场景2-环境检测服务" class="header-anchor">#</a> 具体业务场景2：环境检测服务</h4> <div class="language- extra-class"><pre class="language-text"><code>// 早期注册环境检测服务
public class EnvironmentDetectorInitializer implements ApplicationContextInitializer {
    @Override
    public void initialize(ConfigurableApplicationContext context) {
        EnvironmentDetector detector = new EnvironmentDetector();
        context.getBeanFactory().registerSingleton(&quot;envDetector&quot;, detector);
        
        // 根据环境动态设置配置
        if (detector.isCloudEnvironment()) {
            System.setProperty(&quot;server.port&quot;, &quot;8081&quot;);
            System.setProperty(&quot;spring.profiles.active&quot;, &quot;cloud&quot;);
        }
    }
}
</code></pre></div><h4 id="具体业务场景3-功能开关服务"><a href="#具体业务场景3-功能开关服务" class="header-anchor">#</a> 具体业务场景3：功能开关服务</h4> <div class="language- extra-class"><pre class="language-text"><code>// 早期注册功能开关服务，用于控制后续Bean的注册
public class FeatureToggleInitializer implements ApplicationContextInitializer {
    @Override
    public void initialize(ConfigurableApplicationContext context) {
        FeatureToggle toggle = new FeatureToggle();
        context.getBeanFactory().registerSingleton(&quot;featureToggle&quot;, toggle);
        
        // 其他BeanFactoryPostProcessor可以查询功能开关状态
        // 决定是否注册某些Bean
    }
}
</code></pre></div><h2 id="_3-spring-boot应用监控与调优方案"><a href="#_3-spring-boot应用监控与调优方案" class="header-anchor">#</a> 3. Spring Boot应用监控与调优方案</h2> <p>生产环境监控：使用APM工具（如SkyWalking、Pinpoint）</p> <p>开发阶段：集成Spring Boot DevTools进行热加载监控</p> <p>整体监控架构</p> <div class="language- extra-class"><pre class="language-text"><code>┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   应用层监控      │    │   JVM层监控      │    │   系统层监控      │
│                 │    │                 │    │                 │
│ • 启动时间监控    │    │ • 内存使用       │    │ • CPU使用率      │
│ • Bean加载监控   │    │ • GC统计        │    │ • 磁盘IO         │
│ • 请求响应监控    │    │ • 线程状态       │    │ • 网络流量       │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘
          │                      │                      │
          └──────────────────────┼──────────────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │     监控数据收集层          │
                    │                           │
                    │ • Micrometer              │
                    │ • Spring Boot Actuator    │
                    │ • 自定义监控组件           │
                    └─────────────┬─────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │     数据存储与可视化        │
                    │                           │
                    │ • Prometheus + Grafana    │
                    │ • ELK Stack               │
                    │ • 时序数据库              │
                    └───────────────────────────┘
</code></pre></div><h3 id="依赖配置"><a href="#依赖配置" class="header-anchor">#</a> 依赖配置</h3> <div class="language- extra-class"><pre class="language-text"><code>&lt;!-- Spring Boot Actuator --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;!-- Micrometer Prometheus --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
    &lt;artifactId&gt;micrometer-registry-prometheus&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;!-- 性能监控 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;!-- 日志监控 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;net.logstash.logback&lt;/groupId&gt;
    &lt;artifactId&gt;logstash-logback-encoder&lt;/artifactId&gt;
    &lt;version&gt;7.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre></div><h3 id="启动过程专项监控"><a href="#启动过程专项监控" class="header-anchor">#</a> 启动过程专项监控</h3> <div class="language- extra-class"><pre class="language-text"><code>@Component
public class StartupMonitor {
    private static final Logger logger = LoggerFactory.getLogger(StartupMonitor.class);
    
    private long appStartTime;
    private Map&lt;String, Long&gt; phaseTimestamps = new ConcurrentHashMap&lt;&gt;();
    
    @EventListener
    public void handleApplicationStarting(ApplicationStartingEvent event) {
        appStartTime = System.currentTimeMillis();
        phaseTimestamps.put(&quot;starting&quot;, appStartTime);
        logger.info(&quot;应用开始启动: {}&quot;, appStartTime);
    }
    
    @EventListener
    public void handleEnvironmentPrepared(ApplicationEnvironmentPreparedEvent event) {
        long time = System.currentTimeMillis();
        phaseTimestamps.put(&quot;environmentPrepared&quot;, time);
        logger.info(&quot;环境准备完成, 耗时: {}ms&quot;, time - appStartTime);
        
        // 记录环境配置信息
        Environment env = event.getEnvironment();
        logger.info(&quot;Active Profiles: {}&quot;, Arrays.toString(env.getActiveProfiles()));
        logger.info(&quot;Config Locations: {}&quot;, env.getProperty(&quot;spring.config.location&quot;, &quot;default&quot;));
    }
    
    @EventListener
    public void handleContextPrepared(ApplicationPreparedEvent event) {
        long time = System.currentTimeMillis();
        phaseTimestamps.put(&quot;contextPrepared&quot;, time);
        logger.info(&quot;上下文准备完成, 总耗时: {}ms&quot;, time - appStartTime);
        
        // 记录Bean定义数量
        ConfigurableListableBeanFactory beanFactory = event.getApplicationContext().getBeanFactory();
        int beanDefinitionCount = beanFactory.getBeanDefinitionCount();
        logger.info(&quot;Bean定义数量: {}&quot;, beanDefinitionCount);
    }
    
    @EventListener
    public void handleContextRefreshed(ContextRefreshedEvent event) {
        long time = System.currentTimeMillis();
        phaseTimestamps.put(&quot;contextRefreshed&quot;, time);
        
        ApplicationContext context = event.getApplicationContext();
        String[] beanNames = context.getBeanDefinitionNames();
        
        logger.info(&quot;容器刷新完成, Bean实例化数量: {}, 总耗时: {}ms&quot;, 
                   beanNames.length, time - appStartTime);
        
        // 分析Bean依赖关系
        analyzeBeanDependencies(context, beanNames);
        
        // 识别慢加载Bean
        identifySlowLoadingBeans();

        // 记录启动性能指标
        recordStartupMetrics();
    }
    
    @EventListener
    public void handleApplicationReady(ApplicationReadyEvent event) {
        long totalTime = System.currentTimeMillis() - appStartTime;
        logger.info(&quot;应用启动完成, 总耗时: {}ms&quot;, totalTime);
        
        // 发布启动性能报告
        publishStartupReport(totalTime);
    }
    
    private void analyzeBeanDependencies(ApplicationContext context, String[] beanNames) {
        logger.info(&quot;=== Bean依赖分析 ===&quot;);
        
        for (String beanName : beanNames) {
            if (beanName.contains(&quot;Service&quot;) || beanName.contains(&quot;Controller&quot;)) {
                BeanDefinition bd = ((DefaultListableBeanFactory) 
                    context.getAutowireCapableBeanFactory()).getBeanDefinition(beanName);
                
                if (bd.hasAttribute(&quot;dependsOn&quot;)) {
                    String[] dependsOn = (String[]) bd.getAttribute(&quot;dependsOn&quot;);
                    logger.info(&quot;Bean {} 依赖: {}&quot;, beanName, Arrays.toString(dependsOn));
                }
            }
        }
    }
    
    private void identifySlowLoadingBeans() {
        logger.info(&quot;=== 慢加载Bean识别 ===&quot;);
        
        phaseTimestamps.entrySet().stream()
            .filter(entry -&gt; entry.getValue().getMaxTime() &gt; 500) // 超过500ms
            .sorted((e1, e2) -&gt; Long.compare(e2.getValue().getMaxTime(), 
                    e1.getValue().getMaxTime()))
            .forEach(entry -&gt; {
                logger.warn(&quot;慢加载Bean: {}, 最大耗时: {}ms&quot;, 
                    entry.getKey(), entry.getValue().getMaxTime());
            });
    }

    private void recordStartupMetrics() {
        // 记录到Micrometer指标
        Metrics.gauge(&quot;application.startup.duration&quot;, 
            System.currentTimeMillis() - appStartTime);
        Metrics.gauge(&quot;application.beans.count&quot;, 
            phaseTimestamps.size());
    }
    
    private void publishStartupReport(long totalTime) {
        logger.info(&quot;=== Spring Boot启动性能报告 ===&quot;);
        logger.info(&quot;总启动时间: {}ms&quot;, totalTime);
        
        phaseTimestamps.entrySet().stream()
            .sorted(Map.Entry.comparingByValue())
            .forEach(entry -&gt; {
                logger.info(&quot;阶段 {}: {}ms&quot;, entry.getKey(), entry.getValue() - appStartTime);
            });
    }
}
</code></pre></div><h3 id="bean加载性能监控"><a href="#bean加载性能监控" class="header-anchor">#</a> Bean加载性能监控</h3> <div class="language- extra-class"><pre class="language-text"><code>@Component
public class BeanLoadingMonitor implements BeanPostProcessor {
    private final Map&lt;String, Long&gt; beanCreationStartTimes = new ConcurrentHashMap&lt;&gt;();
    private final Map&lt;String, BeanMetrics&gt; beanMetrics = new ConcurrentHashMap&lt;&gt;();
    
    @Override
    public Object postProcessBeforeInitialization(Object bean, String beanName) {
        beanCreationStartTimes.put(beanName, System.currentTimeMillis());
        return bean;
    }
    
    @Override
    public Object postProcessAfterInitialization(Object bean, String beanName) {
        Long startTime = beanCreationStartTimes.remove(beanName);
        if (startTime != null) {
            long duration = System.currentTimeMillis() - startTime;
            BeanMetrics metrics = beanMetrics.computeIfAbsent(beanName, 
                k -&gt; new BeanMetrics(bean.getClass().getSimpleName()));
            metrics.recordCreation(duration);
            
            if (duration &gt; 100) { // 超过100ms记录警告
                logger.warn(&quot;Bean [{}] 初始化耗时较长: {}ms&quot;, beanName, duration);
            }
        }
        return bean;
    }
    
    @EventListener
    public void handleApplicationReady(ApplicationReadyEvent event) {
        // 启动完成后输出Bean加载性能报告
        logger.info(&quot;=== Bean加载性能报告 ===&quot;);
        beanMetrics.entrySet().stream()
            .sorted((e1, e2) -&gt; Long.compare(e2.getValue().getMaxTime(), e1.getValue().getMaxTime()))
            .limit(10) // 只显示最慢的10个Bean
            .forEach(entry -&gt; {
                BeanMetrics metrics = entry.getValue();
                logger.info(&quot;Bean [{}]: 最大耗时={}ms, 平均耗时={}ms&quot;, 
                    entry.getKey(), metrics.getMaxTime(), metrics.getAverageTime());
            });
    }
    
    static class BeanMetrics {
        private final String className;
        private long totalTime;
        private long maxTime;
        private int count;
        
        BeanMetrics(String className) {
            this.className = className;
        }
        
        void recordCreation(long duration) {
            totalTime += duration;
            maxTime = Math.max(maxTime, duration);
            count++;
        }
        
        long getAverageTime() {
            return count &gt; 0 ? totalTime / count : 0;
        }
        
        long getMaxTime() {
            return maxTime;
        }
    }
}
</code></pre></div><h3 id="配置类加载监控"><a href="#配置类加载监控" class="header-anchor">#</a> 配置类加载监控</h3> <div class="language- extra-class"><pre class="language-text"><code>@Component
public class ConfigurationLoadMonitor implements BeanFactoryPostProcessor {
    
    @Override
    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {
        if (beanFactory instanceof DefaultListableBeanFactory) {
            DefaultListableBeanFactory dlbf = (DefaultListableBeanFactory) beanFactory;
            
            // 监控配置类解析
            dlbf.addBeanPostProcessor(new BeanPostProcessor() {
                @Override
                public Object postProcessBeforeInitialization(Object bean, String beanName) {
                    if (beanName != null &amp;&amp; beanName.endsWith(&quot;Configuration&quot;)) {
                        logger.debug(&quot;配置类加载: {}&quot;, beanName);
                    }
                    return bean;
                }
            });
        }
    }
}
</code></pre></div><h3 id="jvm级别监控配置"><a href="#jvm级别监控配置" class="header-anchor">#</a> JVM级别监控配置</h3> <div class="language- extra-class"><pre class="language-text"><code># application-monitor.yml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,startup
  endpoint:
    metrics:
      enabled: true
    prometheus:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    enable:
      jvm: true
      system: true
      logback: true
  tracing:
    sampling:
      probability: 1.0

# JVM监控配置
server:
  port: 8080
spring:
  application:
    name: my-monitored-app
</code></pre></div><h3 id="自定义健康检查与指标"><a href="#自定义健康检查与指标" class="header-anchor">#</a> 自定义健康检查与指标</h3> <div class="language- extra-class"><pre class="language-text"><code>@Component
public class ApplicationHealthIndicator implements HealthIndicator {
    
    @Override
    public Health health() {
        // 检查应用健康状态
        boolean isHealthy = checkApplicationHealth();
        
        if (isHealthy) {
            return Health.up()
                .withDetail(&quot;启动时间&quot;, ManagementFactory.getRuntimeMXBean().getUptime() + &quot;ms&quot;)
                .withDetail(&quot;内存使用&quot;, getMemoryUsage())
                .build();
        } else {
            return Health.down()
                .withDetail(&quot;错误原因&quot;, &quot;应用运行异常&quot;)
                .build();
        }
    }
    
    private String getMemoryUsage() {
        Runtime runtime = Runtime.getRuntime();
        long usedMemory = runtime.totalMemory() - runtime.freeMemory();
        long maxMemory = runtime.maxMemory();
        return String.format(&quot;%.2fMB/%.2fMB&quot;, 
            usedMemory / 1024.0 / 1024.0, maxMemory / 1024.0 / 1024.0);
    }
}

@Component
public class CustomMetrics {
    private final MeterRegistry meterRegistry;
    private final Counter beanCreationCounter;
    private final Timer startupTimer;
    
    public CustomMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.beanCreationCounter = Counter.builder(&quot;application.beans.created&quot;)
            .description(&quot;应用创建的Bean数量&quot;)
            .register(meterRegistry);
            
        this.startupTimer = Timer.builder(&quot;application.startup.time&quot;)
            .description(&quot;应用启动时间&quot;)
            .register(meterRegistry);
    }
    
    public void recordBeanCreation() {
        beanCreationCounter.increment();
    }
    
    public void recordStartupTime(long duration) {
        startupTimer.record(duration, TimeUnit.MILLISECONDS);
    }
}
</code></pre></div><h3 id="日志监控配置"><a href="#日志监控配置" class="header-anchor">#</a> 日志监控配置</h3> <div class="language- extra-class"><pre class="language-text"><code>&lt;!-- logback-spring.xml --&gt;
&lt;configuration&gt;
    &lt;appender name=&quot;JSON&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;
        &lt;encoder class=&quot;net.logstash.logback.encoder.LogstashEncoder&quot;&gt;
            &lt;customFields&gt;{&quot;application&quot;:&quot;${spring.application.name}&quot;}&lt;/customFields&gt;
        &lt;/encoder&gt;
    &lt;/appender&gt;
    
    &lt;appender name=&quot;METRICS&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;
        &lt;file&gt;logs/metrics.log&lt;/file&gt;
        &lt;encoder&gt;
            &lt;pattern&gt;%d{yyyy-MM-dd HH:mm:ss} - %msg%n&lt;/pattern&gt;
        &lt;/encoder&gt;
        &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;
            &lt;fileNamePattern&gt;logs/metrics.%d{yyyy-MM-dd}.log&lt;/fileNamePattern&gt;
        &lt;/rollingPolicy&gt;
    &lt;/appender&gt;
    
    &lt;logger name=&quot;com.example.monitor&quot; level=&quot;DEBUG&quot; additivity=&quot;false&quot;&gt;
        &lt;appender-ref ref=&quot;METRICS&quot; /&gt;
        &lt;appender-ref ref=&quot;JSON&quot; /&gt;
    &lt;/logger&gt;
    
    &lt;root level=&quot;INFO&quot;&gt;
        &lt;appender-ref ref=&quot;JSON&quot; /&gt;
    &lt;/root&gt;
&lt;/configuration&gt;
</code></pre></div><h3 id="grafana监控面板配置"><a href="#grafana监控面板配置" class="header-anchor">#</a> Grafana监控面板配置</h3> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;title&quot;: &quot;Spring Boot应用监控&quot;,
  &quot;panels&quot;: [
    {
      &quot;title&quot;: &quot;启动时间监控&quot;,
      &quot;targets&quot;: [
        {
          &quot;expr&quot;: &quot;application_startup_time_seconds&quot;,
          &quot;legendFormat&quot;: &quot;启动耗时&quot;
        }
      ],
      &quot;type&quot;: &quot;stat&quot;
    },
    {
      &quot;title&quot;: &quot;Bean加载性能&quot;,
      &quot;targets&quot;: [
        {
          &quot;expr&quot;: &quot;rate(application_beans_created_total[5m])&quot;,
          &quot;legendFormat&quot;: &quot;Bean创建速率&quot;
        }
      ],
      &quot;type&quot;: &quot;graph&quot;
    },
    {
      &quot;title&quot;: &quot;JVM内存使用&quot;,
      &quot;targets&quot;: [
        {
          &quot;expr&quot;: &quot;jvm_memory_used_bytes{area=\&quot;heap\&quot;}&quot;,
          &quot;legendFormat&quot;: &quot;堆内存&quot;
        }
      ],
      &quot;type&quot;: &quot;graph&quot;
    }
  ]
}
</code></pre></div><h2 id="_4-使用springboot开发应用"><a href="#_4-使用springboot开发应用" class="header-anchor">#</a> 4. 使用springboot开发应用</h2> <h3 id="_4-0-项目技巧"><a href="#_4-0-项目技巧" class="header-anchor">#</a> 4.0 项目技巧</h3> <h4 id="include"><a href="#include" class="header-anchor">#</a> include</h4> <p>application.yml</p> <p>application-datasource.yml</p> <div class="language- extra-class"><pre class="language-text"><code>spring:
  profiles:
    #split into multiple profile files
    include: datasource
</code></pre></div><h4 id="multiple-env-dev-prod"><a href="#multiple-env-dev-prod" class="header-anchor">#</a> multiple env: dev prod</h4> <p>application.properties</p> <div class="language- extra-class"><pre class="language-text"><code>spring.profiles.active:@spring.profiles.active@
</code></pre></div><p>application-dev.yml</p> <p>application-prod.yml</p> <div class="language- extra-class"><pre class="language-text"><code>mvn spring-boot:run -Dspring.profiles.active=dev
mvn clean install -Dspring.profiles.active=dev
</code></pre></div><p>~pom.xml(不需要）~</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;profiles&gt;
        &lt;profile&gt;
            &lt;id&gt;dev&lt;/id&gt;
            &lt;properties&gt;
                &lt;myActiveProfile&gt;dev&lt;/myActiveProfile&gt;
            &lt;/properties&gt;
        &lt;/profile&gt;
        &lt;profile&gt;
            &lt;id&gt;prod&lt;/id&gt;
            &lt;properties&gt;
                &lt;myActiveProfile&gt;prod&lt;/myActiveProfile&gt;
            &lt;/properties&gt;
        &lt;/profile&gt;
    &lt;/profiles&gt;
</code></pre></div><h3 id="_4-1-业务开发"><a href="#_4-1-业务开发" class="header-anchor">#</a> 4.1 业务开发</h3> <h4 id="_4-1-1-使用starter"><a href="#_4-1-1-使用starter" class="header-anchor">#</a> 4.1.1 使用starter</h4> <h5 id="pom-depenedency"><a href="#pom-depenedency" class="header-anchor">#</a> POM depenedency</h5> <p>spring boot官方提供了很多现成的starter，可以直接引用其depdendency使用比如
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-starter" target="_blank" rel="noopener noreferrer">starters<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <table><thead><tr><th><code>spring-boot-starter</code></th> <th>Core starter, including auto-configuration support, logging and YAML</th></tr></thead> <tbody><tr><td>spring-boot-starter-web</td> <td>Starter for building web, including RESTful, applications using Spring MVC. Uses Tomcat as the default embedded container</td></tr> <tr><td>spring-boot-starter-jdbc</td> <td>Starter for using JDBC with the HikariCP connection pool</td></tr></tbody></table> <p>但是问题是引用时需要加版本号，很多starter之间以及跟其他的dependency之间可能有版本依赖冲突，
所以官方推荐使用parent方式或者import方式引入某个版本的spring-boot-starter-parent，因为这个parent里面已经定义好了各个版本号，
所以在引用比如spring-boot-starter-web的时候就不需要添加版本号了</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;!-- Inherit defaults from Spring Boot --&gt;
&lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;
&lt;/parent&gt;

&lt;dependencyManagement&gt;
	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;
&lt;/dependencyManagement&gt;

&lt;!--The spring-boot-starter-parent POM includes &lt;executions&gt; configuration to bind the repackage goal.--&gt;
&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;

&lt;!-- Dependence Override 
full list: https://github.com/spring-projects/spring-boot/blob/v2.2.6.RELEASE/spring-boot-project/spring-boot-dependencies/pom.xml
--&gt;
&lt;properties&gt;
    &lt;spring-data-releasetrain.version&gt;Fowler-SR2&lt;/spring-data-releasetrain.version&gt;
&lt;/properties&gt;

</code></pre></div><h5 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h5> <p>默认是 application.properties，也可以使用yaml</p> <p>都在这里：</p> <p>https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html</p> <p>另外一种稍微硬核的通过查阅代码获取的方式：</p> <p>所有的配置都可以在 spring-boot-autoconfigure里面找到，比如</p> <p>org.springframework.boot.autoconfigure.data.redis/RedisProperties</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.redis&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisProperties</span> <span class="token punctuation">{</span>

	<span class="token comment">/**
	 * Database index used by the connection factory.
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">int</span> database <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * Connection URL. Overrides host, port, and password. User is ignored. Example:
	 * redis://user:password@example.com:6379
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>

	<span class="token comment">/**
	 * Redis server host.
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * Login password of the redis server.
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

	<span class="token comment">/**
	 * Redis server port.
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">6379</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * Whether to enable SSL support.
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> ssl<span class="token punctuation">;</span>

	<span class="token comment">/**
	 * Connection timeout.
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">Duration</span> timeout<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">Sentinel</span> sentinel<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">Cluster</span> cluster<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Lettuce</span> lettuce <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lettuce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>database<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDatabase</span><span class="token punctuation">(</span><span class="token keyword">int</span> database<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>database <span class="token operator">=</span> database<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>host<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setHost</span><span class="token punctuation">(</span><span class="token class-name">String</span> host<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>host <span class="token operator">=</span> host<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> password<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>port<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPort</span><span class="token punctuation">(</span><span class="token keyword">int</span> port<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>port <span class="token operator">=</span> port<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSsl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ssl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSsl</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> ssl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>ssl <span class="token operator">=</span> ssl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>timeout <span class="token operator">=</span> timeout<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Duration</span> <span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>timeout<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Sentinel</span> <span class="token function">getSentinel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sentinel<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSentinel</span><span class="token punctuation">(</span><span class="token class-name">Sentinel</span> sentinel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>sentinel <span class="token operator">=</span> sentinel<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Cluster</span> <span class="token function">getCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cluster<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCluster</span><span class="token punctuation">(</span><span class="token class-name">Cluster</span> cluster<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>cluster <span class="token operator">=</span> cluster<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Jedis</span> <span class="token function">getJedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jedis<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Lettuce</span> <span class="token function">getLettuce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lettuce<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * Pool properties.
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Pool</span> <span class="token punctuation">{</span>

		<span class="token comment">/**
		 * Maximum number of &quot;idle&quot; connections in the pool. Use a negative value to
		 * indicate an unlimited number of idle connections.
		 */</span>
		<span class="token keyword">private</span> <span class="token keyword">int</span> maxIdle <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>

		<span class="token comment">/**
		 * Target for the minimum number of idle connections to maintain in the pool. This
		 * setting only has an effect if it is positive.
		 */</span>
		<span class="token keyword">private</span> <span class="token keyword">int</span> minIdle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

		<span class="token comment">/**
		 * Maximum number of connections that can be allocated by the pool at a given
		 * time. Use a negative value for no limit.
		 */</span>
		<span class="token keyword">private</span> <span class="token keyword">int</span> maxActive <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>

		<span class="token comment">/**
		 * Maximum amount of time a connection allocation should block before throwing an
		 * exception when the pool is exhausted. Use a negative value to block
		 * indefinitely.
		 */</span>
		<span class="token keyword">private</span> <span class="token class-name">Duration</span> maxWait <span class="token operator">=</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMaxIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxIdle<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMaxIdle</span><span class="token punctuation">(</span><span class="token keyword">int</span> maxIdle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>maxIdle <span class="token operator">=</span> maxIdle<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMinIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>minIdle<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMinIdle</span><span class="token punctuation">(</span><span class="token keyword">int</span> minIdle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>minIdle <span class="token operator">=</span> minIdle<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getMaxActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxActive<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMaxActive</span><span class="token punctuation">(</span><span class="token keyword">int</span> maxActive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>maxActive <span class="token operator">=</span> maxActive<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token class-name">Duration</span> <span class="token function">getMaxWait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxWait<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMaxWait</span><span class="token punctuation">(</span><span class="token class-name">Duration</span> maxWait<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>maxWait <span class="token operator">=</span> maxWait<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * Cluster properties.
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Cluster</span> <span class="token punctuation">{</span>

		<span class="token comment">/**
		 * Comma-separated list of &quot;host:port&quot; pairs to bootstrap from. This represents an
		 * &quot;initial&quot; list of cluster nodes and is required to have at least one entry.
		 */</span>
		<span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> nodes<span class="token punctuation">;</span>

		<span class="token comment">/**
		 * Maximum number of redirects to follow when executing commands across the
		 * cluster.
		 */</span>
		<span class="token keyword">private</span> <span class="token class-name">Integer</span> maxRedirects<span class="token punctuation">;</span>

		<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nodes<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNodes</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> nodes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>nodes <span class="token operator">=</span> nodes<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getMaxRedirects</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxRedirects<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMaxRedirects</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> maxRedirects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>maxRedirects <span class="token operator">=</span> maxRedirects<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment">/**
	 * Lettuce client properties.
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Lettuce</span> <span class="token punctuation">{</span>

		<span class="token comment">/**
		 * Shutdown timeout.
		 */</span>
		<span class="token keyword">private</span> <span class="token class-name">Duration</span> shutdownTimeout <span class="token operator">=</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">/**
		 * Lettuce pool configuration.
		 */</span>
		<span class="token keyword">private</span> <span class="token class-name">Pool</span> pool<span class="token punctuation">;</span>

		<span class="token keyword">public</span> <span class="token class-name">Duration</span> <span class="token function">getShutdownTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shutdownTimeout<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setShutdownTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span> shutdownTimeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>shutdownTimeout <span class="token operator">=</span> shutdownTimeout<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token class-name">Pool</span> <span class="token function">getPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pool<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPool</span><span class="token punctuation">(</span><span class="token class-name">Pool</span> pool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>pool <span class="token operator">=</span> pool<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>可以看到前缀是 spring.redis ，具体配置举例：</p> <ul><li><p>其中最简单的string类型</p> <div class="language- extra-class"><pre class="language-text"><code>spring.redis.host=x.x.x.48
spring.redis.port=6379
</code></pre></div></li> <li><p>复杂类型如private Cluster cluster，很简单，进去看Cluster的成员即可，只是注意maxRedirects在application.properties写作：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.redis.cluster.nodes=x.x.x.48:6379,x.x.x.48:6380,x.x.x.48:6381,x.x.x.49:6379,x.x.x.49:6380,x.x.x.49:6381,x.x.x.50:6379,x.x.x.50:6380,x.x.x.50:6381
spring.redis.cluster.max-redirects=3
</code></pre></div></li> <li><p>使用yaml</p> <div class="language- extra-class"><pre class="language-text"><code>spring:
  #Redis缓存配置(RedisProperties)
  redis:
#    database: 0
#    host: localhost
#    port: 6380
#    password:
    #timeout: 6000
    #redis cluster
    cluster:
      nodes: 1.1.1.1:6379,1.1.1.1:6380,1.1.1.1:6381
      maxRedirects: 3
    lettuce:
      pool:
        max-active: 200
        max-wait: 3000
        max-idle: -1
        min-idle: 10
</code></pre></div></li></ul> <h6 id="案例分析"><a href="#案例分析" class="header-anchor">#</a> 案例分析：</h6> <p>某次项目使用 spring-boot-starter版本为2.0.5</p> <div class="language- extra-class"><pre class="language-text"><code>    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.0.5.RELEASE&lt;/version&gt;
        &lt;relativePath /&gt;
    &lt;/parent&gt;
</code></pre></div><p>使用其 spring-boot-starter-data-redis 遇到RedisExcpetion 后来没能重现，不过也能重现出类似的WARN级别信息：</p> <p>l.c.c.t.ClusterTopologyRefresh^[[m : Unable to connect to xxxx:6379</p> <p>java.util.concurrent.CompletionException: io.netty.channel.ConnectTimeoutException: connection timed out: /xxxx:6379</p> <p>经过查阅，client端的RedisConnectionFactory需要增加 ClusterTopologyRefreshOptions  这个option，</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisProperties</span> redisProperties<span class="token punctuation">;</span>
 
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${redis.maxRedirects:3}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> maxRedirects<span class="token punctuation">;</span>
 
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${redis.refreshTime:5}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> refreshTime<span class="token punctuation">;</span>
 
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">LettuceConnectionFactory</span> <span class="token function">redisConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 
        <span class="token class-name">RedisClusterConfiguration</span> redisClusterConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisClusterConfiguration</span><span class="token punctuation">(</span>redisProperties<span class="token punctuation">.</span><span class="token function">getCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        redisClusterConfiguration<span class="token punctuation">.</span><span class="token function">setMaxRedirects</span><span class="token punctuation">(</span>maxRedirects<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token operator">/</span> <span class="token operator">/</span> <span class="token class-name">Support</span> adaptive cluster topology refresh and <span class="token keyword">static</span> refresh source
        <span class="token class-name">ClusterTopologyRefreshOptions</span> clusterTopologyRefreshOptions <span class="token operator">=</span>  <span class="token class-name">ClusterTopologyRefreshOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">enablePeriodicRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">enableAllAdaptiveRefreshTriggers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">refreshPeriod</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span>refreshTime<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token class-name">ClusterClientOptions</span> clusterClientOptions <span class="token operator">=</span> <span class="token class-name">ClusterClientOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">topologyRefreshOptions</span><span class="token punctuation">(</span>clusterTopologyRefreshOptions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
                 <span class="token operator">/</span> <span class="token operator">/</span> <span class="token class-name">From</span> the priority<span class="token punctuation">,</span> read and write separation<span class="token punctuation">,</span> read from the possible inconsistency<span class="token punctuation">,</span> the <span class="token keyword">final</span> consistency CP
        <span class="token class-name">LettuceClientConfiguration</span> lettuceClientConfiguration <span class="token operator">=</span> <span class="token class-name">LettuceClientConfiguration</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">readFrom</span><span class="token punctuation">(</span><span class="token class-name">ReadFrom</span><span class="token punctuation">.</span>SLAVE_PREFERRED<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">clientOptions</span><span class="token punctuation">(</span>clusterClientOptions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LettuceConnectionFactory</span><span class="token punctuation">(</span>redisClusterConfiguration<span class="token punctuation">,</span> lettuceClientConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>而实际上为什么这个不提供配置呢，查阅了前面说的官方配置：</p> <p>https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html</p> <p>发现实际有这个选项</p> <div class="language- extra-class"><pre class="language-text"><code>spring.redis.lettuce.cluster.refresh.dynamic-refresh-sources
spring.redis.lettuce.cluster.refresh.period
</code></pre></div><p>而进一步看到第一个config是在spring boot 2.4.0引入的</p> <p>https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.4.0-Configuration-Changelog</p> <p>而第二个period是2.3.0</p> <p>https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.3.0-Configuration-Changelog</p> <p>直接搜源码 ClusterTopologyRefreshOptions 确认下：</p> <p>https://github.com/spring-projects/spring-boot/blob/47516b50c39bd6ea924a1f6720ce6d4a71088651/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/data/redis/LettuceConnectionConfiguration.java</p> <p>点击blame，找到这行</p> <div class="language- extra-class"><pre class="language-text"><code>			if (refreshProperties.getPeriod() != null) {
				refreshBuilder.enablePeriodicRefresh(refreshProperties.getPeriod());
			}
</code></pre></div><p>点击左侧对应的提交：</p> <p>https://github.com/spring-projects/spring-boot/commit/dfac3a282b98bd480c5acf778dbfbce994051dad</p> <p>可以看到这次提交的comment：Add configuration to enable Redis Cluster topology refresh</p> <p>然后从左上角可以看到是从 <a href="https://github.com/spring-projects/spring-boot/releases/tag/v2.3.0.M4" target="_blank" rel="noopener noreferrer">v2.3.0.M4<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 最开始引入的，之后是 v2.3.0.RC1，v2.3.0.RELEASE，直到最新的v2.5.0-RC1</p> <hr> <p>REFERENCE:</p> <p>https://github.com/javastacks/spring-boot-best-practice
https://github.com/YunaiV/SpringBoot-Labs</p> <p><a href="https://mp.weixin.qq.com/s/1yxsCD3IxopIWYceA54Ayw" target="_blank" rel="noopener noreferrer">给你一份超详细 Spring Boot 知识清单<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-starter" target="_blank" rel="noopener noreferrer">一站式starter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-auto-configuration" target="_blank" rel="noopener noreferrer">About AutoConfig<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
Gradually Replacing Auto-configuration
Disabling Specific Auto-configuration Classes
(exclude={DataSourceAutoConfiguration.class})</p> <p>spring boot 中的 Parent POM 和 Starter 的作用什么
https://cloud.tencent.com/developer/article/1362790</p> <p>EnvironmentPostProcessor
BeanPostProcessor</p> <h4 id="_4-1-2-springboot-mvc"><a href="#_4-1-2-springboot-mvc" class="header-anchor">#</a> 4.1.2 springboot mvc</h4> <p>so by default, tomcat will create some temp folder under /tmp and use it later on</p> <p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#spring.servlet.multipart.location" target="_blank" rel="noopener noreferrer"><code>spring.servlet.multipart.location</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>https://stackoverflow.com/questions/50523407/the-temporary-upload-location-tmp-tomcat-4296537502689403143-5000-work-tomcat/50523578</p> <h3 id="_4-2-框架开发-starter"><a href="#_4-2-框架开发-starter" class="header-anchor">#</a> 4.2 框架开发（starter）</h3> <p>ConfigurationProperties和EnableConfigurationProperties是一对，
前者定义对应配置文件的属性，后者是激活读取；
同样，
Configuration或AutoConfiguration跟EnableAutoConfiguration是一对，
前者相当于component就是定义为bean，而后者是激活这个自动配置/装配（具体参考springboot源码分析一文），</p> <p>https://docs.spring.io/spring-boot/docs/1.3.8.RELEASE/reference/html/using-boot-auto-configuration.html</p> <p>Create a Custom Auto-Configuration with Spring Boot</p> <p>https://www.baeldung.com/spring-boot-custom-auto-configuration</p> <p>创建一个starter
hello-spring-boot-starter</p> <div class="language- extra-class"><pre class="language-text"><code>写一个服务类
public class HelloService {

  private String msg;

  public String sayHello() {
    return &quot;hello &quot; + msg;
  }

  public String getMsg() {
    return msg;
  }

  public void setMsg(String msg) {
    this.msg = msg;
  }
}
@ConfigurationProperties(prefix = &quot;hello&quot;) //获取属性值
public class HelloProperties {

  private static final String MSG = &quot;world&quot;;

  private String msg = MSG ;

  public String getMsg() {
    return msg;
  }

  public void setMsg(String msg) {
    this.msg = msg;
  }

}
@Configuration
//为带有@ConfigurationProperties注解的Bean提供有效的支持。
// 这个注解可以提供一种方便的方式来将带有@ConfigurationProperties注解的类注入为Spring容器的Bean。
@EnableConfigurationProperties(HelloProperties.class)//开启属性注入,通过@autowired注入
@ConditionalOnClass(Hello.class)//判断这个类是否在classpath中存在，如果存在，才会实例化一个Bean
// The Hello bean will be created if the hello.enable property exists and has a value other than false
// or the property doesn't exist at all.
@ConditionalOnProperty(prefix=&quot;hello&quot;, value=&quot;enabled&quot;, matchIfMissing = true)
public class HelloAutoConfiguration {

  @Autowired
  private HelloProperties helloProperties;

  @Bean
  @ConditionalOnMissingBean(Hello.class)//容器中如果没有Hello这个类,那么自动配置这个Hello
  public HelloService hello() {
    HelloService hello = new HelloService();
    hello.setMsg(helloProperties.getMsg());
    return hello;
  }

}

application.properties
\#可以不配置
hello.enabled=true

hello.msg=charmingfst

\#以debug模式运行
debug=true

\src\main\resources\META-INF\spring.factories
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.chm.test.HelloAutoConfiguration

https://blog.csdn.net/zxc123e/article/details/80222967
</code></pre></div><h3 id="_4-3-aop切面编程"><a href="#_4-3-aop切面编程" class="header-anchor">#</a> 4.3 AOP切面编程</h3> <p>Aspect（切面）横切关注点的模块化 @Aspect注解的类</p> <p>Join Point（连接点）程序执行过程中的点 方法调用、异常抛出</p> <p>Pointcut（切点）匹配连接点的表达式 execution(* UserService.*(..))</p> <p>Advice（通知）在连接点执行的动作 @Before, @After, @Around</p> <p>Target（目标）被代理的对象 UserService实例</p> <p>Proxy（代理）AOP创建的包装对象 CGLIB或JDK动态代理</p> <p>Weaving（织入）将切面应用到目标对象的过程 编译期、类加载期、运行期</p> <h4 id="什么是aop"><a href="#什么是aop" class="header-anchor">#</a> 什么是AOP</h4> <p>传统OOP的问题：</p> <div class="language- extra-class"><pre class="language-text"><code>// 业务类中混杂着横切关注点
public class UserService {
    public void createUser(User user) {
        // 事务开始
        Transaction tx = beginTransaction();
        try {
            // 权限检查
            checkPermission();
            
            // 日志记录
            log.info(&quot;创建用户: {}&quot;, user.getName());
            
            // 业务逻辑
            userDao.save(user);
            
            // 事务提交
            tx.commit();
        } catch (Exception e) {
            // 事务回滚
            tx.rollback();
            // 错误日志
            log.error(&quot;创建用户失败&quot;, e);
            throw e;
        }
    }
}
</code></pre></div><p>AOP解决方案：</p> <div class="language- extra-class"><pre class="language-text"><code>// 纯净的业务逻辑
public class UserService {
    public void createUser(User user) {
        userDao.save(user); // 只关注业务逻辑
    }
}

// 横切关注点通过AOP处理
@Aspect
@Component
public class TransactionAspect {
    @Around(&quot;execution(* UserService.*(..))&quot;)
    public Object manageTransaction(ProceedingJoinPoint pjp) {
        // 事务管理逻辑在这里统一处理
    }
}
</code></pre></div><h4 id="spring-aop实现机制-spring-boot-starter-aop"><a href="#spring-aop实现机制-spring-boot-starter-aop" class="header-anchor">#</a> Spring AOP实现机制-spring-boot-starter-aop</h4> <div class="language- extra-class"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;
&lt;/dependency&gt;

// 对于每个Bean：
1. Bean正常实例化、依赖注入、初始化
2. AnnotationAwareAspectJAutoProxyCreator.postProcessAfterInitialization()被调用
3. 检查Bean是否需要AOP代理
4. 如果需要，创建JDK动态代理或CGLIB代理
5. 返回代理对象（替代原始Bean）

// Spring框架真实的AOP代理创建类结构：
Object
└── BeanPostProcessor (接口)
    └── InstantiationAwareBeanPostProcessor (接口)  
        └── SmartInstantiationAwareBeanPostProcessor (接口)
            └── AbstractAutoProxyCreator (抽象类) ← 核心实现
                └── AspectJAwareAdvisorAutoProxyCreator (抽象类)
                    └── AnnotationAwareAspectJAutoProxyCreator (具体类) ← 实际工作的类！
</code></pre></div><p>这是Spring AOP的核心引擎</p> <div class="language- extra-class"><pre class="language-text"><code>// 真实的Spring源码（简化版）
public abstract class AbstractAutoProxyCreator extends ProxyProcessorSupport
    implements SmartInstantiationAwareBeanPostProcessor {
    
    // 核心方法：在Bean初始化后创建代理
    @Override
    public Object postProcessAfterInitialization(@Nullable Object bean, String beanName) {
        if (bean != null) {
            Object cacheKey = getCacheKey(bean.getClass(), beanName);
            
            // 检查是否已经处理过（避免循环）
            if (!this.earlyProxyReferences.contains(cacheKey)) {
                // 包装Bean（如果需要代理）
                return wrapIfNecessary(bean, beanName, cacheKey);
            }
        }
        return bean;
    }
    
    // 核心方法：决定是否创建代理
    protected Object wrapIfNecessary(Object bean, String beanName, Object cacheKey) {
        // 1. 检查是否应该跳过代理
        if (isInfrastructureClass(bean.getClass()) || shouldSkip(bean, beanName)) {
            return bean;
        }
        
        // 2. 获取适用的Advisors（切面逻辑）
        Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(bean.getClass(), beanName, null);
        
        // 3. 如果需要代理，创建代理对象
        if (specificInterceptors != DO_NOT_PROXY) {
            this.advisedBeans.put(cacheKey, Boolean.TRUE);
            return createProxy(bean.getClass(), beanName, specificInterceptors, new SingletonTargetSource(bean));
        }
        
        return bean;
    }
}
</code></pre></div><p>这是Spring Boot默认使用的具体实现</p> <div class="language- extra-class"><pre class="language-text"><code>// 真实的Spring Boot AOP处理器
public class AnnotationAwareAspectJAutoProxyCreator extends AspectJAwareAdvisorAutoProxyCreator {
    
    // 重写方法：支持@AspectJ注解风格的切面
    @Override
    protected List&lt;Advisor&gt; findCandidateAdvisors() {
        // 调用父类方法查找基于配置的Advisor
        List&lt;Advisor&gt; advisors = super.findCandidateAdvisors();
        
        // 添加基于@Aspect注解的Advisor
        if (this.aspectJAdvisorsBuilder != null) {
            advisors.addAll(this.aspectJAdvisorsBuilder.buildAspectJAdvisors());
        }
        return advisors;
    }
    
    // 重写方法：支持JDK动态代理和CGLIB代理
    @Override
    protected boolean shouldProxyTargetClass(ConfigurableListableBeanFactory beanFactory, String beanName) {
        // 检查@EnableAspectJAutoProxy配置
        return (this.beanFactory != null &amp;&amp; 
                this.beanFactory.getBeanDefinition(beanName).isProxyTargetClass());
    }
}
</code></pre></div><h4 id="示例1-性能监控aop"><a href="#示例1-性能监控aop" class="header-anchor">#</a> 示例1：性能监控AOP</h4> <div class="language- extra-class"><pre class="language-text"><code>@Aspect
@Component
public class PerformanceMonitoringAspect {
    private static final Logger logger = LoggerFactory.getLogger(PerformanceMonitoringAspect.class);
    
    // 监控Service层方法性能
    @Around(&quot;execution(* com.example.service.*.*(..))&quot;)
    public Object monitorPerformance(ProceedingJoinPoint joinPoint) throws Throwable {
        String methodName = joinPoint.getSignature().getName();
        String className = joinPoint.getTarget().getClass().getSimpleName();
        
        long startTime = System.currentTimeMillis();
        try {
            // 执行原始方法
            Object result = joinPoint.proceed();
            long executionTime = System.currentTimeMillis() - startTime;
            
            // 记录性能指标
            if (executionTime &gt; 100) { // 超过100ms记录警告
                logger.warn(&quot;方法执行缓慢: {}.{}, 耗时: {}ms&quot;, 
                    className, methodName, executionTime);
            }
            
            // 记录到监控系统
            Metrics.timer(&quot;service.method.duration&quot;)
                .tag(&quot;class&quot;, className)
                .tag(&quot;method&quot;, methodName)
                .record(executionTime, TimeUnit.MILLISECONDS);
            
            return result;
            
        } catch (Exception e) {
            long executionTime = System.currentTimeMillis() - startTime;
            logger.error(&quot;方法执行异常: {}.{}, 耗时: {}ms&quot;, 
                className, methodName, executionTime, e);
            throw e;
        }
    }
}
</code></pre></div><h4 id="示例2-事务管理aop"><a href="#示例2-事务管理aop" class="header-anchor">#</a> 示例2：事务管理AOP</h4> <div class="language- extra-class"><pre class="language-text"><code>@Aspect
@Component
public class TransactionAspect {
    
    @Autowired
    private PlatformTransactionManager transactionManager;
    
    // 为所有@Transactional方法添加事务管理
    @Around(&quot;@annotation(transactional)&quot;)
    public Object manageTransaction(ProceedingJoinPoint joinPoint, 
                                   Transactional transactional) throws Throwable {
        
        TransactionDefinition definition = new DefaultTransactionDefinition();
        TransactionStatus status = transactionManager.getTransaction(definition);
        
        try {
            logger.debug(&quot;开始事务: {}&quot;, joinPoint.getSignature());
            
            // 执行业务方法
            Object result = joinPoint.proceed();
            
            // 提交事务
            transactionManager.commit(status);
            logger.debug(&quot;提交事务: {}&quot;, joinPoint.getSignature());
            
            return result;
            
        } catch (Exception e) {
            // 回滚事务
            transactionManager.rollback(status);
            logger.debug(&quot;回滚事务: {}, 原因: {}&quot;, joinPoint.getSignature(), e.getMessage());
            throw e;
        }
    }
    
    // 使用示例
    @Service
    public class UserService {
        @Transactional
        public void createUser(User user) {
            // 业务逻辑，自动享有事务管理
            userRepository.save(user);
            userAuditRepository.logCreation(user);
        }
    }
}
</code></pre></div><h4 id="示例3-缓存aop"><a href="#示例3-缓存aop" class="header-anchor">#</a> 示例3：缓存AOP</h4> <div class="language- extra-class"><pre class="language-text"><code>@Aspect
@Component
public class CacheAspect {
    
    @Autowired
    private CacheManager cacheManager;
    
    // 方法缓存
    @Around(&quot;@annotation(cacheable)&quot;)
    public Object handleCacheable(ProceedingJoinPoint joinPoint, 
                                Cacheable cacheable) throws Throwable {
        
        String cacheName = cacheable.value();
        String key = generateCacheKey(joinPoint);
        
        Cache cache = cacheManager.getCache(cacheName);
        ValueWrapper cachedValue = cache.get(key);
        
        if (cachedValue != null) {
            logger.debug(&quot;缓存命中: {}.{}&quot;, 
                joinPoint.getTarget().getClass().getSimpleName(),
                joinPoint.getSignature().getName());
            return cachedValue.get();
        }
        
        // 缓存未命中，执行方法
        Object result = joinPoint.proceed();
        
        // 缓存结果
        cache.put(key, result);
        logger.debug(&quot;缓存设置: {}.{}&quot;, 
            joinPoint.getTarget().getClass().getSimpleName(),
            joinPoint.getSignature().getName());
        
        return result;
    }
    
    // 缓存失效
    @After(&quot;@annotation(cacheEvict)&quot;)
    public void handleCacheEvict(JoinPoint joinPoint, CacheEvict cacheEvict) {
        String cacheName = cacheEvict.value();
        Cache cache = cacheManager.getCache(cacheName);
        
        if (cacheEvict.allEntries()) {
            cache.clear(); // 清空整个缓存
        } else {
            String key = generateCacheKey(joinPoint);
            cache.evict(key); // 清除特定key
        }
    }
    
    private String generateCacheKey(ProceedingJoinPoint joinPoint) {
        // 基于方法签名和参数生成缓存key
        return joinPoint.getSignature().toShortString() + 
               Arrays.toString(joinPoint.getArgs());
    }
}
</code></pre></div><h4 id="示例4-安全权限aop"><a href="#示例4-安全权限aop" class="header-anchor">#</a> 示例4：安全权限AOP</h4> <div class="language- extra-class"><pre class="language-text"><code>@Aspect
@Component
public class SecurityAspect {
    
    @Autowired
    private AuthenticationService authService;
    
    // 方法级权限控制
    @Around(&quot;@annotation(requiresPermission)&quot;)
    public Object checkPermission(ProceedingJoinPoint joinPoint,
                                RequiresPermission requiresPermission) throws Throwable {
        
        String permission = requiresPermission.value();
        User currentUser = authService.getCurrentUser();
        
        if (!authService.hasPermission(currentUser, permission)) {
            throw new AccessDeniedException(
                &quot;用户 &quot; + currentUser.getUsername() + &quot; 没有权限: &quot; + permission);
        }
        
        logger.info(&quot;权限检查通过: {} 执行 {}.{}&quot;, 
            currentUser.getUsername(),
            joinPoint.getTarget().getClass().getSimpleName(),
            joinPoint.getSignature().getName());
        
        return joinPoint.proceed();
    }
    
    // 参数级权限控制
    @Before(&quot;execution(* delete*(..)) &amp;&amp; args(id,..)&quot;)
    public void checkDeletePermission(JoinPoint joinPoint, Long id) {
        User currentUser = authService.getCurrentUser();
        if (!authService.canDelete(currentUser, id)) {
            throw new AccessDeniedException(&quot;无权删除资源: &quot; + id);
        }
    }
}
</code></pre></div><h4 id="示例5-日志记录aop"><a href="#示例5-日志记录aop" class="header-anchor">#</a> 示例5：日志记录AOP</h4> <div class="language- extra-class"><pre class="language-text"><code>@Aspect
@Component
public class LoggingAspect {
    
    // 方法调用日志
    @Before(&quot;execution(* com.example.controller.*.*(..))&quot;)
    public void logMethodEntry(JoinPoint joinPoint) {
        logger.info(&quot;→ 进入方法: {}.{}&quot;, 
            joinPoint.getTarget().getClass().getSimpleName(),
            joinPoint.getSignature().getName());
        
        if (logger.isDebugEnabled()) {
            logger.debug(&quot;方法参数: {}&quot;, Arrays.toString(joinPoint.getArgs()));
        }
    }
    
    // 方法退出日志
    @AfterReturning(pointcut = &quot;execution(* com.example.controller.*.*(..))&quot;, 
                   returning = &quot;result&quot;)
    public void logMethodExit(JoinPoint joinPoint, Object result) {
        logger.info(&quot;← 退出方法: {}.{}&quot;, 
            joinPoint.getTarget().getClass().getSimpleName(),
            joinPoint.getSignature().getName());
        
        if (logger.isDebugEnabled() &amp;&amp; result != null) {
            logger.debug(&quot;方法返回值: {}&quot;, result.toString());
        }
    }
    
    // 异常日志
    @AfterThrowing(pointcut = &quot;execution(* com.example..*.*(..))&quot;, 
                  throwing = &quot;ex&quot;)
    public void logException(JoinPoint joinPoint, Exception ex) {
        logger.error(&quot;✗ 方法执行异常: {}.{}&quot;, 
            joinPoint.getTarget().getClass().getSimpleName(),
            joinPoint.getSignature().getName(), ex);
    }
}
</code></pre></div><h4 id="aop最佳实践"><a href="#aop最佳实践" class="header-anchor">#</a> AOP最佳实践</h4> <ol><li>切点表达式优化</li></ol> <div class="language- extra-class"><pre class="language-text"><code>@Aspect
@Component
public class OptimizedPointcutAspect {
    
    // 不好的写法：过于宽泛
    // @Around(&quot;execution(* com.example..*(..))&quot;)
    
    // 好的写法：精确匹配
    @Around(&quot;execution(* com.example.service.*Service.*(..))&quot;)
    public Object serviceLayerMonitoring(ProceedingJoinPoint pjp) throws Throwable {
        // 只监控Service层
        return pjp.proceed();
    }
    
    // 使用注解驱动更精确
    @Around(&quot;@annotation(com.example.annotation.Monitored)&quot;)
    public Object monitoredMethods(ProceedingJoinPoint pjp) throws Throwable {
        // 只监控有@Monitored注解的方法
        return pjp.proceed();
    }
}
</code></pre></div><ol start="2"><li>性能考虑</li></ol> <div class="language- extra-class"><pre class="language-text"><code>@Aspect
@Component
public class PerformanceOptimizedAspect {
    
    // 避免在切面中执行耗时操作
    @Around(&quot;execution(* com.example..*(..))&quot;)
    public Object optimizedAdvice(ProceedingJoinPoint pjp) throws Throwable {
        // 不好的做法：每次都生成复杂日志
        // String detailedLog = createDetailedLog(pjp); // 耗时操作
        
        // 好的做法：延迟计算
        if (logger.isDebugEnabled()) {
            logger.debug(&quot;执行方法: {}&quot;, pjp.getSignature());
        }
        
        return pjp.proceed();
    }
}
</code></pre></div><h2 id="_5-spring-boot启动优化"><a href="#_5-spring-boot启动优化" class="header-anchor">#</a> 5. Spring Boot启动优化</h2> <p>启动性能监控和分析</p> <p>使用Spring Boot Actuator监控启动时间</p> <div class="language- extra-class"><pre class="language-text"><code># application.yml
management:
  endpoints:
    web:
      exposure:
        include: startup
  endpoint:
    startup:
      enabled: true

spring:
  application:
    name: myapp

// 启动时间监控端点
@RestController
public class StartupMetricsController {
    
    @Autowired
    private ApplicationStartup startup;
    
    @GetMapping(&quot;/startup-metrics&quot;)
    public StartupMetrics getStartupMetrics() {
        return startup.getMetrics();
    }
}

// 启动时间分析结果示例
public class StartupAnalysis {
    public void analyzeStartupTime() {
        System.out.println(&quot;启动阶段耗时分析:&quot;);
        System.out.println(&quot;JVM启动: 0.8秒&quot;);
        System.out.println(&quot;组件扫描: 4.2秒 (51%) ← 优化重点!&quot;);
        System.out.println(&quot;Bean实例化: 2.1秒 (26%)&quot;);
        System.out.println(&quot;自动配置: 1.1秒 (13%)&quot;);
        System.out.println(&quot;服务器启动: 0.3秒 (4%)&quot;);
        System.out.println(&quot;总启动时间: 8.5秒&quot;);
    }
}
</code></pre></div><p>使用JVM参数优化启动性能</p> <div class="language- extra-class"><pre class="language-text"><code># 优化启动速度的JVM参数
java -jar myapp.jar \
  -Xms512m -Xmx512m \          # 固定堆大小，避免动态调整
  -XX:+UseG1GC \               # 使用G1垃圾回收器
  -XX:MaxGCPauseMillis=200 \   # 控制GC停顿时间
  -noverify \                  # 关闭字节码验证（开发环境）
  -Dspring.jmx.enabled=false \ # 关闭JMX监控
  -Dspring.main.lazy-initialization=true \ # 启用懒加载
  -Dspring.context.index.enabled=true      # 启用类路径索引
</code></pre></div><p>案例1：减少组件扫描范围</p> <div class="language- extra-class"><pre class="language-text"><code>优化前（扫描整个包路径）：
@SpringBootApplication
@ComponentScan(&quot;com.example&quot;)  // 扫描整个项目包
public class MyApplication {
    // 启动时间: 8.2秒（扫描2000个类）
}

优化后（精确扫描必要包）：
@SpringBootApplication
@ComponentScan({
    &quot;com.example.controller&quot;,
    &quot;com.example.service&quot;, 
    &quot;com.example.config&quot;
    // 不扫描: com.example.entity, com.example.dto等
})
public class MyApplication {
    // 启动时间: 3.1秒（只扫描500个类）
}
</code></pre></div><p>案例2：使用懒加载优化</p> <div class="language- extra-class"><pre class="language-text"><code>优化前（所有Bean立即加载）：
@Service
public class HeavyService {
    // 启动时立即初始化，耗时2秒
    public HeavyService() {
        loadLargeDataSet();  // 耗时的初始化操作
    }
}
优化后（按需懒加载）：
@Service
@Lazy  // 添加懒加载注解
public class HeavyService {
    // 第一次使用时才初始化
    public HeavyService() {
        loadLargeDataSet();
    }
}

@RestController
public class MyController {
    @Autowired
    private HeavyService heavyService;  // 启动时不初始化
    
    @GetMapping(&quot;/data&quot;)
    public Data getData() {
        // 第一次调用时才初始化HeavyService
        return heavyService.processData();
    }
}

</code></pre></div><p>案例3：排除不必要的自动配置</p> <div class="language- extra-class"><pre class="language-text"><code>优化前（加载所有自动配置）：
@SpringBootApplication  // 默认加载100+个自动配置
public class MyApplication {
    // 启动时间: 6.5秒
}

优化后（排除不需要的配置）：
@SpringBootApplication(exclude = {
    DataSourceAutoConfiguration.class,      // 不使用数据库
    SecurityAutoConfiguration.class,        // 不需要安全配置
    MailSenderAutoConfiguration.class,     // 不需要邮件发送
    CacheAutoConfiguration.class           // 不使用缓存
})
public class MyApplication {
    // 启动时间: 3.8秒
}

</code></pre></div><p>案例4：类路径索引优化</p> <div class="language- extra-class"><pre class="language-text"><code>优化前（类路径扫描）：
// Maven依赖包含大量不需要的jar
&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt; &lt;!-- 不用数据库 --&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;  
        &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt; &lt;!-- 不用安全 --&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;

优化后（精简依赖）：
// 只引入必要的starter
&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;!-- 移除不必要的starter --&gt;
&lt;/dependencies&gt;

// 添加类路径索引（Spring 5.2+）
spring:
  context:
    index:
      enabled: true  # 启用编译时类路径索引
</code></pre></div><p>案例5：使用Spring Fu进行函数式配置</p> <div class="language- extra-class"><pre class="language-text"><code>传统配置方式：
@Configuration
public class TraditionalConfig {
    @Bean
    public MyService myService() {
        return new MyService();  // 反射创建，性能一般
    }
}

函数式配置（Spring Fu）：
public class FunctionalConfig {
    public static void main(String[] args) {
        var app = new SpringApplication(Application.class)
            .run(args);
        
        // 函数式注册Bean，避免反射开销
        app.addInitializer((context) -&gt; {
            context.registerBean(MyService.class, 
                () -&gt; new MyService());  // 直接lambda创建
        });
    }
}
</code></pre></div><p>案例6：编译时处理优化</p> <div class="language- extra-class"><pre class="language-text"><code>使用Micronaut或Quarkus的编译时处理：
// Quarkus示例：编译时处理依赖注入
@ApplicationScoped
public class MyService {
    @Inject
    MyRepository repository;  // 编译时生成注入代码，避免运行时反射
}


</code></pre></div><h2 id="_6-troubleshooting"><a href="#_6-troubleshooting" class="header-anchor">#</a> 6. Troubleshooting</h2> <h3 id="beandefinitionoverrideexception"><a href="#beandefinitionoverrideexception" class="header-anchor">#</a> BeanDefinitionOverrideException</h3> <p>https://www.baeldung.com/spring-boot-bean-definition-override-exception</p> <h3 id="beancurrentlyincreationexception-circular-reference"><a href="#beancurrentlyincreationexception-circular-reference" class="header-anchor">#</a> BeanCurrentlyInCreationException/circular reference</h3> <p>Caused by: org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'AAAA': Bean with name 'AAAA' has been injected into other beans [BBBB] in its raw version as part of a circular reference, but has eventually been wrapped. This means that said other beans do not use the final version of the bean. This is often the result of over-eager type matching - consider using 'getBeanNamesForType' with the 'allowEagerInit' flag turned off, for example.</p> <p>解决：加@Lazy</p> <h3 id="nohup-ignoring-input-no-main-manifest-attribute"><a href="#nohup-ignoring-input-no-main-manifest-attribute" class="header-anchor">#</a> nohup: ignoring input no main manifest attribute</h3> <div class="language- extra-class"><pre class="language-text"><code>执行 
nohup java -server -jar test.jar &gt; `date +\%F`_funding-rate-datasource_`date +\%H.%M.%S`.log 2&gt;&amp;1
log中内容为：
nohup: ignoring input no main manifest attribute
解决方法，pom增加：
&lt;build&gt;
        &lt;finalName&gt;funding-rate-datasource&lt;/finalName&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;attach&gt;true&lt;/attach&gt;
                &lt;/configuration&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;compile&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;jar&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
            &lt;!-- package --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;fork&gt;true&lt;/fork&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;!-- deploy --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-deploy-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;skip&gt;true&lt;/skip&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
</code></pre></div><hr> <p>ref:</p> <p>@bean方法调用的特殊性：</p> <p>https://www.racecoder.com/archives/787/</p> <p>https://stackoverflow.com/questions/27990060/calling-a-bean-annotated-method-in-spring-java-configuration</p> <p><a href="https://blog.csdn.net/TheLudlows/article/details/81360067" target="_blank" rel="noopener noreferrer">Spring Boot 2.0 ：深入分析Spring Boot原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>spring boot之自动装配（spring-boot-autoconfigure） https://blog.csdn.net/wangjie5540/article/details/99542777</p> <p>原创 | 我被面试官给虐懵了，竟然是因为我不懂Spring中的@Configuration
https://juejin.im/post/5d005860f265da1b7f297630</p> <p>https://blog.csdn.net/yiifaa/java/article/details/74852425
https://www.huaweicloud.com/articles/b59be8ffdcfbd1f8a1fe28bffe848d20.html
https://www.cnblogs.com/wuchanming/p/5426746.html
https://stackoverflow.com/questions/39890849/what-exactly-is-field-injection-and-how-to-avoid-it</p> <p>https://medium.com/@ilyailin7777/all-dependency-injection-types-spring-336da7baf51b</p> <p>SpringBoot常见异步编程 https://mp.weixin.qq.com/s/Z-GE_qBtnSgLQTVr9bQYcQ</p> <div id="disqus_thread"></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.9414df7f.js" defer></script><script src="/docs/assets/js/2.4a937564.js" defer></script><script src="/docs/assets/js/399.f2abe701.js" defer></script><script src="/docs/assets/js/8.3332a15d.js" defer></script>
  </body>
</html>
