<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>计算机基础教程</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script async="true" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9742852210287449" crossorigin="anonymous"></script>
    <script>
			(function() { // DON'T EDIT BELOW THIS LINE
			
			})();
		 </script>
    <meta name="description" content="软件开发教程，白帽黑客入门教程，区块链入门教程，物联网，大数据">
    
    <link rel="preload" href="/docs/assets/css/0.styles.d4eb5ad8.css" as="style"><link rel="preload" href="/docs/assets/js/app.a8326da5.js" as="script"><link rel="preload" href="/docs/assets/js/2.95eca7e9.js" as="script"><link rel="preload" href="/docs/assets/js/156.0493c8d9.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.7f093658.js"><link rel="prefetch" href="/docs/assets/js/100.3ba5506f.js"><link rel="prefetch" href="/docs/assets/js/101.3d93217d.js"><link rel="prefetch" href="/docs/assets/js/102.57b0a5a0.js"><link rel="prefetch" href="/docs/assets/js/103.7464326f.js"><link rel="prefetch" href="/docs/assets/js/104.05b4e0c6.js"><link rel="prefetch" href="/docs/assets/js/105.d31f69dd.js"><link rel="prefetch" href="/docs/assets/js/106.1d36c448.js"><link rel="prefetch" href="/docs/assets/js/107.893f351a.js"><link rel="prefetch" href="/docs/assets/js/108.7e01ac9a.js"><link rel="prefetch" href="/docs/assets/js/109.1c4dec9c.js"><link rel="prefetch" href="/docs/assets/js/11.59bb086b.js"><link rel="prefetch" href="/docs/assets/js/110.98d8440c.js"><link rel="prefetch" href="/docs/assets/js/111.138e0d4d.js"><link rel="prefetch" href="/docs/assets/js/112.9b2449fb.js"><link rel="prefetch" href="/docs/assets/js/113.ca2af639.js"><link rel="prefetch" href="/docs/assets/js/114.73307931.js"><link rel="prefetch" href="/docs/assets/js/115.613a1547.js"><link rel="prefetch" href="/docs/assets/js/116.1fe48a6f.js"><link rel="prefetch" href="/docs/assets/js/117.6c02a873.js"><link rel="prefetch" href="/docs/assets/js/118.ef4f030e.js"><link rel="prefetch" href="/docs/assets/js/119.a0326e2d.js"><link rel="prefetch" href="/docs/assets/js/12.2309e2c5.js"><link rel="prefetch" href="/docs/assets/js/120.a4e6b27d.js"><link rel="prefetch" href="/docs/assets/js/121.1610e379.js"><link rel="prefetch" href="/docs/assets/js/122.c280bf94.js"><link rel="prefetch" href="/docs/assets/js/123.2d4b183e.js"><link rel="prefetch" href="/docs/assets/js/124.1e3e152d.js"><link rel="prefetch" href="/docs/assets/js/125.4acf0747.js"><link rel="prefetch" href="/docs/assets/js/126.4824945e.js"><link rel="prefetch" href="/docs/assets/js/127.f5f52f98.js"><link rel="prefetch" href="/docs/assets/js/128.84cbbc09.js"><link rel="prefetch" href="/docs/assets/js/129.f7586a67.js"><link rel="prefetch" href="/docs/assets/js/13.3dbcff41.js"><link rel="prefetch" href="/docs/assets/js/130.dd21dffa.js"><link rel="prefetch" href="/docs/assets/js/131.35be19b2.js"><link rel="prefetch" href="/docs/assets/js/132.82e8d73e.js"><link rel="prefetch" href="/docs/assets/js/133.df62d5c2.js"><link rel="prefetch" href="/docs/assets/js/134.e2c62181.js"><link rel="prefetch" href="/docs/assets/js/135.5ccf0d9e.js"><link rel="prefetch" href="/docs/assets/js/136.9fb43ea7.js"><link rel="prefetch" href="/docs/assets/js/137.05a43b89.js"><link rel="prefetch" href="/docs/assets/js/138.11d9d712.js"><link rel="prefetch" href="/docs/assets/js/139.a7df2ff8.js"><link rel="prefetch" href="/docs/assets/js/14.e9bd8ebe.js"><link rel="prefetch" href="/docs/assets/js/140.0eef7f1f.js"><link rel="prefetch" href="/docs/assets/js/141.f739a9eb.js"><link rel="prefetch" href="/docs/assets/js/142.97c44f8f.js"><link rel="prefetch" href="/docs/assets/js/143.e7adbd4a.js"><link rel="prefetch" href="/docs/assets/js/144.68adfe0d.js"><link rel="prefetch" href="/docs/assets/js/145.3145cf0c.js"><link rel="prefetch" href="/docs/assets/js/146.74f04ae2.js"><link rel="prefetch" href="/docs/assets/js/147.4262282f.js"><link rel="prefetch" href="/docs/assets/js/148.13416a58.js"><link rel="prefetch" href="/docs/assets/js/149.35faf6fa.js"><link rel="prefetch" href="/docs/assets/js/15.684254f9.js"><link rel="prefetch" href="/docs/assets/js/150.a0181dcb.js"><link rel="prefetch" href="/docs/assets/js/151.d09d07d9.js"><link rel="prefetch" href="/docs/assets/js/152.d5a7eae9.js"><link rel="prefetch" href="/docs/assets/js/153.14cfa8ed.js"><link rel="prefetch" href="/docs/assets/js/154.ad90aaa3.js"><link rel="prefetch" href="/docs/assets/js/155.aa1f6f11.js"><link rel="prefetch" href="/docs/assets/js/157.9fdc5ad9.js"><link rel="prefetch" href="/docs/assets/js/158.a8d17fc0.js"><link rel="prefetch" href="/docs/assets/js/159.867f6fd2.js"><link rel="prefetch" href="/docs/assets/js/16.f738b282.js"><link rel="prefetch" href="/docs/assets/js/160.1bb8b779.js"><link rel="prefetch" href="/docs/assets/js/161.3d5d588b.js"><link rel="prefetch" href="/docs/assets/js/162.f4d89da5.js"><link rel="prefetch" href="/docs/assets/js/163.4b8c4df8.js"><link rel="prefetch" href="/docs/assets/js/164.64007985.js"><link rel="prefetch" href="/docs/assets/js/165.34db3636.js"><link rel="prefetch" href="/docs/assets/js/166.f6d37e89.js"><link rel="prefetch" href="/docs/assets/js/167.a949ba9e.js"><link rel="prefetch" href="/docs/assets/js/168.89c003f6.js"><link rel="prefetch" href="/docs/assets/js/169.f449daee.js"><link rel="prefetch" href="/docs/assets/js/17.32945a33.js"><link rel="prefetch" href="/docs/assets/js/170.92c4fa62.js"><link rel="prefetch" href="/docs/assets/js/171.9f47335c.js"><link rel="prefetch" href="/docs/assets/js/172.5eefb8d5.js"><link rel="prefetch" href="/docs/assets/js/173.ff28ef46.js"><link rel="prefetch" href="/docs/assets/js/174.6a8ceee8.js"><link rel="prefetch" href="/docs/assets/js/175.493e990f.js"><link rel="prefetch" href="/docs/assets/js/176.579768df.js"><link rel="prefetch" href="/docs/assets/js/177.36e4cca3.js"><link rel="prefetch" href="/docs/assets/js/178.ecd582a1.js"><link rel="prefetch" href="/docs/assets/js/179.bddeaf93.js"><link rel="prefetch" href="/docs/assets/js/18.d53cfe99.js"><link rel="prefetch" href="/docs/assets/js/180.40af6a88.js"><link rel="prefetch" href="/docs/assets/js/181.9c2d0313.js"><link rel="prefetch" href="/docs/assets/js/182.4e6b8848.js"><link rel="prefetch" href="/docs/assets/js/183.062fb114.js"><link rel="prefetch" href="/docs/assets/js/184.0ca3c1e0.js"><link rel="prefetch" href="/docs/assets/js/185.0914490e.js"><link rel="prefetch" href="/docs/assets/js/186.6abcc7ac.js"><link rel="prefetch" href="/docs/assets/js/187.906f6715.js"><link rel="prefetch" href="/docs/assets/js/188.ab43641f.js"><link rel="prefetch" href="/docs/assets/js/189.d0deedec.js"><link rel="prefetch" href="/docs/assets/js/19.84cddbf5.js"><link rel="prefetch" href="/docs/assets/js/190.fb9635a7.js"><link rel="prefetch" href="/docs/assets/js/191.66c784e9.js"><link rel="prefetch" href="/docs/assets/js/192.356e555f.js"><link rel="prefetch" href="/docs/assets/js/193.8b78bb82.js"><link rel="prefetch" href="/docs/assets/js/194.91997a4c.js"><link rel="prefetch" href="/docs/assets/js/195.abf797be.js"><link rel="prefetch" href="/docs/assets/js/196.71768e6c.js"><link rel="prefetch" href="/docs/assets/js/197.05d4affa.js"><link rel="prefetch" href="/docs/assets/js/198.8b223ce5.js"><link rel="prefetch" href="/docs/assets/js/199.6f7d6368.js"><link rel="prefetch" href="/docs/assets/js/20.fddf6a74.js"><link rel="prefetch" href="/docs/assets/js/200.3b7690f0.js"><link rel="prefetch" href="/docs/assets/js/201.3be4ea04.js"><link rel="prefetch" href="/docs/assets/js/202.f712539e.js"><link rel="prefetch" href="/docs/assets/js/203.55a39736.js"><link rel="prefetch" href="/docs/assets/js/204.154f0bc0.js"><link rel="prefetch" href="/docs/assets/js/205.54789726.js"><link rel="prefetch" href="/docs/assets/js/206.429a2b2f.js"><link rel="prefetch" href="/docs/assets/js/207.1aa240d0.js"><link rel="prefetch" href="/docs/assets/js/208.fe84d63b.js"><link rel="prefetch" href="/docs/assets/js/209.0032c3cc.js"><link rel="prefetch" href="/docs/assets/js/21.bb9370f2.js"><link rel="prefetch" href="/docs/assets/js/210.188d1d89.js"><link rel="prefetch" href="/docs/assets/js/211.fc366b61.js"><link rel="prefetch" href="/docs/assets/js/212.754f5778.js"><link rel="prefetch" href="/docs/assets/js/213.2b9ed67d.js"><link rel="prefetch" href="/docs/assets/js/214.ebce51b4.js"><link rel="prefetch" href="/docs/assets/js/215.50c1fa2f.js"><link rel="prefetch" href="/docs/assets/js/216.f79d9995.js"><link rel="prefetch" href="/docs/assets/js/217.46de850d.js"><link rel="prefetch" href="/docs/assets/js/218.ca8eaaf8.js"><link rel="prefetch" href="/docs/assets/js/219.feb7fbf9.js"><link rel="prefetch" href="/docs/assets/js/22.5483c5b0.js"><link rel="prefetch" href="/docs/assets/js/23.a80f8106.js"><link rel="prefetch" href="/docs/assets/js/24.329a8052.js"><link rel="prefetch" href="/docs/assets/js/25.2b060012.js"><link rel="prefetch" href="/docs/assets/js/26.c4899fe1.js"><link rel="prefetch" href="/docs/assets/js/27.6d87da7a.js"><link rel="prefetch" href="/docs/assets/js/28.059c249d.js"><link rel="prefetch" href="/docs/assets/js/29.a110ef16.js"><link rel="prefetch" href="/docs/assets/js/3.aa118c9c.js"><link rel="prefetch" href="/docs/assets/js/30.3b9f70aa.js"><link rel="prefetch" href="/docs/assets/js/31.bc86814e.js"><link rel="prefetch" href="/docs/assets/js/32.0b5d904d.js"><link rel="prefetch" href="/docs/assets/js/33.6f454a08.js"><link rel="prefetch" href="/docs/assets/js/34.e73e52bb.js"><link rel="prefetch" href="/docs/assets/js/35.38ec8921.js"><link rel="prefetch" href="/docs/assets/js/36.def4950e.js"><link rel="prefetch" href="/docs/assets/js/37.84f88476.js"><link rel="prefetch" href="/docs/assets/js/38.fe61d6c9.js"><link rel="prefetch" href="/docs/assets/js/39.43e3a925.js"><link rel="prefetch" href="/docs/assets/js/4.1203cd76.js"><link rel="prefetch" href="/docs/assets/js/40.20177672.js"><link rel="prefetch" href="/docs/assets/js/41.f0c1c12b.js"><link rel="prefetch" href="/docs/assets/js/42.57a5bb99.js"><link rel="prefetch" href="/docs/assets/js/43.2c905f66.js"><link rel="prefetch" href="/docs/assets/js/44.4ec701e9.js"><link rel="prefetch" href="/docs/assets/js/45.36c4ce0d.js"><link rel="prefetch" href="/docs/assets/js/46.04892c9e.js"><link rel="prefetch" href="/docs/assets/js/47.2e76caaf.js"><link rel="prefetch" href="/docs/assets/js/48.d3fdcc56.js"><link rel="prefetch" href="/docs/assets/js/49.f6688bf8.js"><link rel="prefetch" href="/docs/assets/js/5.758705a3.js"><link rel="prefetch" href="/docs/assets/js/50.3e97fe93.js"><link rel="prefetch" href="/docs/assets/js/51.dc8b6090.js"><link rel="prefetch" href="/docs/assets/js/52.05588503.js"><link rel="prefetch" href="/docs/assets/js/53.f5b542ed.js"><link rel="prefetch" href="/docs/assets/js/54.41daaadc.js"><link rel="prefetch" href="/docs/assets/js/55.12204edb.js"><link rel="prefetch" href="/docs/assets/js/56.f8cb4d1e.js"><link rel="prefetch" href="/docs/assets/js/57.040881e2.js"><link rel="prefetch" href="/docs/assets/js/58.25a5ab71.js"><link rel="prefetch" href="/docs/assets/js/59.cc6f2d1f.js"><link rel="prefetch" href="/docs/assets/js/6.f43aaf71.js"><link rel="prefetch" href="/docs/assets/js/60.2acaf485.js"><link rel="prefetch" href="/docs/assets/js/61.cc11992d.js"><link rel="prefetch" href="/docs/assets/js/62.18d82002.js"><link rel="prefetch" href="/docs/assets/js/63.b89dc927.js"><link rel="prefetch" href="/docs/assets/js/64.ae9c3b3c.js"><link rel="prefetch" href="/docs/assets/js/65.9d2ff34b.js"><link rel="prefetch" href="/docs/assets/js/66.6adae59a.js"><link rel="prefetch" href="/docs/assets/js/67.a42e4a1d.js"><link rel="prefetch" href="/docs/assets/js/68.40734ec9.js"><link rel="prefetch" href="/docs/assets/js/69.763bb2a6.js"><link rel="prefetch" href="/docs/assets/js/7.3cf4abee.js"><link rel="prefetch" href="/docs/assets/js/70.a16780eb.js"><link rel="prefetch" href="/docs/assets/js/71.70a906de.js"><link rel="prefetch" href="/docs/assets/js/72.955fe2cb.js"><link rel="prefetch" href="/docs/assets/js/73.2cf4e36b.js"><link rel="prefetch" href="/docs/assets/js/74.15c8f28d.js"><link rel="prefetch" href="/docs/assets/js/75.ef927eb3.js"><link rel="prefetch" href="/docs/assets/js/76.f1cd969d.js"><link rel="prefetch" href="/docs/assets/js/77.1a61a3b9.js"><link rel="prefetch" href="/docs/assets/js/78.727d6c56.js"><link rel="prefetch" href="/docs/assets/js/79.ff362992.js"><link rel="prefetch" href="/docs/assets/js/8.1961f4f4.js"><link rel="prefetch" href="/docs/assets/js/80.d009f8df.js"><link rel="prefetch" href="/docs/assets/js/81.000660e8.js"><link rel="prefetch" href="/docs/assets/js/82.d7f53d54.js"><link rel="prefetch" href="/docs/assets/js/83.d2117ee7.js"><link rel="prefetch" href="/docs/assets/js/84.2627dfd4.js"><link rel="prefetch" href="/docs/assets/js/85.4b7648f9.js"><link rel="prefetch" href="/docs/assets/js/86.1a50dc2f.js"><link rel="prefetch" href="/docs/assets/js/87.fdf57fe2.js"><link rel="prefetch" href="/docs/assets/js/88.d8afaf43.js"><link rel="prefetch" href="/docs/assets/js/89.f8f3c17f.js"><link rel="prefetch" href="/docs/assets/js/9.013de894.js"><link rel="prefetch" href="/docs/assets/js/90.f3092a57.js"><link rel="prefetch" href="/docs/assets/js/91.d5821f41.js"><link rel="prefetch" href="/docs/assets/js/92.ac7ca2ce.js"><link rel="prefetch" href="/docs/assets/js/93.e73d1835.js"><link rel="prefetch" href="/docs/assets/js/94.fe60b4cf.js"><link rel="prefetch" href="/docs/assets/js/95.db4d12c4.js"><link rel="prefetch" href="/docs/assets/js/96.b81ce75a.js"><link rel="prefetch" href="/docs/assets/js/97.b498829a.js"><link rel="prefetch" href="/docs/assets/js/98.0c94ba25.js"><link rel="prefetch" href="/docs/assets/js/99.8da1668b.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.d4eb5ad8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">计算机基础教程</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">
  机器指令
</a></div><div class="nav-item"><a href="/docs/software/" class="nav-link router-link-active">
  软件基础
</a></div><div class="nav-item"><a href="/docs/coder2hacker/" class="nav-link">
  白帽黑客
</a></div><div class="nav-item"><a href="/docs/blockchain/" class="nav-link">
  区块链
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">
  机器指令
</a></div><div class="nav-item"><a href="/docs/software/" class="nav-link router-link-active">
  软件基础
</a></div><div class="nav-item"><a href="/docs/coder2hacker/" class="nav-link">
  白帽黑客
</a></div><div class="nav-item"><a href="/docs/blockchain/" class="nav-link">
  区块链
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/software/" aria-current="page" class="sidebar-link">软件基础</a></li><li><a href="/docs/coder2hacker/" class="sidebar-link">黑客入门</a></li><li><a href="/docs/blockchain/" class="sidebar-link">区块链入门</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>整理 google doc：Basics: Linux Basic</p> <h2 id="命令执行本质"><a href="#命令执行本质" class="header-anchor">#</a> 命令执行本质</h2> <p>一个命令行终端是一个shell进程，在这个终端里执行的程序都是作为该shell进程的子进程。
如果子进程命令阻塞终端shell进程，shell进程就会等待子进程退出才能接收其他命令；
如果关掉了shell终端，，依附的所有子进程都会退出；
加上&amp;号可以避免这种情况，原理是将命令挂在systemd系统守护进程名下，其他办法还有nohup或者开tmux或者screen，并且加&amp;可以让shell进程不再阻塞，从而继续响应新命令；</p> <p>set -x 可以显示shell在执行什么程序</p> <p>当使用 sudo 时，系统会使用 /etc/sudoers 这个文件中规定的该用户的权限和环境变量</p> <h2 id="重定向-管道"><a href="#重定向-管道" class="header-anchor">#</a> 重定向/管道</h2> <p><img src="/docs/docs_image/software/linux/linux_redirect01.png" alt=""></p> <ul><li><p>重定向</p> <p>输入&lt;+输出流&gt;</p> <p><code>exec 8&lt;&gt; /dev/tcp/www.baidu.com/80</code></p> <p>重定向到文件：<code>&gt; file</code></p> <p>重定向到文件描述符要加&amp;<code>&gt;&amp; fd</code></p> <p><code>echo -e &quot;GET / HTTP/1.0\n&quot; 1&gt;&amp; 8</code> <code>cat 0&lt;&amp; 8 或 cat&lt;&amp;8</code></p></li> <li><p><strong>标准输出重定向：</strong></p> <p>比如标准输出重定向 java -jar **.jar &gt; log.txt</p> <p>2&gt;&amp;1 标准错误输出重定向到标准输出</p> <p>如果需要sudo权限，可以用tee：sudo tee</p> <div class="language- extra-class"><pre class="language-text"><code>cat shopee.sg.domain.uniq | filter-resolved &gt; shopee.sg.domain.uniq.resolved
cat shopee.sg.domain.uniq | filter-resolved | sudo tee shopee.sg.domain.uniq.resolved
</code></pre></div></li> <li><p><strong>标准输入重定向：管道|和&lt;&lt;&lt; 以及命令替换$()：</strong></p> <p>首先$()主要则是command substitution，比如</p> <div class="language- extra-class"><pre class="language-text"><code>rm $(where connect.sh)

dos2unix $(find . -type f)
</code></pre></div><p>echo $(cmd) 和 echo &quot;$(cmd)&quot;，结果差不多，但是仍然有区别。注意观察，双引号转义完成的结果会自动增加单引号，而前者不会， 如果 $ 读取出的参数字符串包含空格，应该用双引号括起来，否则就会出错。</p> <p>管道：</p> <p><code>ps -aef | grep -v grep | grep &quot;java -server -jar&quot; | awk '{print $2}'</code>
$(2)获取管道前面等输出结果第二列,此时可以用$2替代；</p> <p><code>yes|cp -r source_folder target_folder/</code></p> <p>标准输入重定向符：</p> <p>&lt;&lt;&lt; String 比如脚本中读取第一个参数并取分隔''的第一个值 <code>IFS='/' read -ra target_arr &lt;&lt;&lt; &quot;$1&quot;</code></p></li> <li><p><strong>位置参数${}：</strong></p> <p>${}主要是作为positional parameter，</p> <p>$｛2｝还可以表示获取脚本输入参数等第二个，此时也可以用$2替代，$#是输入参数个数；</p> <div class="language- extra-class"><pre class="language-text"><code>$ animal=cat
$ echo $animals
# No such variable as “animals”.
$ echo ${animal}s
cats
</code></pre></div><p>{}https://askubuntu.com/questions/339015/what-does-mean-in-the-find-command</p> <p>https://labuladong.gitbook.io/algo/di-wu-zhang-ji-suan-ji-ji-shu/linux-jin-cheng https://labuladong.gitbook.io/algo/di-wu-zhang-ji-suan-ji-ji-shu/linuxshell</p> <p>difference between ${} and $() in shell script https://superuser.com/questions/935374/difference-between-and-in-shell-scriptcd /proc/$$/fd $$代表当前解释程序</p></li> <li><p><strong>哪些命令接受标准输入</strong></p> <p>命令默认都接受参数 -argument，有些命令还接受标准输入（可以使用管道符|和重定向符&lt; &lt;&lt;&lt;）,
简单判别方式：命令是否可以阻塞终端（如cat不加任何命令会阻塞终端）
如 echo&quot;trade:trade&quot;|chpasswd</p></li></ul> <h2 id="用户身份和权限"><a href="#用户身份和权限" class="header-anchor">#</a> 用户身份和权限</h2> <p>su – The difference between the su and the hyphenated su – commands is the su command without arguments keeps almost all environment variables belonging to the original user. Contrary to this, the hyphenated su – command clears most environment variables.</p> <div class="language- extra-class"><pre class="language-text"><code>su _gvm
This account is currently not available.

sudo -u _gvm gvmd --migrate
sudo su -l _gvm -s /bin/bash

sudo sh -c &quot;cmds&quot;


</code></pre></div><p>Permissions take a different meaning for directories. Here's what they mean:</p> <ul><li><strong>r</strong>ead determines if a user can view the directory's contents, i.e. do ls in it.</li> <li><strong>w</strong>rite determines if a user can create new files or delete file in the directory. (Note here that this essentially means that a user with write access toa directory can delete files in the directory <em>even</em> if he/she doesn't have write permissions for the file! So be careful with this.)</li> <li>e<strong>x</strong>ecute determines if the user can cd into the directory.</li></ul> <p>系统启动用户</p> <div class="language- extra-class"><pre class="language-text"><code>-----------------------------------------------------
--- mysql
-----------------------------------------------------
$ systemctl status mysqld
● mysqld.service - MySQL Server
   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)                                                                                          
   Active: active (running) since Thu 2021-07-08 09:44:33 SGT; 2 months 1 days ago
     Docs: man:mysqld(8)
           http://dev.mysql.com/doc/refman/en/using-systemd.html
  Process: 2934 ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS (code=exited, status=0/SUCCESS)                                             
  Process: 2913 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS)
 Main PID: 2936 (mysqld)
   CGroup: /system.slice/mysqld.service
           └─2936 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid

$ vim /usr/lib/systemd/system/mysqld.service
[Unit]
Description=MySQL Server
Documentation=man:mysqld(8)
Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html
After=network.target
After=syslog.target

[Install]
WantedBy=multi-user.target

[Service]
User=mysql
Group=mysql

Type=forking

PIDFile=/var/run/mysqld/mysqld.pid
.....
# Start main service
ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS
...........

-----------------------------------------------------
--- keepalived
-----------------------------------------------------
$ systemctl status keepalived
● keepalived.service - LVS and VRRP High Availability Monitor
   Loaded: loaded (/usr/lib/systemd/system/keepalived.service; disabled; vendor preset: disabled)
   Active: active (running) since Sun 2021-08-29 14:39:15 SGT; 1 weeks 2 days ago
  Process: 15401 ExecStart=/usr/sbin/keepalived $KEEPALIVED_OPTIONS (code=exited, status=0/SUCCESS)
 Main PID: 15402 (keepalived)

$ vim /usr/lib/systemd/system/keepalived.service
[Unit]
Description=LVS and VRRP High Availability Monitor
After=syslog.target network-online.target

[Service]
Type=forking
PIDFile=/var/run/keepalived.pid
KillMode=process
EnvironmentFile=-/etc/sysconfig/keepalived
ExecStart=/usr/sbin/keepalived $KEEPALIVED_OPTIONS
ExecReload=/bin/kill -HUP $MAINPID

[Install]
WantedBy=multi-user.target

可以看到mysqld的实际用户是mysql，而keepalived没有指定，所以其用户就是执行启动命令systemctl start keepalived的用户

</code></pre></div><h2 id="about-env"><a href="#about-env" class="header-anchor">#</a> About Env</h2> <p>先确认默认的shell: BASH OR ZSH OR..</p> <div class="language- extra-class"><pre class="language-text"><code>echo $0 or echo $SHELL or ps -p $$

</code></pre></div><p>改变默认shell</p> <div class="language- extra-class"><pre class="language-text"><code>cat /etc/shells
type -a bash
chsh -s /usr/bin/bash
restart
</code></pre></div><h3 id="env"><a href="#env" class="header-anchor">#</a> env</h3> <p>The files in /etc directory sets the respective shell configuration  for all the users on the system. This is normally set up by the system  administrator.</p> <p>The files in the home directory of the user are user-specific, obviously. This allows users to create alias for frequently used commands or use a custom PATH variable for a program.</p> <p>i) 特定用户的PATH  ~/bashrc  ~/bash_profile</p> <ul><li>Bash Startup Files
When a &quot;login shell&quot; starts up, it reads the file /etc/profile and then ~/.bash_profile or ~/.bash_login or ~/.profile (whichever one exists - it only reads ONE of these, checking for them in the order mentioned).
When a &quot;non-login shell&quot; starts up, it reads the file /etc/bashrc and then the file ~/.bashrc.</li></ul> <p>ii) system wide全局PATH /etc/profile或/root/.bashrc  (/etc/environment?)</p> <p>Anything in <code>~/.profile</code> and <code>~/.bashrc</code> is run <em>after</em> <code>/etc/profile</code> and <code>/bash.bashrc</code></p> <p>所以如果是修改了/etc/profile对root或sudo操作无效，要看下root下面的~/.bashXXX是不是有PATH设置，</p> <p>如果还不生效，就要看下/etc/sudoers: Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin，可以使用 sudo -E 绕过</p> <p>For some setups the <code>-E</code> switch will not work. To &quot;workaround&quot; it you can use <code>sudo env &quot;PATH=$PATH&quot; bash</code>. This will also carry your current <code>$PATH</code> forward to your <code>sudo</code> environment.</p> <h3 id="登录式-shell-和非登录式-shell"><a href="#登录式-shell-和非登录式-shell" class="header-anchor">#</a> 登录式 shell 和非登录式 shell</h3> <p>https://linuxhandbook.com/login-shell/</p> <p>https://unix.stackexchange.com/questions/38175/difference-between-login-shell-and-non-login-shell</p> <ul><li><p>交互式 shell 指的是<strong>在终端有交互的模式，用户输入命令，并在回车后立即执行的 shell</strong>，这种模式也是大部分情况下用户执行的一种方式，比如 ssh 登录</p> <p>You can start a new shell from your current shell (an interactive shell): $ bash  (subshell)</p></li> <li><p>when you run a shell script, it runs in its own shell (a non-interactive shell).</p> <p>非交互式 shell 指的<strong>是 bash shell 以命令脚本的形式执行</strong>，这种模式下，shell 不会和用户有交互，而是读取脚本文件并执行，直到读取到文件 EOF 时结束</p></li> <li><p>The login shell is the first process that is executed with your user ID when you log into an interactive session.</p> <p>The login process tells the shell to behave as a login shell with a  convention: passing argument 0, which is normally the name of the shell  executable, with a <code>-</code> character prepended (e.g. <code>-bash</code> whereas it would normally be <code>bash</code>.</p> <p>The login shell reads environment variable and other configuration from  /etc/profile and a profile file in the home directory. This allows you  to have tab completion, colored output and sets other stuff such as  umask etc.</p> <p>登录式 shell 是<strong>用户使用自己的 user ID 登录交互式 shell 的第一个进程</strong></p> <p>login shell 会读取不同的配置文件，比如 bash 会读取 <code>/etc/profile</code> ， <code>~/.profile</code>，<code>~/.bash_profile</code> 等配置文件。而 zsh 会是 <code>/etc/zprofile</code> 和 <code>~/.zprofile</code></p> <p>When you log in on a text console, or through SSH, or with <code>su -</code>, you get an <strong>interactive login</strong> shell. When you log in in graphical mode (on an <a href="http://en.wikipedia.org/wiki/X_display_manager_(program_type)" target="_blank" rel="noopener noreferrer">X display manager<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>), you don't get a login shell, instead you get a session manager or a window manager.</p></li> <li><p>non-login shell</p> <p>It's rare to run a <strong>non-interactive login</strong> shell, but  some X settings do that when you log in with a display manager, so as to arrange to read the profile files. Other settings (this depends on the  distribution and on the display manager) read <code>/etc/profile</code> and <code>~/.profile</code> explicitly, or don't read them. Another way to get a non-interactive  login shell is to log in remotely with a command passed through standard input which is not a terminal, e.g. <code>ssh example.com &lt;my-script-which-is-stored-locally</code> (as opposed to <code>ssh example.com my-script-which-is-on-the-remote-machine</code>, which runs a non-interactive, non-login shell).</p> <ul><li><p><strong>interactive, non-login</strong> shell</p> <p>When you start a shell in a terminal in an existing session (screen, X  terminal, Emacs terminal buffer, a shell inside another, etc.), you get  an <strong>interactive, non-login</strong> shell. That shell might read a shell configuration file (<code>~/.bashrc</code> for bash invoked as <code>bash</code>, <code>/etc/zshrc</code> and <code>~/.zshrc</code> for zsh, <code>/etc/csh.cshrc</code> and <code>~/.cshrc</code> for csh, the file indicated by the <code>ENV</code> variable for POSIX/XSI-compliant shells such as dash, ksh, and bash when invoked as <code>sh</code>, <code>$ENV</code> if set and <code>~/.mkshrc</code> for mksh, etc.).</p> <p>当你在已经存在的终端 session 中开启一个 shell，比如在 screen, Tmux, X terminal 等中，会得到一个交互式，非登录 shell</p> <p>只会读取 <code>~/.bashrc</code> 配置(<code>~/.bashrc</code> for bash, <code>/etc/zshrc</code> and <code>~/.zshrc</code> for zsh)。</p></li> <li><p><strong>non-interactive, non-login</strong> shell</p> <p>When a shell runs a script or a command passed on its command line, it's a <strong>non-interactive, non-login</strong> shell. Such shells run all the time: it's very common that when a  program calls another program, it really runs a tiny script in a shell  to invoke that other program. Some shells read a startup file in this  case (bash runs the file indicated by the <code>BASH_ENV</code> variable, zsh runs <code>/etc/zshenv</code> and <code>~/.zshenv</code>), but this is risky: the shell can be invoked in all sorts of contexts,  and there's hardly anything you can do that might not break something.</p> <p>当 shell 执行一个脚本，或者通过命令行将命令传送过去执行，这时就是非交互，非登录的 shell</p> <p>不会读取任何profile 或 rc</p></li></ul></li></ul> <p>举例1：</p> <div class="language- extra-class"><pre class="language-text"><code>echo $0
- `-bash` 中 `-` 表示当前是一个 login shell
- `bash` 表示不是 login shell

用户在当前交互式的shell中执行：
$ bash
就会开启一个新的 subshell，这个subshell就是一个 non-login shell，在该subshell中可以读取`~/.bashrc` 也可以读取`~/.bash_profile`（继承parent）

On desktop Linux, you don't use login shell. Your login is managed by a display manager. This is why when you open a terminal in Linux desktop, you'll see that even the first shell running in the terminal is not login shell. 
</code></pre></div><p>举例2：</p> <p>https://www.tecmint.com/change-a-users-default-shell-in-linux/</p> <p>There are several reasons for changing a user’s shell in Linux including the following:</p> <ol><li>To <a href="https://www.tecmint.com/block-or-disable-normal-user-logins-in-linux/" target="_blank" rel="noopener noreferrer">block or disable normal user logins<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in Linux using a nologin shell.</li> <li>Use a shell wrapper script or program to login user commands before  they are sent to a shell for execution. Here, you specify the shell  wrapper as a user’s login shell.</li> <li>To meet a user’s demands (wants to use a specific shell), especially those with administrative rights</li></ol> <p>举例3 non-interactive, non-login shell：</p> <p>使用crontab自动启动jar的时候，java代码中getHostName抛错，手动启动则没有问题</p> <div class="language- extra-class"><pre class="language-text"><code>----------------------------------------------------------------------------------------------------------
--- java code
----------------------------------------------------------------------------------------------------------
private Long getDataCenterId(){
        int[] ints = StringUtils.toCodePoints(SystemUtils.getHostName());
        int sums = 0;
        for (int i: ints) {
            sums += i;
        }
        return (long)(sums % 32);
    }
    
Caused by: java.lang.NullPointerException
	at com.lyhistory.util.IdWorkerConfiguration.getDataCenterId(IdWorkerConfiguration.java:64)
	at com.lyhistory.util.IdWorkerConfiguration.getDateFromConfig(IdWorkerConfiguration.java:43)
	
查了下，在linux下面，SystemUtils.getHostName()实际是去获取linux env的HOSTNAME，
在该linux机器上使用执行crontab对应相同的用户登录，并执行env，正常显示HOSTNAME（当然了，毕竟手动运行没问题）
所以合理的怀疑是，crontab没有拿到env


----------------------------------------------------------------------------------------------------------
--- crontab
----------------------------------------------------------------------------------------------------------
$ crontab -e
44 17 * * * /opt/scripts/start_some_service.sh &amp;&amp; &amp;&gt;&gt; /opt/logs/start_some_service`date +\%F`.log   2&gt;&amp;1

----------------------------------------------------------------------------------------------------------
--- start_some_service.sh
----------------------------------------------------------------------------------------------------------
$ vim start_some_service
#!/bin/bash 

readonly PROGNAME=$(basename $0)
readonly PROGDIR=$(readlink -m $(dirname $0))

# source env
L_INVOCATION_DIR=&quot;$(pwd)&quot;
L_CMD_DIR=&quot;/opt/scripts&quot;

if [ &quot;${L_INVOCATION_DIR}&quot; != &quot;${L_CMD_DIR}&quot; ]; then
  pushd ${L_CMD_DIR} &amp;&gt; /dev/null
fi

source ./_set_env.sh
./start_service.sh A
./start_service.sh B

----------------------------------------------------------------------------------------------------------
--- start_service.sh
----------------------------------------------------------------------------------------------------------
$ vim start_service.sh
PID=`ps -aef | grep -v grep | grep &quot;java -server -jar ./${1}.jar&quot; | awk '{print $2}'`

if [ ! -z &quot;$PID&quot; ]; then
        echo &quot;Service $1 already running on the server. PID is [$PID];&quot;
        exit 0
fi

ulimit -c unlimited

nohup java -server -jar $1.jar &gt; ../logs/`date +\%F`_$1_`date +\%H.%M.%S`.log 2&gt;&amp;1 &amp;
sleep 1
PID=`ps -aef | grep -v grep | grep &quot;java -server -jar ${1}.jar&quot; | awk '{print $2}'`

if [ ! -z &quot;$PID&quot; ]; then
        echo &quot;Service $1 started. PID is [$PID]&quot;
else
        echo &quot;Failed to start service $1&quot;
fi

popd &amp;&gt;/dev/null


----------------------------------------------------------------------------------------------------------
--- 修复方式
----------------------------------------------------------------------------------------------------------
start_some_service.sh 替换 #!/bin/bash 为 #!/bin/bash -l
或者crontab添加bash -l
44 17 * * * bash -l /opt/scripts/start_some_service.sh &amp;&amp; &amp;&gt;&gt; /opt/logs/start_some_service`date +\%F`.log       2&gt;&amp;1
----------------------------------------------------------------------------------------------------------
--- 原因
----------------------------------------------------------------------------------------------------------
$ man 5 crontab
............
Several environment variables are set up automatically by the cron(8) daemon.  SHELL is set to /bin/sh, and LOGNAME and HOME are set from the /etc/passwd line of  the  crontab´s
       owner.  HOME and SHELL can be overridden by settings in the crontab; LOGNAME can not.

       (Note: the LOGNAME variable is sometimes called USER on BSD systems and is also automatically set).
.............

$ man bash
 -l        Make bash act as if it had been invoked as a login shell (see INVOCATION below).

The -l option tells bash to read all the various &quot;profile&quot; scripts, from /etc and from your home directory. Bash normally only does this for interactive sessions (in which bash is run without any command line parameters).

Normal scripts have no business reading the profile; they're supposed to run in the environment they were given. That said, you might want to do this for personal scripts, maybe, if they're tightly bound to your environment and you plan to run them outside of a normal session.

A crontab is one example of running a script outside your session, so yes, go do it!

refer:
https://www.baeldung.com/linux/load-env-variables-in-cron-job
https://unix.stackexchange.com/questions/422499/what-are-the-pros-and-cons-in-using-the-l-in-a-script-shebang/422505
https://stackoverflow.com/questions/2229825/where-can-i-set-environment-variables-that-crontab-will-use
https://stackoverflow.com/questions/36885909/cronjob-does-not-execute-a-script-that-works-fine-standalone/69100347#69100347
https://unix.stackexchange.com/questions/321315/get-cron-to-run-in-the-same-environment-as-i-get-with-ssh-login
</code></pre></div><h2 id="安装包管理"><a href="#安装包管理" class="header-anchor">#</a> 安装包管理</h2> <h3 id="不同发行版选择"><a href="#不同发行版选择" class="header-anchor">#</a> 不同发行版选择</h3> <ul><li><p>Ubuntu / kali / parrotOS</p> <p>based on debian,</p></li> <li><p>Centos</p> <p>for bigdata</p></li> <li><p>Redhat</p> <p>for databases(because those database companies use redhat, it’s tested)</p></li></ul> <h3 id="基本安装方法"><a href="#基本安装方法" class="header-anchor">#</a> 基本安装方法</h3> <ul><li><p>apt或yum安装</p> <p>add to apt/yum repository, and then apt-get/yum install ***</p> <p>Normally will be put in <strong>/usr/bin/</strong></p> <p>Additionally, you can use <code>yum localinstall &lt;packagename&gt;</code> to intelligently install dependencies as needed.</p> <p>Know the version before installing:</p> <p><code>apt policy &lt;packagename&gt;</code></p> <p><code>yum info/search &lt;packagename&gt;</code></p></li> <li><p>deb或rpm安装 / AppImage</p> <p>download deb for ubuntu or rpm for centos, and install it, it will help you install all related dependencies</p> <ul><li><p>版本</p> <p>amd64, i386,x64<a href="https://askubuntu.com/questions/32402/amd64-i386-32bit-64bit-which-version-to-choose" target="_blank" rel="noopener noreferrer"> https://askubuntu.com/questions/32402/amd64-i386-32bit-64bit-which-version-to-choose<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>包类型：dpkg(Ubuntu) , rpm(centos)</p> <p>http://linuxintro.org/index.php?title=Dpkg-rpm_equivalent_commands&amp;redirect=no</p> <p>deb for debian</p> <div class="language- extra-class"><pre class="language-text"><code>dpkg -i google-chrome-stable_current_amd64.deb
apt install ./google-chrome-stable_current_amd64.deb
</code></pre></div><p>rpm for # CentOS/RHEL</p> <div class="language- extra-class"><pre class="language-text"><code>rpm -Uvh gitlab-ce-&lt;version&gt;.rpm
如果是第一次安装可以用rpm -ivh gitlab-ce-&lt;version&gt;.rpm
yum localinstall gitlab-ce-&lt;version&gt;.rpm
</code></pre></div><p>AppImage for all:
is a universal software package format, 只需要下载然后给可执行权限</p></li></ul></li> <li><p>解压直接使用 download tar file, and extract, then:</p> <ol><li>set env variable or persist it in:</li></ol> <p>​	e.g. export PATH=$PATH:/usr/local/go/bin, more read section #About ENV</p> <ol start="2"><li><p>or just mv it into /usr/local/bin/</p></li> <li><p>or link</p></li></ol> <p>​	<code>cd /usr/bin sudo ln -s /home/lyhistory/.local/bin/tldr tldr</code> OR</p> <p>​	<code>sudo ln -sf /usr/local/share/$PHANTOM_JS/bin/phantomjs /usr/local/bin</code></p> <p>缺点: if there is dependencies, you have to manually install them</p></li> <li><p>源码编译安装</p> <p>configuration或cmake之后make install，通常安装的路径在 install_manifest.txt，所以删除方式：<code>cat install_manifest.txt | xargs echo sudo rm | sh</code></p> <blockquote><p>The steps:</p> <ol><li><p>The <code>autogen.sh</code> script generates the <code>configure</code> script (from <code>configure.ac</code>, using autoconf) and any files it needs (like creating <code>Makefile.in</code> from <code>Makefile.am</code> using automake). This requires autotools to be installed on your system, and it must be run when checking out the project from source control (if <code>configure</code> isn’t checked in). People who download source tarballs can usually skip this step, because output of this step is included in source tarballs.</p> <p><strong>Note</strong> This is usually equivalent to <code>autoreconf --install</code>. If there is not <code>autogen.sh</code> file, then just run <code>autoreconf --install</code> instead. If you have inherited a project with an <code>autogen.sh</code>, consider deleting it if you can use <code>autoreconf --install</code>.</p></li> <li><p>The <code>configure</code> script generates <code>Makefile</code> and other files needed to build. Typically <code>Makefile.in</code> is used as a template to generate <code>Makefile</code> (and <code>config.h.in</code> to generate <code>config.h</code>). This process happens using only standard tools installed on your system, like sed and awk, and doesn't require autotools to be installed.</p></li> <li><p>The <code>make</code> command builds the software.</p></li> <li><p>The <code>make install</code> command installs it.</p></li></ol> <p>https://stackoverflow.com/questions/50044091/what-is-the-job-of-autogen-sh-when-building-a-c-package-on-linux</p></blockquote></li></ul> <p>常见问题：</p> <ul><li><p>前面几种安装方法的比较：rpm -ivh -uvh VS yum install vs yum localinstall</p> <p>[https://serverfault.com/questions/825320/difference-between-rpm-ivh-package-and-yum-install-package#:~:text=there%20is%20no%20difference%20if,works%20with%20file(s).](https://serverfault.com/questions/825320/difference-between-rpm-ivh-package-and-yum-install-package#:~:text=there is no difference if,works with file(s).)</p></li> <li><p>安装后管理</p> <ul><li>rpm:<div class="language- extra-class"><pre class="language-text"><code>rpm -qa | grep &quot;package name&quot;。
yum list installed | grep &quot;package name&quot;
</code></pre></div></li> <li>deb:<div class="language- extra-class"><pre class="language-text"><code>dpkg -l | grep &quot;package name&quot;
apt list --installed|grep &quot;package name&quot;
```；
</code></pre></div></li> <li>如果是以源码包自己编译安装的，例如.tar.gz或者tar.bz2形式的，这个只能看可执行文件是否存在了，如果是以root用户安装的，可执行程序通常都在/usr/local/sbin:/usr/bin目录下。</li></ul></li> <li><p>安装后找不到命令，因为安装的位置不在系统path上，可以参考上面的“解压后使用”的方式中的，link或设置环境变量方式来搞；</p></li></ul> <h3 id="apt"><a href="#apt" class="header-anchor">#</a> apt</h3> <div class="language- extra-class"><pre class="language-text"><code>apt vs apt-get
更新repo：apt update
apt upgrade / apt full-upgrade
apt search &quot;PKG&quot;
apt list --installed | grep &quot;PKG&quot;

</code></pre></div><h3 id="yum"><a href="#yum" class="header-anchor">#</a> yum</h3> <div class="language- extra-class"><pre class="language-text"><code>更新repo：yum clean all / yum repolist / yum check-update 
yum provides package-name / rpm -q --provides openssl
yum list/search/info package-name
yum update package-name
yum history
yum history info 21

// find references
rpm -q --whatrequires openssl

[root@liuyuelocal ~]# yum repolist
Loaded plugins: fastestmirror, langpacks
Repodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast
Determining fastest mirrors
 * base: mirror.newmediaexpress.com
 * epel: mirrors.aliyun.com
 * extras: mirror.newmediaexpress.com
 * updates: mirror.newmediaexpress.com
repo id                                                                                   repo name                                                                                                       status

!base/7/x86_64                                                                            CentOS-7 - Base                                                                                                 10,097

!docker-ce-stable/x86_64                                                                  Docker CE Stable - x86_64                                                                                           63

!epel/x86_64                                                                              Extra Packages for Enterprise Linux 7 - x86_64                                                                  13,499

!extras/7/x86_64                                                                          CentOS-7 - Extras                                                                                                  307

!ius/x86_64                                                                               IUS for Enterprise Linux 7 - x86_64                                                                                714

!updates/7/x86_64                                                                         CentOS-7 - Updates                                                                                                 997

repolist: 25,677


#yum repolist
Loaded plugins: product-id, search-disabled-repos, subscription-manager
This system is not registered with an entitlement server. You can use subscription-manager to register.
repo id                                                                              repo name                                                                                                            status

nodesource/x86_64                                                                    Node.js Packages for Enterprise Linux 7 - x86_64                                                                         37

repolist: 55,117
</code></pre></div><p>DNF, or Dandified Yum, which is the next major version of the Yum  package manager was introduced with Fedora 18. As of Fedora 22, it has  become the default package manager.</p> <p>https://www.rootusers.com/how-to-install-dnf-package-manager-in-centosrhel/</p> <h2 id="服务管理-service-systemctl"><a href="#服务管理-service-systemctl" class="header-anchor">#</a> 服务管理 service/systemctl</h2> <h3 id="system-v"><a href="#system-v" class="header-anchor">#</a> System V</h3> <p>is the oldest init system, used in
Debian 6 and earlier
Ubuntu 9.04 and earlier
CentOS 5 and earlier
In System V, an init script is a shell script. They are also called rc (run command) scripts. The scripts are located under the <strong>/etc/init.d</strong> directory</p> <div class="language- extra-class"><pre class="language-text"><code>To make a service restart after a crash or reboot, you can usually add a line like this to the init script:
ms:2345:respawn:/bin/sh /usr/bin/service_name

To enable/disable a System V service to start at system boot time, run this command:
sudo chkconfig service_name on
sudo chkconfig service_name off
sudo service service_name status

update-rc.d - install and remove System-V style init script links
https://manpages.ubuntu.com/manpages/xenial/man8/update-rc.d.8.html
  https://askubuntu.com/questions/72127/when-you-run-update-rc-d-myscript-default-what-is-called-on-startup-shutdown#:~:text=If%20defaults%20is%20used%20then,overridden%20if%20there%20are%20dependencies.
</code></pre></div><h3 id="upstart"><a href="#upstart" class="header-anchor">#</a> Upstart</h3> <p>came after System V and was used in
Ubuntu 9.10 to Ubuntu 14.10, including Ubuntu 14.04
CentOS 6</p> <p>To keep things simple, Upstart is backward-compatible with System V. The /etc/init.d/rc script still runs to manage native System V services. Its main difference is the way it allows multiple events to be associated with a service. This event-based architecture allowed Upstart to be a flexible service manager.
At startup, Upstart will run any System V init scripts normally. It will then look under the /etc/init directory and execute the shell commands in each service configuration file.
The files have a naming style of service_name.conf</p> <h3 id="systemd"><a href="#systemd" class="header-anchor">#</a> systemd</h3> <p>is the newest Linux service manager, used in
Debian 7 and above
Ubuntu 15.04 and above
CentOS 7 and above</p> <p>systemd is backward-compatible with System V commands and initialization scripts. That means any System V service will also run under systemd.
The main difference between systemd and the other two init methods is that systemd is responsible for the initialization of service daemons and other types of resources like device operating system paths, mount points, sockets, etc. The naming style for a unit file is service_name.unit_type. So, you will see files like dbus.service, sshd.socket, or home.mount</p> <p>main location:</p> <div class="language- extra-class"><pre class="language-text"><code>/lib/systemd/system/
/etc/systemd/system
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>ls -l /etc/systemd/system/default.target
sudo ls -l /etc/systemd/system/multi-user.target.wants/*.service
sudo systemctl show --property &quot;Requires&quot; multi-user.target | fmt -10
sudo systemctl show --property &quot;Requires&quot; basic.target | fmt -10
sudo systemctl show --property &quot;Wants&quot; basic.target | fmt -10

sudo vi /etc/systemd/system/multi-user.target.wants/xxx.service


How To Configure a Linux Service to Start Automatically After a Crash or Reboot https://www.digitalocean.com/community/tutorials/how-to-configure-a-linux-service-to-start-automatically-after-a-crash-or-reboot-part-2-reference
sudo systemctl daemon-reload
sudo systemctl restart mysqld.service
</code></pre></div><h3 id="example-openvpn-on-kali-linux"><a href="#example-openvpn-on-kali-linux" class="header-anchor">#</a> example -openvpn on kali linux</h3> <p>因为某国直接使用openvpn有问题，所以要开启scramble模式，因此我卸载了kali默认的openvpn，
安装了scramble option</p> <div class="language- extra-class"><pre class="language-text"><code>apt remove openvpn
then
make install the patched version
</code></pre></div><p>结果无法用service/systemctl启动openvpn</p> <div class="language- extra-class"><pre class="language-text"><code>$service/systemctl start openvpn
failed to start .service unit is masked

Check that the unit file is a symlink to /dev/null:
$file /etc/systemd/system/openvpn.service

/lib/systemd/system/openvpn.service: symbolic link to /dev/null

</code></pre></div><p>删除无效link后重启：</p> <div class="language- extra-class"><pre class="language-text"><code>$sudo rm /lib/systemd/system/openvpn.service
$sudo systemctl daemon-reload

$service/systemctl start openvpn 

忘记尝试 sudo systemctl unmask openvpn.service
</code></pre></div><p>但是这一次显示状态有点奇怪：</p> <div class="language- extra-class"><pre class="language-text"><code>$service/systemctl status openvpn
State active (exited) 
</code></pre></div><p>means that systemd has successfully run the commands but that it does not know there is a daemon to monitor.
https://unix.stackexchange.com/questions/241970/what-does-status-active-exited-mean-for-a-systemd-service</p> <div class="language- extra-class"><pre class="language-text"><code>$which open
/usr/local/sbin/openvpn

$sudo find / -name &quot;openvpn.service&quot;
/run/systemd/generator.late/openvpn.service

$/etc/init.d/openvpn still point to:
/usr/sbin/openvpn

configuration file for /etc/init.d/openvpn: /etc/default/openvpn  

修改 /etc/init.d/openvpn指向 /usr/local/sbin/openvpn即可
</code></pre></div><p>install /etc/init.d/script
https://askubuntu.com/questions/335242/how-to-install-an-init-d-script</p> <h2 id="基础服务"><a href="#基础服务" class="header-anchor">#</a> 基础服务</h2> <h3 id="网络"><a href="#网络" class="header-anchor">#</a> 网络</h3> <h4 id="ubuntu"><a href="#ubuntu" class="header-anchor">#</a> Ubuntu</h4> <p>注意,对于Ubuntu 17.10 switched from ifupdown (which uses the /etc/network/interfaces file) to netplan,</p> <p>所以新版本已经找不到 /etc/network/interfaces</p> <p>netplan貌似只是个接口: https://netplan.io/examples/</p> <p>具体的控制还是: NetworkManager 和 networkd, 其中desktop版本默认是 NetworkManager，而对于无UI的server版本只能用networkd
https://askubuntu.com/questions/1031439/am-i-running-networkmanager-or-networkd</p> <div class="language- extra-class"><pre class="language-text"><code>To configure netplan, save configuration files under /etc/netplan/ with a .yaml extension (e.g. /etc/netplan/config.yaml), then run sudo netplan apply. This command parses and applies the configuration to the system. Configuration written to disk under /etc/netplan/ will persist between reboots.

---------------------------------------------------------
对于NetworkManager:
---------------------------------------------------------
First any interfaces defined in /etc/network/interfaces are ignored by network-manager. (man 5 NetworkManager)
systemctl status network-manager

vim /etc/netplan/01-network-manager-all.yaml
# Let NetworkManager manage all devices on this system
network:
  version: 2
  renderer: NetworkManager       

UI是使用NetworkManager,所以直接打开控制面板来设置静态IP和DNS即可
address 192.168.0.109
netmask 255.255.255.0
gateway 192.168.0.1
DNS: 8.8.8.8
设置完等一会即可    

---------------------------------------------------------
对于Networkd：
---------------------------------------------------------
systemd-networkd will only manage network addresses and routes for any link for which it finds a .network file with an appropriate [Match] section. (man 8 systemd-networkd).
systemctl status systemd-netword

vim /etc/netplan/01-network-manager-all.yaml
network:
    version: 2
    renderer: networkd
    ethernets:
        enp3s0:
            dhcp4: true

</code></pre></div><h4 id="debain-based-kali"><a href="#debain-based-kali" class="header-anchor">#</a> Debain based : Kali</h4> <div class="language- extra-class"><pre class="language-text"><code>--- for debain:
配置静态ip
/etc/network/interfaces：
#auto eth0
#iface eth0 inet dhcp
auto eth0
iface eth0 inet static
address 192.168.0.109
netmask 255.255.255.0
gateway 192.168.0.1

sudo ifdown eth0
sudo ifup eth0
or
sudo /etc/init.d/networking restart

如果还是无法上网（上面172.17.5.36是某ISP提供的，貌似虚拟机无法用）：
/etc/resolv.conf
nameserver 8.8.8.8

sudo systemctl restart systemd-resolved.service

解决后看下当前路由情况：
route -n

#Verify new IP settings:
ip a s eth0
#Verify new routing settings:
ip r
#Verify DNS servers settings:
cat /etc/resolv.conf
#Verify the internet connectivity:
ping -c 4 google.com

root@kali:/home/lyhistory# ip -4 addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    inet 192.168.0.109/24 brd 192.168.0.255 scope global eth0
       valid_lft forever preferred_lft forever

root@kali:/home/lyhistory# ip route
default via 192.168.0.1 dev eth0 onlink 
192.168.0.0/24 dev eth0 proto kernel scope link src 192.168.0.109 
</code></pre></div><h4 id="centos"><a href="#centos" class="header-anchor">#</a> Centos</h4> <div class="language- extra-class"><pre class="language-text"><code>--- for centos
vim /etc/sysconfig/network-scripts/ifcfg-eth0
HWADDR=00:08:A2:0A:BA:B8
TYPE=Ethernet
#BOOTPROTO=dhcp
BOOTPROTO=none	
# Server IP #
IPADDR=192.168.0.110
# Subnet #
PREFIX=24
# Set default gateway IP #
GATEWAY=192.168.0.1
# Set dns servers #
DNS1=8.8.8.8
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
# Disable ipv6 #
IPV6INIT=no
NAME=eth0
# This is system specific and can be created using 'uuidgen eth0' command #
UUID=41171a6f-bce1-44de-8a6e-cf5e782f8bd6
DEVICE=eth0
ONBOOT=yes

systemctl restart network


</code></pre></div><h2 id="troubleshooting"><a href="#troubleshooting" class="header-anchor">#</a> Troubleshooting</h2> <h3 id="error-package-requires"><a href="#error-package-requires" class="header-anchor">#</a> error: Package Requires</h3> <div class="language- extra-class"><pre class="language-text"><code>[lyhistory/opt]#nginx -v
nginx version: nginx/1.12.1
[lyhistory/opt]#yum localinstall nginx-1.20.1-1.el7.ngx.x86_64.rpm 
Loaded plugins: product-id, search-disabled-repos, subscription-manager
This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.
Examining nginx-1.20.1-1.el7.ngx.x86_64.rpm: 1:nginx-1.20.1-1.el7.ngx.x86_64
Marking nginx-1.20.1-1.el7.ngx.x86_64.rpm as an update to 1:nginx-1.12.1-1.el7.ngx.x86_64
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package nginx.x86_64 1:1.12.1-1.el7.ngx will be updated
---&gt; Package nginx.x86_64 1:1.20.1-1.el7.ngx will be an update
--&gt; Processing Dependency: libcrypto.so.10(OPENSSL_1.0.2)(64bit) for package: 1:nginx-1.20.1-1.el7.ngx.x86_64
--&gt; Finished Dependency Resolution
Error: Package: 1:nginx-1.20.1-1.el7.ngx.x86_64 (/nginx-1.20.1-1.el7.ngx.x86_64)
           Requires: libcrypto.so.10(OPENSSL_1.0.2)(64bit)
 You could try using --skip-broken to work around the problem
** Found 2 pre-existing rpmdb problem(s), 'yum check' output follows:
redhat-access-insights-1.0.6-0.el7.noarch has missing requires of libcgroup
redhat-access-insights-1.0.6-0.el7.noarch has missing requires of libcgroup-tools
[lyhistory/opt]#cat /etc/os-release 
NAME=&quot;Red Hat Enterprise Linux Server&quot;
VERSION=&quot;7.2 (Maipo)&quot;
ID=&quot;rhel&quot;
ID_LIKE=&quot;fedora&quot;
VERSION_ID=&quot;7.2&quot;
PRETTY_NAME=&quot;Red Hat Enterprise Linux Server 7.2 (Maipo)&quot;
ANSI_COLOR=&quot;0;31&quot;
CPE_NAME=&quot;cpe:/o:redhat:enterprise_linux:7.2:GA:server&quot;
HOME_URL=&quot;https://www.redhat.com/&quot;
BUG_REPORT_URL=&quot;https://bugzilla.redhat.com/&quot;

REDHAT_BUGZILLA_PRODUCT=&quot;Red Hat Enterprise Linux 7&quot;
REDHAT_BUGZILLA_PRODUCT_VERSION=7.2
REDHAT_SUPPORT_PRODUCT=&quot;Red Hat Enterprise Linux&quot;
REDHAT_SUPPORT_PRODUCT_VERSION=&quot;7.2&quot;


[lyhistory/opt]#openssl version
OpenSSL 1.0.1e-fips 11 Feb 2013

[lyhistory/opt]#rpm -q --provides openssl
openssl = 1:1.0.1e-42.el7_1.9
openssl(x86-64) = 1:1.0.1e-42.el7_1.9
[lyhistory/opt]#rpm -q --provides openssl-libs | grep libcrypto.so.10
libcrypto.so.10()(64bit)
libcrypto.so.10(OPENSSL_1.0.1)(64bit)
libcrypto.so.10(OPENSSL_1.0.1_EC)(64bit)
libcrypto.so.10(libcrypto.so.10)(64bit)


[lyhistory/opt]#yum localinstall openssl-libs-1.0.2k-19.el7.x86_64.rpm 
Loaded plugins: product-id, search-disabled-repos, subscription-manager
This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.
Examining openssl-libs-1.0.2k-19.el7.x86_64.rpm: 1:openssl-libs-1.0.2k-19.el7.x86_64
Marking openssl-libs-1.0.2k-19.el7.x86_64.rpm as an update to 1:openssl-libs-1.0.1e-42.el7_1.9.x86_64
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package openssl-libs.x86_64 1:1.0.1e-42.el7_1.9 will be updated
--&gt; Processing Dependency: openssl-libs(x86-64) = 1:1.0.1e-42.el7_1.9 for package: 1:openssl-devel-1.0.1e-42.el7_1.9.x86_64
--&gt; Processing Dependency: openssl-libs(x86-64) = 1:1.0.1e-42.el7_1.9 for package: 1:openssl-1.0.1e-42.el7_1.9.x86_64
---&gt; Package openssl-libs.x86_64 1:1.0.2k-19.el7 will be an update
--&gt; Finished Dependency Resolution
Error: Package: 1:openssl-1.0.1e-42.el7_1.9.x86_64 (@anaconda/7.2)
           Requires: openssl-libs(x86-64) = 1:1.0.1e-42.el7_1.9
           Removing: 1:openssl-libs-1.0.1e-42.el7_1.9.x86_64 (@anaconda/7.2)
               openssl-libs(x86-64) = 1:1.0.1e-42.el7_1.9
           Updated By: 1:openssl-libs-1.0.2k-19.el7.x86_64 (/openssl-libs-1.0.2k-19.el7.x86_64)
               openssl-libs(x86-64) = 1:1.0.2k-19.el7
Error: Package: 1:openssl-devel-1.0.1e-42.el7_1.9.x86_64 (@local-repo)
           Requires: openssl-libs(x86-64) = 1:1.0.1e-42.el7_1.9
           Removing: 1:openssl-libs-1.0.1e-42.el7_1.9.x86_64 (@anaconda/7.2)
               openssl-libs(x86-64) = 1:1.0.1e-42.el7_1.9
           Updated By: 1:openssl-libs-1.0.2k-19.el7.x86_64 (/openssl-libs-1.0.2k-19.el7.x86_64)
               openssl-libs(x86-64) = 1:1.0.2k-19.el7
 You could try using --skip-broken to work around the problem
** Found 2 pre-existing rpmdb problem(s), 'yum check' output follows:
redhat-access-insights-1.0.6-0.el7.noarch has missing requires of libcgroup
redhat-access-insights-1.0.6-0.el7.noarch has missing requires of libcgroup-tools

[lyhistory]#rpm -q --whatrequires openssl
nginx-1.12.1-1.el7.ngx.x86_64



</code></pre></div><p>尝试解决</p> <div class="language- extra-class"><pre class="language-text"><code>[lyhistory]#yum remove openssl-libs.x86_64 / yum remove openssl-libs-1.0.1e-42.el7_1.9.x86_64
Loaded plugins: product-id, search-disabled-repos, subscription-manager
This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package openssl-libs.x86_64 1:1.0.1e-42.el7_1.9 will be erased
....
--&gt; Finished Dependency Resolution
Error: Trying to remove &quot;systemd&quot;, which is protected
Error: Trying to remove &quot;yum&quot;, which is protected
</code></pre></div><p>失败！</p> <p>最终解决</p> <div class="language- extra-class"><pre class="language-text"><code>cd /etc/yum.repos.d/
vi nginx.repo
  [nginx]
  name=nginx repo
  baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
  gpgcheck=0
  enabled=1
                 
yum clean all 
yum repolist 
yum update nginx 
rpm -qa | grep nginx 
nginx -v
</code></pre></div><p>未尝试的另一种方案：</p> <div class="language- extra-class"><pre class="language-text"><code>yum swap -- remove openssl-libs-1.0.1e-42.el7_1.9.x86_64 -- install openssl-libs-1.0.2k-19.el7.x86_64.rpm 
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.a8326da5.js" defer></script><script src="/docs/assets/js/2.95eca7e9.js" defer></script><script src="/docs/assets/js/156.0493c8d9.js" defer></script>
  </body>
</html>
