<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Basic | 计算机基础教程</title>
    <meta name="description" content="软件开发教程，白帽黑客入门教程，区块链入门教程，物联网，大数据">
    
    
    <link rel="preload" href="/docs/assets/css/0.styles.89d6372f.css" as="style"><link rel="preload" href="/docs/assets/js/app.d7a0657f.js" as="script"><link rel="preload" href="/docs/assets/js/2.dc5756d7.js" as="script"><link rel="preload" href="/docs/assets/js/124.a0a1fa15.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.ce6bc47b.js"><link rel="prefetch" href="/docs/assets/js/100.9585055b.js"><link rel="prefetch" href="/docs/assets/js/101.1c1bc510.js"><link rel="prefetch" href="/docs/assets/js/102.1eb70f6d.js"><link rel="prefetch" href="/docs/assets/js/103.4b36d126.js"><link rel="prefetch" href="/docs/assets/js/104.4183424a.js"><link rel="prefetch" href="/docs/assets/js/105.cb44ca2c.js"><link rel="prefetch" href="/docs/assets/js/106.0f1f8bf0.js"><link rel="prefetch" href="/docs/assets/js/107.8c97de85.js"><link rel="prefetch" href="/docs/assets/js/108.e7c5ed28.js"><link rel="prefetch" href="/docs/assets/js/109.11326621.js"><link rel="prefetch" href="/docs/assets/js/11.7543d77a.js"><link rel="prefetch" href="/docs/assets/js/110.2ddb5499.js"><link rel="prefetch" href="/docs/assets/js/111.5363dc23.js"><link rel="prefetch" href="/docs/assets/js/112.73a0265f.js"><link rel="prefetch" href="/docs/assets/js/113.427d7988.js"><link rel="prefetch" href="/docs/assets/js/114.8340fe8f.js"><link rel="prefetch" href="/docs/assets/js/115.c5da329a.js"><link rel="prefetch" href="/docs/assets/js/116.9aa798e1.js"><link rel="prefetch" href="/docs/assets/js/117.3832d1e2.js"><link rel="prefetch" href="/docs/assets/js/118.db190ed2.js"><link rel="prefetch" href="/docs/assets/js/119.41a372c4.js"><link rel="prefetch" href="/docs/assets/js/12.72633a9e.js"><link rel="prefetch" href="/docs/assets/js/120.7ad97d2c.js"><link rel="prefetch" href="/docs/assets/js/121.2e526440.js"><link rel="prefetch" href="/docs/assets/js/122.c30b674b.js"><link rel="prefetch" href="/docs/assets/js/123.e407ebb2.js"><link rel="prefetch" href="/docs/assets/js/125.10a0f8f7.js"><link rel="prefetch" href="/docs/assets/js/126.1ca39489.js"><link rel="prefetch" href="/docs/assets/js/127.dfda288c.js"><link rel="prefetch" href="/docs/assets/js/128.824e8a4b.js"><link rel="prefetch" href="/docs/assets/js/129.82d5f523.js"><link rel="prefetch" href="/docs/assets/js/13.a2df7c6b.js"><link rel="prefetch" href="/docs/assets/js/130.e033e840.js"><link rel="prefetch" href="/docs/assets/js/131.a9317e21.js"><link rel="prefetch" href="/docs/assets/js/132.8ad4b670.js"><link rel="prefetch" href="/docs/assets/js/133.13e6da00.js"><link rel="prefetch" href="/docs/assets/js/134.33680bef.js"><link rel="prefetch" href="/docs/assets/js/135.1f285bfa.js"><link rel="prefetch" href="/docs/assets/js/136.93c18c0d.js"><link rel="prefetch" href="/docs/assets/js/137.f11597e4.js"><link rel="prefetch" href="/docs/assets/js/138.bd1ed086.js"><link rel="prefetch" href="/docs/assets/js/139.c48e0d89.js"><link rel="prefetch" href="/docs/assets/js/14.e95de8d7.js"><link rel="prefetch" href="/docs/assets/js/140.fb69fe10.js"><link rel="prefetch" href="/docs/assets/js/141.596297b7.js"><link rel="prefetch" href="/docs/assets/js/142.b0e369da.js"><link rel="prefetch" href="/docs/assets/js/143.7b8ee668.js"><link rel="prefetch" href="/docs/assets/js/144.9ef2893a.js"><link rel="prefetch" href="/docs/assets/js/145.ea094c09.js"><link rel="prefetch" href="/docs/assets/js/146.00bda133.js"><link rel="prefetch" href="/docs/assets/js/147.304e186b.js"><link rel="prefetch" href="/docs/assets/js/148.b9a8aebd.js"><link rel="prefetch" href="/docs/assets/js/149.90401971.js"><link rel="prefetch" href="/docs/assets/js/15.8ab2e168.js"><link rel="prefetch" href="/docs/assets/js/150.847540bd.js"><link rel="prefetch" href="/docs/assets/js/151.31e094c3.js"><link rel="prefetch" href="/docs/assets/js/152.c5f9b571.js"><link rel="prefetch" href="/docs/assets/js/153.398576d6.js"><link rel="prefetch" href="/docs/assets/js/154.6952267f.js"><link rel="prefetch" href="/docs/assets/js/155.788ad7b9.js"><link rel="prefetch" href="/docs/assets/js/156.18b5e7d9.js"><link rel="prefetch" href="/docs/assets/js/157.45010093.js"><link rel="prefetch" href="/docs/assets/js/158.ad920b8d.js"><link rel="prefetch" href="/docs/assets/js/159.f14b5638.js"><link rel="prefetch" href="/docs/assets/js/16.8e3e454a.js"><link rel="prefetch" href="/docs/assets/js/160.4ef03629.js"><link rel="prefetch" href="/docs/assets/js/161.a6e82b17.js"><link rel="prefetch" href="/docs/assets/js/162.5080e4d1.js"><link rel="prefetch" href="/docs/assets/js/163.a5b844bc.js"><link rel="prefetch" href="/docs/assets/js/17.5603d183.js"><link rel="prefetch" href="/docs/assets/js/18.52d217c9.js"><link rel="prefetch" href="/docs/assets/js/19.cb7475da.js"><link rel="prefetch" href="/docs/assets/js/20.1501e782.js"><link rel="prefetch" href="/docs/assets/js/21.e09e4c61.js"><link rel="prefetch" href="/docs/assets/js/22.b16c67d9.js"><link rel="prefetch" href="/docs/assets/js/23.3aa7e609.js"><link rel="prefetch" href="/docs/assets/js/24.ead9c542.js"><link rel="prefetch" href="/docs/assets/js/25.73971747.js"><link rel="prefetch" href="/docs/assets/js/26.74705119.js"><link rel="prefetch" href="/docs/assets/js/27.0fa8e1df.js"><link rel="prefetch" href="/docs/assets/js/28.f6fe18b4.js"><link rel="prefetch" href="/docs/assets/js/29.bf7f861e.js"><link rel="prefetch" href="/docs/assets/js/3.9a7c1ddc.js"><link rel="prefetch" href="/docs/assets/js/30.81f03a3a.js"><link rel="prefetch" href="/docs/assets/js/31.7ff7f647.js"><link rel="prefetch" href="/docs/assets/js/32.b541ab54.js"><link rel="prefetch" href="/docs/assets/js/33.1e35504a.js"><link rel="prefetch" href="/docs/assets/js/34.22afaccf.js"><link rel="prefetch" href="/docs/assets/js/35.d479f42d.js"><link rel="prefetch" href="/docs/assets/js/36.7790b58e.js"><link rel="prefetch" href="/docs/assets/js/37.597e00eb.js"><link rel="prefetch" href="/docs/assets/js/38.9b4659af.js"><link rel="prefetch" href="/docs/assets/js/39.ac58eab3.js"><link rel="prefetch" href="/docs/assets/js/4.7d1e56e0.js"><link rel="prefetch" href="/docs/assets/js/40.f41d6ab2.js"><link rel="prefetch" href="/docs/assets/js/41.62d54f13.js"><link rel="prefetch" href="/docs/assets/js/42.f49db8d6.js"><link rel="prefetch" href="/docs/assets/js/43.10ffbee8.js"><link rel="prefetch" href="/docs/assets/js/44.378c6267.js"><link rel="prefetch" href="/docs/assets/js/45.392c5a0f.js"><link rel="prefetch" href="/docs/assets/js/46.d6d8f8ba.js"><link rel="prefetch" href="/docs/assets/js/47.b7a4c531.js"><link rel="prefetch" href="/docs/assets/js/48.ad5fa17b.js"><link rel="prefetch" href="/docs/assets/js/49.a97fb6d2.js"><link rel="prefetch" href="/docs/assets/js/5.8df5cec4.js"><link rel="prefetch" href="/docs/assets/js/50.1041a198.js"><link rel="prefetch" href="/docs/assets/js/51.69d32edb.js"><link rel="prefetch" href="/docs/assets/js/52.d3e83486.js"><link rel="prefetch" href="/docs/assets/js/53.1cc5fda5.js"><link rel="prefetch" href="/docs/assets/js/54.5f2ecf04.js"><link rel="prefetch" href="/docs/assets/js/55.f0253d38.js"><link rel="prefetch" href="/docs/assets/js/56.e4594bf8.js"><link rel="prefetch" href="/docs/assets/js/57.2f711e2b.js"><link rel="prefetch" href="/docs/assets/js/58.5b842999.js"><link rel="prefetch" href="/docs/assets/js/59.0b2a7cab.js"><link rel="prefetch" href="/docs/assets/js/6.f59a9763.js"><link rel="prefetch" href="/docs/assets/js/60.c716b08b.js"><link rel="prefetch" href="/docs/assets/js/61.9bdd4eb7.js"><link rel="prefetch" href="/docs/assets/js/62.a8465fbc.js"><link rel="prefetch" href="/docs/assets/js/63.6acfe33c.js"><link rel="prefetch" href="/docs/assets/js/64.8919994b.js"><link rel="prefetch" href="/docs/assets/js/65.baa9d6c1.js"><link rel="prefetch" href="/docs/assets/js/66.82611c2f.js"><link rel="prefetch" href="/docs/assets/js/67.1f706253.js"><link rel="prefetch" href="/docs/assets/js/68.22d0d616.js"><link rel="prefetch" href="/docs/assets/js/69.19ddb7d5.js"><link rel="prefetch" href="/docs/assets/js/7.0c0e690a.js"><link rel="prefetch" href="/docs/assets/js/70.57c85e1a.js"><link rel="prefetch" href="/docs/assets/js/71.9e36fa94.js"><link rel="prefetch" href="/docs/assets/js/72.5265057b.js"><link rel="prefetch" href="/docs/assets/js/73.2a949fcb.js"><link rel="prefetch" href="/docs/assets/js/74.bc2be1c7.js"><link rel="prefetch" href="/docs/assets/js/75.c5fd5d99.js"><link rel="prefetch" href="/docs/assets/js/76.8306bc5e.js"><link rel="prefetch" href="/docs/assets/js/77.1f282154.js"><link rel="prefetch" href="/docs/assets/js/78.68919345.js"><link rel="prefetch" href="/docs/assets/js/79.780e3bb0.js"><link rel="prefetch" href="/docs/assets/js/8.f2b5db77.js"><link rel="prefetch" href="/docs/assets/js/80.421757df.js"><link rel="prefetch" href="/docs/assets/js/81.c7cb61bf.js"><link rel="prefetch" href="/docs/assets/js/82.101b31b3.js"><link rel="prefetch" href="/docs/assets/js/83.1c2d4861.js"><link rel="prefetch" href="/docs/assets/js/84.62d407aa.js"><link rel="prefetch" href="/docs/assets/js/85.10905711.js"><link rel="prefetch" href="/docs/assets/js/86.617cb2f5.js"><link rel="prefetch" href="/docs/assets/js/87.bd131ebc.js"><link rel="prefetch" href="/docs/assets/js/88.a22e136a.js"><link rel="prefetch" href="/docs/assets/js/89.98d04265.js"><link rel="prefetch" href="/docs/assets/js/9.feb3d57b.js"><link rel="prefetch" href="/docs/assets/js/90.729abb6a.js"><link rel="prefetch" href="/docs/assets/js/91.e801341c.js"><link rel="prefetch" href="/docs/assets/js/92.b5e5aed5.js"><link rel="prefetch" href="/docs/assets/js/93.063a8764.js"><link rel="prefetch" href="/docs/assets/js/94.51f676cd.js"><link rel="prefetch" href="/docs/assets/js/95.814297a6.js"><link rel="prefetch" href="/docs/assets/js/96.199e821e.js"><link rel="prefetch" href="/docs/assets/js/97.e73f1d3c.js"><link rel="prefetch" href="/docs/assets/js/98.5a32c4ab.js"><link rel="prefetch" href="/docs/assets/js/99.9813c7d2.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.89d6372f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">计算机基础教程</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">机器指令</a></div><div class="nav-item"><a href="/docs/software/" class="nav-link router-link-active">软件基础</a></div><div class="nav-item"><a href="/docs/coder2hacker/" class="nav-link">白帽黑客</a></div><div class="nav-item"><a href="/docs/blockchain/" class="nav-link">区块链</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">机器指令</a></div><div class="nav-item"><a href="/docs/software/" class="nav-link router-link-active">软件基础</a></div><div class="nav-item"><a href="/docs/coder2hacker/" class="nav-link">白帽黑客</a></div><div class="nav-item"><a href="/docs/blockchain/" class="nav-link">区块链</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/software/" class="sidebar-link">软件基础</a></li><li><a href="/docs/coder2hacker/" class="sidebar-link">黑客入门</a></li><li><a href="/docs/blockchain/" class="sidebar-link">区块链入门</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="basic"><a href="#basic" class="header-anchor">#</a> Basic</h2> <p>chrome/network right click -&gt; header options-&gt;protocol，可以看到http/1.1</p> <h3 id="headers"><a href="#headers" class="header-anchor">#</a> headers</h3> <p><strong>Hop-by-hop headers</strong></p> <p>比如：</p> <p>client-&gt;reverse proxy (e.g. nginx)-&gt;proxied server(e.g spring mvc/netty rpc)，</p> <p>client到proxied server是end to end，而client和proxy以及，proxy和proxied server之间是跳到跳</p> <div class="language- extra-class"><pre class="language-text"><code> For the purpose of defining the behavior of caches and non-caching
   proxies, we divide HTTP headers into two categories:

      - End-to-end headers, which are  transmitted to the ultimate
        recipient of a request or response. End-to-end headers in
        responses MUST be stored as part of a cache entry and MUST be
        transmitted in any response formed from a cache entry.

      - Hop-by-hop headers, which are meaningful only for a single
        transport-level connection, and are not stored by caches or
        forwarded by proxies.

   The following HTTP/1.1 headers are hop-by-hop headers:

      - Connection
      - Keep-Alive
      - Proxy-Authenticate
      - Proxy-Authorization
      - TE
      - Trailers
      - Transfer-Encoding
      - Upgrade

</code></pre></div><h3 id="methods"><a href="#methods" class="header-anchor">#</a> methods</h3> <p>get post put option head preflight</p> <p><strong>HTTP CONNECT method</strong>
The most common form of HTTP tunneling is the standardized HTTP CONNECT method. In this mechanism, the client asks an HTTP proxy server to forward the TCP connection to the desired destination. The server then proceeds to make the connection on behalf of the client. Once the connection has been established by the server, the proxy server continues to proxy the TCP stream to and from the client. Only the initial connection request is HTTP - after that, the server simply proxies the established TCP connection.</p> <p>This mechanism is how a client behind an HTTP proxy can access websites using SSL or TLS (i.e. HTTPS). Proxy servers may also limit connections by only allowing connections to the default HTTPS port 443, whitelisting hosts, or blocking traffic which doesn't appear to be SSL.</p> <h2 id="websocket"><a href="#websocket" class="header-anchor">#</a> websocket</h2> <p>To turn a connection between a client and server from HTTP/1.1 into WebSocket, the <a href="https://tools.ietf.org/html/rfc2616#section-14.42" target="_blank" rel="noopener noreferrer">protocol switch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> mechanism available in HTTP/1.1 is used.</p> <p>protocol switch 是要在http头部加上 &quot;Upgrade&quot;，但是这个header是跳对跳的，所以client-server没有问题，但是如果中间是带有proxy的，比如：</p> <p>(client-&gt;forward proxy)-&gt;remote server</p> <p>client-&gt;(reverse proxy-&gt;proxied server)</p> <p>正向代理（对remote隐藏客户端）的情况下，client还可以通过使用http connect方法解决这个问题，因为client知道remote server，With forward proxying, clients may use the <code>CONNECT</code> method to circumvent this issue.</p> <p>但是这个方法无法在反向代理（对client隐藏proxied server）情况下使用，因为client只知道reverse proxy的存在，proxied server对其不可见  This does not work with reverse proxying however, since clients are not aware of any proxy servers, and special processing on a proxy server is required.</p> <p>反向代理下，解决办法就是需要reverse proxy server本身要实现一种机制，可以让其设置这个Upgrade header，比如对于nginx来说：
Since version 1.3.13, nginx implements special mode of operation that allows setting up a tunnel between a client and proxied server if the proxied server returned a response with the code 101 (Switching Protocols), and the client asked for a protocol switch via the “Upgrade” header in a request，因为Upgrade header是跳到跳的，所以nginx需要设置如下</p> <div class="language- extra-class"><pre class="language-text"><code>location /chat/ {
    proxy_pass http://backend;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &quot;upgrade&quot;;
}
    
</code></pre></div><p>举例，client端发起：</p> <div class="language- extra-class"><pre class="language-text"><code>Request:
GET ws://10.136.100.45/websocket HTTP/1.1
Host: 10.136.100.45
Connection: Upgrade
Pragma: no-cache
Cache-Control: no-cache
Upgrade: websocket
Origin: http://10.136.100.45
Sec-WebSocket-Version: 13
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.101 Safari/537.36
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Sec-GPC: 1
Sec-WebSocket-Key: rlNWZDD4jGOrhYjTYv5UEA==
Sec-WebSocket-Extensions: permessage-deflate; client_max_window_bits

Response:
HTTP/1.1 101 Switching Protocols
Server: nginx/1.16.1
Date: Fri, 29 Jan 2021 06:17:07 GMT
Connection: upgrade
upgrade: websocket
sec-websocket-accept: l+0+vEsZvDECt5AGda7vPI3BwME=

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.d7a0657f.js" defer></script><script src="/docs/assets/js/2.dc5756d7.js" defer></script><script src="/docs/assets/js/124.a0a1fa15.js" defer></script>
  </body>
</html>
