<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ËÆ°ÁÆóÊú∫Âü∫Á°ÄÊïôÁ®ã</title>
    <meta name="description" content="ËΩØ‰ª∂ÂºÄÂèëÊïôÁ®ãÔºåÁôΩÂ∏ΩÈªëÂÆ¢ÂÖ•Èó®ÊïôÁ®ãÔºåÂå∫ÂùóÈìæÂÖ•Èó®ÊïôÁ®ãÔºåÁâ©ËÅîÁΩëÔºåÂ§ßÊï∞ÊçÆ">
    
    
    <link rel="preload" href="/docs/assets/css/0.styles.89d6372f.css" as="style"><link rel="preload" href="/docs/assets/js/app.eabc2ebc.js" as="script"><link rel="preload" href="/docs/assets/js/2.dc5756d7.js" as="script"><link rel="preload" href="/docs/assets/js/109.4f068233.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.9367df13.js"><link rel="prefetch" href="/docs/assets/js/100.b2a9d795.js"><link rel="prefetch" href="/docs/assets/js/101.2c90069f.js"><link rel="prefetch" href="/docs/assets/js/102.81d94ceb.js"><link rel="prefetch" href="/docs/assets/js/103.62463559.js"><link rel="prefetch" href="/docs/assets/js/104.79408923.js"><link rel="prefetch" href="/docs/assets/js/105.9fd45402.js"><link rel="prefetch" href="/docs/assets/js/106.ee95207a.js"><link rel="prefetch" href="/docs/assets/js/107.b23e7512.js"><link rel="prefetch" href="/docs/assets/js/108.37c8ded9.js"><link rel="prefetch" href="/docs/assets/js/11.9ae730cf.js"><link rel="prefetch" href="/docs/assets/js/110.ca8c95ee.js"><link rel="prefetch" href="/docs/assets/js/111.78c4ba56.js"><link rel="prefetch" href="/docs/assets/js/112.ab2d4fd3.js"><link rel="prefetch" href="/docs/assets/js/113.35cbe32b.js"><link rel="prefetch" href="/docs/assets/js/114.3ba87b1e.js"><link rel="prefetch" href="/docs/assets/js/115.6baefa86.js"><link rel="prefetch" href="/docs/assets/js/116.1ba86509.js"><link rel="prefetch" href="/docs/assets/js/117.77fbdabb.js"><link rel="prefetch" href="/docs/assets/js/118.672420aa.js"><link rel="prefetch" href="/docs/assets/js/119.b4ebe8e4.js"><link rel="prefetch" href="/docs/assets/js/12.da4abbf9.js"><link rel="prefetch" href="/docs/assets/js/120.4febc4f1.js"><link rel="prefetch" href="/docs/assets/js/121.d86e431b.js"><link rel="prefetch" href="/docs/assets/js/122.9258bd09.js"><link rel="prefetch" href="/docs/assets/js/123.d19253fd.js"><link rel="prefetch" href="/docs/assets/js/124.1d9e4c2a.js"><link rel="prefetch" href="/docs/assets/js/125.e4a062da.js"><link rel="prefetch" href="/docs/assets/js/126.759e63ac.js"><link rel="prefetch" href="/docs/assets/js/127.064f18f7.js"><link rel="prefetch" href="/docs/assets/js/128.23c97c34.js"><link rel="prefetch" href="/docs/assets/js/129.efbc05a1.js"><link rel="prefetch" href="/docs/assets/js/13.3f6ed76a.js"><link rel="prefetch" href="/docs/assets/js/130.54514161.js"><link rel="prefetch" href="/docs/assets/js/131.01036264.js"><link rel="prefetch" href="/docs/assets/js/132.9af7923a.js"><link rel="prefetch" href="/docs/assets/js/133.3bc61fff.js"><link rel="prefetch" href="/docs/assets/js/134.57e4bd09.js"><link rel="prefetch" href="/docs/assets/js/135.52fc9feb.js"><link rel="prefetch" href="/docs/assets/js/136.080078a1.js"><link rel="prefetch" href="/docs/assets/js/137.c2a6a0e7.js"><link rel="prefetch" href="/docs/assets/js/138.a2c3e344.js"><link rel="prefetch" href="/docs/assets/js/139.4022b4c0.js"><link rel="prefetch" href="/docs/assets/js/14.fb3b0109.js"><link rel="prefetch" href="/docs/assets/js/140.95243dad.js"><link rel="prefetch" href="/docs/assets/js/141.3d9b4095.js"><link rel="prefetch" href="/docs/assets/js/142.3a5699da.js"><link rel="prefetch" href="/docs/assets/js/143.0ea7193c.js"><link rel="prefetch" href="/docs/assets/js/144.cf55588c.js"><link rel="prefetch" href="/docs/assets/js/145.47074be0.js"><link rel="prefetch" href="/docs/assets/js/146.0371d819.js"><link rel="prefetch" href="/docs/assets/js/147.2467f2db.js"><link rel="prefetch" href="/docs/assets/js/148.1aef72ce.js"><link rel="prefetch" href="/docs/assets/js/149.ccbbf1eb.js"><link rel="prefetch" href="/docs/assets/js/15.ecea33c9.js"><link rel="prefetch" href="/docs/assets/js/150.f469c9b8.js"><link rel="prefetch" href="/docs/assets/js/151.5d897da8.js"><link rel="prefetch" href="/docs/assets/js/152.f0627450.js"><link rel="prefetch" href="/docs/assets/js/153.54398bd4.js"><link rel="prefetch" href="/docs/assets/js/154.0a71781b.js"><link rel="prefetch" href="/docs/assets/js/155.592172d8.js"><link rel="prefetch" href="/docs/assets/js/156.8134caf4.js"><link rel="prefetch" href="/docs/assets/js/157.3e61c03d.js"><link rel="prefetch" href="/docs/assets/js/158.063104e4.js"><link rel="prefetch" href="/docs/assets/js/159.4ef56409.js"><link rel="prefetch" href="/docs/assets/js/16.067c6446.js"><link rel="prefetch" href="/docs/assets/js/160.2ba86c30.js"><link rel="prefetch" href="/docs/assets/js/161.0d17102e.js"><link rel="prefetch" href="/docs/assets/js/162.daf03d68.js"><link rel="prefetch" href="/docs/assets/js/163.f70d4527.js"><link rel="prefetch" href="/docs/assets/js/164.a4cb87c7.js"><link rel="prefetch" href="/docs/assets/js/165.46b57da1.js"><link rel="prefetch" href="/docs/assets/js/166.c35b4495.js"><link rel="prefetch" href="/docs/assets/js/167.b66eab2f.js"><link rel="prefetch" href="/docs/assets/js/168.bf147547.js"><link rel="prefetch" href="/docs/assets/js/169.f4a0f6a3.js"><link rel="prefetch" href="/docs/assets/js/17.8acde0c0.js"><link rel="prefetch" href="/docs/assets/js/170.e952df97.js"><link rel="prefetch" href="/docs/assets/js/171.d38c1aa5.js"><link rel="prefetch" href="/docs/assets/js/172.7cb21724.js"><link rel="prefetch" href="/docs/assets/js/173.2e96576d.js"><link rel="prefetch" href="/docs/assets/js/174.ff8a875c.js"><link rel="prefetch" href="/docs/assets/js/175.1cb70593.js"><link rel="prefetch" href="/docs/assets/js/176.ef5b8018.js"><link rel="prefetch" href="/docs/assets/js/177.e41b55ce.js"><link rel="prefetch" href="/docs/assets/js/178.715f0548.js"><link rel="prefetch" href="/docs/assets/js/179.c48ef3ab.js"><link rel="prefetch" href="/docs/assets/js/18.ef0c3fc1.js"><link rel="prefetch" href="/docs/assets/js/180.50951521.js"><link rel="prefetch" href="/docs/assets/js/181.adc8d6e7.js"><link rel="prefetch" href="/docs/assets/js/182.64446ee6.js"><link rel="prefetch" href="/docs/assets/js/183.1b10f271.js"><link rel="prefetch" href="/docs/assets/js/184.c253e73c.js"><link rel="prefetch" href="/docs/assets/js/185.707db21a.js"><link rel="prefetch" href="/docs/assets/js/186.b66959f2.js"><link rel="prefetch" href="/docs/assets/js/187.4f92e6a8.js"><link rel="prefetch" href="/docs/assets/js/188.5515636d.js"><link rel="prefetch" href="/docs/assets/js/189.285ee232.js"><link rel="prefetch" href="/docs/assets/js/19.54973c60.js"><link rel="prefetch" href="/docs/assets/js/190.7c9ed8a5.js"><link rel="prefetch" href="/docs/assets/js/191.a7708a5b.js"><link rel="prefetch" href="/docs/assets/js/192.e1f04c2c.js"><link rel="prefetch" href="/docs/assets/js/193.75f34a8a.js"><link rel="prefetch" href="/docs/assets/js/194.2c544e50.js"><link rel="prefetch" href="/docs/assets/js/195.99b0e46e.js"><link rel="prefetch" href="/docs/assets/js/196.58759193.js"><link rel="prefetch" href="/docs/assets/js/197.920ff518.js"><link rel="prefetch" href="/docs/assets/js/20.9111aa12.js"><link rel="prefetch" href="/docs/assets/js/21.c2df7120.js"><link rel="prefetch" href="/docs/assets/js/22.22acbd8f.js"><link rel="prefetch" href="/docs/assets/js/23.154c6b7e.js"><link rel="prefetch" href="/docs/assets/js/24.40e27830.js"><link rel="prefetch" href="/docs/assets/js/25.8dce653e.js"><link rel="prefetch" href="/docs/assets/js/26.bb1bf817.js"><link rel="prefetch" href="/docs/assets/js/27.9eb6552e.js"><link rel="prefetch" href="/docs/assets/js/28.34e44507.js"><link rel="prefetch" href="/docs/assets/js/29.f39a5684.js"><link rel="prefetch" href="/docs/assets/js/3.d261c412.js"><link rel="prefetch" href="/docs/assets/js/30.400dd6a7.js"><link rel="prefetch" href="/docs/assets/js/31.65e4c908.js"><link rel="prefetch" href="/docs/assets/js/32.0fa24375.js"><link rel="prefetch" href="/docs/assets/js/33.4a058b7d.js"><link rel="prefetch" href="/docs/assets/js/34.28adacab.js"><link rel="prefetch" href="/docs/assets/js/35.5ced6d6f.js"><link rel="prefetch" href="/docs/assets/js/36.38e1e488.js"><link rel="prefetch" href="/docs/assets/js/37.b0c07f67.js"><link rel="prefetch" href="/docs/assets/js/38.d2b35ea7.js"><link rel="prefetch" href="/docs/assets/js/39.35785227.js"><link rel="prefetch" href="/docs/assets/js/4.7d1e56e0.js"><link rel="prefetch" href="/docs/assets/js/40.ba7b82c5.js"><link rel="prefetch" href="/docs/assets/js/41.443a9b31.js"><link rel="prefetch" href="/docs/assets/js/42.9cece8c8.js"><link rel="prefetch" href="/docs/assets/js/43.8cb65eca.js"><link rel="prefetch" href="/docs/assets/js/44.46075dc3.js"><link rel="prefetch" href="/docs/assets/js/45.f3cfff10.js"><link rel="prefetch" href="/docs/assets/js/46.e7094364.js"><link rel="prefetch" href="/docs/assets/js/47.31453b0f.js"><link rel="prefetch" href="/docs/assets/js/48.c1ce9cab.js"><link rel="prefetch" href="/docs/assets/js/49.b1e3abe0.js"><link rel="prefetch" href="/docs/assets/js/5.540a7edc.js"><link rel="prefetch" href="/docs/assets/js/50.6fde47b0.js"><link rel="prefetch" href="/docs/assets/js/51.1beeb7f6.js"><link rel="prefetch" href="/docs/assets/js/52.f72b9477.js"><link rel="prefetch" href="/docs/assets/js/53.e9b492e4.js"><link rel="prefetch" href="/docs/assets/js/54.eea6a3ae.js"><link rel="prefetch" href="/docs/assets/js/55.354ad178.js"><link rel="prefetch" href="/docs/assets/js/56.895beea6.js"><link rel="prefetch" href="/docs/assets/js/57.5947ae98.js"><link rel="prefetch" href="/docs/assets/js/58.f0943f92.js"><link rel="prefetch" href="/docs/assets/js/59.878eef37.js"><link rel="prefetch" href="/docs/assets/js/6.ecad960f.js"><link rel="prefetch" href="/docs/assets/js/60.91d9f062.js"><link rel="prefetch" href="/docs/assets/js/61.8f3f5aea.js"><link rel="prefetch" href="/docs/assets/js/62.9d4e1daf.js"><link rel="prefetch" href="/docs/assets/js/63.c67953b4.js"><link rel="prefetch" href="/docs/assets/js/64.e7b91d1f.js"><link rel="prefetch" href="/docs/assets/js/65.ded5e4df.js"><link rel="prefetch" href="/docs/assets/js/66.7ea161c3.js"><link rel="prefetch" href="/docs/assets/js/67.aa74feb7.js"><link rel="prefetch" href="/docs/assets/js/68.99179d94.js"><link rel="prefetch" href="/docs/assets/js/69.406994ec.js"><link rel="prefetch" href="/docs/assets/js/7.3552a3d6.js"><link rel="prefetch" href="/docs/assets/js/70.edd8dd70.js"><link rel="prefetch" href="/docs/assets/js/71.ccfcadc3.js"><link rel="prefetch" href="/docs/assets/js/72.0eb626bd.js"><link rel="prefetch" href="/docs/assets/js/73.a4642749.js"><link rel="prefetch" href="/docs/assets/js/74.bea7d9c0.js"><link rel="prefetch" href="/docs/assets/js/75.5b44e281.js"><link rel="prefetch" href="/docs/assets/js/76.ae4eb08a.js"><link rel="prefetch" href="/docs/assets/js/77.dec39cbe.js"><link rel="prefetch" href="/docs/assets/js/78.43038a13.js"><link rel="prefetch" href="/docs/assets/js/79.9436c918.js"><link rel="prefetch" href="/docs/assets/js/8.8155851b.js"><link rel="prefetch" href="/docs/assets/js/80.9efd426e.js"><link rel="prefetch" href="/docs/assets/js/81.c3e55010.js"><link rel="prefetch" href="/docs/assets/js/82.76eeed6a.js"><link rel="prefetch" href="/docs/assets/js/83.1400cfba.js"><link rel="prefetch" href="/docs/assets/js/84.88f4ce2e.js"><link rel="prefetch" href="/docs/assets/js/85.1767347b.js"><link rel="prefetch" href="/docs/assets/js/86.317d27e5.js"><link rel="prefetch" href="/docs/assets/js/87.a6e23781.js"><link rel="prefetch" href="/docs/assets/js/88.22dc1f1a.js"><link rel="prefetch" href="/docs/assets/js/89.7f7ec646.js"><link rel="prefetch" href="/docs/assets/js/9.705d414e.js"><link rel="prefetch" href="/docs/assets/js/90.3bf8846b.js"><link rel="prefetch" href="/docs/assets/js/91.c15d4fab.js"><link rel="prefetch" href="/docs/assets/js/92.dfbb6dc2.js"><link rel="prefetch" href="/docs/assets/js/93.25f77836.js"><link rel="prefetch" href="/docs/assets/js/94.e60a6a2c.js"><link rel="prefetch" href="/docs/assets/js/95.4c721187.js"><link rel="prefetch" href="/docs/assets/js/96.538e79ad.js"><link rel="prefetch" href="/docs/assets/js/97.8915c58f.js"><link rel="prefetch" href="/docs/assets/js/98.db1716d2.js"><link rel="prefetch" href="/docs/assets/js/99.2c99302a.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.89d6372f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">ËÆ°ÁÆóÊú∫Âü∫Á°ÄÊïôÁ®ã</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">Êú∫Âô®Êåá‰ª§</a></div><div class="nav-item"><a href="/docs/software/" class="nav-link router-link-active">ËΩØ‰ª∂Âü∫Á°Ä</a></div><div class="nav-item"><a href="/docs/coder2hacker/" class="nav-link">ÁôΩÂ∏ΩÈªëÂÆ¢</a></div><div class="nav-item"><a href="/docs/blockchain/" class="nav-link">Âå∫ÂùóÈìæ</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">Êú∫Âô®Êåá‰ª§</a></div><div class="nav-item"><a href="/docs/software/" class="nav-link router-link-active">ËΩØ‰ª∂Âü∫Á°Ä</a></div><div class="nav-item"><a href="/docs/coder2hacker/" class="nav-link">ÁôΩÂ∏ΩÈªëÂÆ¢</a></div><div class="nav-item"><a href="/docs/blockchain/" class="nav-link">Âå∫ÂùóÈìæ</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/software/database/mysql.html#_0-knowledge-base" class="sidebar-link">0. Knowledge Base</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/software/database/mysql.html#_1-setup" class="sidebar-link">1.Setup</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#_1-1-install-on-centos" class="sidebar-link">1.1 Install on centos</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#_1-2-install-on-windows" class="sidebar-link">1.2 Install on windows</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#_1-3-client-tools" class="sidebar-link">1.3 Client Tools</a></li></ul></li><li><a href="/docs/software/database/mysql.html#_2-db-management" class="sidebar-link">2. DB Management</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#_2-1-mysql-cli" class="sidebar-link">2.1 mysql-cli</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#_2-2-database-management" class="sidebar-link">2.2 database management</a></li></ul></li><li><a href="/docs/software/database/mysql.html#_4-sql" class="sidebar-link">4. SQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#basic" class="sidebar-link">Basic</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#advance" class="sidebar-link">Advance</a></li></ul></li><li><a href="/docs/software/database/mysql.html#_5-ha" class="sidebar-link">5. HA</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#ÁêÜËÆ∫" class="sidebar-link">ÁêÜËÆ∫</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#‰∏§ÁßçÊ®°Âºè" class="sidebar-link">‰∏§ÁßçÊ®°Âºè</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#Áõ∏ÂÖ≥ÊùÉÈôê" class="sidebar-link">Áõ∏ÂÖ≥ÊùÉÈôê</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#replication-solution" class="sidebar-link">Replication Solution</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#sync-replication" class="sidebar-link">Sync Replication</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#replication-troubleshooting" class="sidebar-link">Replication Troubleshooting</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#keepalived-mysql-È´òÂèØÁî®" class="sidebar-link">Keepalived+ mysql È´òÂèØÁî®</a></li></ul></li><li><a href="/docs/software/database/mysql.html#_3-troubleshooting" class="sidebar-link">3 Troubleshooting</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#host-xxx-xx-xxx-xxx-is-not-allowed-to-connect-to-this-mysql-server" class="sidebar-link">Host 'xxx.xx.xxx.xxx' is not allowed to connect to this MySQL server**</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#mysql-workbench-the-type-initializer-for-htmlrenderer-utils-fontsutils-threw-an-exception" class="sidebar-link">mysql workbench The type initializer for 'HtmlRenderer.Utils.FontsUtils' threw an exception.**</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#mysqldump-stored-procedure-routines-faild" class="sidebar-link">mysqldump stored procedure --routines faild</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#script-import-issue" class="sidebar-link">script import issue;</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#fixing-‚Äúlock-wait-timeout-exceeded-try-restarting-transaction‚Äù-for-a-stuck-mysql-table" class="sidebar-link">Fixing ‚ÄúLock wait timeout exceeded; try restarting transaction‚Äù for a 'stuck&quot; Mysql table?</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#upgrade-trouble-shooting" class="sidebar-link">upgrade trouble shooting</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#access-denied-for-user-root-localhost-using-password-no-when-trying-to-connect" class="sidebar-link">Access denied for user 'root'@'localhost' (using password: NO) when trying to connect**</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#ÈöèÊú∫Âá∫Áé∞ÁöÑconnection-timeout" class="sidebar-link">ÈöèÊú∫Âá∫Áé∞ÁöÑconnection timeout</a></li><li class="sidebar-sub-header"><a href="/docs/software/database/mysql.html#my-cnf-not-working" class="sidebar-link">my.cnf not working</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><a href="/docs/software">ÂõûÁõÆÂΩï</a>  „ÄämysqlÂÆûÁî®Âü∫Á°Ä„Äã</p> <h2 id="_0-knowledge-base"><a href="#_0-knowledge-base" class="header-anchor">#</a> 0. Knowledge Base</h2> <p>default storage engine: <strong>InnoDB</strong></p> <p>https://dev.mysql.com/doc/refman/5.6/en/innodb-introduction.html</p> <p>other engine:</p> <p><strong>MyISAM</strong>: https://kinsta.com/knowledgebase/convert-myisam-to-innodb/</p> <h2 id="_1-setup"><a href="#_1-setup" class="header-anchor">#</a> 1.Setup</h2> <h3 id="_1-1-install-on-centos"><a href="#_1-1-install-on-centos" class="header-anchor">#</a> 1.1 Install on centos</h3> <p><strong>Method 1: Using rpm</strong></p> <p><strong>Method 2: Using tar</strong></p> <div class="language- extra-class"><pre class="language-text"><code>tar -xvf mysql-5.7.26-1.el7.x86_64.rpm-bundle.tar
‚Ä¢	mysql-community-client-5.7.32-1.el7.x86_64.rpm
‚Ä¢	mysql-community-common-5.7.32-1.el7.x86_64.rpm
‚Ä¢	mysql-community-libs-5.7.32-1.el7.x86_64.rpm
‚Ä¢	mysql-community-libs-compat-5.7.32-1.el7.x86_64.rpm
‚Ä¢	mysql-community-server-5.7.32-1.el7.x86_64.rpm


yum install mysql-community-{server,client,common,libs}-* mysql-5.*¬≠

?#Install error
https://princetonits.com/centos7-mysql-install-fails-due-conflict-libmysqlclient/
yum list installed mariadb\*
yum remove mariadb-libs.x86_64

vim /etc/my.cnf
Bind-address:0.0.0.0
service mysqld stop/start
</code></pre></div><p>MysqlÈªòËÆ§ÂØÜÁ†ÅÔºö
/var/log/mysqld.log
A temporary password
https://www.techietown.info/2017/08/mysql-default-root-password-on-centos7/</p> <p>password policy:</p> <div class="language- extra-class"><pre class="language-text"><code>mysql -uroot -p
SET PASSWORD = PASSWORD(‚Äò1qaz#EDC‚Äô);
SHOW VARIABLES LIKE 'validate_password%';
SET GLOBAL validate_password_length = 6;
SET GLOBAL validate_password_number_count = 0;
SET PASSWORD = PASSWORD(‚Äò123456‚Äô);
</code></pre></div><p>create database:</p> <div class="language- extra-class"><pre class="language-text"><code>CREATE USER 'newuser'@'%' IDENTIFIED BY 'password';
GRANT ALL PRIVILEGES ON dbname.* TO 'newuser'@'%' identified by 'password';
#GRANT ALL PRIVILEGES ON *.* TO 'newuser'@'localhost';
FLUSH PRIVILEGES;

SHOW GRANTS FOR 'root'@'localhost';
SELECT user, host FROM mysql.user;
DROP USER ''@'localhost';

create database dbname;

</code></pre></div><h3 id="_1-2-install-on-windows"><a href="#_1-2-install-on-windows" class="header-anchor">#</a> 1.2 Install on windows</h3> <p><img src="/docs/docs_image/software/mysql/mysql01.png" alt=""></p> <p>Setup replication
https://lyhistory.com/mysql_replication/#</p> <h3 id="_1-3-client-tools"><a href="#_1-3-client-tools" class="header-anchor">#</a> 1.3 Client Tools</h3> <p><strong>mysql built-in tools:</strong></p> <p>mysql</p> <p>mysqldump</p> <p>mysqladmin</p> <p>È™åËØÅÈÖçÁΩÆÔºö<code>mysqld --verbose --help | grep skip-slave-start</code></p> <p>mysqlbinlog:</p> <p>https://dev.mysql.com/doc/refman/8.0/en/mysqlbinlog.html</p> <p>https://www.zhihu.com/tardis/sogou/art/66501464</p> <div class="language- extra-class"><pre class="language-text"><code>sudo mysqlbinlog --verbose --start-position=653218764 --stop-position=653263629 /var/lib/mysql/mysql-bin.000007 &gt; check-mysql-bin.000007-14

--verbose Âú®BINLOG '‰πãÂêéÊâìÂç∞sqlËØ≠Âè•
</code></pre></div><p><strong>3rd party:</strong></p> <p>http://sqlfiddle.com/</p> <p>Dbeaver export mysql
Export without data https://github.com/dbeaver/dbeaver/issues/2176</p> <p>mysql workbench</p> <h2 id="_2-db-management"><a href="#_2-db-management" class="header-anchor">#</a> 2. DB Management</h2> <h3 id="_2-1-mysql-cli"><a href="#_2-1-mysql-cli" class="header-anchor">#</a> 2.1 mysql-cli</h3> <p>vertical format:</p> <p>mysql&gt; select * from table limit 1 \G;</p> <p>ÂçÉ‰∏á‰∏çË¶ÅÁî®ÂèåÂºïÂè∑ÔºåÂ∞§ÂÖ∂ÊòØpasswordÔºåÊâÄÊúâÁöÑ-u -p -eÁ≠âÁ≠âÂêéÈù¢‰∏çË¶ÅÂä†Á©∫Ê†ºÔºÅ</p> <div class="language- extra-class"><pre class="language-text"><code>mysql -uroot -p123456
mysql --login-path=XXXX


mysql_config_editor/login-path
mysql_config_editor print --all
mysql_config_editor set --login-path=host-rpl --host=localhost --port=3306 --user=replicator --password

</code></pre></div><p>grep:</p> <div class="language- extra-class"><pre class="language-text"><code>pager grep ***
\n
https://stackoverflow.com/questions/10177465/grep-in-mysql-cli-interpretter
</code></pre></div><h3 id="_2-2-database-management"><a href="#_2-2-database-management" class="header-anchor">#</a> 2.2 database management</h3> <h4 id="users-permissions"><a href="#users-permissions" class="header-anchor">#</a> Users &amp; Permissions</h4> <p>https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html</p> <p><a href="https://stackoverflow.com/questions/11634084/are-users-user-and-userlocalhost-not-the-same" target="_blank" rel="noopener noreferrer"> 'User'@'%' and 'User'@'localhost'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language- extra-class"><pre class="language-text"><code>SELECT user,host FROM mysql.user;

SHOW GRANTS FOR 'test'@'localhost';
GRANT ALL PRIVILEGES ON *.* TO 'test'@'localhost' WITH GRANT OPTION;
REVOKE ALL ON *.* FROM 'test'@'localhost';
flush privileges;

DROP USER 'test'@'localhost';
</code></pre></div><h4 id="global-status"><a href="#global-status" class="header-anchor">#</a> Global Status</h4> <div class="language- extra-class"><pre class="language-text"><code>show global variables like '%timeout'; 
show variables like '%engine%';
SHOW VARIABLES LIKE &quot;max_connections&quot;;
select @@wait_timeout;
show variables like '%error%';

show global status like '%connection%';
show global status like '%errors%';
show global status like '%thread%';
show processlist;

select * from mysql.user;

show variables like &quot;%time_zone%&quot;;
show processlist;
select substring_index(host,':' ,1) as client_ip,Command,Time from information_schema.processlist;
show variables like 'max_connections';
SHOW GLOBAL STATUS LIKE &quot;Threads_connected&quot;;
show variables like 'log_error';

use mysql;
SHOW CREATE TABLE innodb_index_stats;
</code></pre></div><h4 id="security"><a href="#security" class="header-anchor">#</a> Security</h4> <p><strong>disable remote Access</strong></p> <div class="language- extra-class"><pre class="language-text"><code>DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');
FLUSH PRIVILEGES;

my.ini:
[mysqld]
.....
skip-networking

vim /etc/my.cnf
Bind-address:127.0.0.1
service mysqld stop/start
</code></pre></div><p><strong>turn off local_infile</strong></p> <p>https://dev.mysql.com/doc/refman/8.0/en/load-data-local-security.html</p> <div class="language- extra-class"><pre class="language-text"><code>SHOW VARIABLES WHERE Variable_name = 'local_infile';
SET GLOBAL local_infile = 'OFF';
</code></pre></div><h4 id="backup-restore"><a href="#backup-restore" class="header-anchor">#</a> backup&amp;restore</h4> <p>backup https://dev.mysql.com/doc/refman/5.7/en/mysqldump-sql-format.html</p> <p>Âü∫Êú¨Áî®Ê≥ï</p> <div class="language- extra-class"><pre class="language-text"><code>--------------------------------------------------------------
--- all db
--------------------------------------------------------------
mysqldump -uroot -p123456--all-databases &gt; mysqldump_20190524.sql

--------------------------------------------------------------
--- schema only
--------------------------------------------------------------
mysqldump -uXXX -pXXX --no-tablespaces --routines --events --no-data --set-gtid-purged=OFF DBName &gt; schema.sql

mysql -uXXX -pXXX  DBName &lt; schema.sql

--------------------------------------------------------------
--- options
--------------------------------------------------------------
If you used the **‚Äìset-gtid-purged=ON** option, you would see the value of the [Global Transaction Identifier‚Äôs](http://dev.mysql.com/doc/refman/5.6/en/replication-gtids-concepts.html) (GTID‚Äôs):
--
--GTID state at the beginning of the backup 
--

SET @@GLOBAL.GTID_PURGED='';

-routines
Include stored routines (procedures and functions) 
</code></pre></div><p>ËÑöÊú¨Ôºö</p> <div class="language- extra-class"><pre class="language-text"><code>-----------------------------------------------------------------
--- db_backup.sh
-----------------------------------------------------------------
#!/bin/bash
# Shell script to backup MySQL database

# Set variables
V_USER=&quot;root&quot;	# DB_USERNAME
V_PASS=&quot;123456&quot;	# DB_PASSWORD

V_DBS=&quot;db1
db2&quot;

V_DEST=&quot;/opt/backup/&quot; # Backup Dest directory
V_DAYS=365 # How many days old files must be to be removed

# Linux bin paths
MYSQL=&quot;$(which mysql)&quot;
MYSQLDUMP=&quot;$(which mysqldump)&quot;
GZIP=&quot;$(which gzip)&quot;

# Create Backup sub-directories
NOW=&quot;$(date +&quot;%Y%m%d&quot;)&quot;
MBD=&quot;$V_DEST/$NOW/mysql&quot;
install -d $MBD


# Archive database dumps
for db in $V_DBS
do
    FILE=&quot;$MBD/$db.sql&quot;
    echo &quot;Start to backup $db ....&quot;
    $MYSQLDUMP -u$V_USER -p$V_PASS $db &gt; $FILE
    echo &quot;Done!&quot;
done

# Archive the directory, send mail and cleanup
cd $V_DEST
tar -cf $NOW.tar $NOW
$GZIP -9 $NOW.tar

echo &quot;MySQL backup is completed! Backup name is $NOW.tar.gz&quot;
#echo &quot;MySQL backup is completed! Backup name is $NOW.tar.gz&quot; | mail -s &quot;MySQL backup&quot; $EMAIL
rm -rf $NOW

# Remove old files
find $V_DEST -mtime +$V_DAYS -exec rm -f {} \;

-----------------------------------------------------------------
--- db_restore.sh
-----------------------------------------------------------------
#!/bin/bash - 
# Shell script to restore MySQL database

# Set Variables
V_USER=&quot;root&quot;
V_SOURCE=&quot;/opt/backup/&quot;

MYSQL=&quot;$(which mysql)&quot;
MYSQLADMIN=&quot;$(which mysqladmin)&quot;

pushd ${V_SOURCE} &amp;&gt; /dev/null

if [ $# -eq 0 ]
  then
    echo &quot;Please speicifed the date, USAGE:./db_restore 20200101&quot;
    exit 0
fi

# Look for sql.gz files:
if [ &quot;$(ls -A $1.tar.gz 2&gt; /dev/null)&quot; ]  ; then
  echo &quot;sql.gz files found extracting...&quot;
  tar -zxvf $1.tar.gz
else
  echo &quot;target file $1.tar.gz not found in ${V_SOURCE}&quot;
  exit 0
fi
pushd ${V_SOURCE}/$1/mysql &amp;&gt; /dev/null
# Exit when folder doesn't have .sql files:
if [ &quot;$(ls -A *.sql 2&gt; /dev/null | wc -l)&quot; == 0 ]; then
  echo &quot;No *.sql files found in $(pwd)&quot;
  exit 0
fi

# Read mysql root password:
echo -n &quot;Type mysql $V_USER password: &quot;
read -s V_PASS
echo &quot;&quot;


# Get all database list first
DBS=&quot;$($MYSQL -u$V_USER -p$V_PASS -Bse 'show databases')&quot;

# Ignore list, won't restore the following list of DB:
SKIP=&quot;db2&quot;


# Restore DBs:
for filename in *.sql
do
  dbname=${filename%.sql}
  
  skipdb=-1
  if [ &quot;$SKIP&quot; != &quot;&quot; ]; then
    for ignore in $SKIP
    do
        [ &quot;$dbname&quot; == &quot;$ignore&quot; ] &amp;&amp; skipdb=1 || :
        
    done
  fi      

  # If not in ignore list, restore:
  if [ &quot;$skipdb&quot; == &quot;-1&quot; ] ; then
  
    skip_create=-1
    for existing in $DBS
    do      
      [ &quot;$dbname&quot; == &quot;$existing&quot; ] &amp;&amp; skip_create=1 || :
    done
  
    if [ &quot;$skip_create&quot; ==  &quot;1&quot; ] ; then 
      echo &quot;Database: $dbname already exist, skiping create&quot;
    else
      echo &quot;Creating DB: $dbname&quot;
      #mysqladmin create $dbname -u $V_USER -p$V_PASS
    fi
    
    echo &quot;Importing DB: $dbname from $filename&quot;
    #mysql $dbname &lt; $filename -u $V_USER -p$V_PASS
  fi    
done

</code></pre></div><h4 id="upgrade"><a href="#upgrade" class="header-anchor">#</a> upgrade</h4> <p>EXAMPLE: from 5.7.18 to 5.7.26</p> <div class="language- extra-class"><pre class="language-text"><code>SHOW VARIABLES WHERE Variable_name LIKE &quot;version&quot;;

https://dev.mysql.com/doc/refman/5.7/en/upgrading.html
yum list installed | grep &quot;^mysql&quot;

$ yum list installed | grep &quot;^mysql&quot;
Repodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast
mysql-community-client.x86_64         5.7.18-1.el7                @/mysql-community-client-5.7.18-1.el7.x86_64
mysql-community-common.x86_64         5.7.18-1.el7                @/mysql-community-common-5.7.18-1.el7.x86_64
mysql-community-libs.x86_64           5.7.18-1.el7                @/mysql-community-libs-5.7.18-1.el7.x86_64
mysql-community-server.x86_64         5.7.18-1.el7                @/mysql-community-server-5.7.18-1.el7.x86_64

$ find / -name &quot;mysql&quot; -o -name &quot;mysqld&quot; -type f -print 2&gt;/dev/null
/usr/sbin/mysqld
$ find / -name &quot;mysql&quot; -type d -print 2&gt;/dev/null
/var/lib/mysql
/usr/lib64/mysql
/usr/share/mysql

</code></pre></div><p>Upgrading MySQL with Directly-Downloaded RPM Packages
https://dev.mysql.com/doc/refman/5.7/en/updating-direct-rpms.html
https://dev.mysql.com/doc/refman/5.7/en/linux-installation-rpm.html</p> <p>https://dev.mysql.com/downloads/mysql/</p> <p>??rpm -qpl mysql-community-server-5.7.26-1.el7.x86_64.rpm
For Red Hat Enterprise Linux/Oracle Linux/CentOS systems:
yum install mysql-community-{server,client,common,libs}-* mysql-5.*¬≠</p> <p>For Red Hat Enterprise Linux, Oracle Linux, CentOS, and Fedora systems, use the following command to start MySQL:
service mysqld start
mysql-upgrade -uroot -pPassword
Once the server restarts, run mysql_upgrade to check and possibly resolve any incompatibilities between the old data and the upgraded software. mysql_upgrade also performs other functions; see Section 4.4.7, ‚Äúmysql_upgrade ‚Äî Check and Upgrade MySQL Tables‚Äù for details.
If you use replication, review Section 16.4.3, ‚ÄúUpgrading a Replication Setup‚Äù.
warning Table mysql/innodb_table_stats has length mismatch in the column name table_name. Please run mysql_upgrade
https://dev.mysql.com/doc/relnotes/mysql/5.7/en/news-5-7-23.html</p> <p>Installation of previous versions of MySQL using older packages might have created a configuration file named /usr/my.cnf. It is highly recommended that you examine the contents of the file and migrate the desired settings inside to the file /etc/my.cnf file, then remove /usr/my.cnf.</p> <h4 id="plugins"><a href="#plugins" class="header-anchor">#</a> plugins</h4> <p>https://dev.mysql.com/doc/refman/5.7/en/server-plugins.html
https://dev.mysql.com/doc/refman/5.7/en/plugin-loading.html#server-plugin-installing</p> <div class="language- extra-class"><pre class="language-text"><code>SHOW VARIABLES WHERE Variable_name = 'plugin_dir';
	/usr/lib64/mysql/plugin/
SELECT * FROM INFORMATION_SCHEMA.PLUGINS\G 
SELECT * FROM mysql.plugin;
INSTALL PLUGIN myplugin SONAME 'validate_password.so';

SELECT PLUGIN_NAME, PLUGIN_STATUS
       FROM INFORMATION_SCHEMA.PLUGINS
       WHERE PLUGIN_NAME LIKE 'validate%';
	   
The following lines should be present in the global configuration:
plugin-load=validate_password.so
validate-password=FORCE_PLUS_PERMANENT
https://dev.mysql.com/doc/refman/5.7/en/validate-password-installation.html

vim /etc/my.cnf
[mysqld]
plugin-load-add=validate_password.so
validate-password=FORCE_PLUS_PERMANENT
</code></pre></div><p>If it is desired to prevent the server from running without the password-validation plugin, use --validate-password with a value of FORCE or FORCE_PLUS_PERMANENT to force server startup to fail if the plugin does not initialize successfully.</p> <p>service mysqld start --validate-password=FORCE_PLUS_PERMANENT</p> <h2 id="_4-sql"><a href="#_4-sql" class="header-anchor">#</a> 4. SQL</h2> <h3 id="basic"><a href="#basic" class="header-anchor">#</a> Basic</h3> <p>a mysql db can have many schema,<strong>like a building have many rooms, and users can get access to different room, so schema can have more than one user.</strong></p> <div class="language- extra-class"><pre class="language-text"><code>SELECT DATE_FORMAT(date_add(date_column,INTERVAL 8 HOUR),'%b %d %Y %h %p'),COUNT(distinct(count_column))
FROM db.table
where date_add(date_column,INTERVAL 8 HOUR) between '2015-02-01 00:00:00' and '2015-03-01 00:00:00'
GROUP BY DATE_FORMAT(date_column,'%b %d %Y %h %p')
order by DATE_FORMAT(date_add(date_column,INTERVAL 8 HOUR),'%b %d %Y %h %p');
</code></pre></div><p>CRUD</p> <div class="language- extra-class"><pre class="language-text"><code>insert into phoenix.`program-slot`(duration,dateOfProgram,startTime,`weekly-schedule_id`,presenter_id,producer_id,program_id)
select duration,date_add(dateOfProgram,INTERVAL 2 DAY), IFNULL(date_add(startTime,INTERVAL 2 DAY),null) ,100,presenter_id,producer_id,program_id from phoenix.`program-slot` where `weekly-schedule_id` =3;

</code></pre></div><h3 id="advance"><a href="#advance" class="header-anchor">#</a> Advance</h3> <p><strong>ÊâπÈáèÁîüÊàêtruncate</strong></p> <div class="language- extra-class"><pre class="language-text"><code>mysql -h'HOST' -u'USERNAME' -p'PASSWORD' -e'SELECT CONCAT(&quot;TRUNCATE TABLE &quot;,TABLE_NAME,&quot;;&quot;) FROM information_schema.TABLES WHERE TABLE_SCHEMA=&quot;db01&quot; into outfile &quot;/var/lib/mysql-files/truncate_db01.sql&quot;;'

SHOW VARIABLES LIKE &quot;secure_file_priv&quot; Êü•ÁúãËÉΩÂÜôÂà∞Âì™‰∏™ÁõÆÂΩï
</code></pre></div><p><strong>Performance on index : when join a large table</strong></p> <div class="language- extra-class"><pre class="language-text"><code>bad:
select user.*, log.LoginTime
from users user
left join login_log log on user.id=log.userid and log.LoginTime=(select max(LoginTime) from login_log where userid=log.userid and status='true');
good:
select user.*, log.LoginTime
from users user
left join (
select max(LoginTime) LoginTime,userid from login_log
where  status='true'
group by userid) temp on temp.userid=user.userid;
</code></pre></div><p><strong>Â≠òÂÇ®ËøáÁ®ã‰∫íÁõ∏Ë∞ÉÁî®</strong></p> <div class="language- extra-class"><pre class="language-text"><code>DELIMITER $$
CREATE DEFINER=`dbuser`@`%` PROCEDURE `PROCE1`(
in _param varchar(50)
)
root:BEGIN
declare _count int;
select count(1) into _count from table where column=_param;
if _count&lt;&gt;1 then
select -1 as result;
leave root;
end if;
call PROCE2(_param);
do something else
select 0 as result;
END

DELIMITER $$
CREATE DEFINER=`dbuser`@`%` PROCEDURE `PROCE2`(
in _param int
)
BEGIN
DECLARE done INT DEFAULT FALSE;
declare _variable1 int;
declare _variable2 decimal(10,2);
declare resultCur cursor for select column1,column2 from table where column=_param;
DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
DECLARE exit handler for sqlexception
BEGIN
ROLLBACK;
get diagnostics condition 1 @p1 = MESSAGE_TEXT;
select -1 as result, @p1 as message from dual;
END;
open resultCur;
operaLoop:Loop
fetch resultCur into _variable1,_variable2;
if done then
leave operaLoop;
end if;
do something...
end Loop;
close resultCur;
END

</code></pre></div><p><strong>Multiple cursors in mysql stored procedure</strong></p> <div class="language- extra-class"><pre class="language-text"><code>DROP PROCEDURE IF EXISTS `multipleCursorsAtOne`;
DELIMITER $$
CREATE PROCEDURE `multipleCursorsAtOne`()
BEGIN
DROP TABLE IF EXISTS userNames;
CREATE TEMPORARY TABLE userNames
(userName varchar(200) NOT NULL);
BEGIN
DECLARE done BOOLEAN DEFAULT false;
DECLARE p_first_name VARCHAR(200);
DECLARE cursor_a CURSOR FOR SELECT user_name FROM user_info LIMIT 1,3;
DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
OPEN cursor_a;
cursor_a_loop: LOOP
FETCH cursor_a INTO p_first_name;
IF done THEN
LEAVE cursor_a_loop;
END IF;
-- cursor loop statements
IF p_first_name IS NOT NULL AND p_first_name &lt;&gt; &quot;&quot; THEN
INSERT INTO userNames(userName) VALUES(p_first_name);
END IF;
END LOOP;
CLOSE cursor_a;
END;
BEGIN
DECLARE done BOOLEAN DEFAULT false;
DECLARE p_first_name VARCHAR(200);
DECLARE cursor_a CURSOR FOR SELECT user_name FROM user_info LIMIT 4,3;
DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
OPEN cursor_a;
cursor_a_loop: LOOP
FETCH cursor_a INTO p_first_name;
IF done THEN
LEAVE cursor_a_loop;
END IF;
-- cursor loop statements
IF p_first_name IS NOT NULL AND p_first_name &lt;&gt; &quot;&quot; THEN
INSERT INTO userNames(userName) VALUES(p_first_name);
END IF;
END LOOP;
CLOSE cursor_a;
END;
SELECT * FROM userNames;
END
$$

</code></pre></div><p><strong>Recursive query</strong></p> <p>Â∞±ÊòØÈíàÂØπÂ≠òÂú®parent idÁöÑÂ≠òÂú®Â±ÇÁ∫ßÂÖ≥Á≥ªÁöÑË°®</p> <p>Hierarchical data in MySQL: parents and children in one query</p> <p>https://stackoverflow.com/questions/20215744/how-to-create-a-mysql-hierarchical-recursive-query</p> <p>Managing Hierarchical Data in MySQL</p> <p>https://www.mysqltutorial.org/mysql-adjacency-list-tree/</p> <p><strong>Partition</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createPartition</span><span class="token punctuation">(</span><span class="token class-name">String</span> theDate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;SELECT count(partition_name) FROM INFORMATION_SCHEMA.PARTITIONS WHERE  TABLE_SCHEMA =SCHEMA() AND TABLE_NAME='t_xxx';&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> result <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sql <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;ALTER TABLE t_xxx PARTITION BY LIST COLUMNS(CreateDate) (PARTITION p%s VALUES IN ('%s'));&quot;</span><span class="token punctuation">,</span> theDate<span class="token punctuation">,</span> theDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
            jdbcTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            sql <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT count(partition_name) FROM INFORMATION_SCHEMA.PARTITIONS WHERE  TABLE_SCHEMA =SCHEMA() AND TABLE_NAME='t_xxx' AND PARTITION_NAME = 'p%s' &quot;</span><span class="token punctuation">,</span> theDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Integer</span> count <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sql <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;ALTER TABLE t_xxx ADD PARTITION(PARTITION p%s VALUES IN ('%s'));&quot;</span><span class="token punctuation">,</span> theDate<span class="token punctuation">,</span> theDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
                jdbcTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-ha"><a href="#_5-ha" class="header-anchor">#</a> 5. HA</h2> <h3 id="ÁêÜËÆ∫"><a href="#ÁêÜËÆ∫" class="header-anchor">#</a> ÁêÜËÆ∫</h3> <p>https://dev.mysql.com/doc/refman/8.0/en/replication.html</p> <p>In MySQL, replication involves the source database writing down every  change made to the data held within one or more databases in a special  file known as the <em>binary log</em></p> <p>Once the replica instance has been initialized, it creates two threaded processes:</p> <ul><li><p>master-binary log=&gt;slave-relay log</p> <p>The first, called the <em>IO thread</em>, connects to the source MySQL instance and reads the binary log events  line by line, and then copies them over to a local file on the replica‚Äôs server called the <em>relay log</em>.</p></li> <li><p>slave-relay log=&gt;slave db changes</p> <p>The second thread, called the <em>SQL thread</em>, reads events from the relay log and then applies them to the replica instance as fast as possible.</p></li></ul> <h3 id="‰∏§ÁßçÊ®°Âºè"><a href="#‰∏§ÁßçÊ®°Âºè" class="header-anchor">#</a> ‰∏§ÁßçÊ®°Âºè</h3> <ul><li><p>Âü∫‰∫ébinary log, <em>binary log file position-based replication</em></p> <p>When you turn a MySQL instance into a replica using this method, you  must provide it with a set of binary log coordinates. These consist of  the name of the binary log file on the source which the replica must  read and a specific position within that file which represents the first database event the replica should copy to its own MySQL instance.</p> <p>These coordinates are important since replicas receive a copy of their  source‚Äôs entire binary log and, without the right coordinates, they will begin replicating every database event recorded within it. This can  lead to problems if you only want to replicate data after a certain  point in time or only want to replicate a subset of the source‚Äôs data.</p> <p>Binary log file position-based replication is viable for many use cases, but this method can become clunky in more complex setups.</p></li> <li><p>Âü∫‰∫é global transaction identifier GTID [starting with version 5.6 and above]</p> <p>GTID stands for global transaction identifier (GTID) which uniquely  identifies a transaction committed on the server of origin (master). A  unique GTID is created when any transaction occurs. The GTID is not  just unique to the server on which it originates, but also across the  servers in any given replication setup. In other words, each transaction is mapped to a GTID.</p> <p>MySQL GTIDs are displayed as a pair of coordinates, separated by a colon character (üòÉ <code>GTID = source_id(noramlly server uuid):transaction_id(sequential integer,start from 1, representing the order a transaction was committed on the source)</code></p> <p>server uuid: /var/lib/mysql/auto.cnf</p> <p>GTID Set</p> <p>rather than just a single transaction id, an interval is given a range of transactions like <code>baecf819-a6a5-11e9-a78d-566f18fa0007:1-699</code> or</p> <p>two ranges with a gap <code>baecf819-a6a5-11e9-a78d-566f18fa0007:1-699, 702-900</code></p> <ul><li>Retrieved _Gtid_Set:
<ul><li>All GTIDs received from the master</li> <li>Resets on:
<ul><li>CHANGE MASTER</li> <li>RESET SLAVE</li> <li>server restart(if relay-log-recovery is on)</li></ul></li></ul></li> <li>Executed_Gtid_Set:
<ul><li>All GTIDs written to binary log</li> <li>Same value seen in:
<ul><li>SHOW MASTER STATUS</li> <li>SHOW SLAVE STATUS</li> <li>show global variables like 'gtid_executed';</li></ul></li></ul></li></ul> <p>This method involves creating a global transaction identifier (GTID)  for each transaction ‚Äî or, an isolated piece of work performed by a  database ‚Äî that the source MySQL instance executes.</p> <p>The mechanics of transaction-based replication are similar to binary log file-based replication: whenever a database transaction occurs on the  source, MySQL assigns and records a GTID for the transaction in the  binary log file along with the transaction itself. The GTID and the  transaction are then transmitted to the source‚Äôs replicas for them to  process.</p> <p>When the replication takes place, the slave makes use of the same  GTIDs, irrespective of whether it acts as a master for any other nodes  or not. With each transaction replication, the same GTIDs and  transaction numbers also come along from the master and the slave will  write these to the binlog if it‚Äôs configured to write its data events.</p> <p>To ensure a smooth, consistent and fault-tolerant replication, the  slave will then inform the master of the GTIDs that were a part of the  execution, which helps master node identify if any transaction did not  take place. The master node then informs the slave to carry out the  left-over transactions and thereby ensures that data replication takes  place accurately.</p> <p>MySQL‚Äôs transaction-based replication has a number of benefits over its  traditional replication method. For example, because both a source and  its replicas preserve GTIDs, if either the source or a replica encounter a transaction with a GTID that they have processed before they will  skip that transaction. This helps to ensure consistency between the  source and its replicas. Additionally, with transaction-based  replication replicas don‚Äôt need to know the binary log coordinates of  the next database event to process. This means that starting new  replicas or changing the order of replicas in a replication chain is far less complicated.</p></li></ul> <h3 id="Áõ∏ÂÖ≥ÊùÉÈôê"><a href="#Áõ∏ÂÖ≥ÊùÉÈôê" class="header-anchor">#</a> Áõ∏ÂÖ≥ÊùÉÈôê</h3> <p>REPLICATION CLIENTÊùÉÈôê: replication user‰ΩøÁî®shellÂëΩ‰ª§ SHOW MASTER STATUS, SHOW SLAVE STATUSÂíå SHOW BINARY LOGSÊù•Á°ÆÂÆöÂ§çÂà∂Áä∂ÊÄÅ„ÄÇ</p> <p>REPLICATION SLAVEÊùÉÈôê: SLAVE ËøõË°åreplicationÔºå‰ΩøÁî® show slave hosts Ôºåshow binlog events;Á≠âÂëΩ‰ª§Ôºõ</p> <p>ÂÅáËÆæÊÉ≥Ë¶ÅÂú®Slave‰∏äÊúâÊùÉÈôêËøêË°å&quot;LOAD TABLE FROM MASTER&quot; Êàñ &quot;LOAD DATA FROM MASTER&quot;ËØ≠Âè•ÁöÑËØùÔºåÂøÖÈ°ªÊéà‰∫àÂÖ®Â±ÄÁöÑ FILE Âíå SELECT ÊùÉÈôêÔºö</p> <p>RELOAD ÊùÉÈôêÔºöReset slave: Access denied; you need (at least one of) the RELOAD privilege(s) for this operation</p> <p>superÊùÉÈôêÔºöstart slaveÔºåstop slaveÔºõ</p> <h3 id="replication-solution"><a href="#replication-solution" class="header-anchor">#</a> Replication Solution</h3> <p>‰∏ªÊú∫Âô®ÈúÄË¶ÅÂÖÅËÆ∏‰ªéÊú∫Âô®ËÆøÈóÆÂÖ∂3306Á´ØÂè£</p> <h4 id="‰∏ª‰ªé-Âü∫‰∫éfile-based-binary-log-replication"><a href="#‰∏ª‰ªé-Âü∫‰∫éfile-based-binary-log-replication" class="header-anchor">#</a> ‰∏ª‰ªé - Âü∫‰∫éfile based / binary log replication</h4> <p>https://www.digitalocean.com/community/tutorials/how-to-set-up-replication-in-mysql</p> <div class="language- extra-class"><pre class="language-text"><code>----------------------------------------------------------------------------
step 1: config master and slave /etc/my.cnf And restart:
----------------------------------------------------------------------------
Master:
server-id=1
log-bin=mysql-bin #This defines the base name and location of MySQL‚Äôs binary log file,When commented out, as this directive is by default, binary logging is disabled. Your replica server must read the source‚Äôs binary log file so it knows when and how to replicate the source‚Äôs data

binlog_do_db          = include_database_name ÈúÄË¶ÅÂ§çÂà∂ÁöÑÊï∞ÊçÆÂ∫ì
binlog_do_db          = db_1
binlog_do_db          = db_2

replicate-ignore-db = mysql  #ÂøΩÁï•Êï∞ÊçÆÂ∫ìÔºå‰∏çÈúÄË¶ÅÂ§çÂà∂
replicate-ignore-db = information_schema
replicate-ignore-db = performance_schema
replicate-ignore-db = sys

Slave:
[mysqld]
server-id=2
log_bin                 = /var/log/mysql/mysql-bin.log
binlog_do_db            =  Ë∑ümaster‰∏ÄËá¥
relay-log               = /var/log/mysql/mysql-relay-bin.log

&gt; sudo systemctl restart mysqld

----------------------------------------------------------------------------
step 2: on master, create and grant repl user
----------------------------------------------------------------------------

good:
mysql&gt; CREATE USER 'replica_user'@'replica_server_ip' IDENTIFIED WITH mysql_native_password BY 'password';
# Note that this command specifies that replica_user will use the mysql_native_password authentication plugin. It‚Äôs possible to instead use MySQL‚Äôs default authentication mechanism, caching_sha2_password, but this would require setting up an encrypted connection between the source and the replica. This kind of setup would be optimal for production environment: https://dev.mysql.com/doc/refman/8.0/en/replication-solutions-encrypted-connections.html

bad: ‰ªªÊÑèipÈÉΩÂèØ‰ª•ËÆøÈóÆÔºå‰∏çÂÆâÂÖ®
mysql&gt; CREATE USER 'replica_user'@'%' IDENTIFIED BY '123456';


mysql&gt; GRANT REPLICATION SLAVE ON *.* TO 'replica_user'@'replica_server_ip';

----------------------------------------------------------------------------
step 3: on master: Retrieving Binary Log Coordinates from the Source
----------------------------------------------------------------------------
To make sure that no users change any data while you retrieve the coordinates, which could lead to problems, you‚Äôll need to lock the database to prevent any clients from reading or writing data as you obtain the coordinates. 

mysql&gt; FLUSH TABLES WITH READ LOCK;
mysql&gt; SHOW MASTER STATUS; # return the current status information for the source‚Äôs binary log files

Output
+------------------+----------+--------------+------------------+-------------------+
| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+------------------+----------+--------------+------------------+-------------------+
| mysql-bin.000001 |      899 | db           |                  |                   |
+------------------+----------+--------------+------------------+-------------------+
1 row in set (0.00 sec)

ËæìÂá∫ÁöÑfileÂíåpositionÂç≥‰∏ãÈù¢Áî®Âà∞ÁöÑMASTER_LOG_FILEÂíåMASTER_LOG_POS

sudo find / -name mysql-bin.000001
mysqlbinlog /var/lib/mysql/mysql-bin.000001

----------------------------------------------------------------------------
step 4: dump and import, If Your Source Has Existing Data to Migrate
----------------------------------------------------------------------------
on master::
If you have data on your source MySQL instance that you want to migrate to your replicas, you can do so by creating a snapshot of the database with the mysqldump utility. However, your database should still be currently locked. If you make any new changes in the same window, the database will automatically unlock. Likewise, the tables will automatically unlock if you exit the client. 
For this reason, you must open a new terminal window or tab on your local machine so you can create the database snapshot without unlocking MySQL.

&gt; mysqldump -u root db &gt; db.sql
or
&gt; mysqldump -u repl -p 123456 --all-databases --master-data &gt; dbdump.db


Following that you can close this terminal window or tab and return to your first one, which should still have the MySQL shell open, then:
mysql&gt; UNLOCK TABLES;


on slave:: import data
&gt; mysql -u root -p &lt; dbdump.db
or
mysql&gt; CREATE DATABASE db; 
&gt; mysql db &lt; /tmp/db.sql


----------------------------------------------------------------------------
step 5: Slave: setting and start
----------------------------------------------------------------------------

mysql&gt; CHANGE MASTER TO MASTER_HOST='source_server_ip',MASTER_PORT=3306,MASTER_USER='replica_user',MASTER_PASSWORD='password',MASTER_LOG_FILE='mysql-bin.000001',MASTER_LOG_POS=52113;

mysql&gt; START SLAVE;
 
mysql&gt; SHOW SLAVE STATUS\G;
Master_Log_File:	# source bin log
Read_Master_Log_Pos: # source bin log position
Relay_Log_File:		# slave relay log
Relay_Log_Pos: 		# salve relay log position
Relay_Master_Log_File:
        
ÂÖ∂‰∏≠ÔºåSlave_IO_RunningÂíåSlave_SQL_RunningÂùáÊòæÁ§∫yesË°®Á§∫ReplicationÂ∑•‰ΩúÊ≠£Â∏∏ÔºåÂèØÈÄöËøáÂÖ∂‰ΩôÂèÇÊï∞Êù•‰∫ÜËß£ReplicationÁöÑÂ∑•‰ΩúÁä∂ÊÄÅ„ÄÇ



Note: If your replica has an issue in connecting or replication stops unexpectedly, it may be that an event in the source‚Äôs binary log file is preventing replication. In such cases, you could run the SET GLOBAL SQL_SLAVE_SKIP_COUNTER command to skip a certain number of events following the binary log file position you defined in the previous command. This example only skips the first event:
mysql&gt; SET GLOBAL SQL_SLAVE_SKIP_COUNTER = 1;

Following that, you‚Äôd need to start the replica again:
mysql&gt; START REPLICA;


</code></pre></div><h4 id="‰∏ª‰ªé-Âü∫‰∫égtid-based-replication"><a href="#‰∏ª‰ªé-Âü∫‰∫égtid-based-replication" class="header-anchor">#</a> ‰∏ª‰ªé - Âü∫‰∫éGTID based replication</h4> <p>https://hevodata.com/learn/mysql-gtids-and-replication-set-up/</p> <p>https://dev.mysql.com/doc/refman/5.7/en/replication-gtids-howto.html</p> <p>gtid_executedÔºöËøô‰∏™ÊòØÂ∑≤ÁªèÊâßË°åËøáÁöÑÊâÄÊúâÁöÑ‰∫ãÂä°ÁöÑGTIDÁöÑ‰∏Ä‰∏™Á≥ªÂàó‰∏≤Ôºå‰πüÂ∞±ÊòØbinary logÈáåÈù¢Â∑≤ÁªèËêΩÂ∫ìÁöÑ‰∫ãÂä°ÁöÑÂ∫èÂàóÂè∑„ÄÇËøô‰∏™ÂèÇÊï∞ÊòØÂè™ËØªÁöÑÔºå‰∏çËÉΩÂ§üËøõË°åËÆæÁΩÆ„ÄÇ</p> <p>gtid_purgedÔºösubsets of gtid_executed that are no longer in the binary logs Ëøô‰∏™Â∫èÂàóÊòØÊåáÊàë‰ª¨Âú®binary logÂà†Èô§ÁöÑ‰∫ãÂä°ÁöÑGTIDÁöÑÂ∫èÂàóÂè∑„ÄÇÊàë‰ª¨ÂèØ‰ª•ÊâãÂä®ËøõË°åËÆæÁΩÆÔºåÊñπ‰æøÊàë‰ª¨ÂÅö‰∏Ä‰∫õÁÆ°ÁêÜ„ÄÇ</p> <div class="language- extra-class"><pre class="language-text"><code>----------------------------------------------------------------------------
step 1: lock master&amp;slave
----------------------------------------------------------------------------
on both master &amp; slave:
mysql&gt; SET @@GLOBAL.read_only = ON;
mysql&gt; show global variables like 'read_only';
ËøôÊ¨°Ë∑üÂâçÈù¢ÁöÑlockÊñπÊ≥ï‰∏çÂêåÔºåÊ≥®ÊÑè**‰∏ç‰ºöÂΩ±ÂìçslaveÂêåÊ≠•Â§çÂà∂ÁöÑÂäüËÉΩ**

mysqladmin -uroot -p shutdown

----------------------------------------------------------------------------
step 2: config master and slave /etc/my.cnf And restart:
----------------------------------------------------------------------------
mysqld --defaults-file=/etc/my.cnf --validate-config

for master: 
The Master server needs to be started with GTID mode enabled by setting the gtid_mode variable to ON. It is also essential that the enforce_gtid_consistency variable is enabled to make sure that only the statements which are safe for MySQL GTIDs Replication are logged. 
[mysqld]
server-id=1
log-bin = mysql-bin
#binlog_format = row
gtid-mode=ON
enforce-gtid-consistency=ON
#read-only = ON #Âè¶‰∏ÄÁßçÊñπÂºèËÆæÁΩÆreadonly

&gt; systemctl restart mysqld

for slave:
[mysqld]
server-id = 2
log-bin = mysql-bin
gtid-mode=ON
enforce-gtid-consistency=ON
log-slave-updates
#read-only = ON #Âè¶‰∏ÄÁßçÊñπÂºèËÆæÁΩÆreadonly
#relay-log = relay-log-server
skip-slave-start #ÔºÅÔºÅÔºÅÔºÅImportant In addition, you should start replicas with the --skip-slave-start option before configuring the replica settings. Tells the replica server not to start the replication threads when the server starts. To start the threads later, use a START SLAVE statement. 

&gt; systemctl restart mysqld
----------------------------------------------------------------------------
step 3: on master create replicator user
----------------------------------------------------------------------------

&gt; mysql -uroot -p

mysql&gt; DROP USER 'replicator'@'localhost';
--- mysql&gt; REVOKE ALL ON *.* FROM 'replicator'@'localhost';

# replicator@localhostÂèØ‰ª•ÁÆ°ÁêÜmasterÊú¨Êú∫
mysql&gt; CREATE USER replicator@localhost IDENTIFIED BY 'password';
mysql&gt; GRANT SUPER,RELOAD,REPLICATION SLAVE ON *.* TO 'replicator'@'localhost' IDENTIFIED BY 'password';

# 'replicator'@'replication_server_ip'Âú®slaveÊú∫Âô®‰∏äreplication_server_ipËøúÁ®ãËøûÊé•ÁÆ°ÁêÜmaster‰ª•ÂèäËøõË°åÂü∫Êú¨ÁöÑÂ§çÂà∂ÔºàÊúÄ‰ΩéÈúÄË¶ÅREPLICATION SLAVEÊùÉÈôêÔºâ
mysql&gt; CREATE USER replicator@replication_server_ip IDENTIFIED BY 'password';
mysql&gt; GRANT SUPER,RELOAD,REPLICATION SLAVE ON *.* TO 'replicator'@'replication_server_ip' IDENTIFIED BY 'password';

mysql&gt; flush privileges;

mysql_config_editor set --login-path=host-rpl --host=localhost --port=3306 --user=replicator --password

----------------------------------------------------------------------------
(no need) step 4: on master: Retrieving Binary Log Coordinates from the Source
----------------------------------------------------------------------------

mysql&gt; show master status
mysql&gt; show global variables like 'gtid_executed';
‰∏§ËÄÖËæìÂá∫ÁöÑgtid_executedÂ∫îËØ•ÊòØ‰∏ÄÊ†∑ÁöÑ
select * from mysql.gtid_executed;

GTID = source_id(noramlly server uuid):transaction_id(sequential integer,start from 1, representing the order a transaction was committed on the source)

mysqlbinlog /var/lib/mysql/mysql-bin.000001
ÂÜÖÂÆπÂü∫Êú¨Ë∑ü‰∏äÈù¢ÁöÑfile based replicationÁöÑbin log‰∏ÄÊ†∑ÔºåÂè™‰∏çËøáÂ§ö‰∫ÜÔºö
                    #210621 16:50:01 server id 2  end_log_pos 259 CRC32 0x7b8ba749  GTID    last_committed=0        sequence_number=1
                    SET @@SESSION.GTID_NEXT= '878556a6-ff0e-11ea-bf92-566f18fa0008:3'/*!*/;
                    # at 259
----------------------------------------------------------------------------
step 5: dump and import, If Your Source Has Existing Data to Migrate
----------------------------------------------------------------------------

&gt; mysqldump --all-databases -flush-privileges --single-transaction --flush-logs --triggers --routines --events -hex-blob --host=54.89.xx.xx --port=3306 --user=root  --password=XXXXXXXX &gt; mysqlbackup_dump.sql
# head -n30 mysqlbackup_dump.sql

&gt; mysqldump -flush-privileges --single-transaction --flush-logs --triggers --routines --events -hex-blob --host=localhost --user=root --password --databases db1 db2&gt; source_dump.sql

            SET @MYSQLDUMP_TEMP_LOG_BIN = @@SESSION.SQL_LOG_BIN;
            SET @@SESSION.SQL_LOG_BIN= 0;

            --
            -- GTID state at the beginning of the backup 
            --

            SET @@GLOBAL.GTID_PURGED='baecf819-a6a5-11e9-a78d-566f18fa0007:1-594';


on slave:: import data
mysql&gt; show global variables like 'gtid_executed';
Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°ÔºåÂ∫îËØ•ÊòØÁ©∫ÁöÑ
mysql&gt; SET @@GLOBAL.read_only = OFF;
mysql&gt; source source_dump.sql ;
mysql&gt; show global variables like 'gtid_executed';

ÂØºÂÖ•ÂÆåÂ∫îËØ•Ë∑ümaster‰∏ÄÊ†∑‰∫Ü? Ë∑üfile based replication‰∏çÂêåÔºå‰∏§Âè∞Êú∫Âô®‰∏ä‰∫ßÁîüÁöÑgtidÊú¨Êù•Â∞±‰∏çÂêåÁöÑÔºåÂè™‰∏çËøáslave‰ºöÂ§çÂà∂master‰∏äÈù¢‰∫ßÁîüÁöÑgtid transactionÔºå

Âè¶Â§ñÂèëÁé∞readonly‰πüÂèòÊàê‰∫ÜoffÔºåÊàë‰ª•‰∏∫Á¨¨‰∏ÄÊ≠•ËÆæÁΩÆreadonly‰ºö‰∏ÄÁõ¥ÊúâÊïàÔºåÁúãÊù•ÊòØ‰∏≠Èó¥Êüê‰∏ÄÊ≠•ÊîπÂèò‰∫ÜreadonlyÔºàÈáçÂêØÊàñËÄÖÂÖ∂‰ªñÊìç‰ΩúÔºâÔºåÂÜçÂÅö‰∏ÄÊ¨°Step 1

----------------------------------------------------------------------------
step 6: Slave: setting and start	
----------------------------------------------------------------------------
The slave should be configured to use the master with GTID based transactions as the source for data replication and to use GTID-based auto-positioning rather than file-based positioning.

&gt; mysql -uroot -p
mysql&gt; CHANGE MASTER TO
MASTER_HOST = '54.89.xx.xx',
MASTER_PORT = 3306,
MASTER_USER = 'repl_user',
MASTER_PASSWORD = 'XXXXXXXXX',
MASTER_AUTO_POSITION = 1;

Take a new backup.  Existing backups that were made before you enabled GTIDs can no longer be used on these servers now that you have enabled GTIDs. Take a new backup at this point, so that you are not left without a usable backup. 

mysql&gt; start slave;
mysql&gt; show slave status\G

			Retrieved_Gtid_Set:
            Executed_Gtid_Set: baecf819-a6a5-11e9-a78d-566f18fa0007:
                Auto_Position: 1
----------------------------------------------------------------------------
step 6: Finally touch: unlock
----------------------------------------------------------------------------
mysql&gt; SET @@GLOBAL.read_only = OFF;

ON SLAVE:
&gt; vim /etc/my.cnf
 #skip-slave-start

</code></pre></div><p>https://www.cnblogs.com/shengdimaya/p/6897584.html</p> <h4 id="‰∏ª‰∏ª-Âü∫‰∫égtid-replication"><a href="#‰∏ª‰∏ª-Âü∫‰∫égtid-replication" class="header-anchor">#</a> ‰∏ª‰∏ª - Âü∫‰∫éGTID replication</h4> <p>https://www.huaweicloud.com/articles/e85563c3c3c75c7d980466d800a8c43c.html</p> <p>‰∏äÈù¢ÁöÑÊìç‰ΩúÂèçËøáÊù•Êìç‰Ωú‰∏ÄÈÅçÂç≥ÂèØÔºå‰ΩÜÊòØÊ≥®ÊÑèÔºö</p> <p>‰∏§‰∏™‰∏ªËá™Â¢ûidË¶ÅÂàÜÂà´‰∏∫Â•áÊï∞ÂÅ∂Êï∞Ôºå‰∏çÁÑ∂ÊúâÂÜ≤Á™Å</p> <div class="language- extra-class"><pre class="language-text"><code>----------------------------------------------------------------------------
step 1: lock master&amp;slave
----------------------------------------------------------------------------
on both master &amp; slave:
mysql&gt; SET @@GLOBAL.read_only = ON;
mysql&gt; show global variables like 'read_only';
ËøôÊ¨°Ë∑üÂâçÈù¢ÁöÑlockÊñπÊ≥ï‰∏çÂêåÔºåÊ≥®ÊÑè**‰∏ç‰ºöÂΩ±ÂìçslaveÂêåÊ≠•Â§çÂà∂ÁöÑÂäüËÉΩ**

mysqladmin -uroot -p shutdown

----------------------------------------------------------------------------
step 2: config master &amp; slave /etc/my.cnf And restart:
----------------------------------------------------------------------------
master:

[mysqld]
server-id = 1
auto_increment_offset = 1
auto_increment_increment = 2  #Â•áÊï∞ID


log-bin = mysql-bin  #ÊâìÂºÄ‰∫åËøõÂà∂ÂäüËÉΩ,MASTER‰∏ªÊúçÂä°Âô®ÂøÖÈ°ªÊâìÂºÄÊ≠§È°π
binlog-format=ROW
log-slave-updates=true
gtid-mode=ON
enforce-gtid-consistency=ON
master-info-repository=TABLE
relay-log-info-repository=TABLE
sync-master-info=1
slave-parallel-workers=0
sync_binlog=0
binlog-checksum=CRC32
master-verify-checksum=1
slave-sql-verify-checksum=1
binlog-rows-query-log_events=1
max_binlog_size=1024M       #binlogÂçïÊñá‰ª∂ÊúÄÂ§ßÂÄº

replicate-ignore-db = mysql  #ÂøΩÁï•‰∏çÂêåÊ≠•‰∏ª‰ªéÁöÑÊï∞ÊçÆÂ∫ì
replicate-ignore-db = information_schema
replicate-ignore-db = performance_schema
replicate-ignore-db = sys

max_connections = 3000
max_connect_errors = 30

lower_case_table_names=1      
skip-name-resolve

skip-slave-start #ÔºÅÔºÅÔºÅÔºÅImportant In addition, you should start replicas with the --skip-slave-start option before configuring the replica settings. Tells the replica server not to start the replication threads when the server starts. To start the threads later, use a START SLAVE statement. 

&gt; systemctl restart mysqld

slave:
[mysqld]
server-id = 2
auto_increment_offset = 2
auto_increment_increment = 2    #ÂÅ∂Êï∞ID


log-bin = mysql-bin    #ÊâìÂºÄ‰∫åËøõÂà∂ÂäüËÉΩ,MASTER‰∏ªÊúçÂä°Âô®ÂøÖÈ°ªÊâìÂºÄÊ≠§È°π
binlog-format=ROW
log-slave-updates=true
gtid-mode=ON
enforce-gtid-consistency=ON
master-info-repository=TABLE
relay-log-info-repository=TABLE
sync-master-info=1
slave-parallel-workers=0
sync_binlog=0
binlog-checksum=CRC32
master-verify-checksum=1
slave-sql-verify-checksum=1
binlog-rows-query-log_events=1
max_binlog_size=1024M         #binlogÂçïÊñá‰ª∂ÊúÄÂ§ßÂÄº

replicate-ignore-db = mysql   #ÂøΩÁï•‰∏çÂêåÊ≠•‰∏ª‰ªéÁöÑÊï∞ÊçÆÂ∫ì
replicate-ignore-db = information_schema
replicate-ignore-db = performance_schema
replicate-ignore-db = sys

max_connections = 3000
max_connect_errors = 30

lower_case_table_names=1      
skip-name-resolve

skip-slave-start #ÔºÅÔºÅÔºÅÔºÅImportant In addition, you should start replicas with the --skip-slave-start option before configuring the replica settings. Tells the replica server not to start the replication threads when the server starts. To start the threads later, use a START SLAVE statement. 

NoteÔºö
1. Âè¶Â§ñ‰∏ÄÁßçÊñπÂºèÂ∞±ÊòØ
systemctl edit mysqld.service
and then adding --skip-slave-start
https://stackoverflow.com/questions/65434207/start-mysql-replication-server-with-skip-slave-start
2. ÈÖçÁΩÆÂÆåÊàê‰∏ª‰∏ªÂ§çÂà∂‰πãÂêé‰∏ÄÂÆöË¶ÅÊ≥®ÈáäÊéâmy.cnfÈáåÈù¢ÁöÑskip-slave-startÔºå‰∏çÁÑ∂ÊØèÊ¨°ÂêØÂä®‰πãÂêéÈÉΩË¶ÅÊâãÂä®start slave

&gt; systemctl restart mysqld

----------------------------------------------------------------------------
step 3: on BOTH two masters create replicator user
----------------------------------------------------------------------------

&gt; mysql -uroot -p

ON BOTH SERVER:
# replicator@localhostÂèØ‰ª•ÁÆ°ÁêÜmasterÊú¨Êú∫
mysql&gt; CREATE USER replicator@localhost IDENTIFIED BY 'password';
mysql&gt; GRANT SUPER,RELOAD,REPLICATION SLAVE ON *.* TO 'replicator'@'localhost' IDENTIFIED BY 'password';

# 'replicator'@'replication_server_ip'Âú®slaveÊú∫Âô®‰∏äreplication_server_ipËøúÁ®ãËøûÊé•ÁÆ°ÁêÜmaster‰ª•ÂèäËøõË°åÂü∫Êú¨ÁöÑÂ§çÂà∂ÔºàÊúÄ‰ΩéÈúÄË¶ÅREPLICATION SLAVEÊùÉÈôêÔºâ
ON SERVER 1:
mysql&gt; CREATE USER replicator@replication_server2_ip IDENTIFIED BY 'password';
mysql&gt; GRANT SUPER,RELOAD,REPLICATION SLAVE ON *.* TO 'replicator'@'replication_server2_ip' IDENTIFIED BY 'password';
mysql_config_editor set --login-path=host-rpl --host=replication_server2_ip --port=3306 --user=replicator --password

ON SERVER 2:
mysql&gt; CREATE USER replicator@replication_server1_ip IDENTIFIED BY 'password';
mysql&gt; GRANT SUPER,RELOAD,REPLICATION SLAVE ON *.* TO 'replicator'@'replication_server1_ip' IDENTIFIED BY 'password';
mysql_config_editor set --login-path=host-rpl --host=replication_server1_ip --port=3306 --user=replicator --password


mysql&gt; flush privileges;

----------------------------------------------------------------------------
step 4: on BOTH two master: Retrieving Binary Log Coordinates from the Source
----------------------------------------------------------------------------

mysql&gt; show master status
mysql&gt; show global variables like 'gtid_executed';
‰∏§ËÄÖËæìÂá∫ÁöÑgtid_executedÂ∫îËØ•ÊòØ‰∏ÄÊ†∑ÁöÑ

----------------------------------------------------------------------------
step 5: dump and import, If Your Source Has Existing Data to Migrate
----------------------------------------------------------------------------

Method 1Ôºö
&gt; mysqldump --all-databases -flush-privileges --single-transaction --flush-logs --triggers --routines --events -hex-blob --host=54.89.xx.xx --port=3306 --user=root  --password=XXXXXXXX &gt; mysqlbackup_dump.sql
# head -n30 mysqlbackup_dump.sql


on slave:: import data
mysql&gt; show global variables like 'gtid_executed';
Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°ÔºåÂ∫îËØ•ÊòØÁ©∫ÁöÑ
mysql&gt; SET @@GLOBAL.read_only = OFF;
mysql&gt; source mysqlbackup_dump.sql ;
mysql&gt; show global variables like 'gtid_executed';
ÂØºÂÖ•ÂÆåÂ∫îËØ•Ë∑ümaster‰∏ÄÊ†∑‰∫Ü

Method 2Ôºö
Create a dump file using mysqldump on the source server. Set the mysqldump option --master-data (with the default value of 1) to include a CHANGE MASTER TO statement with binary logging information. Set the --set-gtid-purged option to AUTO (the default) or ON, to include information about executed transactions in the dump. Then use the mysql client to import the dump file on the target server. 

--master-data[=value]

Use this option to dump a source replication server to produce a dump file that can be used to set up another server as a replica of the source. It causes the dump output to include a CHANGE MASTER TO statement that indicates the binary log coordinates (file name and position) of the dumped server. These are the source server coordinates from which the replica should start replicating after you load the dump file into the replica.

If the option value is 2, the CHANGE MASTER TO statement is written as an SQL comment, and thus is informative only; it has no effect when the dump file is reloaded. If the option value is 1, the statement is not written as a comment and takes effect when the dump file is reloaded. If no option value is specified, the default value is 1. 

----------------------------------------------------------------------------
step 6: Both two Slave: setting and start
----------------------------------------------------------------------------
The slave should be configured to use the master with GTID based transactions as the source for data replication and to use GTID-based auto-positioning rather than file-based positioning.

&gt; mysql -uroot -p
mysql&gt; CHANGE MASTER TO
MASTER_HOST = '54.89.xx.xx',
MASTER_PORT = 3306,
MASTER_USER = 'repl_user',
MASTER_PASSWORD = 'XXXXXXXXX',
MASTER_AUTO_POSITION = 1;

Take a new backup.  Existing backups that were made before you enabled GTIDs can no longer be used on these servers now that you have enabled GTIDs. Take a new backup at this point, so that you are not left without a usable backup. 

mysql&gt; start slave;
mysql&gt; show slave status\G

----------------------------------------------------------------------------
step 6: Finally touch: unlock
----------------------------------------------------------------------------
mysql&gt; SET @@GLOBAL.read_only = OFF;

&gt; vim /etc/my.cnf
 #skip-slave-start

</code></pre></div><h4 id="reset-replication"><a href="#reset-replication" class="header-anchor">#</a> Reset Replication</h4> <div class="language- extra-class"><pre class="language-text"><code>on slave:
mysql &gt; stop slave;
mysql &gt; reset slave (all);
	RESET SLAVE ‰∏ç‰ºöÊîπÂèòÂ§çÂà∂ËøûÊé•‰ΩøÁî®ÁöÑÂèÇÊï∞Ôºå‰æãÂ¶Çmaster host, master port, master user, or master password
	RESET SLAVE ALL Âàô‰ºöÔºõ
    Ê∏ÖÈô§slave Â§çÂà∂Êó∂ÁöÑmaster binlogÁöÑ‰ΩçÁΩÆ
    Ê∏ÖÁ©∫master info, relay log info
    Âà†Èô§ÊâÄÊúâÁöÑrelay logÊñá‰ª∂ÔºåÂπ∂ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑrelay logÊñá‰ª∂„ÄÇ
    ÈáçÁΩÆÂ§çÂà∂Âª∂Ëøü(CHANGE MASTER TO ÁöÑ MASTER_DELAYÂèÇÊï∞ÊåáÂÆöÁöÑ)‰∏∫0„ÄÇ

ÂäüËÉΩËØ¥ÊòéÔºöÁî®‰∫éÂà†Èô§SLAVEÊï∞ÊçÆÂ∫ìÁöÑrelaylogÊó•ÂøóÊñá‰ª∂ÔºåÂπ∂ÈáçÊñ∞ÂêØÁî®Êñ∞ÁöÑrelaylogÊñá‰ª∂Ôºõ

reset slave Â∞Ü‰Ωøslave ÂøòËÆ∞‰∏ª‰ªéÂ§çÂà∂ÂÖ≥Á≥ªÁöÑ‰ΩçÁΩÆ‰ø°ÊÅØ„ÄÇËØ•ËØ≠Âè•Â∞ÜË¢´Áî®‰∫éÂπ≤ÂáÄÁöÑÂêØÂä®, ÂÆÉÂà†Èô§master.infoÊñá‰ª∂Âíårelay-log.info Êñá‰ª∂‰ª•ÂèäÊâÄÊúâÁöÑrelay log Êñá‰ª∂Âπ∂ÈáçÊñ∞ÂêØÁî®‰∏Ä‰∏™Êñ∞ÁöÑrelaylogÊñá‰ª∂„ÄÇ

‰ΩøÁî®reset slave‰πãÂâçÂøÖÈ°ª‰ΩøÁî®stop slave ÂëΩ‰ª§Â∞ÜÂ§çÂà∂ËøõÁ®ãÂÅúÊ≠¢„ÄÇ


on master:

mysql &gt; RESET MASTER

    Âà†Èô§binlogÁ¥¢ÂºïÊñá‰ª∂‰∏≠ÂàóÂá∫ÁöÑÊâÄÊúâbinlogÊñá‰ª∂
    Ê∏ÖÁ©∫binlogÁ¥¢ÂºïÊñá‰ª∂
    ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑbinlogÊñá‰ª∂
    Ê∏ÖÁ©∫Á≥ªÁªüÂèòÈáègtid_purgedÂíågtid_executed
    Âú®MySQL 5.7.5 ÂèäÂêéÁª≠ÁâàÊú¨‰∏≠, RESET MASTERËøò‰ºö‰ºöÊ∏ÖÁ©∫ mysql.gtid_executed Êï∞ÊçÆË°®„ÄÇ

ÂäüËÉΩËØ¥ÊòéÔºöÂà†Èô§ÊâÄÊúâÁöÑbinglogÊó•ÂøóÊñá‰ª∂ÔºåÂπ∂Â∞ÜÊó•ÂøóÁ¥¢ÂºïÊñá‰ª∂Ê∏ÖÁ©∫ÔºåÈáçÊñ∞ÂºÄÂßãÊâÄÊúâÊñ∞ÁöÑÊó•ÂøóÊñá‰ª∂„ÄÇÁî®‰∫éÁ¨¨‰∏ÄÊ¨°ËøõË°åÊê≠Âª∫‰∏ª‰ªéÂ∫ìÊó∂ÔºåËøõË°å‰∏ªÂ∫ìbinlogÂàùÂßãÂåñÂ∑•‰ΩúÔºõ

 Ê≥®ÊÑèreset master ‰∏çÂêå‰∫épurge binary logÁöÑ‰∏§Â§ÑÂú∞Êñπ
1. reset master Â∞ÜÂà†Èô§Êó•ÂøóÁ¥¢ÂºïÊñá‰ª∂‰∏≠ËÆ∞ÂΩïÁöÑÊâÄÊúâbinlogÊñá‰ª∂ÔºåÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÊó•ÂøóÊñá‰ª∂ Ëµ∑ÂßãÂÄº‰ªé000001 ÂºÄÂßãÔºåÁÑ∂ËÄåpurge binary log ÂëΩ‰ª§Âπ∂‰∏ç‰ºö‰øÆÊîπËÆ∞ÂΩïbinlogÁöÑÈ°∫Â∫èÁöÑÊï∞ÂÄº
2. reset master ‰∏çËÉΩÁî®‰∫éÊúâ‰ªª‰Ωïslave Ê≠£Âú®ËøêË°åÁöÑ‰∏ª‰ªéÂÖ≥Á≥ªÁöÑ‰∏ªÂ∫ì„ÄÇÂõ†‰∏∫Âú®slave ËøêË°åÊó∂Âàª reset master ÂëΩ‰ª§‰∏çË¢´ÊîØÊåÅÔºåreset master Â∞Ümaster ÁöÑbinlog‰ªé000001 ÂºÄÂßãËÆ∞ÂΩï,slave ËÆ∞ÂΩïÁöÑmaster log ÂàôÊòØreset master Êó∂‰∏ªÂ∫ìÁöÑÊúÄÊñ∞ÁöÑbinlog,‰ªéÂ∫ì‰ºöÊä•ÈîôÊó†Ê≥ïÊâæÁöÑÊåáÂÆöÁöÑbinlogÊñá‰ª∂„ÄÇ
</code></pre></div><h3 id="sync-replication"><a href="#sync-replication" class="header-anchor">#</a> Sync Replication</h3> <p>Synchronize both servers by setting them to read-only if the replication is running already by using the following command:</p> <div class="language- extra-class"><pre class="language-text"><code>mysql&gt; SET @@GLOBAL.read_only = ON;
</code></pre></div><p>Ëß£ÈáäÔºö</p> <p>ÂØπ‰∫éMysqlÊï∞ÊçÆÂ∫ìËØªÂÜôÁä∂ÊÄÅÔºå‰∏ªË¶ÅÈù†&quot;read_only&quot;ÂÖ®Â±ÄÂèÇÊï∞Êù•ËÆæÂÆöÔºõÈªòËÆ§ÊÉÖÂÜµ‰∏ã, Êï∞ÊçÆÂ∫ìÊòØÁî®‰∫é<strong>ËØªÂÜôÊìç‰Ωú</strong>ÁöÑÔºåÊâÄ‰ª•read_onlyÂèÇÊï∞‰πüÊòØ0ÊàñfaluseÁä∂ÊÄÅÔºåËøôÊó∂ÂÄô‰∏çËÆ∫ÊòØÊú¨Âú∞Áî®Êà∑ËøòÊòØËøúÁ®ãËÆøÈóÆÊï∞ÊçÆÂ∫ìÁöÑÁî®Êà∑ÔºåÈÉΩÂèØ‰ª•ËøõË°åËØªÂÜôÊìç‰ΩúÔºõ</p> <p>Â¶ÇÈúÄËÆæÁΩÆ‰∏∫<strong>Âè™ËØªÁä∂ÊÄÅ</strong>ÔºåÂ∞ÜËØ•read_onlyÂèÇÊï∞ËÆæÁΩÆ‰∏∫1ÊàñTRUEÁä∂ÊÄÅÔºå‰ΩÜËÆæÁΩÆ read_only=1 Áä∂ÊÄÅÊúâ‰∏§‰∏™ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÂú∞ÊñπÔºö</p> <ol><li><p>read_only=1Âè™ËØªÊ®°ÂºèÔºå<strong>‰∏ç‰ºöÂΩ±ÂìçslaveÂêåÊ≠•Â§çÂà∂ÁöÑÂäüËÉΩ</strong>ÔºåÊâÄ‰ª•Âú®MySQL slaveÂ∫ì‰∏≠ËÆæÂÆö‰∫Üread_only=1ÂêéÔºåÈÄöËøá &quot;show slave status\G&quot; ÂëΩ‰ª§Êü•ÁúãsalveÁä∂ÊÄÅÔºåÂèØ‰ª•ÁúãÂà∞salve‰ªçÁÑ∂‰ºöËØªÂèñmaster‰∏äÁöÑÊó•ÂøóÔºåÂπ∂‰∏îÂú®slaveÂ∫ì‰∏≠Â∫îÁî®Êó•ÂøóÔºå‰øùËØÅ‰∏ª‰ªéÊï∞ÊçÆÂ∫ìÂêåÊ≠•‰∏ÄËá¥Ôºõ</p></li> <li><p>read_only=1Âè™ËØªÊ®°ÂºèÔºåÈôêÂÆöÁöÑÊòØÊôÆÈÄöÁî®Êà∑ËøõË°åÊï∞ÊçÆ‰øÆÊîπÁöÑÊìç‰ΩúÔºå‰ΩÜ‰∏ç‰ºöÈôêÂÆöÂÖ∑ÊúâsuperÊùÉÈôêÁöÑÁî®Êà∑ÁöÑÊï∞ÊçÆ‰øÆÊîπÊìç‰Ωú (‰ΩÜÊòØÂ¶ÇÊûúËÆæÁΩÆ‰∫Ü&quot;<strong>super_read_only=on</strong>&quot;Ôºå ÂàôÂ∞±‰ºöÈôêÂÆöÂÖ∑ÊúâsuperÊùÉÈôêÁöÑÁî®Êà∑ÁöÑÊï∞ÊçÆ‰øÆÊîπÊìç‰Ωú‰∫Ü)ÔºõÂú®MySQL‰∏≠ËÆæÁΩÆread_only=1ÂêéÔºåÊôÆÈÄöÁöÑÂ∫îÁî®Áî®Êà∑ËøõË°åinsert„ÄÅupdate„ÄÅdeleteÁ≠â‰ºö‰∫ßÁîüÊï∞ÊçÆÂèòÂåñÁöÑDMLÊìç‰ΩúÊó∂ÔºåÈÉΩ‰ºöÊä•Âá∫Êï∞ÊçÆÂ∫ìÂ§Ñ‰∫éÂè™ËØªÊ®°Âºè‰∏çËÉΩÂèëÁîüÊï∞ÊçÆÂèòÂåñÁöÑÈîôËØØÔºå‰ΩÜÂÖ∑ÊúâsuperÊùÉÈôêÁöÑÁî®Êà∑Ôºå‰æãÂ¶ÇÂú®Êú¨Âú∞ÊàñËøúÁ®ãÈÄöËøárootÁî®Êà∑ÁôªÂΩïÂà∞Êï∞ÊçÆÂ∫ìÔºåËøòÊòØÂèØ‰ª•ËøõË°åÊï∞ÊçÆÂèòÂåñÁöÑDMLÊìç‰ΩúÔºõ<strong>(‰πüÂ∞±ÊòØËØ¥&quot;real_only&quot;Âè™‰ºöÁ¶ÅÊ≠¢ÊôÆÈÄöÁî®Êà∑ÊùÉÈôêÁöÑmysqlÂÜôÊìç‰ΩúÔºå‰∏çËÉΩÈôêÂà∂superÊùÉÈôêÁî®Êà∑ÁöÑÂÜôÊìç‰ΩúÔºõ Â¶ÇÊûúË¶ÅÊÉ≥ËøûsuperÊùÉÈôêÁî®Êà∑ÁöÑÂÜôÊìç‰Ωú‰πüÁ¶ÅÊ≠¢ÔºåÂ∞±‰ΩøÁî®&quot;flush tables with read lock;&quot;ÔºåËøôÊ†∑ËÆæÁΩÆ‰πü‰ºöÈòªÊ≠¢‰∏ª‰ªéÂêåÊ≠•Â§çÂà∂ÔºÅ)</strong></p></li></ol> <p>https://www.cnblogs.com/kevingrace/p/10095332.html</p> <h3 id="replication-troubleshooting"><a href="#replication-troubleshooting" class="header-anchor">#</a> Replication Troubleshooting</h3> <h4 id="gtid"><a href="#gtid" class="header-anchor">#</a> gtid</h4> <p><strong>GTID Set Gaps:</strong></p> <p>Executed_Gtid_Set</p> <p>uuid:1-111,113-120</p> <p>occur when slave_parrallel_workers &gt; 1, A transaction is missing;</p> <p><strong>Finding transactions:</strong></p> <p>mysqlbinlog --no-defaults -vvv --base64-output=DECODE-ROWS --include-gtids='uuid:112' /var/lib/mysql/mysql-bin.xxxxx</p> <p>result: SET @@SESSION.GTID_NEXT='uuid:112'</p> <p><strong>Faking transactions:</strong></p> <p>set gtid_next='uuid:112'; BEGIN; COMMIT;</p> <p><strong>Skipping transactions:</strong></p> <p>sql_slave_skip_counter</p> <h4 id="other"><a href="#other" class="header-anchor">#</a> other</h4> <p>https://dev.mysql.com/doc/mysql-replication-excerpt/8.0/en/replication-problems.html</p> <p>‰∏çË¶ÅËΩªÊòìÂú®‰∏§Áßç‰∏çÂêåÁöÑreplicationÊ®°ÂºèÈó¥ÂàáÊç¢Ôºö</p> <p>MySQL 5.7Â§çÂà∂ÈÖçÁΩÆ‰∏çËßÑËåÉ‰øÆÊîπÂØºËá¥ÁöÑÂùëÔºöhttp://blog.itpub.net/28218939/viewspace-2142235/</p> <p>https://www.cnblogs.com/shengdimaya/p/6897584.html</p> <p>ref:</p> <p>https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-centos-7</p> <p>benchmark: http://www.itsecure.hu/library/image/CIS_Oracle_MySQL_Enterprise_Edition_5.7_Benchmark_v1.0.0.pdf</p> <h3 id="keepalived-mysql-È´òÂèØÁî®"><a href="#keepalived-mysql-È´òÂèØÁî®" class="header-anchor">#</a> Keepalived+ mysql È´òÂèØÁî®</h3> <div class="language- extra-class"><pre class="language-text"><code>-------------------------------------------------------------------------------
1.	‰∏§Âè∞ÊúçÂä°ÈÉΩÂÆâË£ÖnginxÂíåkeepalived
-------------------------------------------------------------------------------
yum install nginx
yum install keepalived


-------------------------------------------------------------------------------
2. MYSQL check linux scripts
-------------------------------------------------------------------------------
vim /etc/keepalived/scripts/check_mysql.sh

MYSQL=/usr/bin/mysql
MYSQL_HOST=localhost
MYSQL_USER=root
MYSQL_PASSWORD=redhat

$MYSQL -h $MYSQL_HOST -u $MYSQL_USER -p$MYSQL_PASSWORD -e &quot;show status;&quot; &gt;/dev/null 2&gt;&amp;1

if [ $? == 0 ]
then
  echo &quot; $host mysql login successfully&quot;
  exit 0
else
  #echo &quot; $host mysql login faild&quot; #Ëã•mysqlÂÖ≥Èó≠ÔºåÂàôkeepalivedÂÖ≥Èó≠
  killall keepalived
  exit 2
fi

-------------------------------------------------------------------------------
4. ‰øÆÊîπkeepalivedÈÖçÁΩÆÊñá‰ª∂
-------------------------------------------------------------------------------
sudo vim /etc/keepalived/keepalived.conf 

! Configuration File for keepalived 

global_defs {
   router_id MYSQL0001    # router_idÂèØÈöèÊÑèÈÖçÁΩÆÔºå‰∏ªÂ§áÊúçÂä°Âô®ÈÖçÁΩÆÈúÄ‰∏çÂêå #ËøêË°åkeepalivedÁöÑÊú∫Âô®ÁöÑ‰∏Ä‰∏™Ê†áËØÜÔºåÈÄöÂ∏∏ÂèØËÆæ‰∏∫hostname„ÄÇÊïÖÈöúÂèëÁîüÊó∂ÔºåÂèëÈÇÆ‰ª∂Êó∂ÊòæÁ§∫Âú®ÈÇÆ‰ª∂‰∏ªÈ¢ò‰∏≠ÁöÑ‰ø°ÊÅØ„ÄÇ
}

vrrp_script chk_mysql {
    script &quot;/etc/keepalived/scripts/check_mysql.sh&quot;    #ËÑöÊ≠•Âú∞ÂùÄ
    interval 300  #ËÑöÊú¨ÊâßË°åÈó¥Èöî 300Áßí
    weight -5                    #ËÑöÊú¨ÁªìÊûúÂØºËá¥ÁöÑ‰ºòÂÖàÁ∫ßÂèòÊõ¥ÔºåÊ£ÄÊµãÂ§±Ë¥•ÔºàËÑöÊú¨ËøîÂõûÈùû0ÔºâÂàô‰ºòÂÖàÁ∫ß -5
    fall 2                    #Ê£ÄÊµãËøûÁª≠2Ê¨°Â§±Ë¥•ÊâçÁÆóÁ°ÆÂÆöÊòØÁúüÂ§±Ë¥•„ÄÇ‰ºöÁî®weightÂáèÂ∞ë‰ºòÂÖàÁ∫ßÔºà1-255‰πãÈó¥Ôºâ
    rise 1                    #Ê£ÄÊµã1Ê¨°ÊàêÂäüÂ∞±ÁÆóÊàêÂäü„ÄÇ‰ΩÜ‰∏ç‰øÆÊîπ‰ºòÂÖàÁ∫ß
}

vrrp_instance VI_1 { #keepalivedÂú®Âêå‰∏Ävirtual_router_id‰∏≠priorityÔºà0-255ÔºâÊúÄÂ§ßÁöÑ‰ºöÊàê‰∏∫masterÔºå‰πüÂ∞±ÊòØÊé•ÁÆ°VIPÔºåÂΩìpriorityÊúÄÂ§ßÁöÑ‰∏ªÊú∫ÂèëÁîüÊïÖÈöúÂêéÊ¨°priorityÂ∞Ü‰ºöÊé•ÁÆ°
    state BACKUP    # ‰∏ªÂ§ákeepalivedËäÇÁÇπÊ≠§Â§ÑÂøÖÈ°ªÈÉΩËÆæÁΩÆÊàêBACKUPÔºåÂê¶ÂàôÈùûÊä¢Âç†Ê®°Âºè‰∏çÁîüÊïà
    interface eth0 #ÊåáÂÆöHAÁõëÊµãÁΩëÁªúÁöÑÊé•Âè£„ÄÇÂÆû‰æãÁªëÂÆöÁöÑÁΩëÂç°ÔºåÂõ†‰∏∫Âú®ÈÖçÁΩÆËôöÊãüIPÁöÑÊó∂ÂÄôÂøÖÈ°ªÊòØÂú®Â∑≤ÊúâÁöÑÁΩëÂç°‰∏äÊ∑ªÂä†ÁöÑ
    virtual_router_id 54  # Âêå‰∏Ä‰∏™VIPÁöÑvirtual_router_idÂøÖÈ°ª‰∏ÄËá¥ #ËôöÊãüË∑ØÁî±Ê†áËØÜÔºåËøô‰∏™Ê†áËØÜÊòØ‰∏Ä‰∏™Êï∞Â≠óÔºåÂêå‰∏Ä‰∏™vrrpÂÆû‰æã‰ΩøÁî®ÂîØ‰∏ÄÁöÑÊ†áËØÜ„ÄÇÂç≥Âêå‰∏Ävrrp_instance‰∏ãÔºåMASTERÂíåBACKUPÂøÖÈ°ªÊòØ‰∏ÄËá¥ÁöÑ
    priority 100     # ‰ºòÂÖàÁ∫ßÈÖçÁΩÆÔºåÊï∞Â≠óË∂äÂ§ßÔºå‰ºòÂÖàÁ∫ßË∂äÈ´òÔºà‰∏ªÁöÑÂ§ßÔºå‰ªéÁöÑÂ∞èÔºâ
    advert_int 1	#ËÆæÂÆöMASTER‰∏éBACKUPË¥üËΩΩÂùáË°°Âô®‰πãÈó¥ÂêåÊ≠•Ê£ÄÊü•ÁöÑÊó∂Èó¥Èó¥ÈöîÔºåÂçï‰ΩçÊòØÁßí
    authentication {	#ËÆæÁΩÆÈ™åËØÅÁ±ªÂûãÂíåÂØÜÁ†Å„ÄÇ‰∏ª‰ªéÂøÖÈ°ª‰∏ÄÊ†∑
        auth_type PASS	#ËÆæÁΩÆvrrpÈ™åËØÅÁ±ªÂûãÔºå‰∏ªË¶ÅÊúâPASSÂíåAH‰∏§Áßç
        auth_pass 1111	#ËÆæÁΩÆvrrpÈ™åËØÅÂØÜÁ†ÅÔºåÂú®Âêå‰∏Ä‰∏™vrrp_instance‰∏ãÔºåMASTER‰∏éBACKUPÂøÖÈ°ª‰ΩøÁî®Áõ∏ÂêåÁöÑÂØÜÁ†ÅÊâçËÉΩÊ≠£Â∏∏ÈÄö‰ø°
    }
    nopreempt        # ÈùûÊä¢Âç†Ê®°ÂºèÔºåÂç≥masterÂ§±ÊïàÂêéÔºåÂ¶ÇÈáçÊñ∞‰∏äÁ∫øÔºåÂ∞Ü‰∏çÊä¢Âç†VIPÔºà‰∏ªÁöÑÈúÄË¶ÅÔºå‰ªéÁöÑ‰∏çÈúÄË¶ÅÔºâ
    track_script {
        chk_mysql
    }
    track_interface {
        eth0    
    }
    virtual_ipaddress {
        192.168.100.150    ËôöÊãüIp  #Ê†πÊçÆÊÉÖÂÜµÈÖçÁΩÆËôöÊãüip
    }
    notify_master /etc/keepalived/scripts/mysql_master.sh     #ËÑöÊ≠•Âú∞ÂùÄ
    notify_backup /etc/keepalived/scripts/mysql_slave.sh
    notify_fault /etc/keepalived/scripts/mysql_fault.sh
#    notify_stop /etc/keepalived/scripts/mysql_stop.sh
}


Âú®10.136.100.49‰∏äÔºåÂè™ÈúÄË¶ÅÊîπÂèò:
router_id MYSQL0001-&gt;MYSQL0002
priority 101 -&gt; priority 100Ôºå
mcast_src_ip 10.136.100.48 -&gt; mcast_src_ip 10.136.100.49Âç≥ÂèØ„ÄÇ

-------------------------------------------------------------------------------
5. ÂêØÂä®
-------------------------------------------------------------------------------

systemctl start keepalived

ip addr show eth0
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000
    link/ether 56:6f:18:fa:00:08 brd ff:ff:ff:ff:ff:ff
    inet 10.136.100.49/24 brd 10.136.100.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet 10.136.100.44/32 scope global eth0
       valid_lft forever preferred_lft forever

ÂÜçÂêØÂä®Âè¶Â§ñ‰∏Ä‰∏™Êú∫Âô®ÁöÑkeepalivedÔºåÊâßË°å ip addr show eth0 Âπ∂‰∏ç‰ºöÊúâÁ±ª‰ºº‰∏äÈù¢ÁöÑËæìÂá∫ÔºåÈô§ÈùûÊòØÂú®ÂâçÈù¢ÁöÑÊú∫Âô®‰∏äÊâßË°å systemctl stop keepalived

ÊüêÂè∞Êú∫Âô®Ë¢´ÈÄâ‰∏≠ÁöÑÊó∂ÂÄô‰ºöÂá∫Áé∞Â¶Ç‰∏ãÊó•ÂøóÔºå/var/log/messages Ôºö

Jun 15 17:01:08 sgkc2-devclr-v08 Keepalived_vrrp[4850]: VRRP_Instance(VI_1) Transition to MASTER STATE
Jun 15 17:01:09 sgkc2-devclr-v08 Keepalived_vrrp[4850]: VRRP_Instance(VI_1) Entering MASTER STATE
Jun 15 17:01:09 sgkc2-devclr-v08 Keepalived_vrrp[4850]: VRRP_Instance(VI_1) setting protocol VIPs.
Jun 15 17:01:09 sgkc2-devclr-v08 Keepalived_vrrp[4850]: Sending gratuitous ARP on eth0 for 10.136.100.44
Jun 15 17:01:09 sgkc2-devclr-v08 Keepalived_vrrp[4850]: VRRP_Instance(VI_1) Sending/queueing gratuitous ARPs on eth0 for 10.136.100.44
Jun 15 17:01:09 sgkc2-devclr-v08 Keepalived_vrrp[4850]: Sending gratuitous ARP on eth0 for 10.136.100.44

-------------------------------------------------------------------------------
5. Áä∂ÊÄÅÊ£ÄÊµã
-------------------------------------------------------------------------------
sudo tcpdump -vvv -n -i eth0 dst 224.0.0.18 and src 10.136.100.48
</code></pre></div><h2 id="_3-troubleshooting"><a href="#_3-troubleshooting" class="header-anchor">#</a> 3 Troubleshooting</h2> <h3 id="host-xxx-xx-xxx-xxx-is-not-allowed-to-connect-to-this-mysql-server"><a href="#host-xxx-xx-xxx-xxx-is-not-allowed-to-connect-to-this-mysql-server" class="header-anchor">#</a> Host 'xxx.xx.xxx.xxx' is not allowed to connect to this MySQL server**</h3> <div class="language- extra-class"><pre class="language-text"><code>CREATE USER 'test'@'%' IDENTIFIED BY '123456';
GRANT ALL PRIVILEGES ON * . * TO 'test'@'%';
FLUSH PRIVILEGES;
</code></pre></div><h3 id="mysql-workbench-the-type-initializer-for-htmlrenderer-utils-fontsutils-threw-an-exception"><a href="#mysql-workbench-the-type-initializer-for-htmlrenderer-utils-fontsutils-threw-an-exception" class="header-anchor">#</a> mysql workbench The type initializer for 'HtmlRenderer.Utils.FontsUtils' threw an exception.**</h3> <p>http://stackoverflow.com/questions/32020024/upgrading-to-windows-10-breaks-mysql-workbench
https://bugs.mysql.com/bug.php?id=75344</p> <h3 id="mysqldump-stored-procedure-routines-faild"><a href="#mysqldump-stored-procedure-routines-faild" class="header-anchor">#</a> mysqldump stored procedure --routines faild</h3> <p>mysqldump: test_dbuser has insufficent privileges to SHOW CREATE PROCEDURE <code>pTEST</code>!</p> <div class="language- extra-class"><pre class="language-text"><code>ÊúÄÂºÄÂßãÊòØÂá∫Áé∞
ERROR 1227 (42000) at line 5632: Access denied; you need (at least one of) the SUPER privilege(s) for this operation

5618 --
5619 -- Dumping routines for database 'db01'
5620 --
5621 /*!50003 DROP PROCEDURE IF EXISTS `pTEST1` */;
5622 ALTER DATABASE `db01` CHARACTER SET utf8 COLLATE utf8_general_ci ;
5623 /*!50003 SET @saved_cs_client      = @@character_set_client */ ;
5624 /*!50003 SET @saved_cs_results     = @@character_set_results */ ;
5625 /*!50003 SET @saved_col_connection = @@collation_connection */ ;
5626 /*!50003 SET character_set_client  = utf8 */ ;
5627 /*!50003 SET character_set_results = utf8 */ ;
5628 /*!50003 SET collation_connection  = utf8_general_ci */ ;
5629 /*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
5630 /*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
5631 DELIMITER ;;
5632 CREATE DEFINER=`test_dbuser`@`%` PROCEDURE `pTEST1`(IN i_asof DATE)
5633 BEGIN
5634 
5635         DECLARE EXIT HANDLER FOR SQLEXCEPTION
5636     BEGIN

ÂèØ‰ª•ÁúãÂà∞ 5632 CREATE DEFINER=`test_dbuser`@`%` PROCEDURE `pTEST1`(IN i_asof DATE)
ÊâÄ‰ª•ÊàëÂ∞±Áõ¥Êé•
mysql&gt; GRANT SUPER ON *.* TO 'test_dbuser'@'%';                                                                
ÁÑ∂ÂêéÂêéÊù•ÊàëÊÉ≥Âà∞ÂÆûÈôÖ‰∏äÊâßË°åmysqldumpÁöÑËØ≠Âè•ÊòØ
mysqldump --login-path=cn-dev-v01 --set-gtid-purged=OFF --no-tablespaces db01 &gt;test
cn-dev-v01ÁöÑhostÊòØlocalhostÔºå‰∏çÊòØ%ÔºåÂèØ‰ª•ÁúãÂà∞CREATE DEFINER=`test_dbuser`@`%` ‰∏çÊòØ @`localhost`
ÁÑ∂ÂêéÊàëÊÉ≥ÁùÄËÆæÁΩÆcn-dev-v01 login path host‰∏∫%Ôºå‰ΩÜÊòØÂ§±Ë¥•ÔºåÂõ†‰∏∫%Êó†Ê≥ïËß£ÊûêÔºåËá™ÁÑ∂Êó†Ê≥ïËøûÊé•dbÔºåÂè™Â•ΩÊîπÂõûÊù•Ôºå
ÁÑ∂ÂêéÂÜçËØïÂèëÁé∞ÂèàÊúâÈóÆÈ¢òÔºö
mysqldump: test_dbuser has insufficent privileges to SHOW CREATE PROCEDURE `pTEST1`!
Êü•‰∫Ü‰∏ã
https://dba.stackexchange.com/questions/184724/permissions-for-mysql-show-create-procedure
To use either statement, you must be the user named in the routine DEFINER clause or have SELECT access to the mysql.proc table. If you do not have privileges for the routine itself, the value displayed for the Create Procedure or Create Function field will be NULL. 
https://dev.mysql.com/doc/refman/5.7/en/show-create-procedure.html
Ë¶ÅÁªôSELECTÊùÉÈôêÔºåSUPER‰∏çÂåÖÂê´SELECTÊùÉÈôêÔºüÔºü
mysql&gt; grant SELECT ON *.* TO 'test_dbuser'@'localhost';
Â∞±Â•Ω‰∫Ü

ÁÑ∂ÂêéÂèàÊÉ≥Âà∞ÔºåÊó¢ÁÑ∂'%'ÂåÖÂê´'localhost'ÔºåÂπ≤ËÑÜÁõ¥Êé•Âà†Êéâ test_dbuser@'localhost'
DROP USER 'test_dbuser'@'localhost';
ËøôÊ¨°ËôΩÁÑ∂Ê≤°Êúâ
mysqldump: test_dbuser has insufficent privileges to SHOW CREATE PROCEDURE `pTEST1`!
‰ΩÜÊòØÂè¶Â§ñ‰∏Ä‰∏™db02ËøòÊòØÊúâËøô‰∏™ÈóÆÈ¢ò
mysqldump: test_dbuser has insufficent privileges to SHOW CREATE PROCEDURE `pTEST2`!

1994 DELIMITER ;
1995 /*!50003 SET sql_mode              = @saved_sql_mode */ ;
1996 /*!50003 SET character_set_client  = @saved_cs_client */ ;
1997 /*!50003 SET character_set_results = @saved_cs_results */ ;
1998 /*!50003 SET collation_connection  = @saved_col_connection */ ;
1999 /*!50003 DROP PROCEDURE IF EXISTS `pTEST2` */;
2000 /*!50003 SET @saved_cs_client      = @@character_set_client */ ;
2001 /*!50003 SET @saved_cs_results     = @@character_set_results */ ;
2002 /*!50003 SET @saved_col_connection = @@collation_connection */ ;
2003 /*!50003 SET character_set_client  = utf8 */ ;
2004 /*!50003 SET character_set_results = utf8 */ ;
2005 /*!50003 SET collation_connection  = utf8_general_ci */ ;
2006 /*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
2007 /*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION' */ ;
2008 DELIMITER ;;
2009 CREATE DEFINER=`test_dbuser`@`%` PROCEDURE `pTEST2`(IN i_asof DATE)
2010 BEGIN
2011 
2012         DECLARE EXIT HANDLER FOR SQLEXCEPTION
2013     BEGIN

ÂÜçÊääSELECTÂä†Áªô'test_dbuser'@'%'Âç≥ÂèØ
mysql&gt; grant SELECT ON *.* TO 'test_dbuser'@'%';
ÊúÄÂêérevokeÊéâSUPERÊùÉÈôêÂÜçËØï
mysql&gt; revoke SUPER ON *.* FROM 'test_dbuser'@'%';
‰ªçÁÑ∂ÊàêÂäü
</code></pre></div><h3 id="script-import-issue"><a href="#script-import-issue" class="header-anchor">#</a> script import issue;</h3> <div class="language- extra-class"><pre class="language-text"><code>-- Set new delimiter '$$'
DELIMITER $$
$$
-- Set default delimiter ';'
DELIMITER ;
</code></pre></div><h3 id="fixing-‚Äúlock-wait-timeout-exceeded-try-restarting-transaction‚Äù-for-a-stuck-mysql-table"><a href="#fixing-‚Äúlock-wait-timeout-exceeded-try-restarting-transaction‚Äù-for-a-stuck-mysql-table" class="header-anchor">#</a> Fixing ‚ÄúLock wait timeout exceeded; try restarting transaction‚Äù for a 'stuck&quot; Mysql table?</h3> <p>https://stackoverflow.com/questions/5836623/getting-lock-wait-timeout-exceeded-try-restarting-transaction-even-though-im</p> <div class="language- extra-class"><pre class="language-text"><code>show processlist;
kill &lt;put_process_id_here&gt;; ÂÖàÂπ≤ÊéâËÄóÊó∂ÈïøÁöÑprocess
</code></pre></div><h3 id="upgrade-trouble-shooting"><a href="#upgrade-trouble-shooting" class="header-anchor">#</a> upgrade trouble shooting</h3> <p>https://dev.mysql.com/doc/refman/5.7/en/upgrade-troubleshooting.html</p> <h3 id="access-denied-for-user-root-localhost-using-password-no-when-trying-to-connect"><a href="#access-denied-for-user-root-localhost-using-password-no-when-trying-to-connect" class="header-anchor">#</a> Access denied for user 'root'@'localhost' (using password: NO) when trying to connect**</h3> <p>ÈÄöÂ∏∏ÊòØÂõ†‰∏∫ËæìÂÖ•‰∫Ü‰∏≠ÊñáÂ≠óÁ¨¶ÁöÑdash -- ÊàñËÄÖ‰ªéwordÊñáÊ°£copyÂá∫Êù•ÁöÑÈîôËØØÁºñÁ†ÅÁöÑÂèÇÊï∞Á¨¶Âè∑--</p> <h3 id="ÈöèÊú∫Âá∫Áé∞ÁöÑconnection-timeout"><a href="#ÈöèÊú∫Âá∫Áé∞ÁöÑconnection-timeout" class="header-anchor">#</a> ÈöèÊú∫Âá∫Áé∞ÁöÑconnection timeout</h3> <h5 id="Ëµ∑Âõ†ÊòØduirdËøûÊé•Ê±†Êä•Èîô"><a href="#Ëµ∑Âõ†ÊòØduirdËøûÊé•Ê±†Êä•Èîô" class="header-anchor">#</a> Ëµ∑Âõ†ÊòØduirdËøûÊé•Ê±†Êä•Èîô</h5> <p>Êàë‰ª¨ÁöÑ‰∏Ä‰∏™springbootÁ®ãÂ∫è ‰ΩøÁî®‰∫ÜÈòøÈáådruidÔºå‰πãÂâçÈÉΩÂ•ΩÂ•ΩÁöÑÔºå‰∏äÂà∞Áîü‰∫ßÈÅáÂà∞Âá†Ê¨°ÊØîËæÉÈöèÊú∫ÁöÑÈîôËØØÔºö</p> <div class="language- extra-class"><pre class="language-text"><code>Caused by: com.alibaba.druid.pool.GetConnectionTimeoutException: wait millis 60000, active 0, maxActive 500, creating 1, createElapseMillis 120001
	at com.alibaba.druid.pool.DruidDataSource.getConnectionInternal(DruidDataSource.java:1682)
	at com.alibaba.druid.pool.DruidDataSource.getConnectionDirect(DruidDataSource.java:1395)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1375)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1365)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:109)
	at org.springframework.jdbc.datasource.DataSourceTransactionManager.doBegin(DataSourceTransactionManager.java:262)

ÈíàÂØπËøô‰∏™ÈóÆÈ¢ò‰∏™‰∫∫ÂàÜÊûêÊñπÊ≥ïÂèäËß£ÂÜ≥ÊñπÊ°à Ôºö
1„ÄÅ‰ª£Á†Å‰∏≠Â≠òÂú®Ëé∑ÂèñDataSource Connection Ê≤°ÊúâÈáäÊîæÁöÑÊÉÖÂÜµÔºåÂèØÊü•ËØ¢‰∏öÂä°‰ª£Á†ÅÊòØÂê¶Â≠òÂú® Êú™ÈáäÊîæÁé∞Ë±°„ÄÇ
2„ÄÅÁ®ãÂ∫èÂπ∂ÂèëÊï∞ÈáèÂ§ßÊàñËÄÖSQLÊâßË°åËæÉÊÖ¢ÔºåÊï∞ÊçÆÂ∫ìËøûÊé•ÈÖçÁΩÆÂ§™Â∞èÔºåÂèØÂ¢ûÂ§ßmaxActiveÂèÇÊï∞„ÄÅÂ¢ûÂ§ßwait millis ÂèÇÊï∞„ÄÇ
3„ÄÅÊ£ÄÊü•Êï∞ÊçÆÂ∫ìËøûÊé•Êï∞ÊòØÂê¶ÈÖçÁΩÆËøá‰ΩéÔºåLinuxÊñá‰ª∂Âè•ÊüÑÊï∞ÊòØÂê¶ÈúÄË¶ÅË∞ÉÊï¥
4„ÄÅÊ≠§ÈóÆÈ¢òÈùûdruidÊ°ÜÊû∂ÂºïÂèëÔºåÂª∫ËÆÆ‰ªé‰∏öÂä°‰ª£Á†Å„ÄÅÂπ∂ÂèëÈáèËøõË°åÂàÜÊûêÊéíÊü•„ÄÇÂ¶ÇËã•druidÁâàÊú¨Ëøá‰ΩéÂèØÂçáÁ∫ßÔºå‰πüÂèØÈÖçÁΩÆÂº∫Âà∂ÈáäÊîæËøûÊé•„ÄÇ
‰ª•‰∏ãÈÖçÁΩÆÔºö
spring.datasource.druid.log-abandoned=true
spring.datasource.druid.remove-abandoned=true
#ÂèØÊ†πÊçÆÂÖ∑‰ΩìÊÉÖÂÜµÈÖåÊÉÖÈÖçÁΩÆÂõûÊî∂Êó∂Èó¥
spring.datasource.druid.remove-abandoned-timeout=300


###mysql show connections
show processlist;
show variables like 'max_connections';
select substring_index(host,':' ,1) as client_ip,Command,Time from information_schema.processlist;

### linuxÂè•ÊüÑÊï∞ÊéíÈîô mysql
https://blog.csdn.net/qq_28423997/article/details/87880653
https://blog.csdn.net/fygkchina/article/details/106537736

### mysql timeout
vi /etc/my.cnf
 wait_timeout = 28800
 interactive_timeout = 28800
 select @@wait_timeout; 
 

### druid VS hikari
https://github.com/alibaba/druid/issues/3720
</code></pre></div><p>Ê†∏ÂøÉÁöÑÊèêÁ§∫Â∞±ÊòØËøô‰∏™Ôºö</p> <p>Caused by: com.alibaba.druid.pool.GetConnectionTimeoutException: wait millis 60000, active 0, maxActive 500, creating 1, createElapseMillis 120001</p> <p>Ê†πÊçÆÊàëÁõÆÂâçÊü•Âà∞ÁöÑÔºåËÉΩÁü•ÈÅìÁöÑÊòØÔºåÊäõÂá∫ÂºÇÂ∏∏Êó∂ÔºåÊ±†Â≠êÈáåÁöÑactive ConnectionÊòØ0ÔºåÊâÄ‰ª•‰∏çÂ≠òÂú®Ê±†Â≠êÊª°‰∫ÜÁöÑÊÉÖÂÜµÔºåÂè¶Â§ñcreating 1Â∫îËØ•ÊòØ‰ª£Ë°®ÈúÄË¶ÅÂàõÂª∫‰∏Ä‰∏™connectionÔºå‰ΩÜÊòØ‰∏çÁü•ÈÅìÂõ†‰∏∫‰ªÄ‰πàÂéüÂõ†ÔºåÂàõÂª∫Ë∂ÖËøá‰∫ÜÊàë‰ª¨ËÆæÁΩÆÁöÑmaxWait=60000‰πüÂ∞±ÊòØ1ÂàÜÈíüÔºåcreateElapseMillis 120001ÊÑèÊÄùÂ∫îËØ•ÊòØÂàõÂª∫Ë∂ÖËøá‰∫Ü‰∏§ÂàÜÈíü</p> <p>Áî±‰∫é‰πãÂâçÂÖ∂‰ªñÁéØÂ¢ÉÊ≤°ÊúâÈÅáÂà∞ËøáÔºåÊØîËæÉÂÄæÂêë‰∫éÊòØÊúçÂä°Á´ØÈóÆÈ¢òÊàñÁΩëÁªúÈóÆÈ¢òÔºåÊÄªÁªìÂèØËÉΩÁöÑÈóÆÈ¢òÂ¶Ç‰∏ã</p> <p>1.ÊúçÂä°Á´ØÔºö
1ÔºâmysqlÔºöÊ†πÊçÆlogÁöÑwarnÔºåÂ•ΩÂÉèËøô‰∏™ÁâàÊú¨ÊòØÁªèËøáÂçáÁ∫ßÁöÑÔºå‰ΩÜÊòØÊ≤°ÊúâÂçáÁ∫ßÂÆåÂÖ®ÔºåÈúÄË¶ÅÊâßË°å‰∏ãmysql_upgradeÔºå‰∏çÁü•ÈÅìÊòØÂê¶ÊúâÂΩ±ÂìçÔºõ</p> <p>[Warning] InnoDB: Table mysql/innodb_table_stats has length mismatch in the column name table_name.  Please run mysql_upgrade</p> <p>2ÔºâÁΩëÁªúÊ≥¢Âä®Ôºå‰∏çÊ∏ÖÊ•ö‰∏§Âè∞Êú∫Âô®ÁöÑÈÉ®ÁΩ≤ÊÉÖÂÜµ</p> <p>2.ÈÖçÁΩÆÈóÆÈ¢òÔºö
1Ôºâmysql connection string‰ΩøÁî®ÁöÑÊòØserverTimezone=Asia/ShanghaiÔºåÊúçÂä°Âô®‰ΩøÁî®ÁöÑÂ∫îËØ•ÊòØSGT Asia/SingaporeÔºå‰∏çËøáËøô‰∏™ÊÑüËßâÂ∫îËØ•Ê≤°ÊúâÂΩ±ÂìçÔºåÂõ†‰∏∫ÈÉΩÊòØ‰∏úÂÖ´Âå∫
2ÔºâdruidÈÖçÁΩÆÈóÆÈ¢òÔºåÂÆòÊñπÂª∫ËÆÆmysql‰∏çË¶ÅÂºÄÂêØmaxPoolPreparedStatementPerConnectionSizeÔºåÁõÆÂâçÁä∂ÊÄÅÊòØÂºÄÂêØ‰∫Ü</p> <p>3.druidÊú¨Ë∫´ÈóÆÈ¢òÔºö
1ÔºâÁâàÊú¨Ëøá‰ΩéÔºåÁõÆÂâç‰ΩøÁî®ÁöÑ1.1.20ÊòØ19Âπ¥ÁöÑÁâàÊú¨Ôºå‰ΩÜÊòØÊàëÊ≤°ÊúâÁúãÂà∞‰ªª‰ΩïÊñ∞ÁâàÊú¨ÁöÑrelease noteÊèêÂà∞‰∫ÜÊàë‰ª¨ÈÅáÂà∞ÁöÑÈóÆÈ¢òÔºå‰∏çËøáÊúâ‰∫∫ÈÄöËøáÂçáÁ∫ßËß£ÂÜ≥‰∫ÜÈóÆÈ¢ò
2ÔºâdruidÊú¨Ë∫´ÁöÑÁº∫Èô∑ÔºåÊàëÁúãÂà∞duird ‰∏Ä‰∫õÂºÄÊîæÁöÑissueÂíåÂÖ≥Èó≠ÁöÑissue‰ªéÂá†Âπ¥ÂâçÂà∞ÊúÄËøëÈÉΩÊúâ‰∫∫ÊèêÂà∞Ëøô‰∏™ÈóÆÈ¢òÔºå‰ΩÜÊòØÂÆòÊñπÊ≤°ÊúâÁªôÂá∫‰ªª‰ΩïÂõûÂ∫îÂíåËß£ÂÜ≥ÔºåÁÑ∂ÂêéÊúâ‰∫∫ÈÄöËøáÊîæÂºÉÈòøÈáåÁöÑdruidÔºå‰ΩøÁî®ÂÖ∂‰ªñËøûÊé•Ê±†Ëß£ÂÜ≥‰∫Ü</p> <p>https://github.com/alibaba/druid/issues/3720
https://github.com/alibaba/druid/issues/2130
<a href="https://github.com/alibaba/druid/wiki/DruidDataSource%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/druid/wiki/DruidDataSource%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h5 id="ËÑöÊú¨ËøûÊé•Êï∞ÊçÆÂ∫ì‰πüÈöèÊú∫Âá∫Èîô"><a href="#ËÑöÊú¨ËøûÊé•Êï∞ÊçÆÂ∫ì‰πüÈöèÊú∫Âá∫Èîô" class="header-anchor">#</a> ËÑöÊú¨ËøûÊé•Êï∞ÊçÆÂ∫ì‰πüÈöèÊú∫Âá∫Èîô</h5> <p>Êé•ÁùÄÔºåÂêå‰∫ãÂèçÈ¶àcron job‰πüÈÅáÂà∞ËøáÂá†Ê¨°Á±ª‰ººÈóÆÈ¢ò:</p> <p>error 2003 (hy000) can't connect to mysql server 110</p> <p>https://blog.csdn.net/qq1137623160/article/details/78927741</p> <p>ÊúÄÂêéÂÖ∂ÂÆûÊÑüËßâÁõÆÂâçÁº∫Â∞ëÁöÑÊòØÔºö</p> <p>ÁõëÊéßÂíåload test performance test</p> <p>https://segmentfault.com/a/1190000022336871</p> <h5 id="ÂèëÁé∞Á´ØÂÄ™-aborted-connects"><a href="#ÂèëÁé∞Á´ØÂÄ™-aborted-connects" class="header-anchor">#</a> ÂèëÁé∞Á´ØÂÄ™ Aborted_connects</h5> <p>ÁûÑ‰∫ÜÁúºËøôÁØáÊñáÁ´†ÔºåÊÉ≥Âà∞ÂøòËÆ∞ËÆ§ÁúüÁúã‰∏ãËøûÊé•Êï∞</p> <p>https://www.jianshu.com/p/07c85b8a7997</p> <p>ÊâßË°å netstat -anp|grep 3306 Â§ßÊ¶Ç‰∏âÂçÅÂ§ö‰∏™ÔºåËøòÁÆóÊ≠£Â∏∏ÔºåÁÑ∂Âêé</p> <p>show global status like '%connection%';</p> <p>ÁªìÊûúÔºöConnections=7772 Max_used_connections=60</p> <p>Êü•‰∫Ü‰∏ãÔºåÂ•ΩÂÉèÊòØÊåáÊúçÂä°Âô®ÂêØÂä®‰πãÂêéÁ¥ØÁßØÁöÑÔºåÊâÄ‰ª•Ê≤°Êúâ‰ªÄ‰πàÂèÇËÄÉÊÑè‰πâ</p> <p>ConnectionsÔºöThe number of connection attempts (successful or not) to the MySQL server.
Max_used_connectionsÔºöThe maximum number of connections that have been in use simultaneously since the server started.</p> <p>show global status like '%thread%';</p> <p>ÁªìÊûúÔºöThreads_cached=8	Threads_connected=34	Threads_created=2232	Threads_running=1</p> <p>Threads_createdÂ∫îËØ•‰πüÊòØÁ¥ØËÆ°ÁöÑÔºåThreads_connectedÂ∫îËØ•ÊòØÂΩìÂâçÁöÑÔºåÁ°ÆÂÆûË∑üÂâçÈù¢netstatÂ∑Æ‰∏çÂ§ö</p> <p>show processlist;</p> <p>ÁªìÊûúÊòæÁ§∫‰∏âÂçÅÂ§ö‰∏™Á®ãÂ∫èÔºåÂ§ßÈÉ®ÂàÜÈÉΩÊòØsleepÁä∂ÊÄÅÔºåÂîØ‰∏ÄrunningÁöÑÊòØÊàëÂΩìÂâçÊü•ËØ¢ÁöÑËøô‰∏™Á∫øÁ®ãÔºõ</p> <p>Á°ÆËÆ§‰∫Ü‰∏ãÊúÄÂ§ßËøûÊé•Êï∞</p> <p>SHOW VARIABLES LIKE &quot;max_connections&quot;;</p> <p>ÁªìÊûúÊòØ151ÈªòËÆ§ÂÄºÔºåËøúË∂Ö34ÔºåÂ∫îËØ•Ê≤°‰ªÄ‰πàÈóÆÈ¢òÔºå‰ΩÜÊòØÊÄªÊÑüËßâËøô‰∫õsleepÁä∂ÊÄÅÁöÑthreads/connectionsÊúâ‰∫õÈóÆÈ¢òÔºå</p> <p>ÁÑ∂ÂêéÁúãÂà∞‰∫ÜËøô‰∏™</p> <p>show global status like '%aborted%';</p> <p>ÁªìÊûúÔºöAborted_clients 1095	Aborted connections 9</p> <p>Ëøô‰∏™ÊúâÁÇπÊÑèÊÄùÔºö</p> <p>Aborted_clientsÔºöThe number of connections that were aborted because the client died without closing the connection properly.</p> <p>Aborted_connectsÔºöThe number of failed attempts to connect to the MySQL server.</p> <p>ÁÑ∂ÂêéÁåúÊµãÂ¶Ç‰∏ãÔºö
Aborted_clients=1095, big number, probably means that we have some clients(app or scripts) connected to mysql, but failed to close mysql connections properly, caused lots of sleep threads/connections in mysql processlist;
at some point in time, it may reached the max connections limit;
and then some new connection request coming in, mysql then start to recycle zombies, most of the time is fine, but sometimes may delayed some seconds because of recycle taking time, caused Aborted_connects=9, small number, quite random</p> <p>Ê†πÊçÆAborted_connectsÊñáÊ°£ÊèêÁ§∫Ôºö</p> <p>For additional connection-related information, check the   <a href="https://dev.mysql.com/doc/refman/8.0/en/server-status-variables.html#statvar_Connection_errors_xxx" target="_blank" rel="noopener noreferrer"><code>Connection_errors_*</code>xxx<code>*</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>   status variables and the <a href="https://dev.mysql.com/doc/refman/8.0/en/performance-schema-host-cache-table.html" target="_blank" rel="noopener noreferrer"><code>host_cache</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> table.</p> <p>show global status like '%errors%';</p> <p>select * from performance_schema.host_cache;</p> <p>‰∏çËøáÂπ∂Ê≤°Êúâ‰ªÄ‰πàÂèëÁé∞</p> <h3 id="my-cnf-not-working"><a href="#my-cnf-not-working" class="header-anchor">#</a> my.cnf not working</h3> <div class="language- extra-class"><pre class="language-text"><code>ËÆæÁΩÆ‰∏ª‰ªéÊó∂Ôºå
change master toÂ§±Ë¥•Ôºö

ERROR 1794 (HY000): Slave is not configured or failed to initialize properly. You must at least set --server-id to enable either a master or a slave. Additional error messages can be found in the MySQL error log.

ÂàöÂºÄÂßã‰ΩøÁî®‰∫Ü  mysqld --verbose --help Êù•È™åËØÅ my.cnfÊòØÂê¶ÊúâÊïàÔºåÁúãÂà∞ËæìÂá∫Á°ÆÂÆûÊòØÂØπÁöÑ
‰ΩÜÊòØÂÆûÈôÖ‰∏äËøû‰∏äÊï∞ÊçÆÂ∫ìÂêéÊâßË°åÔºö
mysql&gt; SHOW GLOBAL VARIABLES like 'server\_id';
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| server_id     | 0     |
+---------------+-------+
1 row in set (0.00 sec)
ÂèØ‰ª•ÁúãÂà∞Âπ∂Ê≤°ÊúâÁîüÊïà

Êü•Áúã‰∫Ümy.cnf‰πüÊ≤°Êúâ‰ªÄ‰πàÂºÇÂ∏∏ÔºåÊÄÄÁñëÊòØÊùÉÈôê
#ll /etc/my.cnf
-rw-r----- 1 root root 2112 Aug  2 10:24 /etc/my.cnf
ÂèØ‰ª•ÁúãÂà∞Èô§‰∫Üroot‰πãÂ§ñÁöÑÁî®Êà∑ÈÉΩÊ≤°ÊúâËØªÂèñÊùÉÈôê,
ËôΩÁÑ∂ÂêØÂä®mysqldÂ•ΩÂÉèÊòØÈÄöËøárootÔºöservice mysqld startÔºå‰ΩÜÊòØÂÆûÈôÖ‰ΩøÁî®my.cnfÁöÑÁî®Êà∑Â∫îËØ•ÊòØÔºö
/etc/passwd
mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/false

Êõ¥ÊîπÊùÉÈôêÔºåÈáçÂêØÂç≥ÂèØ
chmod o+r /etc/my.cnf

Ë°•ÂÖÖÔºö
#service mysqld status
Redirecting to /bin/systemctl status  mysqld.service
‚óè mysqld.service - MySQL Server
   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)
   Active: active (running) since Mon 2021-08-02 15:59:34 SGT; 58min ago
     Docs: man:mysqld(8)
           http://dev.mysql.com/doc/refman/en/using-systemd.html
  Process: 15300 ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS (code=exited, status=0/SUCCESS)
  Process: 15282 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS)
 Main PID: 15303 (mysqld)
   CGroup: /system.slice/mysqld.service
           ‚îî‚îÄ15303 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid
Êü•Áúã‰∫ÜÂêØÂä®ËÑöÊú¨/usr/lib/systemd/system/mysqld.service‰πüÊ≤°ÊúâÂèëÁé∞‰ªÄ‰πàÂºÇÂ∏∏

ÊâæÂà∞ÂêØÂä®ËÑöÊú¨ /usr/lib/systemd/system/mysqld.serviceÔºö
„ÄÇ„ÄÇ„ÄÇ„ÄÇ„ÄÇ
[Service]
User=mysql
Group=mysql
„ÄÇ„ÄÇ„ÄÇ„ÄÇ
# Start main service
ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS
„ÄÇ„ÄÇ„ÄÇ„ÄÇ„ÄÇ„ÄÇ

ÂèØ‰ª•ÁúãÂà∞ÂêØÂä®mysqldÁúüÊ≠£ÁöÑÁî®Êà∑ÊòØmysql

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.eabc2ebc.js" defer></script><script src="/docs/assets/js/2.dc5756d7.js" defer></script><script src="/docs/assets/js/109.4f068233.js" defer></script>
  </body>
</html>
